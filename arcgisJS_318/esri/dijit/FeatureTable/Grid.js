// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.18/esri/copyright.txt for details.
//>>built
require({cache:{"url:esri/dijit/FeatureTable/templates/Grid.html":'\x3cdiv\x3e\r\n  \x3cdiv class\x3d"${css.borderContainer}" data-dojo-attach-point\x3d "_gridBorderContainerNode" data-dojo-type\x3d"dijit/layout/BorderContainer" gutters\x3d"false"\x3e\r\n    \x3cdiv class\x3d"${css.contentPane} ${css.menu}" data-dojo-attach-point\x3d "_gridHeaderNode" data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"region: \'top\'"\x3e\r\n      \x3cdiv class\x3d"${css.menuItem} ${css.loadingIndicator} ${css.hidden}" data-dojo-attach-point\x3d "_gridLoadingIndicatorNode"\x3e\x3c/div\x3e\r\n      \x3cdiv class\x3d"${css.menuItem} ${css.menuOptions}" data-dojo-attach-point\x3d "_menuNode" \x3e\r\n        \x3cdiv data-dojo-attach-point\x3d "_gridMenuNode"\x3e\x3c/div\x3e\r\n      \x3c/div\x3e\r\n      \x3cdiv class\x3d"${css.menuItem} ${css.title}" data-dojo-attach-point\x3d "_gridTitleNode"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n    \x3cdiv class\x3d"${css.contentPane}" data-dojo-attach-point\x3d "_gridContentPaneNode" data-dojo-type\x3d"dijit/layout/ContentPane" data-dojo-props\x3d"region: \'center\'"\x3e\r\n      \x3cdiv class\x3d"${css.grid}" data-dojo-attach-point\x3d"_gridNode"\x3e\x3c/div\x3e\r\n    \x3c/div\x3e\r\n  \x3c/div\x3e\r\n\x3c/div\x3e'}});
define("esri/dijit/FeatureTable/Grid","../../kernel ./dataUtils ./dialogUtils dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/aspect dojo/has dojo/keys dojo/on dojo/string dojo/dom-class dojo/dom-construct dojo/Deferred dijit/_TemplatedMixin dijit/_WidgetsInTemplateMixin dijit/_WidgetBase dijit/a11yclick dijit/focus dijit/Menu dijit/MenuItem dijit/Tooltip dijit/form/Button dijit/form/DateTextBox dijit/form/DropDownButton dijit/form/NumberTextBox dijit/form/Select dijit/form/TimeTextBox dijit/form/ValidationTextBox dijit/layout/BorderContainer dijit/layout/ContentPane dgrid/OnDemandGrid dgrid/Selection dgrid/selector dgrid/Keyboard dgrid/editor dgrid/extensions/Pagination dgrid/extensions/DijitRegistry dgrid/extensions/ColumnHider dgrid/extensions/ColumnResizer dojo/i18n!../../nls/jsapi dojo/text!./templates/Grid.html".split(" "),
function(O,h,G,H,e,p,I,P,y,s,x,u,r,Q,C,R,S,D,T,J,z,U,ha,K,V,E,F,W,X,ia,ja,Y,Z,$,aa,L,ba,ca,da,ea,fa,ga){C=H([S,C,R],{declaredClass:"esri.dijit.FeatureTable.Grid",baseClass:"esri-feature-table-grid",templateString:ga,map:null,layer:null,layerInfo:null,idProperty:"id",sort:null,defaultSort:null,filterIds:null,where:null,batchCount:50,editable:!1,editOn:"dblclick, keypress",css:null,showAttachments:!1,showRelatedRecords:!1,showCyclicalRelationships:!1,showStatistics:!1,showFieldDetails:!1,showGridHeader:!0,
showGridMenu:!0,showFilterMenuItems:!0,showFeatureCount:!0,showDataTypes:!1,showColumnHeaderTooltips:!1,showColumnHider:!1,syncSelection:!1,menuFunctions:null,gridOptions:null,dateOptions:null,visibleLayerIds:null,loaded:!1,store:null,columns:null,fieldInfos:null,customFieldInfos:null,noDataMessage:"",featureCount:0,selectedFeatureCount:0,selectedRows:null,selectedRowIds:null,optionsMenu:null,optionsMenuAnchor:null,columnMenu:null,rollbackInfos:null,attachmentInfos:null,relatedRecordInfos:null,relatedRecordCounts:null,
_i18nStrings:fa.widgets.FeatureTable,_numericFieldTypes:["esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble","esriFieldTypeSmallInteger"],_unsupportedFieldTypes:["esriFieldTypeGUID","esriFieldTypeRaster","esriFieldTypeBlob","esriFieldTypeGeometry","esriFieldTypeXML"],_activeEditors:null,_relationshipColumnLimit:5,_nullConstant:"ft_null",_watchers:null,_columnHiderButton:null,postMixInProperties:function(){this.inherited(arguments);this.set({sort:{},columns:[],fieldInfos:[],selectedRows:[],
selectedRowIds:[],rollbackInfos:{},attachmentInfos:{},relatedRecordInfos:{},relatedRecordCounts:{},_watchers:[]})},startup:function(){this.inherited(arguments);this.dGrid=this._createGrid();this._cleanUpGrid();this.dGrid.startup();this.dGrid.resize();this.showLoadingIndicator();this.updateHeaderText();this.showGridHeader||this.hideHeader();this._generateOptionsMenu();this.showGridMenu||this.hideOptionsMenu();this._generateColumnHiderButton();this.showColumnHider||this.hideColumnHiderButton();this._addGridListeners()},
destroy:function(){this.inherited(arguments);this.optionsMenu&&this.optionsMenu.destroy();this.columnMenu&&this.columnMenu.destroyRecursive();p.forEach(this._watchers,function(a){a.remove()})},resize:function(){this._gridBorderContainerNode.resize();this._gridHeaderNode.resize();this._gridContentPaneNode.resize();this.dGrid&&this.dGrid.resize()},setHeaderTitle:function(a){this._gridTitleNode.innerHTML=a},showHeader:function(){u.remove(this._gridHeaderNode.domNode,this.css.hidden);this.resize()},hideHeader:function(){u.add(this._gridHeaderNode.domNode,
this.css.hidden);this.resize()},showLoadingIndicator:function(){this._gridLoadingIndicatorNode&&u.remove(this._gridLoadingIndicatorNode,this.css.hidden)},hideLoadingIndicator:function(){this._gridLoadingIndicatorNode&&u.add(this._gridLoadingIndicatorNode,this.css.hidden)},showOptionsMenu:function(){this._menuNode&&u.remove(this._menuNode,this.css.hidden)},hideOptionsMenu:function(){this._menuNode&&u.add(this._menuNode,this.css.hidden)},updateNoDataMessage:function(a){this.dGrid.set("noDataMessage",
a)},showColumnHiderMenu:function(){this.gridOptions.columnHider&&this.dGrid._toggleColumnHiderMenu()},showColumnHiderButton:function(){this._columnHiderButton&&u.remove(this._columnHiderButton,this.css.hidden)},hideColumnHiderButton:function(){this._columnHiderButton&&u.add(this._columnHiderButton,this.css.hidden)},refresh:function(){this.dGrid&&this.dGrid.refresh();this._updateSelection().then(e.hitch(this,this.updateHeaderText))},getRowById:function(a){return this.dGrid.row(a)||{}},getRowDataById:function(a){return(a=
this.getRowById(a))&&a.data?a.data:{}},emptyStore:function(){this.updateNoDataMessage("");this.updateStore(null)},updateStore:function(a){this.set("store",a);this.dGrid.set("store",a)},updateSort:function(a){this.set("sort",a[0]);this.dGrid.set("sort",a)},updateSelectionMode:function(a){this.dGrid.set("selectionMode",a)},getColumns:function(){return this.dGrid.columns},styleColumn:function(a,b){return this.dGrid.styleColumn(a,b)},clearSelection:function(){this.dGrid.clearSelection();this._updateSelection().then(e.hitch(this,
this.updateHeaderText));this.emit("clear-selection")},centerOnSelection:function(){var a=this.map,b=this.layer,d=this.selectedRowIds;if(a&&d&&0!==d.length)return h.queryLayerForFeatures({layer:b,ids:d}).then(e.hitch(function(b){(b=b.features)&&0<b.length&&a.setExtent(h.calculateExtentFromFeatures(b))}))},selectRows:function(a,b,d){var c=this.dGrid,f=[],g;this._closeCellEditors();this.clearSelection();a instanceof Array?(p.forEach(a,function(a){c._select(a);f.push(this.getRowById(a))},this),g=a[0]):
(c._select(a),g=a,f=[this.getRowById(a)]);this._updateSelection().then(e.hitch(this,function(){this.updateHeaderText();d||this.emit("row-select",{rows:f,grid:this.dGrid});b&&this._scrollToRow(g)}))},_createGrid:function(){return new (this._generateGridClass())({columns:this.columns,sort:[this.defaultSort],noDataMessage:this.noDataMessage,selectionMode:this.gridOptions.selectionMode,allowSelectAll:this.gridOptions.allowSelectAll,allowTextSelection:this.gridOptions.allowTextSelection,cellNavigation:this.gridOptions.cellNavigation,
keepScrollPosition:this.gridOptions.keepScrollPosition,pageSizeOptions:this.gridOptions.pageSizeOptions,queryRowsOverlap:this.gridOptions.queryRowsOverlap,minRowsPerPage:this.batchCount,maxRowsPerPage:this.batchCount,pagingDelay:this.pagingDelay,query:e.hitch(this,this._getQueryForGrid)},this._gridNode)},_generateGridClass:function(){var a=[ca,Y,Z,L,$,aa];this.gridOptions.pagination&&a.push(ba);this.gridOptions.columnHider&&a.push(da);this.gridOptions.columnResizer&&a.push(ea);return H(a)},_getQueryForGrid:function(a){return!this.filterIds||
-1!==p.indexOf(this.filterIds,a[this.idProperty])},_cleanUpGrid:function(){var a=this.dGrid,b=I.before(a,"removeRow",e.hitch(this,function(b){p.forEach(this.columns.length,function(d,g){var e=a.cell(b,g).element;(e=(e.contents||e).widget)&&e.destroyRecursive()})})),d=I.after(a,"renderHeader",function(){a._sortListener.remove()});this._watchers.push(b,d)},_setUpColumns:function(a){a=this._generateFieldInfos(a);var b=this._generateColumns(a);this.set({columns:b,fieldInfos:a});this.dGrid.set("columns",
b);return{fieldInfos:a,columns:b}},_generateFieldInfos:function(a){if(a&&0!==a.length&&this.layerInfo){a=this._orderFieldsForDisplay(a);var b=this.layer,d=this.layerInfo,c=this.idProperty,f=[],g=this.customFieldInfos,e=this.outFields,k=this.hiddenFields,l,n,q,B,r,t,M,s,u,N,y,x,A,v;p.forEach(a,function(a){q=a.length||null;A=h.findFirst(b.fields,"name",a.name)||{};l=(v=h.findFirst(g,"name",a.name)||h.findFirst(g,"fieldName",a.name))&&(v.label||v.alias)||A.alias;r=b.getDomain(a.name)||!1;B=!!(d.typeIdField&&
a.name===d.typeIdField);t=d.types&&p.some(d.types,function(b){if(b.domains&&b.domains[a.name]&&b.domains[a.name].name)return!0});M=-1!==p.indexOf(k,a.name)||"esriFieldTypeOID"===a.type||"esriFieldTypeGlobalID"===a.type||v&&!1===v.visible||"*"!==e[0]&&-1===p.indexOf(e,a.name);y=d.editable&&d.editCapabilities.canUpdate;x=v&&("undefined"!==typeof v.editable&&!1!==A.editable||"undefined"!==typeof v.isEditable&&!1!==A.isEditable);s=y&&a.name!==c&&A&&"undefined"!==A.editable?x?!!v.editable||!!v.isEditable:
!!A.editable:!1;n=v&&v.format?v.format:null;u=!!A.nullable;N=v&&(v.dateOptions||v.format&&v.format.dateFormat)||null;f.push({name:a.name,alias:l,length:q,type:a.type,hidden:M,editable:s,nullable:u,domain:r,typeId:B,subtypeDomain:t,format:n,dateOptions:N})},this);this.showRelatedRecords&&this._generateRelatedRecordFieldInfos({fieldInfos:f,relationships:b.relationships});this.showAttachments&&f.push({alias:this._i18nStrings.photosAndFiles,name:"esriAttachments",type:"esriAttachments",editable:d.editable});
return f}},_destroyColumns:function(){this.dGrid&&this.dGrid._destroyColumns()},_applyEdits:function(a){var b=a.row,d=a.rollbackInfo;this.showLoadingIndicator();d&&this._updateRollbackInfos(d);return h.applyEditsFromRow({layer:this.layer,idProperty:this.idProperty,row:b}).then(function(){}).otherwise(e.hitch(this,function(){d&&(b=this.getRowDataById(d.rowId),b[d.fieldName]=d.oldValue,this.dGrid.updateDirty(d.rowId,d.fieldName,d.oldValue),this.refresh());this.hideLoadingIndicator();this.emit("error",
{message:this._i18nStrings.errorUpdateFailed})}))},_updateRollbackInfos:function(a){if(a){var b=a.rowId;this.rollbackInfos[b]||(this.rollbackInfos[b]=[]);this.rollbackInfos[b].push(a)}},_updateSelection:function(){var a=this.dGrid.selection,b=new Q,d=[],c=[],f,g;for(g in a)a.hasOwnProperty(g)&&(f=parseInt(g,10),c.push(f),f=this.dGrid.row(f),(f=f.data)&&d.push(f));a={selectedRows:d,selectedRowIds:c,selectedFeatureCount:c.length};this.set(a);b.resolve(a);return b},_scrollToRow:function(a){var b=this.store,
d=this.dGrid,c=d.row(a),f=this.sort;if(c)if(c.element)c.element.scrollIntoView();else if(a=b.data[a]||c.data)b=f&&f.attribute===this.idProperty&&f.descending?b.data.length-p.indexOf(b.data,a):p.indexOf(b.data,a),b=d.rowHeight*b-d.rowHeight,d.scrollTo({x:0,y:b}),c.element?c.element.scrollIntoView():setTimeout(function(){c.element&&c.element.scrollIntoView()},200)},_generateColumns:function(a){a=e.clone(a)||[];var b=[];p.forEach(a,function(a){"esriAttachments"===a.type?b.push(this._generateAttachmentsColumn(a)):
"esriRelatedRecords"===a.type?b.push(this._generateRelatedRecordsColumn(a)):"esriFieldTypeDate"===a.type?this.dateOptions.timeEnabled?b.push(this._generateDateTimeColumn(a)):b.push(this._generateDateColumn(a)):a.typeId?b.push(this._generateTypeColumn(a)):a.domain?b.push(this._generateDomainColumn(a)):a.subtypeDomain&&!a.typeId?b.push(this._generateSubtypeDomainColumn(a)):-1<p.indexOf(this._numericFieldTypes,a.type)?b.push(this._generateNumberColumn(a)):-1===p.indexOf(this._unsupportedFieldTypes,a.type)&&
b.push(this._generateStringColumn(a))},this);return b},_orderFieldsForDisplay:function(a){var b=this.outFields,d=this.idProperty,c=[];b&&"*"===b[0]?c=e.clone(a):(-1===p.indexOf(b,d)&&c.push(h.findFirst(a,"name",d)),p.forEach(b,function(b){var g=h.findFirst(a,"name",b)||null;g&&(b.name!==d&&-1===p.indexOf(c,g))&&c.push(g)}),p.forEach(a,function(a){-1===p.indexOf(c,a)&&c.push(e.clone(a))}));return c},_generateDateColumn:function(a){var b=a.dateOptions||this.dateOptions;return new L({label:a.alias,field:a.name,
type:a.type,editorArgs:{required:!a.nullable,constraints:{datePattern:a.dateOptions&&a.dateOptions.datePattern?a.dateOptions.datePattern:this.dateOptions.datePattern}},editOn:this.editOn,hidden:a.hidden,formatter:function(d){return!h.isValueEmpty(d)?h.formatDateForLocale({dateOptions:b,timestamp:d,fieldInfo:a}):null},get:function(b){return!h.isValueEmpty(b[a.name])?new Date(b[a.name]):null},renderHeaderCell:e.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a})})},K)},_generateDateTimeColumn:function(a){var b=
a.dateOptions||this.dateOptions;return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:e.hitch(this,function(d){return!h.isValueEmpty(d[a.name])?h.formatDateForLocale({dateOptions:b,timestamp:new Date(d[a.name]),fieldInfo:a}):null}),renderCell:e.hitch(this,function(b,c,f){c=r.create("div",{innerHTML:!h.isValueEmpty(c)?c:""},f);this._setUpDateTimeCell({row:b,cellNode:f,fieldInfo:a,container:c})}),renderHeaderCell:e.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a})})}},
_generateDomainColumn:function(a){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:function(b){return h.getDomainValueFromRow({fieldInfo:a,row:b})},renderHeaderCell:e.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a})}),renderCell:e.hitch(this,function(b,d,c){var f=r.create("div");if(a.domain.codedValues)d=this._formatStringCellContent({fieldInfo:a,value:d}),this._setUpCodedValueDomainCell({row:b,cellNode:c,fieldInfo:a,container:f});else if("range"===a.domain.type)d=
this._formatNumberCellContent({fieldInfo:a,value:d}),this._setUpRangeDomainCell({row:b,cellNode:c,fieldInfo:a,container:f});else{this.emit("error",{message:this._i18nStrings.errorDomainType});return}f.innerHTML=d;r.place(f,c)})}},_generateTypeColumn:function(a){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,get:e.hitch(this,function(b){return h.getTypeValueFromRow({layerInfo:this.layerInfo,fieldInfo:a,row:b})}),renderCell:e.hitch(this,function(b,d,c){d=this._formatStringCellContent({fieldInfo:a,
value:d});d=r.create("div",{innerHTML:d},c);this._setUpTypeCell({row:b,cellNode:c,fieldInfo:a,container:d})}),renderHeaderCell:e.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a})})}},_generateSubtypeDomainColumn:function(a){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,editOn:this.editOn,editor:"text",get:e.hitch(this,function(b){return h.getSubtypeDomainValue({layerInfo:this.layerInfo,fieldInfo:a,row:b})}),renderHeaderCell:e.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a})}),
renderCell:e.hitch(this,function(b,d,c){d=this._formatStringCellContent({fieldInfo:a,value:d});d=r.create("div",{innerHTML:d},c);this._setUpSubtypeDomainCell({row:b,cellNode:c,fieldInfo:a,container:d})})}},_generateNumberColumn:function(a){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,renderHeaderCell:e.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a})}),renderCell:e.hitch(this,function(b,d,c){d=this._formatNumberCellContent({fieldInfo:a,value:d});d=r.create("div",
{innerHTML:d},c);this._setUpNumberCell({row:b,cellNode:c,fieldInfo:a,container:d})})}},_generateStringColumn:function(a){return{label:a.alias,field:a.name,type:a.type,hidden:a.hidden,renderHeaderCell:e.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a})}),renderCell:e.hitch(this,function(b,d,c){d=this._formatStringCellContent({fieldInfo:a,value:d});d=r.create("div",{innerHTML:d},c);this._setUpStringCell({row:b,cellNode:c,fieldInfo:a,container:d})})}},_generateAttachmentsColumn:function(a){var b=
this.layerInfo||{};return{label:a.alias,field:a.name,type:"esriAttachments",get:e.hitch(this,function(a){a=this.attachmentInfos[a[this.idProperty]];var c;c=b.queryAttachmentsSupported?0:null;return a&&a.attachments?a.attachments.length:c}),renderCell:e.hitch(this,function(b,c,f){this._generateAttachmentsCell({row:b,fieldInfo:a,cellValue:c,cellNode:f})}),renderHeaderCell:e.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a,cssClass:this.css.attachmentsTitle})})}},_generateRelatedRecordsColumn:function(a){return{label:a.alias,
field:a.name,type:"esriRelatedRecords",hidden:a.hidden,get:e.hitch(this,function(b){return this._getRelatedRecordsCount({featureId:b[this.idProperty],relationshipId:a.relationship.id})}),renderCell:e.hitch(this,function(b,d,c){this._generateRelatedRecordsCell({row:b,fieldInfo:a,cellValue:d,cellNode:c})}),renderHeaderCell:e.hitch(this,function(){return this._getColumnHeaderCellContent({fieldInfo:a,cssClass:this.css.relatedRecordsTitle})})}},_closeCellEditors:function(){p.forEach(this._activeEditors,
function(a){a.widget.onBlur()});this.set("_activeEditors",[])},_getColumnHeaderCellContent:function(a){var b=a.fieldInfo,d=a.cssClass||null;a=this.css;var c=a.lockedIconContainer+" "+a.lockedIcon,f="esriRelatedRecords"===b.type||"esriAttachments"===b.type,g;g=r.create("div",{className:a.columnHeader});d=d?a.columnHeaderTitle+" "+d:a.columnHeaderTitle;!b.editable&&(this.editable&&this.layerInfo.editable)&&r.create("span",{className:c},g);r.create("div",{innerHTML:b.alias||b.name,className:d},g);r.create("div",
{className:a.columnHeaderClear},g);this.showColumnHeaderTooltips&&this.own(new U({connectId:[g],label:b.alias||b.name}));this.showDataTypes&&!f&&(r.create("div",{innerHTML:b.type.replace("esriFieldType",""),className:a.columnHeaderType},g),r.create("div",{className:a.columnHeaderClear},g));return g},_setUpNumberCell:function(a){var b=a.row,d=a.cellNode,c=a.fieldInfo,f=a.container,g=this.idProperty,m=h.isIntegerFieldType(c.type)?0:"0,20",k,l;s(d,this.editOn,e.hitch(this,function(){this.editable&&c.editable&&
(l&&l.destroy(),this._closeCellEditors(),f.innerHTML="",l=new E({value:b[c.name],required:!c.nullable,constraints:{places:m}}),l.placeAt(f),l.focus(),l.textbox.select(),this.emit("editor-show",{cell:d,editor:l,grid:this}),l.on("blur",e.hitch(this,function(){f.innerHTML=this._formatNumberCellContent({fieldInfo:c,value:b[c.name]});d.focus()})),l.on("keydown",function(a){a.keyCode===y.ENTER&&l.isValid()&&l.focusNode.blur()}),l.on("change",e.hitch(this,function(a){k={fieldName:c.name,oldValue:b[c.name],
rowId:b[g],row:b};if(""===a||isNaN(a))a=null;l.isValid()?(b[c.name]=a,f.innerHTML=this._formatNumberCellContent({fieldInfo:c,value:a}),this._applyEdits({row:b,rollbackInfo:k})):f.innerHTML=this._formatNumberCellContent({fieldInfo:c,value:b[c.name]});this.emit("editor-hide",{cell:d,editor:l,grid:this});l.destroy()})),this._activeEditors.push({id:b[g],widget:l}))}))},_setUpDateTimeCell:function(a){var b=a.row,d=a.fieldInfo,c=a.container,f=this.idProperty,g,m,k,l,n,q,B;s(a.cellNode,this.editOn,e.hitch(this,
function(){if(this.editable&&d.editable){m&&m.destroy();k&&k.destroy();this._closeCellEditors();c.innerHTML="";l=d.dateOptions&&d.dateOptions.datePattern?d.dateOptions.datePattern:this.dateOptions.datePattern;n=d.dateOptions&&d.dateOptions.timePattern?d.dateOptions.timePattern:this.dateOptions.timePattern;g=!h.isValueEmpty(b[d.name])?new Date(b[d.name]):null;m=new K({value:g,constraints:{datePattern:l}});k=new W({value:g,constraints:{timePattern:n}});m.placeAt(c);k.placeAt(c);m.focus();m.textbox.select();
m.on("change",e.hitch(this,function(a){if(m.isValid()){var c=k.getValue();B={fieldName:d.name,oldValue:b[d.name],rowId:b[f],row:b};null===a||""===a?(k.setValue(null),b[d.name]=null):(null===c&&(c=new Date(0,0),k.setValue(c)),q=h.getCombinedDateTime(a,c).getTime(),b[d.name]=q,this._applyEdits({row:b,rollbackInfo:B}))}}));k.on("change",e.hitch(this,function(a){if(k.isValid()){var c=m.getValue();B={fieldName:d.name,oldValue:b[d.name],rowId:b[f],row:b};null===a||""===a?(m.setValue(null),b[d.name]=null):
(null===c&&(c=new Date(0,0),m.setValue(c)),q=h.getCombinedDateTime(c,a).getTime(),b[d.name]=q,this._applyEdits({row:b,rollbackInfo:B}))}}));var a=T.watch("activeStack",e.hitch(this,function(g,e,l){if((-1!==p.indexOf(e,m.id)||-1!==p.indexOf(e,k.id))&&-1===p.indexOf(l,m.id)&&-1===p.indexOf(l,k.id))a.remove(),e=m.getValue(),l=k.getValue(),g={fieldName:d.name,oldValue:b[d.name],rowId:b[f],row:b},k.isValid()&&m.isValid()?(e&&l?(e=h.getCombinedDateTime(e,l).getTime(),c.innerHTML=h.formatDateForLocale({dateOptions:this.dateOptions,
timestamp:new Date(e),fieldInfo:d})):(e=null,c.innerHTML=""),b[d.name]=e,this._applyEdits({row:b,rollbackInfo:g})):c.innerHTML=h.formatDateForLocale({dateOptions:this.dateOptions,timestamp:b[d.name],fieldInfo:d})}))}}))},_setUpCodedValueDomainCell:function(a){var b=a.row,d=a.cellNode,c=a.fieldInfo,f=a.container,g=this.idProperty,m=[],k,l,n;p.forEach(c.domain.codedValues,function(a){b[c.name]===a.code?m.push({label:a.name,value:a.code,selected:!0}):m.push({label:a.name,value:a.code})});h.isValueEmpty(b[c.name])&&
c.nullable?m.push({label:this._i18nStrings.empty,value:this._nullConstant,selected:!0}):h.isValueEmpty(b[c.name])&&!c.nullable?m.push({label:this._i18nStrings.empty,value:this._nullConstant,selected:!0,disabled:!0}):c.nullable&&m.push({label:this._i18nStrings.empty,value:this._nullConstant});s(d,this.editOn,e.hitch(this,function(){this.editable&&c.editable&&(n&&n.destroy(),this._closeCellEditors(),f.innerHTML="",n=new F({options:m,"class":this.css.select,style:{width:"100%"}}),n.placeAt(f),n.focus(),
this.emit("editor-show",{cell:d,editor:n,grid:this}),n.on("blur",e.hitch(this,function(){var a=h.getDomainValueFromRow({fieldInfo:c,row:b});f.innerHTML=this._formatStringCellContent({fieldInfo:c,value:a})})),n.on("keydown",function(a){a.keyCode===y.ENTER&&n.focusNode.blur()}),n.on("change",e.hitch(this,function(a){l={fieldName:c.name,oldValue:b[c.name],rowId:b[g],row:b};a===this._nullConstant&&(a=null);b[c.name]=a;k=h.getDomainValueFromRow({fieldInfo:c,row:b});f.innerHTML=this._formatStringCellContent({fieldInfo:c,
value:k});this._applyEdits({row:b,rollbackInfo:l});this.emit("editor-hide",{cell:d,editor:n,grid:this});n.destroy()})),this._activeEditors.push({id:b[g],widget:n}))}))},_setUpRangeDomainCell:function(a){var b=a.row,d=a.cellNode,c=a.fieldInfo,f=a.container,g=c.domain.minValue,m=c.domain.maxValue,k=this.idProperty,l=h.isIntegerFieldType(c.type)?0:"0,20",n,p;s(d,this.editOn,e.hitch(this,function(){this.editable&&c.editable&&(n&&n.destroy(),this._closeCellEditors(),f.innerHTML="",n=new E({value:b[c.name],
required:!c.nullable,constraints:{min:g,max:m,places:l}}),n.placeAt(f),n.focus(),n.textbox.select(),this.emit("editor-show",{cell:d,editor:n,grid:this}),n.on("blur",e.hitch(this,function(){f.innerHTML=this._formatNumberCellContent({fieldInfo:c,value:b[c.name]})})),n.on("keydown",function(a){a.keyCode===y.ENTER&&n.isValid()&&n.focusNode.blur()}),n.on("change",e.hitch(this,function(a){p={fieldName:c.name,oldValue:b[c.name],rowId:b[k],row:b};n.isValid()?(b[c.name]=a,f.innerHTML=this._formatNumberCellContent({fieldInfo:c,
value:a}),this._applyEdits({row:b,rollbackInfo:p})):f.innerHTML=this._formatNumberCellContent({fieldInfo:c,value:b[c.name]});this.emit("editor-hide",{cell:d,editor:n,grid:this});n.destroy()})),this._activeEditors.push({id:b[k],widget:n}))}))},_setUpTypeCell:function(a){var b=a.row,d=a.cellNode,c=a.fieldInfo,f=a.container,g=this.idProperty,m=this.layerInfo,k=[],l,n,q;p.forEach(m.types,function(a){b[c.name]===a.id?k.push({label:a.name,value:a.id,selected:!0}):k.push({label:a.name,value:a.id})});h.isValueEmpty(b[c.name])&&
k.push({label:this._i18nStrings.empty,value:this._nullConstant,selected:!0,disabled:!0});s(d,this.editOn,e.hitch(this,function(){this.editable&&c.editable&&(q&&q.destroy(),this._closeCellEditors(),f.innerHTML="",q=new F({options:k,"class":this.css.select,style:{width:"100%"}}),q.placeAt(f),q.focus(),this.emit("editor-show",{cell:d,editor:q,grid:this}),q.on("blur",e.hitch(this,function(){var a=h.getTypeValueFromRow({layerInfo:m,fieldInfo:c,row:b});f.innerHTML=this._formatStringCellContent({fieldInfo:c,
value:a})})),q.on("keydown",function(a){a.keyCode===y.ENTER&&q.focusNode.blur()}),q.on("change",e.hitch(this,function(a){n={fieldName:c.name,oldValue:b[c.name],rowId:b[g],row:b};a===this._nullConstant&&(a=null);b[c.name]=a;l=h.getTypeValueFromRow({layerInfo:this.layerInfo,fieldInfo:c,row:b});f.innerHTML=this._formatStringCellContent({fieldInfo:c,value:l});this._applyEdits({row:b,rollbackInfo:n});this.emit("editor-hide",{cell:d,editor:q,grid:this.grid});q.destroy()})),this._activeEditors.push({id:b[g],
widget:q}))}))},_setUpSubtypeDomainCell:function(a){var b=a.row,d=a.cellNode,c=a.fieldInfo,f=a.container,g=this.idProperty,m=this.layerInfo,k=m.types,l,n,q,r,w,t,u,x,z;s(d,this.editOn,e.hitch(this,function(){this.editable&&c.editable&&(w&&w.destroy(),t&&t.destroy(),this._closeCellEditors(),l=[],f.innerHTML="",n=h.findFirst(k,"id",b[m.typeIdField]),(q=n.domains[c.name])?(u=n.domains[c.name].codedValues,x=h.findFirst(u,"code",b[c.name]),p.forEach(u,function(a){b[c.name]===a.code?l.push({label:a.name,
value:a.code,selected:!0}):l.push({label:a.name,value:a.code});a.code===x&&(z=!0)}),h.isValueEmpty(b[c.name])&&c.nullable?l.push({label:this._i18nStrings.empty,value:this._nullConstant,selected:!0}):h.isValueEmpty(b[c.name])&&!c.nullable?l.push({label:this._i18nStrings.empty,value:this._nullConstant,selected:!0,disabled:!0}):c.nullable&&l.push({label:this._i18nStrings.empty,value:this._nullConstant}),!z&&(!x&&null!==b[c.name])&&l.push({label:b[c.name],value:"N/A",selected:!0,disabled:!0}),w=new F({options:l,
"class":this.css.select,style:{width:"100%"}}),w.placeAt(f),w.focus(),this.emit("editor-show",{cell:d,editor:w,grid:this}),w.on("blur",e.hitch(this,function(){var a=h.findFirst(u,"code",b[c.name]);f.innerHTML=a?this._formatStringCellContent({fieldInfo:c,value:a.name}):this._formatStringCellContent({fieldInfo:c,value:b[c.name]})})),w.on("keydown",function(a){a.keyCode===y.ENTER&&w.focusNode.blur()}),w.on("change",e.hitch(this,function(a){r={fieldName:c.name,oldValue:b[c.name],rowId:b[g],row:b};a===
this._nullConstant&&(a=null);b[c.name]=a;a=h.findFirst(u,"code",a);f.innerHTML=a?this._formatStringCellContent({fieldInfo:c,value:a.name}):"";this.emit("editor-hide",{cell:d,editor:w,grid:this});w.destroy();this._applyEdits({row:b,rollbackInfo:r})})),this._activeEditors.push({id:b[g],widget:w})):(t=new E({value:b[c.name],required:!c.nullable}),t.placeAt(f),t.focus(),t.textbox.select(),this.emit("editor-show",{cell:d,editor:t,grid:this}),t.on("blur",e.hitch(this,function(){f.innerHTML=b[c.name]})),
t.on("keydown",function(a){a.keyCode===y.ENTER&&t.isValid()&&t.focusNode.blur()}),t.on("change",e.hitch(this,function(a){r={fieldName:c.name,oldValue:b[c.name],rowId:b[g],row:b};t.isValid()?(b[c.name]=a,f.innerHTML=a,this._applyEdits({row:b,rollbackInfo:r})):f.innerHTML=b[c.name]})),this._activeEditors.push({id:b[g],widget:t}),t.destroy()))}))},_setUpStringCell:function(a){var b=a.row,d=a.cellNode,c=a.fieldInfo,f=a.container,g=this.idProperty,h,k;s(d,this.editOn,e.hitch(this,function(){this.editable&&
c.editable&&(k&&k.destroy(),this._closeCellEditors(),f.innerHTML="",k=new X({value:b[c.name],required:!c.nullable,maxLength:c.length?c.length:null}),k.placeAt(f),k.focus(),k.textbox.select(),this.emit("editor-show",{cell:d,editor:k,grid:this}),k.on("blur",e.hitch(this,function(){f.innerHTML=this._formatStringCellContent({fieldInfo:c,value:b[c.name]});d.focus()})),k.on("keydown",function(a){a.keyCode===y.ENTER&&k.isValid()&&k.focusNode.blur()}),k.on("change",e.hitch(this,function(a){h={fieldName:c.name,
oldValue:b[c.name],rowId:b[g],row:b};""===a&&(a=null);k.isValid()?(b[c.name]=a,f.innerHTML=this._formatStringCellContent({fieldInfo:c,value:a}),this._applyEdits({row:b,rollbackInfo:h})):f.innerHTML=this._formatStringCellContent({fieldInfo:c,value:b[c.name]})})),this._activeEditors.push({id:b[g],widget:k}))}))},_formatStringCellContent:function(a){var b=a.value;return(a=(a=a.fieldInfo)?a.format:null)&&(a.embeddedHTML||!1===a.link)?h.isValueEmpty(b)?"":b:a&&a.template?h.isValueEmpty(b)?"":x.substitute(a.template,
{value:b}):h.generateLinkFromString(b)},_formatNumberCellContent:function(a){var b=a.value,d=(a=a.fieldInfo.format)?a.template:null;return a&&d&&null!==b?x.substitute(d,{value:h.formatNumberForLocale(b)}):null===b?"":h.formatNumberForLocale(b)},_generateAttachmentsCell:function(a){if(this.layerInfo){var b=a.row,d=a.cellValue,c=a.cellNode,f=a.fieldInfo;a=this.layerInfo;var g=this.css,m=this._i18nStrings,k,l;l=!h.isValueEmpty(d)?x.substitute(m.parenValue,{value:d}):"";k=r.create("div",{innerHTML:l,
className:g.attachmentsCell},c);r.create("span",{innerHTML:0<d||!a.queryAttachmentsSupported?" "+m.show:this.editable&&a.editable?" "+m.add:"",className:g.attachmentsLink},k);s(k,D,e.hitch(this,function(){this._showAttachmentsHandler({row:b,fieldInfo:f,cellValue:d,cellNode:c,textContainer:k})}))}},_generateRelatedRecordsCell:function(a){var b=a.row,d=a.cellValue,c=a.cellNode,f=a.fieldInfo;a=this.css;var g=this._i18nStrings,m;m=!h.isValueEmpty(d)?x.substitute(g.parenValue,{value:d})+" ":"";m=r.create("div",
{innerHTML:m,className:a.relatedRecordsCell},c);r.create("span",{innerHTML:0<d?g.show:"",className:a.relatedRecordsLink},m);s(c,D,e.hitch(this,function(a){0<d&&(a=this.dGrid.cell(a).column,this._showRelatedRecordsHandler({row:b,fieldInfo:f,column:a,count:d}))}))},updateHeaderText:function(a,b){var d=!isNaN(a)||this.featureCount,c=!isNaN(b)||this.selectedFeatureCount,f=this.filterIds&&0<this.filterIds.length;this.showFeatureCount?this.setHeaderTitle(x.substitute(this._i18nStrings.gridHeader,{gridTitle:this.layer.name||
this._i18nStrings.untitled,featureCount:f?this.filterIds.length:d,featureSelectedCount:c})):this.setHeaderTitle(this.layer.name||this._i18nStrings.untitled)},_generateOptionsMenu:function(){var a=[{label:this._i18nStrings.defaultSort,callback:this._sortFieldDefaultCallback}],b,d,c;b=new J({className:this.css.optionsMenu});this.showFilterMenuItems?a.push({label:this._i18nStrings.showSelected,callback:this._showSelectedRecordsCallback},{label:this._i18nStrings.clearSelection,callback:this._clearFilterCallback}):
a.push({label:this._i18nStrings.clearSelection,callback:this.clearSelection});this.gridOptions.columnHider&&a.push({label:this._i18nStrings.toggleColumns,callback:this.showColumnToggleMenu});this.map&&this.syncSelection&&a.push({label:this._i18nStrings.centerOnSelection,callback:this.centerOnSelection});this.menuFunctions&&0<this.menuFunctions.length&&p.forEach(this.menuFunctions,function(b){a.push({label:b.label,callback:b.callback})},this);p.forEach(a,function(a){d=new z({label:a.label,baseClass:this.css.menuItem,
onClick:e.hitch(this,a.callback)});b.addChild(d)},this);c=new V({label:this._i18nStrings.options,dropDown:b},this._gridMenuNode);this.set({optionsMenu:b,optionsMenuAnchor:c})},_sortFieldDefaultCallback:function(){var a=this.defaultSort.attribute,b=this.defaultSort.descending;this.set("sort",{field:a,descending:b});this.emit("sort",{field:a,descending:b,orderByFields:[h.getOrderByString(a,b)]})},_showSelectedRecordsCallback:function(){0!==this.selectedRowIds.length&&this.emit("show-selected-records",
{ids:this.selectedRowIds})},_clearFilterCallback:function(){this.emit("clear-selection");this.emit("clear-filter")},showColumnToggleMenu:function(){this.dGrid._toggleColumnHiderMenu()},_generateColumnMenu:function(a){var b=this.dGrid.cell(a),d=b?b.column:null;if(d){var c=this.columnMenu,f=c,d=d.id,e=this.dGrid.columns[d],m=h.findFirst(this.fieldInfos,"name",e.field),k="esriRelatedRecords"===e.type||"esriAttachments"===e.type;c&&this.set("columnMenu",null);!k&&!1!==e.sortable&&(c=new J,this._generateSortMenuItems({menu:c,
columnId:d}),this._generateStatisticsMenuItem({menu:c,fieldInfo:m,columnId:d}),this._generateFieldDetailsMenuItem({menu:c,fieldInfo:m,column:e}),c.startup(),e=b.element.getBoundingClientRect(),d=e.right-e.width,e=e.top+e.height,c._openMyself({target:a.target,delegatedTarget:b,iframe:null,coords:{x:d,y:e}}),s(c,"close",function(){f&&(f.destroyRecursive(),f=null)}),this.set("columnMenu",c))}},_generateSortMenuItems:function(a){var b=a.menu;a=a.columnId;var d=this.css;b.addChild(new z({label:this._i18nStrings.sortAsc,
iconClass:d.sortAscendingIcon,baseClass:d.menuItem,onClick:e.hitch(this,this._sortFieldAscendingHandler,a)}));b.addChild(new z({label:this._i18nStrings.sortDesc,iconClass:d.sortDescendingIcon,baseClass:d.menuItem,onClick:e.hitch(this,this._sortFieldDescendingHandler,a)}))},_sortFieldAscendingHandler:function(a){var b=this.dGrid.columns[a];this.emit("sort",{column:b,id:a,field:b.field,descending:!1,orderByFields:[h.getOrderByString(b.field,!1)]})},_sortFieldDescendingHandler:function(a){var b=this.dGrid.columns[a];
this.emit("sort",{column:b,id:a,field:b.field,descending:!0,orderByFields:[h.getOrderByString(b.field,!0)]})},_generateStatisticsMenuItem:function(a){var b=a.menu,d=a.fieldInfo,c=this.css,f=this.layer,f=f.advancedQueryCapabilities.supportsStatistics||f.supportsStatistics;this.showStatistics&&f&&d&&!d.domain&&h.isNumericFieldType(d.type)&&b.addChild(new z({label:this._i18nStrings.statistics,iconClass:c.statisticsIcon,baseClass:c.menuItem,onClick:e.hitch(this,this._showStatisticsHandler,a)}))},_generateFieldDetailsMenuItem:function(a){if(this.showFieldDetails){var b=
a.menu,d=a.fieldInfo,c=parseInt(a.column.id,10);a=this.css;"esriFieldTypeOID"!==d.type&&("esriFieldTypeGlobalID"!==d.type&&-1===p.indexOf(this._unsupportedFieldTypes,d.type))&&b.addChild(new z({label:this._i18nStrings.showDetailedView,iconClass:a.propertiesIcon,baseClass:a.menuItem,onClick:e.hitch(this,function(){this.emit("show-detailed-field-view",{columnId:c,fieldInfo:d})})}))}},_generateColumnHiderButton:function(){var a=this.css,a=r.create("div",{className:a.menuItem+" "+a.button+" "+a.menuIcon,
tabIndex:0});r.place(a,this._gridTitleNode,"before");s(a,D,e.hitch(this,this.showColumnHiderMenu));this._columnHiderButton=a},_fetchAttachments:function(a){return h.queryLayerForAttachments({layer:this.layer,ids:a||null})},_showAttachmentsHandler:function(a){var b=a.row,d=a.fieldInfo,c=a.cellValue,f=a.cellNode;a=this.layerInfo;var g=b[this.idProperty],h,k;if(0!==c||a.editCapabilities.canCreate)h=this.attachmentInfos[g]?this.attachmentInfos[g].attachments:[],a=G.generateAttachmentsDialog({layer:this.layer,
featureId:g,attachments:h,editable:this.editable&&a.editable,css:this.css}),k=a.featureAttachments,h=k.attachments,this.own(k.on("add-complete",e.hitch(this,function(a){this.attachmentInfos[g].attachments=a.attachments;c+=1;f.innerHTML="";this._generateAttachmentsCell({row:b,fieldInfo:d,cellValue:c,cellNode:f})})),k.on("delete-complete",e.hitch(this,function(a){this.attachmentInfos[g].attachments=a.attachments;c-=1;f.innerHTML="";this._generateAttachmentsCell({row:b,fieldInfo:d,cellValue:c,cellNode:f})}))),
this.emit("show-attachments",{featureId:g,attachments:h,dialog:a.dialog})},_updateAttachmentInfos:function(a){return e.mixin(this.attachmentInfos,a)},_fetchRelatedRecords:function(a){return h.queryLayerForRelatedRecords({layer:this.layer,ids:a.ids||null,relationship:a.relationship,outFields:a.outFields||["*"]})},_showRelatedRecordsHandler:function(a){var b=a.row,d=this.idProperty,c=b[d],e=a.fieldInfo.relationship;a=a.count;var g=this.columns,m=this.layer,k=m.getField(e.keyField),l=(k=k?k.name:null)?
b[k]:null,n,q;n=p.filter(g,function(a){return!a.hidden});d=[h.findFirst(n,"field",m.displayField),h.findFirst(n,"field",k),h.findFirst(n,"type","esriFieldTypeString"),h.findFirstNumberColumn(g,d),h.findFirst(n,"type","esriFieldTypeDate")];p.some(d,function(a){if(this._validateRelatedColumnDisplay(a))return q=p.indexOf(g,a),!0},this);h.isValueEmpty(q)&&(q=0);this.emit("show-related-records",{row:b,featureId:c,keyField:k,keyFieldValue:l,columnId:q,relationship:e,count:a})},_setUpRelatedRecordInfos:function(a){var b=
a.records,d=this.relatedRecordInfos;p.forEach(a.relationships,function(a,e){d[a.id]=b[e]});return d},_updateRelatedRecordInfos:function(a){this.relatedRecordInfos=h.mergeDictionaries(this.relatedRecordInfos,a)},_updateRelatedRecordCounts:function(a){var b=this.relatedRecordCounts,d={};p.forEach(this.layer.relationships,function(b){var e=a[b.id].relatedRecordGroups;d[b.id]={};p.forEach(e,function(a){d[b.id][a.objectId]={count:a.count}})});this.relatedRecordCounts=h.mergeDictionaries(b,d)},_getRelatedRecordsById:function(a){var b=
a.featureId;a=a.relationshipId;return this.relatedRecordInfos[a]?this.relatedRecordInfos[a][b]:[]},_getRelatedRecordsCount:function(a){var b=a.featureId;a=a.relationshipId;return this.layerInfo.supportsAdvancedQueryRelated?(b=this.relatedRecordCounts[a]?this.relatedRecordCounts[a][b]:{})?b.count:0:(b=this._getRelatedRecordsById({featureId:b,relationshipId:a}))&&b.features?b.features.length:0},_generateRelatedRecordFieldInfos:function(a){var b=a.fieldInfos,d=this.visibleLayerIds,c=!1,e,g;p.some(a.relationships,
function(a,k){k===this._relationshipColumnLimit&&(c=!0);g=h.isCyclicalRelationship(a);e=d?d[d.length-1]===a.relatedTableId:!1;(!e||!g||this.showCyclicalRelationships)&&b.push({alias:a.name,name:a.name,type:"esriRelatedRecords",hidden:c,relatedIndex:k,relationship:a})},this)},_validateRelatedColumnDisplay:function(a){return!(!a||a.hidden||-1===p.indexOf(this.columns,a)||"esriFieldTypeOID"===a.type||"esriFieldTypeGlobalID"===a.type)},_showStatisticsHandler:function(a){var b=a.fieldInfo,d;h.getFieldStatistics({grid:this.dGrid,
layer:this.layer,fieldInfo:b,idProperty:this.idProperty,filterIds:this.filterIds,where:this.where,columnId:a.columnId}).then(e.hitch(this,function(a){d=G.generateStatisticsDialog({data:a,fieldName:b.name,css:this.css});this.emit("show-statistics",d)}))},_addGridListeners:function(){this._setUpRowSelectListener();this._setUpRowDeselectListener();this._setUpDataChangeListener();this._setUpRefreshListener();this._setUpColumnClickListener();this._setUpColumnStateChangeListener();this._setUpColumnResizeListener();
this._setUpErrorListener();this._setUpSortListener();this._setUpFilterListener();this._setUpEditorShowListener();this._setUpEditorHideListener();this.own(this._setUpStoreLoadListener(),this._setUpLayerEditsCompleteListener(),this._setUpLayerClickListener(),this._setUpLayerSelectionCompleteListener(),this._setUpLayerSelectionClearListener(),this._setUpLayerUpdateEndListener())},_setUpStoreLoadListener:function(){var a=this.watch("store",e.hitch(this,function(b,d,c){null===d&&c&&(this.set("loaded",
!0),this.emit("load",{loaded:!0}),a.remove())}));return a},_setUpRowSelectListener:function(){return this.dGrid.on("dgrid-select",e.hitch(this,function(a){this._updateSelection().then(e.hitch(this,function(){this.updateHeaderText();this.emit("row-select",a)}))}))},_setUpRowDeselectListener:function(){return this.dGrid.on("dgrid-deselect",e.hitch(this,function(a){this._updateSelection().then(e.hitch(this,function(){this.updateHeaderText();this.emit("row-deselect",a)}))}))},_setUpDataChangeListener:function(){return this.dGrid.on("dgrid-datachange",
e.hitch(this,function(a){var b=a.cell.column.field,d=h.findFirst(this.fieldInfos,"name",b),c=a.cell.row.data,f=c[this.idProperty],g=a.value;a=a.oldValue;var m=h.isIntegerFieldType(d.type),d=h.isFloatFieldType(d.type),k={oldValue:a,fieldName:b,rowId:f,row:c};""===g&&(g=null);m&&null!==g&&(g=parseInt(g,10));d&&null!==g&&(g=parseFloat(g));g&&g.getTime&&g.getTime()?c[b]=g.getTime():c[b]=g;this.showLoadingIndicator();this._updateSelection().then(e.hitch(this,function(){this.updateHeaderText();this._applyEdits({row:c,
rollbackInfo:k})}));this.emit("data-change",{row:c,rollbackInfo:k})}))},_setUpRefreshListener:function(){return this.dGrid.on("dgrid-refresh-complete",e.hitch(this,function(a){this.dGrid.columns[0]&&this.emit("refresh",a)}))},_setUpColumnClickListener:function(){return this.dGrid.on(".dgrid-header .dgrid-cell:click",e.hitch(this,this._generateColumnMenu))},_setUpColumnStateChangeListener:function(){return this.dGrid.on("dgrid-columnstatechange",e.hitch(this,function(a){this.emit("column-state-change",
a)}))},_setUpColumnResizeListener:function(){return this.dGrid.on("dgrid-columnresize",e.hitch(this,function(a){this.emit("column-resize",a)}))},_setUpErrorListener:function(){return this.dGrid.on("dgrid-error",e.hitch(this,function(a){this.emit("error",a)}))},_setUpSortListener:function(){return this.dGrid.on("dgrid-sort",e.hitch(this,function(a){this.emit("sort",a)}))},_setUpFilterListener:function(){return this.dGrid.on("dgrid-filter",e.hitch(this,function(a){this.emit("filter",a)}))},_setUpEditorShowListener:function(){return this.dGrid.on("dgrid-editor-show",
e.hitch(this,function(a){this.emit("editor-show",a)}))},_setUpEditorHideListener:function(){return this.dGrid.on("dgrid-editor-hide",e.hitch(this,function(a){this.emit("editor-hide",a)}))},_setUpLayerClickListener:function(){return s(this.layer,"click",e.hitch(this,function(a){this.emit("layer-click",a)}))},_setUpLayerSelectionCompleteListener:function(){return s(this.layer,"selection-complete",e.hitch(this,function(a){this.emit("layer-selection-complete",a)}))},_setUpLayerSelectionClearListener:function(){return s(this.layer,
"selection-clear",e.hitch(this,function(a){this.emit("layer-selection-clear",a)}))},_setUpLayerUpdateEndListener:function(){return s(this.layer,"update-end",e.hitch(this,function(a){this.emit("layer-update-end",a)}))},_setUpLayerEditsCompleteListener:function(){return s(this.layer,"edits-complete",e.hitch(this,function(a){a=a.updates||[];var b=this.rollbackInfos,d,c,e;a&&a.length&&p.forEach(a,function(a){d=b[a.objectId];c=d[d.length-1]||null;a.success||(a.error?this.emit("error",{message:a.error}):
this.emit("error",{message:this._i18nStrings.errorUpdateFailed}),c?(e=this.getRowDataById(c.rowId),e[this.idProperty]===a.objectId?(e[c.fieldName]=c.oldValue,this.dGrid.updateDirty(c.rowId,c.fieldName,c.oldValue),this.refresh()):this.emit("error",{message:this._i18nStrings.errorRollback})):this.emit("error",{message:this._i18nStrings.errorRollback}));this.emit("edits-complete",{update:{success:a.success,field:c.fieldName,value:this.getRowDataById(c.rowId)[c.fieldName],previousValue:c.oldValue}})},
this);this.hideLoadingIndicator()}))}});P("extend-esri")&&e.setObject("dijit.Grid",C,O);return C});