// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.18/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/ImageServiceLayerMixin":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/json dojo/_base/config dojo/_base/connect dojo/has dojo/io-query ../kernel ../config ../lang ../request ../deferredUtils ../urlUtils ../geometry/Extent ../geometry/Point ../geometry/Polygon ./MosaicRule ./RasterFunction ./DimensionalDefinition ./Raster ./PixelBlock ./pixelFilters/VectorFieldPixelFilter ./rasterFormats/ImageCanvasDecoder ./TimeInfo ./Field ../graphic ../tasks/ImageServiceIdentifyTask ../tasks/ImageServiceIdentifyParameters".split(" "),
function(l,h,p,r,f,d,b,a,e,g,n,m,s,A,k,w,u,G,x,y,F,C,B,q,H,t,v,z,I,E){l=l(null,{declaredClass:"esri.layers.ImageServiceLayerMixin",_rasterFieldPrefix:"Raster.",_renderingRuleFieldSubPrefix:"ServicePixelValue.",_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0,"spatial-reference-change":!0},constructor:function(c,D){this.useMapTime=D&&D.hasOwnProperty("useMapTime")?!!D.useMapTime:!0},_initialize:function(c,D){this._url=k.urlToObject(c);this.raster=new C(c);this.infoTemplate=D&&D.infoTemplate;
var a=D&&D.imageServiceParameters;this.format=a&&a.format;this.compressionTolerance=a&&a.compressionTolerance?a.compressionTolerance:0.01;this.interpolation=a?a.interpolation:null;this.compressionQuality=a?a.compressionQuality:null;this.bandIds=a?a.bandIds:null;this.mosaicRule=a?a.mosaicRule:null;this.renderingRule=a?a.renderingRule:null;this.useMapDimensionValue=D&&D.hasOwnProperty("useMapDimensionValue")?!!D.useMapDimensionValue:!0;this.activeMapDimensions=D&&D.activeMapDimensions;this._params=
h.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},a?a.toJson():{});this.pixelFilter=D&&D.pixelFilter;this.originalPixelData=this.pixelData=null;this.hasDataChanged=!0;this._requestDataHandler=h.hitch(this,this._requestDataHandler);this._requestDataErrorHandler=h.hitch(this,this._requestDataErrorHandler);this._rasterReadPromise=null;this._initLayer=h.hitch(this,this._initLayer);
this._queryVisibleRastersHandler=h.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._renderingRuleAttributeTable={};this._useRenderingRuleAttributeTable=!1;this._loadCallback=D&&D.loadCallback;(a=D&&D.resourceInfo)?this._initLayer(a):s({url:this._url.path,content:h.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},
disableClientCaching:!1,_initLayer:function(c,a){if(!(null===c||void 0===c)){this._findCredential();(this.credential&&this.credential.ssl||c&&c._ssl)&&this._useSSL();var b=this.minScale,d=this.maxScale;h.mixin(this,c);this.minScale=b;this.maxScale=d;this.initialExtent=this.fullExtent=this.extent=new w(c.extent);this.spatialReference=this.initialExtent.spatialReference;this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var e=this.minValues,g=this.maxValues,
f=this.meanValues,z=this.stdvValues,s=this.bands=[],b=0,d=this.bandCount;b<d;b++)s[b]={min:e[b],max:g[b],mean:f[b],stddev:z[b]};this.timeInfo=(b=this.timeInfo)&&b.timeExtent?new t(b):null;d=this.fields=[];if(e=c.fields)for(b=0;b<e.length;b++)d.push(new v(e[b]));this.version=c.currentVersion;this.version||(this.version="fields"in c||"objectIdField"in c||"timeInfo"in c?10:9.3);m.isDefined(c.minScale)&&!this._hasMin&&this.setMinScale(c.minScale);m.isDefined(c.maxScale)&&!this._hasMax&&this.setMaxScale(c.maxScale);
b={};c.defaultMosaicMethod?(b.method=c.defaultMosaicMethod,b.operation=c.mosaicOperator,b.sortField=c.sortField,b.sortValue=c.sortValue):b.method=x.METHOD_NONE;this.defaultMosaicRule=new x(b);this.defaultMosaicRule.ascending=!0;this._useRenderingRuleAttributeTable=10<this.version&&"esriImageServiceDataTypeThematic"===this.serviceDataType&&!this.hasRasterAttributeTable;this._setDefaultRenderingRule(!0);this._isScientificData()&&(!this.mosaicRule||this.mosaicRule&&!this.mosaicRule.multidimensionalDefinition)&&
this._setDefaultMultidimensionalDefinition(!0);10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(h.hitch(this,function(c){c&&(c.features&&0<c.features.length)&&(this._rasterAttributeTableFeatures=h.clone(c.features));c&&(c.fields&&0<c.fields.length)&&(this._rasterAttributeTableFields=h.clone(c.fields))}));this._isVectorData()&&!m.isDefined(this.pixelFilter)&&(this.vectorFieldPixelFilter=new q,this.vectorFieldPixelFilter.isDataUV="esriImageServiceDataTypeVector-UV"===
this.serviceDataType,this.pixelFilter=this.vectorFieldPixelFilter.computeMagnitudeAndDirection,this.getKeyProperties().then(h.hitch(this,this._setFlowRepresentation)));this.loaded=!0;this.onLoad(this);if(b=this._loadCallback)delete this._loadCallback,b(this)}},getKeyProperties:function(){var c=this._url.path+"/keyProperties",a=new p(A._dfdCanceller);10<this.version?(a._pendingDfd=s({url:c,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),a._pendingDfd.then(function(c){a.callback(c)},
function(c){a.errback(c)})):(c=Error("Layer does not have key properties"),c.log=d.isDebug,a.errback(c));return a},getRasterAttributeTable:function(c){var a=this._url.path+"/rasterAttributeTable",b=new p(A._dfdCanceller),t={f:"json"},e=this.hasRasterAttributeTable;c&&c.renderingRule&&(t.renderingRule=f.toJson(c.renderingRule.toJson()),e=!0);10<this.version&&e?(b._pendingDfd=s({url:a,content:t,handleAs:"json",callbackParamName:"callback"}),b._pendingDfd.then(function(c){b.callback(c)},function(c){b.errback(c)})):
(c=Error("Layer does not support raster attribute table"),c.log=d.isDebug,b.errback(c));return b},_getRenderingRuleAttributeTable:function(c){var a=new p(A._dfdCanceller);if(!c||!c.renderingRule)return a.errback(Error("Rendering rule is not specified")),a;c=c.renderingRule;var b=c.functionName;this._renderingRuleAttributeTable&&b&&this._renderingRuleAttributeTable.hasOwnProperty(b)?a.resolve(this._renderingRuleAttributeTable[b]):a=this.getRasterAttributeTable({renderingRule:c}).then(h.hitch(this,
function(c){var a;c&&(c.features&&c.features.length&&c.fields&&c.fields.length)&&(a={features:h.clone(c.features),fields:h.clone(c.fields)},b&&(this._renderingRuleAttributeTable[b]=a));return a}));return a},_getRasterAttributeTableFeatures:function(){var c=new p;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return c.resolve(this._rasterAttributeTableFeatures),c;if(10<this.version&&this.hasRasterAttributeTable)return c=this.getRasterAttributeTable(),c.then(h.hitch(this,
function(c){c&&(c.features&&0<c.features.length)&&(this._rasterAttributeTableFeatures=h.clone(c.features))})),c;c.resolve(this._rasterAttributeTableFeatures);return c},_getRenderingRuleAttributeTableFeatures:function(c){c=c&&c.renderingRule;return!c?(c=new p,c.errback(Error("Rendering rule is not specified")),c):this._getRenderingRuleAttributeTable({renderingRule:c}).then(function(c){return c&&c.features})},getCustomRasterFields:function(c){var a=c?c.rasterAttributeTableFieldPrefix:this._rasterFieldPrefix;
c=10.3<=this.version?"esriFieldTypeDouble":"esriFieldTypeString";var b={name:this._rasterFieldPrefix+"ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:c},d={name:this._rasterFieldPrefix+"ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:c},t={name:this._rasterFieldPrefix+"ServicePixelValue.Raw",alias:"Raw Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeDouble"},e=this.fields?h.clone(this.fields):[];c=e.length;
e[c]=d;if(10.4<=this.version&&"esri.layers.ArcGISImageServiceLayer"===this.declaredClass&&(!this.rasterFunctionInfos||!this.rasterFunctionInfos.length||this._isRasterFunctionInfoAvailable("none")))c++,e[c]=t;if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)c++,e[c]=b;if(m.isDefined(this.pixelFilter)&&("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType))b={name:this._rasterFieldPrefix+
"Magnitude",alias:"Magnitude",domain:null,editable:!1,type:"esriFieldTypeDouble"},d={name:this._rasterFieldPrefix+"Direction",alias:"Direction",domain:null,editable:!1,type:"esriFieldTypeDouble"},c++,e[c]=b,c++,e[c]=d;c=this._rasterAttributeTableFields;if((b=this.renderingRule&&this.renderingRule.functionName)&&this._renderingRuleAttributeTable&&this._renderingRuleAttributeTable.hasOwnProperty(b))c=this._renderingRuleAttributeTable[b].fields;c&&0<c.length&&(c=r.filter(c,function(c){return"esriFieldTypeOID"!==
c.type&&"value"!==c.name.toLowerCase()}),c=r.map(c,function(c){var b=h.clone(c);b.name=a+c.name;return b}),e=e.concat(c));var v=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;10.4<=this.version&&this.rasterFunctionInfos&&r.forEach(this.rasterFunctionInfos,function(c){c&&(c.name&&"none"!==c.name.toLowerCase())&&(c={name:v+c.name.replace(/ /gi,"_"),alias:c.name,domain:null,editable:!1,type:"esriFieldTypeDouble"},e.push(c))});return e},_prepareGetImageParameters:function(c,a,b,d){d=m.isDefined(d)?
d:this._params;var e=c.spatialReference.wkid||f.toJson(c.spatialReference.toJson(!1));delete d._ts;h.mixin(d,{bbox:c.xmin+","+c.ymin+","+c.xmax+","+c.ymax,imageSR:e,bboxSR:e,size:a+","+b},this.disableClientCaching?{_ts:(new Date).getTime()}:{});delete d.compressionTolerance;d.format&&"LERC"===d.format.toUpperCase()&&(d.compressionTolerance=this.compressionTolerance);d.token=this._getToken()},getImageUrl:function(c,a,b,d,t){t=m.isDefined(t)?t:this._params;this._prepareGetImageParameters(c,a,b,t);c=
h.clone(t);this._cleanupRequestParams(c);a=this._url.path+"/exportImage?";b=k.addProxy(a+e.objectToQuery(h.mixin(c,{f:"image"})));var v=c.token;b.length>n.defaults.io.postLength||this.useMapImage?this._jsonRequest=s({url:a,content:h.mixin(c,{f:"json"}),callbackParamName:"callback",load:function(c,a){var b=c.href;v&&(b+=-1===b.indexOf("?")?"?token\x3d"+v:"\x26token\x3d"+v);d(k.addProxy(b))},error:this._errorHandler}):d(b)},onRenderingChange:function(){},onMosaicRuleChange:function(){},setInterpolation:function(c,
a){this.interpolation=this._params.interpolation=c;a||this.refresh(!0)},setCompressionQuality:function(c,a){this.compressionQuality=this._params.compressionQuality=c;a||this.refresh(!0)},setCompressionTolerance:function(c,a){this.compressionTolerance=c;a||this.refresh(!0)},setBandIds:function(c,a){var b=!1;this.bandIds!==c&&(b=!0);this.bandIds=c;this._params.bandIds=c.join(",");if(b&&!a)this.onRenderingChange();a||this.refresh(!0)},setDefaultBandIds:function(c){this.bandIds=this._params.bandIds=null;
c||this.refresh(!0)},setDisableClientCaching:function(c){this.disableClientCaching=c},setMosaicRule:function(c,a){var b=!1;this.mosaicRule!==c&&(b=!0);this.mosaicRule=c;this._params.mosaicRule=f.toJson(c.toJson());if(b&&!a)this.onMosaicRuleChange();a||this.refresh(!0)},setRenderingRule:function(c,a){var b=!1;this.renderingRule!==c&&(b=!0);this.renderingRule=c;this._params.renderingRule=c?f.toJson(c.toJson()):null;this._useRenderingRuleAttributeTable&&this._getRenderingRuleAttributeTable({renderingRule:c});
if(b&&!a)this.onRenderingChange();a||this.refresh(!0)},setImageFormat:function(c,a){this.format=this._params.format=c;a||this.refresh(!0)},setInfoTemplate:function(c){this.infoTemplate=c},setDefinitionExpression:function(c,a){var b=this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?b=this.defaultMosaicRule.toJson():b.method=x.METHOD_NONE);b.where=c;b=new x(b);this.setMosaicRule(b,a);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:
null},setPixelFilter:function(c){this.pixelFilter=c},getPixelData:function(c){return c?(this._useBrowserDecoding()&&(this.originalPixelData={pixelBlock:this._getPixelBlockFromCanvas(this._context,this._map.width,this._map.height),extent:this._map.extent}),this.originalPixelData):this.pixelData},redraw:function(){this.hasDataChanged=!1;this._setPixelData(this.originalPixelData)},queryVisibleRasters:function(c,a,b,d){var t=this._map,e=A._fixDfd(new p(A._dfdCanceller));this._visibleRasters=[];var v,
g,f=!0,z=this.infoTemplate?this.infoTemplate.info:null,m=z?h.clone(this.infoTemplate.info.fieldInfos):null;a=a||{};if(z&&this.infoTemplate.info.mediaInfos&&this.infoTemplate.info.mediaInfos.length){var s=[];r.forEach(this.infoTemplate.info.mediaInfos,function(c){s=s.concat(c&&c.value&&c.value.fields||[])});s.length&&r.forEach(m,function(c){c&&-1<s.indexOf(c.fieldName)&&(c.visible=!0)})}if(m&&0<m.length){f=!1;for(v=0;v<m.length;v++)if((g=m[v])&&g.fieldName.toLowerCase()!==this._rasterFieldPrefix.toLowerCase()+
"servicepixelvalue"&&(g.visible||z.title&&-1<z.title.toLowerCase().indexOf(g.fieldName.toLowerCase()))){f=!0;break}}var k=(g=this._removeVisualizationStretchFunction(this.renderingRule))&&g.functionName,n=[];if(10.4<=this.version){var l=!1;if(this.rasterFunctionInfos&&m){var w=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;r.forEach(this.rasterFunctionInfos,function(c){var a=w+c.name.replace(/ /gi,"_");r.some(m,function(c){return c.visible&&c.fieldName===a})&&(l=l||k&&k===c.name,n.push(new y({rasterFunction:c.name})))})}g&&
!l&&n.push(g)}v=new E;v.geometry=c.geometry;v.returnGeometry=this._map.spatialReference.equals(this.spatialReference);v.returnCatalogItems=f;v.timeExtent=c.timeExtent;v.mosaicRule=this.mosaicRule||null;v.renderingRule=10.4>this.version&&g||null;v.renderingRules=n||null;t&&(c=new u((t.extent.xmax-t.extent.xmin)/(2*t.width),(t.extent.ymax-t.extent.ymin)/(2*t.height),t.extent.spatialReference),v.pixelSize=c);a.requestParams=v;var q=this;c=new I(this.url);(e._pendingDfd=c.execute(v)).addCallbacks(function(c){q._queryVisibleRastersHandler(c,
a,b,d,e)},function(c){q._resolve([c],null,d,e,!0)});return e},_queryVisibleRastersHandler:function(c,a,b,d,t){function e(){var c=this.getCustomRasterFields(a),d=this._getDomainFields(c),f=a?a.returnDomainValues:!1,z=a&&a.rasterAttributeTableFieldPrefix,n,s,E,p,q,l,u,A,y,C;this._useRenderingRuleAttributeTable&&this.renderingRule?(c=this._getRenderingRuleAttributeTableFeatures({renderingRule:this.renderingRule}),C=v):c=this._getRasterAttributeTableFeatures();c.then(h.hitch(this,function(c){for(n=0;n<
k.length;n++){J=k[n];J.setInfoTemplate(this.infoTemplate);J._layer=this;if(v){y=v.replace(/ /gi,"").split(",");s=v;E=y;I&&I.length>=n&&(s=I[n].replace(/ /gi,", "),E=I[n].split(" "));J.attributes[this._rasterFieldPrefix+"ItemPixelValue"]=E;J.attributes[this._rasterFieldPrefix+"ServicePixelValue"]=y;g&&(J.attributes[this._rasterFieldPrefix+"ServicePixelValue.Raw"]=g.replace(/ /gi,"").split(","));if(this.pixelFilter){var a=new B({height:1,width:1,pixelType:"F32",pixels:[],statistics:[]});r.forEach(E,
function(c){a.addData({pixels:[c],statistics:{minValue:c,maxValue:c,noDataValue:null}})});this.pixelFilter({pixelBlock:a,extent:new w(0,0,0,0,this._map.spatialReference)});if("esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType)J.attributes[this._rasterFieldPrefix+"Magnitude"]=a.pixels[0][0],J.attributes[this._rasterFieldPrefix+"Direction"]=a.pixels[1][0]}r.forEach(H,function(c){J.attributes[c.name]=c.value});var e=C||s;if(c&&0<
c.length&&(p=r.filter(c,function(c){if(c&&c.attributes)return c.attributes.hasOwnProperty("Value")?c.attributes.Value==e:c.attributes.VALUE==e}),0<p.length&&(q=h.clone(p[0]),z&&q))){A={};for(l in q.attributes)q.attributes.hasOwnProperty(l)&&(u=z+l,A[u]=q.attributes[l]);q.attributes=A;J.attributes=h.mixin(J.attributes,q.attributes)}}f&&(d&&0<d.length)&&r.forEach(d,function(c){if(c){var a=J.attributes[c.name];m.isDefined(a)&&(a=this._getDomainValue(c.domain,a),m.isDefined(a)&&(J.attributes[c.name]=
a))}},this);R.push(J);this._visibleRasters.push(J)}this._resolve([R,null,!0],null,b,t)}))}var v=c.value,g=c.value,I,k,n=0,E=0,p=this,l=this.objectIdField,q,u,H=[];d=a.requestParams.renderingRules;var A=c.processedValues,y=this.renderingRule&&dojo.toJson(this._removeVisualizationStretchFunction(this.renderingRule).toJson());if(d&&A&&d.length===A.length){var C=this._rasterFieldPrefix+this._renderingRuleFieldSubPrefix;r.forEach(d,function(c,a){if(c.functionName){var b={name:C+c.functionName.replace(/ /gi,
"_"),value:A[a].replace(/ /gi,"").split(",")};H.push(b);y&&y===dojo.toJson(c.toJson())&&(v=A[a])}})}d=this.infoTemplate&&this.infoTemplate.info&&this.infoTemplate.info.layerOptions&&this.infoTemplate.info.layerOptions.hasOwnProperty("showNoDataRecords")?this.infoTemplate.info.layerOptions.showNoDataRecords:!0;if(c.catalogItems){var x=0,F,O,P=c.catalogItems.features.length;u=0;k=Array(P);I=Array(P);q=Array(P);for(n=0;n<P;n++)-1<c.properties.Values[n].toLowerCase().indexOf("nodata")&&u++;F=P-u;for(n=
0;n<P;n++)u=!0,-1<c.properties.Values[n].toLowerCase().indexOf("nodata")?(O=F++,d||(u=!1,k.length--,I.length--,q.length--)):O=x++,u&&(k[O]=c.catalogItems.features[n],I[O]=c.properties.Values[n],q[O]=k[O].attributes[l])}this._visibleRasters=[];var J;if((c=-1<v.toLowerCase().indexOf("nodata"))&&!d)k=[],I=[],q=[];v&&(!k&&!c)&&(l="ObjectId",k=[],J=new z(new w(this.fullExtent),null,{ObjectId:0}),k.push(J));var R=[];k?!this._map.spatialReference.equals(this.spatialReference)&&q&&0<q.length?s({url:this._url.path+
"/query",content:{f:"json",objectIds:q.join(","),returnGeometry:!0,outSR:f.toJson(p._map.spatialReference.toJson()),outFields:l},handleAs:"json",callbackParamName:"callback",load:function(c){if(0===c.features.length)p._resolve([R,null,null],null,b,t);else{for(n=0;n<c.features.length;n++)for(E=0;E<k.length;E++)k[E].attributes[l]==c.features[n].attributes[l]&&(k[E].geometry=new G(c.features[n].geometry),k[E].geometry.setSpatialReference(p._map.spatialReference));e.call(p)}},error:function(c){p._resolve([R,
null,null],null,b,t)}}):e.call(this):this._resolve([R,null,null],null,b,t)},getVisibleRasters:function(){var c=this._visibleRasters,a=[],b;for(b in c)c.hasOwnProperty(b)&&a.push(c[b]);return a},_getDomainFields:function(c){if(c){var a=[];r.forEach(c,function(c){if(c.domain){var b={};b.name=c.name;b.domain=c.domain;a.push(b)}});return a}},_getDomainValue:function(c,a){if(c&&c.codedValues){var b;r.some(c.codedValues,function(c){return c.code===a?(b=c.name,!0):!1});return b}},_requestData:function(c,
a,b){this._rasterReadPromise&&this._rasterReadPromise.cancel();c=h.clone(c);var d=c._normalize(!0);this._prepareGetImageParameters(d,a,b);a=h.clone(this._params);this._cleanupRequestParams(a);a.extent=c;b=null;this._useBrowserDecoding()&&(b=new H({ctx:this._context}));a={imageServiceParameters:a,nBands:Math.min(this.bandCount,3),pixelType:this.pixelType,decodeFunc:b?h.hitch(b,"decode"):null};this._rasterReadPromise=this.raster.read(a,this._requestDataHandler,this._requestDataErrorHandler)},_requestDataHandler:function(c){if(!this._rasterReadPromise||
!this._rasterReadPromise.isCanceled())this.originalPixelData=c,this.hasDataChanged=!0,this._setPixelData(c)},_setPixelData:function(c){c=this._clonePixelData(c);this.pixelFilter&&this.pixelFilter(c);this.pixelData=c;if(!this._rasterReadPromise||!this._rasterReadPromise.isCanceled())this._drawPixelData(),this._rasterReadPromise=null},_clonePixelData:function(c){if(null===c||void 0===c)return c;var a={};c.extent&&(a.extent=h.clone(c.extent));c=c.pixelBlock;if(null===c||void 0===c)return a;a.pixelBlock=
c.clone();return a},_getPixelBlockFromCanvas:function(c,a,b){c=c.getImageData(0,0,a,b).data;for(var d=a*b,t=0,e=0,v=new Uint8Array(d),g=new Uint8Array(d),f=new Uint8Array(d),z=new Uint8Array(d),m=Infinity,n=Infinity,k=Infinity,s=-Infinity,I=-Infinity,h=-Infinity,E,p,q,t=0;t<d;t++)E=c[e++],p=c[e++],q=c[e++],m=m<E?m:E,s=s>E?s:E,n=n<p?n:p,I=I>p?I:p,k=k<q?k:q,h=h>q?h:q,v[t]=E,g[t]=p,f[t]=q,z[t]=c[e++]&1;return new B({width:a,height:b,pixels:[v,g,f],pixelType:"U8",mask:z,statistics:[{minValue:m,maxValue:s},
{minValue:n,maxValue:I},{minValue:k,maxValue:h}]})},_useBrowserDecoding:function(){return(void 0===this.pixelFilter||null===this.pixelFilter)&&("jpeg"===this.format.toLowerCase()||"jpg"===this.format.toLowerCase()||-1<this.format.toLowerCase().indexOf("png"))},getMultidimensionalInfo:function(){var c=this._url.path+"/multiDimensionalInfo",a=new p(A._dfdCanceller);if(this._multidimensionalInfo)return a.resolve(this._multidimensionalInfo),a;10.3<=this.version&&this.hasMultidimensions?(a._pendingDfd=
s({url:c,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),a._pendingDfd.then(h.hitch(this,function(c){this._multidimensionalInfo=c.multidimensionalInfo;a.callback(c.multidimensionalInfo)}),function(c){a.errback(c)})):(c=Error("Layer does not support multidimensional info"),c.log=d.isDebug,a.errback(c));return a},getDefaultMultidimensionalDefinition:function(){var c,a,b,d=[],t=new p(A._dfdCanceller);if(this._defaultMultidimensionalDefinition)return t.resolve(this._defaultMultidimensionalDefinition),
t;t._pendingDfd=this.getMultidimensionalInfo();t._pendingDfd.then(h.hitch(this,function(e){c=e;a=c.variables[0].dimensions;for(b in a)a.hasOwnProperty(b)&&(a[b].hasRanges&&!0==a[b].hasRanges?d.push(new F({variableName:"",dimensionName:a[b].name,isSlice:!1,values:[a[b].values[0]]})):d.push(new F({variableName:"",dimensionName:a[b].name,isSlice:!0,values:[a[b].extent[0]]})));this._defaultMultidimensionalDefinition=d;t.callback(d)}),function(c){t.errback(c)});return t},_setDefaultMultidimensionalDefinition:function(c){var a,
b={};this.getDefaultMultidimensionalDefinition().then(h.hitch(this,function(d){a=d;0<a.length&&(this.mosaicRule?(b=h.clone(this.mosaicRule),b.multidimensionalDefinition=a):this.defaultMosaicRule?(b=h.clone(this.defaultMosaicRule),b.multidimensionalDefinition=a):b=new x({multidimensionalDefinition:a}),this.setMosaicRule(b,c))}))},_setDefaultRenderingRule:function(c){var a={};if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"!==this.declaredClass&&this.rasterFunctionInfos&&this.rasterFunctionInfos.length&&
"none"!==this.rasterFunctionInfos[0].name.toLowerCase())a.rasterFunction=this.rasterFunctionInfos[0].name;else if(!this.renderingRule&&"esri.layers.ArcGISImageServiceVectorLayer"===this.declaredClass&&10.3<this.version){var b="esriImageServiceDataTypeVector-UV"===this.serviceDataType?7:10;a.rasterFunction="Resample";a.rasterFunctionArguments={ResamplingType:b,InputCellSize:{x:this.pixelSizeX,y:this.pixelSizeY}}}a.hasOwnProperty("rasterFunction")&&(this.defaultRenderingRule=new y(a),this.setRenderingRule(this.defaultRenderingRule,
c))},_cleanupRequestParams:function(c){if(!c)return c;if(c.time&&c.mosaicRule){var a=new x(f.fromJson(c.mosaicRule));if(a&&a.multidimensionalDefinition&&0<a.multidimensionalDefinition.length){var b=r.filter(a.multidimensionalDefinition,function(c){return"StdTime"!==c.dimensionName});a.multidimensionalDefinition=b;c.mosaicRule=f.toJson(a.toJson())}}var a="displayOnPan drawMode styling id opacity visible resourceInfo useMapDimensionValue extent".split(" "),d;for(d in a)c.hasOwnProperty(a[d])&&delete c[a[d]];
return c},_removeVisualizationStretchFunction:function(c){var a=c&&c.functionName;if(!a||"stretch"!==a.toLowerCase())return c;var b=c.functionArguments.Raster;return b&&b.functionName&&r.some(this.rasterFunctionInfos,function(c){return b.functionName===c.name})?b:c},_isScientificData:function(){return"esriImageServiceDataTypeVector-UV"===this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType||"esriImageServiceDataTypeScientific"===this.serviceDataType},_isVectorData:function(){return"esriImageServiceDataTypeVector-UV"===
this.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===this.serviceDataType},_isRasterFunctionInfoAvailable:function(c){return r.some(c&&(this.rasterFunctionInfos||[]),function(a){return a&&a.name&&a.name.toLowerCase()===c.toLowerCase()})},_createPixelData:function(c){c=new B({width:2,height:2,pixels:c,pixelType:this.pixelType,statistics:c});var a=this.fullExtent.getCenter(),a=new w(a.x,a.y,a.x+this.pixelSizeX,a.y+this.pixelSizeY,this.spatialReference);return{pixelBlock:c,extent:a}},_resolve:function(c,
a,b,d,t){a&&this[a].apply(this,c);b&&b.apply(null,c);d&&A._resDfd(d,c,t)},_toggleTime:function(){var c=this._map;this.timeInfo&&this.useMapTime&&c&&!this.suspended?(this._timeConnect||(this._timeConnect=b.connect(c,"onTimeExtentChange",this,this._onTimeExtentChangeHandler)),this._setTime(c.timeExtent)):(b.disconnect(this._timeConnect),this._timeConnect=null,this._setTime(null))},setUseMapTime:function(c,a){this.useMapTime=c;this._toggleTime();!a&&this._map&&this.refresh(!0)},_setTime:function(c){this._params&&
(this._params.time=c?c.toJson().join(","):null)},_onTimeExtentChangeHandler:function(c){this.suspended||(this._setTime(c),this.refresh(!0))},handleSpatialReferenceChange:function(){this.onSpatialReferenceChange()}});a("extend-esri")&&h.setObject("layers.ImageServiceLayerMixin",l,g);return l})},"esri/layers/MosaicRule":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../geometry/Point".split(" "),function(l,h,p,r,f,d){var b=l(null,{declaredClass:"esri.layers.MosaicRule",
method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],constructor:function(a){h.isObject(a)&&(h.mixin(this,a),a.mosaicMethod&&(this.method=a.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=this._getMethodEnum(this.method)),a.mosaicOperation&&(this.operation=a.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=
this._getOperatorEnum(this.operation)),a.fids&&(this.objectIds=a.fids),a.viewpoint&&(this.viewpoint=new d(a.viewpoint)),this.multidimensionalDefinition=a.multidimensionalDefinition||[])},toJson:function(){var a=null,b=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(b)for(var a=[],d=0;d<b;d++)a.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[d].declaredClass?this.multidimensionalDefinition[d].toJson():this.multidimensionalDefinition[d]);a={mosaicMethod:this.method,
where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation,multidimensionalDefinition:a};return f.filter(a,function(a){if(null!==a)return!0})},_getMethodEnum:function(a){if(a){var d=b.METHOD_NONE;switch(a.toLowerCase()){case "byattribute":d=b.METHOD_ATTRIBUTE;break;case "center":d=b.METHOD_CENTER;break;case "lockraster":d=b.METHOD_LOCKRASTER;
break;case "nadir":d=b.METHOD_NADIR;break;case "northwest":d=b.METHOD_NORTHWEST;break;case "seamline":d=b.METHOD_SEAMLINE;break;case "viewpoint":d=b.METHOD_VIEWPOINT}return d}},_getOperatorEnum:function(a){if(a)switch(a.toLowerCase()){case "first":return b.OPERATION_FIRST;case "last":return b.OPERATION_LAST;case "max":return b.OPERATION_MAX;case "min":return b.OPERATION_MIN;case "blend":return b.OPERATION_BLEND;case "mean":return b.OPERATION_MEAN;case "sum":return b.OPERATION_SUM}}});h.mixin(b,{METHOD_NONE:"esriMosaicNone",
METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND",OPERATION_SUM:"MT_SUM"});p("extend-esri")&&h.setObject("layers.MosaicRule",b,r);return b})},
"esri/layers/RasterFunction":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(l,h,p,r,f){var d=l(null,{declaredClass:"esri.layers.RasterFunction",functionName:null,arguments:null,functionArguments:null,variableName:null,outputPixelType:null,constructor:function(b){if(h.isObject(b)){var a=0;this.functionName=b.rasterFunction;this.functionArguments=h.clone(b.rasterFunctionArguments||b.arguments);h.mixin(this,b);if(b=this.functionArguments)if(b.Raster=
this._toRasterFunction(b.Raster),b.Raster2=this._toRasterFunction(b.Raster2),b.DEM=this._toRasterFunction(b.DEM),b.FillRaster=this._toRasterFunction(b.FillRaster),b.Rasters&&b.Rasters.length)for(a=0;a<b.Rasters.length;a++)b.Rasters[a]=this._toRasterFunction(b.Rasters[a])}},_toRasterFunction:function(b){return b&&(b.rasterFunction||b.functionName)?new d(b):b},_rfToJson:function(b){b&&"esri.layers.RasterFunction"===b.declaredClass&&(b=b.toJson());return b},toJson:function(){var b=h.clone(this.functionArguments||
this.arguments);if(b&&(b.Raster=this._rfToJson(b.Raster),b.Raster2=this._rfToJson(b.Raster2),b.DEM=this._rfToJson(b.DEM),b.FillRaster=this._rfToJson(b.FillRaster),b.Rasters&&b.Rasters.length)){var a,d=[];for(a=0;a<b.Rasters.length;a++)d.push(this._rfToJson(b.Rasters[a]));b.Rasters=d}return f.filter({rasterFunction:this.functionName,rasterFunctionArguments:b,variableName:this.variableName,outputPixelType:this.outputPixelType?this.outputPixelType:null},function(a){if(null!==a&&void 0!==a)return!0})}});
p("extend-esri")&&h.setObject("layers.RasterFunction",d,r);return d})},"esri/layers/DimensionalDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang"],function(l,h,p,r,f){l=l(null,{declaredClass:"esri.layers.DimensionalDefinition",variableName:null,dimensionName:null,values:[],isSlice:!1,constructor:function(d){h.isObject(d)&&h.mixin(this,d)},toJson:function(){return f.filter({variableName:this.variableName,dimensionName:this.dimensionName,values:this.values,
isSlice:this.isSlice},function(d){return null!==d})}});p("extend-esri")&&h.setObject("layers.DimensionalDefinition",l,r);return l})},"esri/layers/Raster":function(){define("require dojo/_base/declare dojo/_base/lang dojo/_base/Deferred dojo/_base/array dojo/_base/config dojo/json dojo/sniff ../kernel ../Evented ../request ../geometry/Extent ../SpatialReference ../deferredUtils ./PixelBlock ./rasterFormats/LercCodec".split(" "),function(l,h,p,r,f,d,b,a,e,g,n,m,s,A,k,w){var u,G,x,y,F,C;h=h(g,{declaredClass:"esri.layers.Raster",
imageServiceUrl:null,validPixelTypes:"U1 U2 U4 U8 U16 U32 S8 S16 S32 F32".split(" "),validFormats:"lerc jpeg jpg jpgpng png png8 png24 png32 bip bsq tiff".split(" "),_eventMap:{"raster-read-complete":["pixelData","params"]},constructor:function(a){this.imageServiceUrl=a;this.registerConnectEvents();this._loadRasterFormatModules()},read:function(b,d,e){var g=this,m=new r(A._dfdCanceller);if(10>a("ie"))throw"This browser is not supported.";if(!b.imageServiceParameters)throw"Insufficient parameters to read data";
var c=p.clone(b.imageServiceParameters),k=b.pixelType;f.some(this.validPixelTypes,function(c){return c===k})||(c.pixelType="F32");f.some(this.validFormats,function(a){return a.toLowerCase()===c.format.toLowerCase()})||(c.format="lerc");var s=b.decodeFunc,h;this._prepareGetImageParameters(c);m._pendingDfd=n({url:this.imageServiceUrl+"/exportImage",handleAs:"arraybuffer",content:p.mixin(c,{f:"image"}),load:function(a){g.decode(a,{width:c.width,height:c.height,planes:null,pixelType:k,noDataValue:c.noData,
format:c.format,decodeFunc:s}).then(function(a){h={pixelBlock:a,extent:c.extent};g._resolve([h,c],"onRasterReadComplete",d,m)},function(c){g._resolve([c],null,e,m,!0)})},error:function(c){g._resolve([c],null,e,m,!0)}});return m.promise},decode:function(a,b){if(void 0===b||null===b)throw"missing decode options";var d,e;b.format&&(d=b.format.toUpperCase());"BSQ"!==d&&"BIP"!==d&&(d=this._getFormat(a));e=b.decodeFunc;if(void 0===e||null===e)e=this._getFormatDecoderDfd(d);return e(a,b)},onRasterReadComplete:function(){},
_prepareGetImageParameters:function(a){if(a.size&&a.bbox){var d=a.size.split(",");a.width=parseFloat(d[0]);a.height=parseFloat(d[1]);a.extent||(d=a.bbox.split(","),a.extent=new m(parseFloat(d[0]),parseFloat(d[1]),parseFloat(d[2]),parseFloat(d[3]),new s(a.bboxSR)))}else{if(!a.width||Math.floor(a.width)!==a.width||!a.height||Math.floor(a.height)!==a.height)throw"Incorrect Image Dimensions";if(!a.extent||"esri.geometry.Extent"!==a.extent.declaredClass)throw"Incorrect extent";var d=a.extent,e=d.spatialReference.wkid||
b.toJson(d.spatialReference.toJson());delete a._ts;p.mixin(a,{bbox:d.xmin+","+d.ymin+","+d.xmax+","+d.ymax,imageSR:e,bboxSR:e,size:a.width+","+a.height},a.disableClientCaching?{_ts:(new Date).getTime()}:{})}},_adjustExtent:function(a,b,d){var e=a.ymax-a.ymin,g=a.xmax-a.xmin;d>=b?a.ymax=a.ymin+g*b/d:(g=e*d/b,a.xmax=a.xmin+g);return a},_resolve:function(a,b,d,e,g){b&&this[b].apply(this,a);d&&d.apply(null,a);e&&A._resDfd(e,a,g)},_getFormatDecoderDfd:function(a){var b=null;switch(a){case "LERC":b=this._decodeLerc;
break;case "JPEG":b=this._decodeJpeg;break;case "PNG":b=this._decodePng;break;case "BSQ":b=this._decodeBsq;break;case "BIP":b=this._decodeBip;break;case "TIFF":b=this._decodeTiff;break;default:b=function(a,b){throw"The raster format is not supported";}}b=p.hitch(this,b);return function(d,e){var g=new r;try{var c;"LERC"===a||!0===F?(c=b(d,e),g.resolve(c)):C.then(function(){c=b(d,e);g.resolve(c)})}catch(f){g.reject(f)}return g}},_getFormat:function(a){a=new Uint8Array(a,0,10);var b="";if(255===a[0]&&
216===a[1])b="JPEG";else if(137===a[0]&&80===a[1]&&78===a[2]&&71===a[3])b="PNG";else if(67===a[0]&&110===a[1]&&116===a[2]&&90===a[3]&&73===a[4]&&109===a[5]&&97===a[6]&&103===a[7]&&101===a[8]&&32===a[9])b="LERC";else if(-1<String.fromCharCode.apply(null,a).toLowerCase().indexOf("error"))b="ERROR";else if(73===a[0]&&73===a[1]&&42===a[2]&&0===a[3]||77===a[0]&&77===a[1]&&0===a[2]&&42===a[3])b="TIFF";return b},_validateDecodeParams:function(a){if(!a.height||Math.floor(a.height)!==a.height)throw"Height not provided.";
if(!a.width||Math.floor(a.width)!==a.width)throw"Width not provided.";},_decodeJpeg:function(a,b){if(!u)throw"The jpeg decoder module is not loaded.";this._validateDecodeParams(b);var d=(new u).decode(a);if(d.height!==b.height||d.width!==b.width)throw"The decoded image dimensions are incorrect.";var e=[],g,c;for(g=0;g<d.pixels.length;g++)c=d.pixels[g],e.push(this._calculateBandStatistics(c));return new k({width:d.width,height:d.height,pixels:d.pixels,pixelType:"U8",mask:d.mask,statistics:e})},_decodePng:function(a,
b){if(!G)throw"The png decoder module is not loaded.";this._validateDecodeParams(b);var d=new Uint8Array(a),e=new G(d),d=new Uint8Array(4*b.width*b.height);e.copyToImageData(d,e.decodePixels());for(var g=e=0,c,g=new Uint8Array(b.width*b.height),e=0;e<b.width*b.height;e++)g[e]=d[4*e+3];for(var f=new k({width:b.width,height:b.height,pixels:[],pixelType:"U8",mask:g,statistics:[]}),e=0;3>e;e++){c=new Uint8Array(b.width*b.height);for(g=0;g<b.width*b.height;g++)c[g]=d[4*g+e];f.addData({pixels:c,statistics:this._calculateBandStatistics(c)})}return f},
_decodeBsq:function(a,b){if(!x)throw"The bsq decoder module is not loaded.";this._validateDecodeParams(b);q=b.noDataValue;b.pixelType=H(b.pixelType);var d=x.decodeBSQ(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:B,noDataValue:q}),e=[],g,c=null;for(g=0;g<d.pixels.length;g++)c=d.pixels[g],e.push(this._calculateBandStatistics(c));return new k({width:b.width,height:b.height,pixels:d.pixels,pixelType:b.pixelType,mask:d.maskData,statistics:e})},_decodeBip:function(a,b){this._validateDecodeParams(b);
q=b.noDataValue;b.pixelType=H(b.pixelType);var d=x.decodeBIP(a,{bandCount:b.planes,width:b.width,height:b.height,pixelType:B,noDataValue:q}),e=[],g,c=null;for(g=0;g<d.pixels.length;g++)c=d.pixels[g],e.push(this._calculateBandStatistics(c));return new k({width:b.width,height:b.height,pixels:d.pixels,pixelType:b.pixelType,mask:d.maskData,statistics:e})},_decodeTiff:function(a,b){this._validateDecodeParams(b);q=b.noDataValue;b.pixelType=H(b.pixelType);var d=y.decode(a),e=[],g,c=null;for(g=0;g<d.pixels.length;g++)c=
d.pixels[g],e.push(this._calculateBandStatistics(c,d.maskData));return new k({width:d.width,height:d.height,pixels:d.pixels,pixelType:d.pixelType,mask:d.maskData,statistics:e})},_decodeLerc:function(a,b){this._validateDecodeParams(b);q=b.noDataValue;b.pixelType=H(b.pixelType);for(var d=0,e,g=0,c,f=a.byteLength-10;g<f;){var m=w.decode(a,{inputOffset:g,encodedMaskData:e,returnMask:0===d?!0:!1,returnEncodedMask:0===d?!0:!1,returnFileInfo:!0,pixelType:B,noDataValue:q}),g=m.fileInfo.eofOffset;0===d&&(e=
m.encodedMaskData,c=new k({width:b.width,height:b.height,pixels:[],pixelType:b.pixelType,mask:m.maskData,statistics:[]}));d++;if(m.height!==b.height||m.width!==b.width)throw"The decoded image dimensions are incorrect";c.addData({pixels:m.pixelData,statistics:{minValue:m.minValue,maxValue:m.maxValue,noDataValue:m.noDataValue}})}return c},_calculateBandStatistics:function(a,b){var d=Infinity,e=-Infinity,g=a.length,c,f=0;if(b)for(c=0;c<g;c++)b[c]&&(f=a[c],d=f<d?f:d,e=f>e?f:e);else for(c=0;c<g;c++)f=
a[c],d=f<d?f:d,e=f>e?f:e;return{minValue:d,maxValue:e}},_loadRasterFormatModules:function(){C=new r;10>a("ie")?C.reject("unsupported browser version"):l(["./rasterFormats/JpgPlus","./rasterFormats/Png","./rasterFormats/Raw","./rasterFormats/TiffDecoder","./rasterFormats/Zlib"],function(a,b,d,e){u=a;G=b;x=d;y=e;F=!0;C.resolve(!0)})}});var B=null,q=null,H=function(a){"U1"===a||"U2"===a||"U4"===a||"U8"===a?(a="U8",q=Math.pow(2,8)-1,B=Uint8Array):"U16"===a?(q=q||Math.pow(2,16)-1,B=Uint16Array):"U32"===
a?(q=q||Math.pow(2,32)-1,B=Uint32Array):"S8"===a?(q=q||0-Math.pow(2,7),B=Int8Array):"S16"===a?(q=q||0-Math.pow(2,15),B=Int16Array):"S32"===a?(q=q||0-Math.pow(2,31),B=Int32Array):B=Float32Array;return a};a("extend-esri")&&p.setObject("layers.Raster",h,e);return h})},"esri/layers/PixelBlock":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(l,h,p,r){l=l([],{declaredClass:"esri.layers.PixelBlock",planes:null,width:null,height:null,pixelType:null,pixels:[],statistics:[],
constructor:function(f){if(f){if(!f.width||Math.floor(f.width)!==f.width)throw"PixelBlock: incorrect width";if(!f.height||Math.floor(f.height)!==f.height)throw"PixelBlock: incorrect height";if(!f.pixels||!f.statistics)throw"PixelBlock: pixel data or statistics not present";this.width=f.width;this.height=f.height;this.pixels=f.pixels;this.pixelType=f.pixelType||null;this.statistics=f.statistics;this.mask=f.mask||null}},getPlaneCount:function(){return this.pixels.length!==this.statistics.length?console.error("Inconsistent pixel data and statistics"):
this.statistics.length},addData:function(f){if(!f.pixels||!f.statistics)throw"Pixel data or statistics are not present";if(f.pixels.length!==this.width*this.height)throw"Inconsistent pixel data size";this.statistics.push(f.statistics);this.pixels.push(f.pixels)},getAsRGBA:function(){var f=new ArrayBuffer(4*this.width*this.height);switch(this.pixelType){case "S8":case "S16":case "U16":case "S32":case "U32":case "F32":case "F64":this._fillFromNon8Bit(f);break;default:this._fillFrom8Bit(f)}return new Uint8ClampedArray(f)},
getAsRGBAFloat:function(){var f=new Float32Array(4*this.width*this.height);this._fillFrom32Bit(f);return f},clone:function(){var f=new this.constructor;f.width=this.width;f.height=this.height;f.pixelType=this.pixelType;this.mask&&(f.mask=new Uint8Array(this.mask));var d,b;if(this.pixels){f.pixels=[];b=this.pixels.length;for(d=0;d<b;d++)f.pixels[d]=new Float32Array(this.pixels[d])}if(this.statistics){f.statistics=[];b=this.statistics.length;for(d=0;d<b;d++)f.statistics[d]=h.clone(this.statistics[d])}return f},
_fillFrom8Bit:function(f){var d=this.pixels,b=this.mask;if(!f||!d||!d.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var a,e,g;a=e=g=d[0];3<=d.length&&(e=d[1],g=d[2]);var d=new Uint32Array(f),n=this.width*this.height;if(a.length!==n)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(b&&b.length===n)for(f=0;f<n;f++)b[f]&&(d[f]=-16777216|g[f]<<16|e[f]<<8|a[f]);else for(f=0;f<n;f++)d[f]=-16777216|g[f]<<16|e[f]<<8|a[f]},_fillFromNon8Bit:function(f){var d=
this.pixels,b=this.mask,a=this.statistics;if(!f||!d||!d.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var e=1,g=0;a&&0<a.length?(g=a[0].minValue,e=255/(a[0].maxValue-a[0].minValue)):(e=255,"S8"===this.pixelType?(g=-128,e=127):"U16"===this.pixelType?e=65535:"S16"===this.pixelType?(g=-32768,e=32767):"U32"===this.pixelType?e=4294967295:"S32"===this.pixelType?(g=-2147483648,e=2147483647):"F32"===this.pixelType?(g=-3.4*1E39,e=3.4*1E39):"F64"===this.pixelType&&
(g=-Number.MAX_VALUE,e=Number.MAX_VALUE),e=255/(e-g));f=new Uint32Array(f);var a=this.width*this.height,n,m,s;n=d[0];if(n.length!==a)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");if(3<=d.length)if(m=d[1],s=d[2],b&&b.length===a)for(d=0;d<a;d++)b[d]&&(f[d]=-16777216|(s[d]-g)*e<<16|(m[d]-g)*e<<8|(n[d]-g)*e);else for(d=0;d<a;d++)f[d]=-16777216|(s[d]-g)*e<<16|(m[d]-g)*e<<8|(n[d]-g)*e;else if(b&&b.length===a)for(d=0;d<a;d++)m=(n[d]-g)*e,b[d]&&(f[d]=-16777216|m<<16|m<<8|m);
else for(d=0;d<a;d++)m=(n[d]-g)*e,f[d]=-16777216|m<<16|m<<8|m},_fillFrom32Bit:function(f){var d=this.pixels,b=this.mask;if(!f||!d||!d.length)return console.error("Unable to convert to RGBA. The input pixel block is empty.");var a,e,g;a=e=g=d[0];3<=d.length&&(e=d[1],g=d[2]);var n=this.width*this.height;if(a.length!==n)return console.error("Unable to convert to RGBA. The pixelblock is invalid.");var m=0;if(b&&b.length===n)for(d=0;d<n;d++)f[m++]=a[d],f[m++]=e[d],f[m++]=g[d],f[m++]=b[d];else for(d=0;d<
n;d++)f[m++]=a[d],f[m++]=e[d],f[m++]=g[d],f[m++]=255}});p("extend-esri")&&h.setObject("layers.PixelBlock",l,r);return l})},"esri/layers/rasterFormats/LercCodec":function(){define([],function(){var l={defaultNoDataValue:-3.4027999387901484E38,decode:function(p,r){var f;r=r||{};var d=r.inputOffset||0,b=r.encodedMaskData||null===r.encodedMaskData,a={},e=new Uint8Array(p,d,10);a.fileIdentifierString=String.fromCharCode.apply(null,e);if("CntZImage"!=a.fileIdentifierString.trim())throw"Unexpected file identifier string: "+
a.fileIdentifierString;var d=d+10,g=new DataView(p,d,24);a.fileVersion=g.getInt32(0,!0);a.imageType=g.getInt32(4,!0);a.height=g.getUint32(8,!0);a.width=g.getUint32(12,!0);a.maxZError=g.getFloat64(16,!0);d+=24;if(!b)if(g=new DataView(p,d,16),a.mask={},a.mask.numBlocksY=g.getUint32(0,!0),a.mask.numBlocksX=g.getUint32(4,!0),a.mask.numBytes=g.getUint32(8,!0),a.mask.maxValue=g.getFloat32(12,!0),d+=16,0<a.mask.numBytes){var b=new Uint8Array(Math.ceil(a.width*a.height/8)),g=new DataView(p,d,a.mask.numBytes),
e=g.getInt16(0,!0),n=2,m=0;do{if(0<e)for(;e--;)b[m++]=g.getUint8(n++);else for(var s=g.getUint8(n++),e=-e;e--;)b[m++]=s;e=g.getInt16(n,!0);n+=2}while(n<a.mask.numBytes);if(-32768!==e||m<b.length)throw"Unexpected end of mask RLE encoding";a.mask.bitset=b;d+=a.mask.numBytes}else 0==(a.mask.numBytes|a.mask.numBlocksY|a.mask.maxValue)&&(b=new Uint8Array(Math.ceil(a.width*a.height/8)),a.mask.bitset=b);g=new DataView(p,d,16);a.pixels={};a.pixels.numBlocksY=g.getUint32(0,!0);a.pixels.numBlocksX=g.getUint32(4,
!0);a.pixels.numBytes=g.getUint32(8,!0);a.pixels.maxValue=g.getFloat32(12,!0);d+=16;b=a.pixels.numBlocksX;e=a.pixels.numBlocksY;b+=0<a.width%b?1:0;e+=0<a.height%e?1:0;a.pixels.blocks=Array(b*e);n=1E9;for(s=m=0;s<e;s++)for(var A=0;A<b;A++){var k=0,g=new DataView(p,d,Math.min(10,p.byteLength-d)),w={};a.pixels.blocks[m++]=w;var u=g.getUint8(0);k++;w.encoding=u&63;if(3<w.encoding)throw"Invalid block encoding ("+w.encoding+")";if(2===w.encoding)d++,n=Math.min(n,0);else{if(0!==u&&2!==u){u>>=6;w.offsetType=
u;if(2===u)w.offset=g.getInt8(1),k++;else if(1===u)w.offset=g.getInt16(1,!0),k+=2;else if(0===u)w.offset=g.getFloat32(1,!0),k+=4;else throw"Invalid block offset type";n=Math.min(w.offset,n);if(1===w.encoding)if(u=g.getUint8(k),k++,w.bitsPerPixel=u&63,u>>=6,w.numValidPixelsType=u,2===u)w.numValidPixels=g.getUint8(k),k++;else if(1===u)w.numValidPixels=g.getUint16(k,!0),k+=2;else if(0===u)w.numValidPixels=g.getUint32(k,!0),k+=4;else throw"Invalid valid pixel count type";}d+=k;if(3!=w.encoding)if(0===
w.encoding){g=(a.pixels.numBytes-1)/4;if(g!==Math.floor(g))throw"uncompressed block has invalid length";k=new ArrayBuffer(4*g);u=new Uint8Array(k);u.set(new Uint8Array(p,d,4*g));k=new Float32Array(k);for(u=0;u<k.length;u++)n=Math.min(n,k[u]);w.rawData=k;d+=4*g}else 1===w.encoding&&(g=Math.ceil(w.numValidPixels*w.bitsPerPixel/8),k=Math.ceil(g/4),k=new ArrayBuffer(4*k),u=new Uint8Array(k),u.set(new Uint8Array(p,d,g)),w.stuffedData=new Uint32Array(k),d+=g)}}a.pixels.minValue=n;a.eofOffset=d;var d=null!=
r.noDataValue?r.noDataValue:l.defaultNoDataValue,e=r.encodedMaskData,k=r.returnMask,n=0,m=a.pixels.numBlocksX,s=a.pixels.numBlocksY,A=Math.floor(a.width/m),w=Math.floor(a.height/s),g=2*a.maxZError,e=e||(a.mask?a.mask.bitset:null),G,b=new (r.pixelType||Float32Array)(a.width*a.height);k&&e&&(G=new Uint8Array(a.width*a.height));for(var k=new Float32Array(A*w),x,y,u=0;u<=s;u++){var F=u!==s?w:a.height%s;if(0!==F)for(var C=0;C<=m;C++){var B=C!==m?A:a.width%m;if(0!==B){var q=u*a.width*w+C*A,H=a.width-B,
t=a.pixels.blocks[n],v,z;if(2>t.encoding){if(0===t.encoding)v=t.rawData;else{v=t.stuffedData;z=t.bitsPerPixel;x=t.numValidPixels;y=t.offset;var I=g,E=k,c=a.pixels.maxValue,D=(1<<z)-1,S=0,M=void 0,K=0,N=void 0,Q=void 0,T=Math.ceil((c-y)/I),M=4*v.length-Math.ceil(z*x/8);v[v.length-1]<<=8*M;for(M=0;M<x;M++)0===K&&(Q=v[S++],K=32),K>=z?(N=Q>>>K-z&D,K-=z):(K=z-K,N=(Q&D)<<K&D,Q=v[S++],K=32-K,N+=Q>>>K),E[M]=N<T?y+N*I:c;v=k}z=0}else f=2===t.encoding?0:t.offset;var L;if(e)for(y=0;y<F;y++){q&7&&(L=e[q>>3],L<<=
q&7);for(x=0;x<B;x++)q&7||(L=e[q>>3]),L&128?(G&&(G[q]=1),b[q++]=2>t.encoding?v[z++]:f):(G&&(G[q]=0),b[q++]=d),L<<=1;q+=H}else if(2>t.encoding)for(y=0;y<F;y++){for(x=0;x<B;x++)b[q++]=v[z++];q+=H}else for(y=0;y<F;y++){for(x=0;x<B;x++)b[q++]=f;q+=H}if(1===t.encoding&&z!==t.numValidPixels)throw"Block and Mask do not match";n++}}}f=G;G={width:a.width,height:a.height,pixelData:b,minValue:a.pixels.minValue,maxValue:a.pixels.maxValue,noDataValue:d};f&&(G.maskData=f);r.returnEncodedMask&&a.mask&&(G.encodedMaskData=
a.mask.bitset?a.mask.bitset:null);if(r.returnFileInfo&&(G.fileInfo=h(a),r.computeUsedBitDepths)){f=G.fileInfo;L=a.pixels.numBlocksX*a.pixels.numBlocksY;v={};for(z=0;z<L;z++)d=a.pixels.blocks[z],0===d.encoding?v.float32=!0:1===d.encoding?v[d.bitsPerPixel]=!0:v[0]=!0;a=Object.keys(v);f.bitDepths=a}return G}},h=function(h){return{fileIdentifierString:h.fileIdentifierString,fileVersion:h.fileVersion,imageType:h.imageType,height:h.height,width:h.width,maxZError:h.maxZError,eofOffset:h.eofOffset,mask:h.mask?
{numBlocksX:h.mask.numBlocksX,numBlocksY:h.mask.numBlocksY,numBytes:h.mask.numBytes,maxValue:h.mask.maxValue}:null,pixels:{numBlocksX:h.pixels.numBlocksX,numBlocksY:h.pixels.numBlocksY,numBytes:h.pixels.numBytes,maxValue:h.pixels.maxValue,minValue:h.pixels.minValue,noDataValue:this.noDataValue}}};return l})},"esri/layers/pixelFilters/VectorFieldPixelFilter":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../../kernel ../../lang dojo/_base/array".split(" "),function(l,h,p,r,f,d){l=l(null,
{declaredClass:"esri.layers.pixelFilters.VectorFieldPixelFilter",speedUnits:["esriMetersPerSecond","esriKilometersPerHour","esriKnots","esriFeetPerSecond","esriMilesPerHour"],constructor:function(b){h.mixin(this,b);this.isDataUV=b&&b.isDataUV?b.isDataUV:!1;this.computeMagnitudeAndDirection=h.hitch(this,this.computeMagnitudeAndDirection);this.unitConversionFactor=1;this._updateUnitConvFactor()},setUnits:function(b,a){this.inputUnit=b;this.outputUnit=a;this.unitConversionFactor=1;this._updateUnitConvFactor()},
_updateUnitConvFactor:function(){var b=d.indexOf(this.speedUnits,this.inputUnit),a=d.indexOf(this.speedUnits,this.outputUnit);if(this.inputUnit&&this.outputUnit&&0<=b&&0<=a){var e=[1,0.277778,0.514444,0.3048,0.44704,0];this.unitConversionFactor=e[b]/e[a]}},computeMagnitudeAndDirection:function(b){if(!f.isDefined(b))throw"Could not compute magnitude and direction. No pixel data is available.";var a=b.pixelBlock;if(!f.isDefined(a)||2!==a.getPlaneCount())throw"Could not compute magnitude and direction. Pixel data does not contain two bands.";
var d=b.extent,g=(d.xmax-d.xmin)/a.width,h=(d.ymax-d.ymin)/a.height,m=d.xmin+g/2,d=d.ymax-h/2;a.statistics[0].minValue=0;a.statistics[0].maxValue=0;var s=180/Math.PI,l=[],k=0,p=0,u=0,r=!f.isDefined(a.mask),x,y,F,C,B,q,H,t;B=H=Infinity;q=t=-Infinity;for(k=0;k<a.height;k++)for(p=0;p<a.width;p++,u++)if(l.push([m+g*p,d-h*k]),r||a.mask[u])F=x=a.pixels[0][u]*this.unitConversionFactor,C=y=a.pixels[1][u],this.isDataUV&&(F=Math.sqrt(x*x+y*y),C=90-s*Math.atan2(y,x),a.pixels[0][u]=F*this.unitConversionFactor,
a.pixels[1][u]=C),F>q&&(q=F),F<B&&(B=F),C>t&&(t=C),C<H&&(H=C);a.statistics[0].maxValue=q;a.statistics[0].minValue=B;a.statistics[1].maxValue=t;a.statistics[1].minValue=H;b.locations=l;return b}});p("extend-esri")&&h.setObject("layers.pixelFilters.VectorFieldPixelFilter",l,r);return l})},"esri/layers/rasterFormats/ImageCanvasDecoder":function(){define(["require","dojo/_base/declare","dojo/Deferred","dojo/sniff"],function(l,h,p,r){var f;return h(null,{constructor:function(d){this.ctx=d.ctx;this._loadRasterFormatModule()},
decode:function(d,b){if(!b.width||!b.height)throw"Native decoding requires the image format, width and height";var a=new p,e,g=new Uint8Array(d),f=this._getFormat(d);if("error"===f)throw"invalid format";"jpeg"===f&&(e=this._getMask(g,b));var m="",h,l;for(h=0;h<g.length;h+=65535)l=g.subarray(h,h+65535>g.length-1?g.length-1:h+65535),m+=String.fromCharCode.apply(null,l);var g="data:image/"+f+";base64,"+window.btoa(m),k=new Image,r;k.src=g;var u=this;k.onload=function(){u.ctx.clearRect(0,0,b.width,b.height);
u.ctx.drawImage(k,0,0);var d=u.ctx.getImageData(0,0,k.width,k.height);r=d.data;if(e)for(h=0;h<e.length;h++)r[4*h+3]=e[h]?255:0;u.ctx.putImageData(d,0,0);a.resolve(null)};k.onerror=function(){a.reject("cannot load image")};return a},_getFormat:function(d){d=new Uint8Array(d,0,10);var b="error";255===d[0]&&216===d[1]?b="jpeg":137===d[0]&&(80===d[1]&&78===d[2]&&71===d[3])&&(b="png");return b},_getMask:function(d,b){var a;try{if(!f)throw"The zlib decoder module is not loaded.";var e=0,g=0,h=Math.round(d.length/
2);1===h%2&&(h+=1);for(var m=d.length-2,e=h;e<m&&!(255===d[e]&&217===d[e+1]);e++);h=e+=2;if(h<d.length-1){var s=(new f(d.subarray(h))).getBytes();a=new Uint8Array(b.width*b.height);for(e=h=0;e<s.length;e++)for(g=7;0<=g;g--)a[h++]=s[e]>>g&1}}catch(l){}return a},_loadRasterFormatModule:function(){10>r("ie")||l(["./Zlib"],function(d){f=d})}})})},"esri/tasks/ImageServiceIdentifyTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../request ../geometry/normalizeUtils ./Task ./ImageServiceIdentifyResult".split(" "),
function(l,h,p,r,f,d,b,a){l=l(b,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(a){this._url.path+="/identify";this._handler=h.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(b,d,f,h,s){try{var l=new a(b);this._successHandler([l],"onComplete",f,s)}catch(k){this._errorHandler(k,h,s)}},execute:function(a,b,d,m){var s=m.assembly;a=this._encode(h.mixin({},this._url.query,{f:"json"},a.toJson(s&&s[0])));var l=this._handler,
k=this._errorHandler;return f({url:this._url.path,content:a,callbackParamName:"callback",load:function(a,e){l(a,e,b,d,m.dfd)},error:function(a){k(a,d,m.dfd)}})},onComplete:function(){}});d._createWrappers(l);p("extend-esri")&&h.setObject("tasks.ImageServiceIdentifyTask",l,r);return l})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(l,h,p,r,f,d,b,a){l=l(a,{declaredClass:"esri.tasks._Task",
_eventMap:{error:["error"],complete:["result"]},constructor:function(a,d){a&&h.isString(a)&&(this._url=b.urlToObject(this.url=a));d&&d.requestOptions&&(this.requestOptions=d.requestOptions);this.normalization=!0;this._errorHandler=h.hitch(this,this._errorHandler);this.registerConnectEvents()},_useSSL:function(){var a=this._url,b=/^http:/i;this.url&&(this.url=this.url.replace(b,"https:"));a&&a.path&&(a.path=a.path.replace(b,"https:"))},_encode:function(a,b,d){var f,s,l={},k,r;for(k in a)if("declaredClass"!==
k&&(f=a[k],s=typeof f,null!==f&&void 0!==f&&"function"!==s))if(h.isArray(f)){l[k]=[];r=f.length;for(s=0;s<r;s++)l[k][s]=this._encode(f[s])}else"object"===s?f.toJson&&(s=f.toJson(d&&d[k]),"esri.tasks.FeatureSet"===f.declaredClass&&s.spatialReference&&(s.sr=s.spatialReference,delete s.spatialReference),l[k]=b?s:p.toJson(s)):l[k]=f;return l},_successHandler:function(a,b,f,h){b&&this[b].apply(this,a);f&&f.apply(null,a);h&&d._resDfd(h,a)},_errorHandler:function(a,b,d){this.onError(a);b&&b(a);d&&d.errback(a)},
setNormalization:function(a){this.normalization=a},onError:function(){}});r("extend-esri")&&(f.Task=l);return l})},"esri/tasks/ImageServiceIdentifyResult":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../geometry/jsonUtils ./FeatureSet".split(" "),function(l,h,p,r,f,d){l=l(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(b){b.catalogItems&&(this.catalogItems=new d(b.catalogItems));b.location&&(this.location=f.fromJson(b.location));this.catalogItemVisibilities=
b.catalogItemVisibilities;this.name=b.name;this.objectId=b.objectId;this.value=b.value;this.processedValues=b.processedValues;this.properties=b.properties}});p("extend-esri")&&h.setObject("tasks.ImageServiceIdentifyResult",l,r);return l})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(l,h,p,r,f,d,b,a,e,g,n){l=l(null,
{declaredClass:"esri.tasks.FeatureSet",constructor:function(d){if(d){h.mixin(this,d);var e=this.features,f=d.spatialReference,k=g.getGeometryType(d.geometryType),f=this.spatialReference=new a(f);this.geometryType=d.geometryType;d.fields&&(this.fields=d.fields);p.forEach(e,function(a,d){var g=a.geometry&&a.geometry.spatialReference;e[d]=new b(k&&a.geometry?new k(a.geometry):null,a.symbol&&n.fromJson(a.symbol),a.attributes);e[d].geometry&&!g&&e[d].geometry.setSpatialReference(f)});this._hydrate()}else this.features=
[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,toJson:function(a){var b={};this.displayFieldName&&(b.displayFieldName=this.displayFieldName);this.fields&&(b.fields=this.fields);this.spatialReference?b.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(b.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(b.geometryType=g.getJsonType(this.features[0].geometry)),
b.features=e._encodeGraphics(this.features,a));b.exceededTransferLimit=this.exceededTransferLimit;b.transform=this.transform;return d.fixJson(b)},_hydrate:function(){var a=this.transform,b=this.geometryType;if(a&&b)for(var d=this.features,e=a.translate[0],g=a.translate[1],f=a.scale[0],h=a.scale[1],l=function(a,b,d){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=d(a.y)};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){a=a.rings||a.paths;var e,g,f,h,k,l,m,c;
e=0;for(g=a.length;e<g;e++){k=a[e];f=0;for(h=k.length;f<h;f++)l=k[f],0<f?(m+=l[0],c+=l[1]):(m=l[0],c=l[1]),l[0]=b(m),l[1]=d(c)}};if("esriGeometryEnvelope"===a)return function(a){a.xmin=b(a.xmin);a.ymin=d(a.ymin);a.xmax=b(a.xmax);a.ymax=d(a.ymax)};if("esriGeometryMultipoint"===a)return function(a){a=a.points;var e,f,g,h,k;e=0;for(f=a.length;e<f;e++)g=a[e],0<e?(h+=g[0],k+=g[1]):(h=g[0],k=g[1]),g[0]=b(h),g[1]=d(k)}}(b,function(a){return a*f+e},function(a){return g-a*h}),a=0,b=d.length;a<b;a++)d[a].geometry&&
l(d[a].geometry);this.transform=null},quantize:function(a){if(!this.geometryType)return this.transform=null,this;var b=a.translate[0],d=a.translate[1],e=a.scale[0],g=a.scale[1],f=this.features,h=function(a,b,d){var e,f,g,h,k,l,c=[];e=0;for(f=a.length;e<f;e++)if(g=a[e],0<e){if(l=b(g[0]),g=d(g[1]),l!==h||g!==k)c.push([l-h,g-k]),h=l,k=g}else h=b(g[0]),k=d(g[1]),c.push([h,k]);return 0<c.length?c:null},l=function(a,b,d){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=d(a.y);return a};if("esriGeometryPolyline"===
a||"esriGeometryPolygon"===a)return function(a){var e,g,f,k,l;f=a.rings||a.paths;l=[];e=0;for(g=f.length;e<g;e++)k=f[e],(k=h(k,b,d))&&l.push(k);return 0<l.length?(a.rings?a.rings=l:a.paths=l,a):null};if("esriGeometryMultipoint"===a)return function(a){var e;e=h(a.points,b,d);return 0<e.length?(a.points=e,a):null};if("esriGeometryEnvelope"===a)return function(a){return a}}(this.geometryType,function(a){return Math.round((a-b)/e)},function(a){return Math.round((d-a)/g)}),n,p;n=0;for(p=f.length;n<p;n++)f[n].geometry&&
(l(f[n].geometry)||f[n].setGeometry(null));this.transform=a;return this}});r("extend-esri")&&h.setObject("tasks.FeatureSet",l,f);return l})},"esri/tasks/ImageServiceIdentifyParameters":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/_base/array dojo/has ../kernel ../lang ../geometry/jsonUtils".split(" "),function(l,h,p,r,f,d,b,a){l=l(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,renderingRules:null,pixelSizeX:null,
pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(d){var g=d&&d.geometry||this.geometry;d={geometry:g,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,mosaicRule:this.mosaicRule?p.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?p.toJson(this.renderingRule.toJson()):null};g&&(d.geometryType=a.getJsonType(g));g=this.timeExtent;d.time=g?g.toJson().join(","):null;b.isDefined(this.pixelSizeX)&&b.isDefined(this.pixelSizeY)?
d.pixelSize=p.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(d.pixelSize=this.pixelSize?p.toJson(this.pixelSize.toJson()):null);this.renderingRules&&(d.renderingRules=p.toJson(r.map(this.renderingRules,function(a){return a.toJson()})));return d}});f("extend-esri")&&h.setObject("tasks.ImageServiceIdentifyParameters",l,d);return l})},"*noref":1}});
define("esri/layers/ArcGISImageServiceLayer","dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../config ./DynamicMapServiceLayer ./ImageServiceLayerMixin".split(" "),function(l,h,p,r,f,d,b){l=l([d,b],{declaredClass:"esri.layers.ArcGISImageServiceLayer",constructor:function(a,b){this._initialize(a,b);this.useMapImage=b&&b.useMapImage||!1},refresh:function(a){if(a)this.inherited(arguments);else{var b=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=
b}},exportMapImage:function(a,b){var d=f.defaults.map,d=h.mixin({size:d.width+","+d.height},this._params,a?a.toJson(this.normalization):{},{f:"json"});delete d._ts;this._exportMapImage(this._url.path+"/exportImage",d,b)}});p("extend-esri")&&h.setObject("layers.ArcGISImageServiceLayer",l,r);return l});