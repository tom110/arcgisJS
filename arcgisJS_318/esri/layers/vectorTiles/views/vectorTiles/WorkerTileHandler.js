// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.18/esri/copyright.txt for details.
//>>built
define("esri/layers/vectorTiles/views/vectorTiles/WorkerTileHandler","require exports dojo/Deferred ../../core/promiseUtils ./WorkerTile ./style/StyleRepository".split(" "),function(n,p,k,e,l,m){return function(){function b(){this._tiles={};this._spriteInfo={};this._glyphInfo={}}b.prototype.reset=function(){var a=new k;this._spriteInfo={};this._glyphInfo={};var h=this._tiles,b;for(b in h){var c=h[b];c&&c.setObsolete()}this._tiles={};a.resolve();return a.promise};b.prototype.getLayers=function(){return this._layers};
b.prototype.setLayers=function(a){this._layers=(new m(a)).layers;return e.resolve({data:""})};b.prototype.getTile=function(a,b){var d=this;this._tiles[a.key]&&delete this._tiles[a.key];var c=new l(a.key,a.refKey,this,a.rotation);this._tiles[a.key]=c;return b.invoke("fetchTileData",a.refKey).then(function(a){return c.setDataAndParse(a.protobuff,b).then(function(a){return a})}).otherwise(function(a){c.setObsolete();delete d._tiles[c.tileKey]}).always(function(a){return a})};b.prototype.update=function(a){var b=
this._tiles[a.key];return!b?e.reject():b.updateSymbols(a.rotation)};b.prototype.destructTileData=function(a){this._tiles[a.key]&&delete this._tiles[a.key];return e.resolve()};b.prototype.fetchSprites=function(a,b){var d=[],c=this._spriteInfo;a.forEach(function(a){void 0===c[a]&&d.push(a)});return 0===d.length?e.resolve():b.invoke("getSprites",{sprites:d}).then(function(a){a=a.spriteItems;for(var b in a)c[b]=a[b]})};b.prototype.getSpriteItems=function(){return this._spriteInfo};b.prototype.fetchGlyphs=
function(a,b,d,c){var f=[],g=this._glyphInfo[b];g?d.forEach(function(a){g[a]||f.push(a)}):(g=this._glyphInfo[b]=[],d.forEach(function(a){return f.push(a)}));return 0===f.length?e.resolve():c.invoke("getGlyphs",{tileID:a,font:b,codePoints:f}).then(function(a){a=a.glyphItems;for(var b in a)g[b]=a[b]})};b.prototype.getGlyphItems=function(a){return this._glyphInfo[a]};return b}()});