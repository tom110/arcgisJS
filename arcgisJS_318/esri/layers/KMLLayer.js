// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.18/esri/copyright.txt for details.
//>>built
require({cache:{"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(n,p,h,k,d,a,r,b){n=n([a,r],{declaredClass:"esri.dijit.PopupTemplate","-chains-":{constructor:"manual"},chartTheme:null,constructor:function(a,e){p.mixin(this,e);this.initialize(a,e)},getTitle:function(a){var e;this.info&&(e=this.titleHasRelatedFields?"":this._getPopupValues(a,!0).title);return e||""},
getContent:function(a){return this.info?(new b({template:this,graphic:a,chartTheme:this.chartTheme},k.create("div"))).domNode:""}});h("extend-esri")&&p.setObject("dijit.PopupTemplate",n,d);return n})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/StatisticDefinition dojo/i18n!dojo/cldr/nls/number".split(" "),function(n,
p,h,k,d,a,r,b,l,e,v,A,F,t,x,H){n=n(null,{declaredClass:"esri.PopupInfo",initialize:function(m,a){if(m){p.mixin(this,a);this.info=m;this.title=this.getTitle;this.content=this.getContent;var e=this._fieldLabels={},d=this._fieldsMap={};m.fieldInfos&&h.forEach(m.fieldInfos,function(m){var s=m.fieldName.toLowerCase();e[s]=m.label;d[s]=m});this._relatedFieldPrefix="relationships/";this.titleHasRelatedFields=!!(m.title&&-1!==m.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return k.fromJson(k.toJson(this.info))},
getTitle:function(){},getContent:function(){},getFieldInfo:function(m){var a;h.some(this.info&&this.info.fieldInfos,function(e){e.fieldName===m&&(a=e);return!!a});return a},getComponents:function(m){var a=this.info,e=new r,d,b;a.fieldInfos&&(b=h.filter(a.fieldInfos,function(m){return-1!==m.fieldName.indexOf(this._relatedFieldPrefix)},this));b&&0<b.length&&(d=this._getRelatedRecords({graphic:m,fieldsInfo:b}));d?d.always(p.hitch(this,function(){e.resolve(this._getPopupValues(m))})):e.resolve(this._getPopupValues(m));
return e.promise},getAttachments:function(m){var a=m.getLayer();m=m.attributes;if(this.info.showAttachments&&(a&&a.hasAttachments&&a.objectIdField)&&(m=m&&m[a.objectIdField]))return a.queryAttachmentInfos(m)},_getPopupValues:function(m,a){var d=this.info,b=m.getLayer(),l=p.clone(m.attributes)||{},s=p.clone(l),y=d.fieldInfos,q="",f="",g,c,w,D,K,k=b&&b._getDateOpts&&b._getDateOpts().properties,k=k&&k.slice(0),G={dateFormat:{properties:k,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};
if(this._relatedInfo)for(D in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(D)){var r=this._relatedInfo[D],v=this._relatedLayersInfo[D];r&&(h.forEach(r.relatedFeatures,function(c){for(K in c.attributes)if(c.attributes.hasOwnProperty(K)&&"esriRelCardinalityOneToOne"===v.relation.cardinality){var g=this._toRelatedFieldName([v.relation.id,K]);l[g]=s[g]=c.attributes[K]}},this),h.forEach(r.relatedStatsFeatures,function(c){for(K in c.attributes)if(c.attributes.hasOwnProperty(K)){var g=this._toRelatedFieldName([v.relation.id,
K]);l[g]=s[g]=c.attributes[K]}},this))}y&&h.forEach(y,function(g){c=g.fieldName;var f=this._getLayerFieldInfo(b,c);f&&(c=g.fieldName=f.name);s[c]=this._formatValue(s[c],c,G);k&&(g.format&&g.format.dateFormat)&&(g=h.indexOf(k,c),-1<g&&k.splice(g,1))},this);if(b){D=b.types;var F=(r=b.typeIdField)&&l[r];for(c in l)if(l.hasOwnProperty(c)&&-1===c.indexOf(this._relatedFieldPrefix)&&(w=l[c],e.isDefined(w))){var n=this._getDomainName(b,m,D,F,c,w);e.isDefined(n)?s[c]=n:c===r&&(n=this._getTypeName(b,m,w),e.isDefined(n)&&
(s[c]=n))}}d.title&&(q=this._processFieldsInLinks(this._fixTokens(d.title,b),l),q=p.trim(e.substitute(s,q,G)||""));if(a)return{title:q};d.description&&(f=this._processFieldsInLinks(this._fixTokens(d.description,b),l),f=p.trim(e.substitute(s,f,G)||""));y&&(g=[],h.forEach(y,function(f){(c=f.fieldName)&&f.visible&&g.push([f.label||c,e.substitute(s,"${"+c+"}",G)||""])}));var A,t;d.mediaInfos&&(A=[],h.forEach(d.mediaInfos,function(c){t=0;w=c.value;switch(c.type){case "image":var g=w.sourceURL,g=g&&p.trim(e.substitute(l,
this._fixTokens(g,b)));t=!!g;break;case "piechart":case "linechart":case "columnchart":case "barchart":var f,g=w.normalizeField;w.fields=h.map(w.fields,function(c){return(f=this._getLayerFieldInfo(b,c))?f.name:c},this);g&&(f=this._getLayerFieldInfo(b,g),w.normalizeField=f?f.name:g);t=h.some(w.fields,function(c){return e.isDefined(l[c])||-1!==c.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(t){c=p.clone(c);w=c.value;var g=c.title?this._processFieldsInLinks(this._fixTokens(c.title,
b),l):"",D=c.caption?this._processFieldsInLinks(this._fixTokens(c.caption,b),l):"";c.title=g?p.trim(e.substitute(s,g,G)||""):"";c.caption=D?p.trim(e.substitute(s,D,G)||""):"";if("image"===c.type)w.sourceURL=e.substitute(l,this._fixTokens(w.sourceURL,b)),w.linkURL&&(w.linkURL=p.trim(e.substitute(l,this._fixTokens(w.linkURL,b))||""));else{var m,q;h.forEach(w.fields,function(c,g){if(-1!==c.indexOf(this._relatedFieldPrefix))q=this._getRelatedChartInfos(c,w,l,G),q instanceof Array?w.fields=q:w.fields[g]=
q;else{var f=l[c],f=void 0===f?null:f;m=l[w.normalizeField]||0;f&&m&&(f/=m);w.fields[g]={y:f,tooltip:(this._fieldLabels[c.toLowerCase()]||c)+":\x3cbr/\x3e"+this._formatValue(f,c,G,!!m)}}},this)}A.push(c)}},this));return{title:q,description:f,hasDescription:!!d.description,fields:g&&g.length?g:null,mediaInfos:A&&A.length?A:null,formatted:s,editSummary:b&&b.getEditSummary?b.getEditSummary(m):""}},_getRelatedChartInfos:function(m,a,b,e){var d,s,y,q,f,g;d=[];g=this._fromRelatedFieldName(m);f=g[0];s=this._relatedInfo[f];
f=this._relatedLayersInfo[f];s&&h.forEach(s.relatedFeatures,function(c){c=c.attributes;var f,D;for(D in c)if(c.hasOwnProperty(D)&&D===g[1]){f={};q=c[D];a.normalizeField&&(y=-1!==a.normalizeField.indexOf(this._relatedFieldPrefix)?c[this._fromRelatedFieldName(a.normalizeField)[1]]:b[a.normalizeField]);q&&y&&(q/=y);if(a.tooltipField)if(-1!==a.tooltipField.indexOf(this._relatedFieldPrefix)){var s=this._fromRelatedFieldName(a.tooltipField)[1];f.tooltip=c[s]&&"string"===typeof c[s]?c[s]+":\x3cbr/\x3e"+
this._formatValue(q,c[s],e,!!y):s+":\x3cbr/\x3e"+this._formatValue(q,s,e,!!y)}else f.tooltip=(this._fieldLabels[m.toLowerCase()]||m)+":\x3cbr/\x3e"+this._formatValue(q,a.tooltipField,e,!!y);else f.tooltip=q;f.y=q;d.push(f)}},this);return"esriRelCardinalityOneToMany"===f.relation.cardinality||"esriRelCardinalityManyToMany"===f.relation.cardinality?d:d[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",
dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",
shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",
year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,_fixTokens:function(m,a){var e=this;return m.replace(/(\{([^\{\r\n]+)\})/g,function(m,b,s){m=e._getLayerFieldInfo(a,s);return"$"+(m?"{"+m.name+"}":b)})},_encodeAttributes:function(m){m=p.clone(m)||{};var a,e;for(a in m)if((e=m[a])&&"string"===typeof e)e=encodeURIComponent(e).replace(/\'/g,"\x26apos;"),m[a]=e;return m},_processFieldsInLinks:function(m,a){var e=this._encodeAttributes(a),
b=this;m&&(m=m.replace(this._reHref,function(m,s){return b._addValuesToHref(m,s,a,e)}).replace(this._reHrefApos,function(m,s){return b._addValuesToHref(m,s,a,e)}));return m},_addValuesToHref:function(m,a,b,d){a=a&&p.trim(a);return e.substitute(a&&0===a.indexOf("${")?b:d,m)},_getLayerFieldInfo:function(m,a){return m&&m.getField?m.getField(a):null},_formatValue:function(m,a,b,d){var l=this._fieldsMap[a.toLowerCase()],s=l&&l.format;a=-1!==h.indexOf(b.dateFormat.properties,a);var y="number"===typeof m&&
!a&&(!s||!s.dateFormat);if(!e.isDefined(m)||!l||!e.isDefined(s))return y?this._forceLTR(m):m;var q="",l=[],f=s.hasOwnProperty("places")||s.hasOwnProperty("digitSeparator"),g=s.hasOwnProperty("digitSeparator")?s.digitSeparator:!0;if(f&&!a)q="NumberFormat",l.push("places: "+(e.isDefined(s.places)&&(!d||0<s.places)?Number(s.places):"Infinity")),l.length&&(q+="("+l.join(",")+")");else if(s.dateFormat)q="DateFormat"+this._insertOffset(this._dateFormats[s.dateFormat]||this._dateFormats.shortDateShortTime);
else return y?this._forceLTR(m):m;var c=this._applyFormatting(m,q,b);f&&-1<m.constructor.toString().indexOf("Array")&&(c="",h.forEach(m,p.hitch(this,function(g){c=c+this._applyFormatting(g,q,b)+" "})));f&&!g&&H.group&&(c=c.replace(RegExp("\\"+H.group,"g"),""));a&&(c='\x3cspan class\x3d"esriDateValue"\x3e'+c+"\x3c/span\x3e");return y?this._forceLTR(c):c},_applyFormatting:function(a,b,d){return e.substitute({myKey:a},"${myKey:"+b+"}",d)||""},_forceLTR:function(a){var e=b("ie");return e&&10>=e?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+
a+"\x3c/span\x3e"},_insertOffset:function(a){a&&(a=e.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,e,b,d,l,s){return(a=a.getDomain&&a.getDomain(l,{feature:e}))&&a.codedValues?a.getName(s):null},_getTypeName:function(a,e,b){return(a=a.getType&&a.getType(e))&&a.name},_getRelatedRecords:function(a){var e=a.graphic,b=new r,d;this._relatedLayersInfo?this._queryRelatedLayers(e).then(p.hitch(this,function(a){this._setRelatedRecords(e,
a);b.resolve(a)}),p.hitch(this,this._handlerErrorResponse,b)):this._getRelatedLayersInfo(a).then(p.hitch(this,function(a){for(d in a)a.hasOwnProperty(d)&&a[d]&&(this._relatedLayersInfo[d].relatedLayerInfo=a[d]);this._queryRelatedLayers(e).then(p.hitch(this,function(a){this._setRelatedRecords(e,a);b.resolve(a)}),p.hitch(this,this._handlerErrorResponse,b))}),p.hitch(this,this._handlerErrorResponse,b));return b.promise},_getRelatedLayersInfo:function(a){var e=a.fieldsInfo,b,d,k={};b=a.graphic.getLayer();
this._relatedLayersInfo||(this._relatedLayersInfo={});h.forEach(e,function(a){var e,q,f,g;e=this._fromRelatedFieldName(a.fieldName);q=e[0];e=e[1];q&&(this._relatedLayersInfo[q]||(h.some(b.relationships,function(c){if(c.id==q)return g=c,!0}),g&&(this._relatedLayersInfo[q]={relation:g,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[q]&&(this._relatedLayersInfo[q].relatedFields.push(e),a.statisticType&&(f=new x,f.statisticType=a.statisticType,f.onStatisticField=e,f.outStatisticFieldName=
e,this._relatedLayersInfo[q].outStatistics.push(f))))},this);for(d in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(d)&&this._relatedLayersInfo[d]&&(a=this._relatedLayersInfo[d].relation,a=b.url.replace(/[0-9]+$/,a.relatedTableId),this._relatedLayersInfo[d].relatedLayerUrl=a,k[d]=A({url:a,content:{f:"json"},callbackParamName:"callback"}));return l(k)},_queryRelatedLayers:function(a){var e={},b;for(b in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(b)&&(e[b]=this._queryRelatedLayer({graphic:a,
relatedInfo:this._relatedLayersInfo[b]}));return l(e)},_queryRelatedLayer:function(a){var e,b,d,k,s,y,q,f,g,c;e=a.graphic;b=e.getLayer().url.match(/[0-9]+$/g)[0];f=a.relatedInfo;q=f.relatedLayerInfo;g=f.relatedLayerUrl;c=f.relation;h.some(q.relationships,function(c){if(c.relatedTableId===parseInt(b,10))return d=c,!0},this);d&&(a=new F,h.some(q.fields,function(c){if(c.name===d.keyField)return s=-1!==h.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],
c.type)?"number":"string",!0}),k="string"===s?d.keyField+"\x3d'"+e.attributes[c.keyField]+"'":d.keyField+"\x3d"+e.attributes[c.keyField],a.where=k,a.outFields=f.relatedFields,f.outStatistics&&(0<f.outStatistics.length&&q.supportsStatistics)&&(y=new F,y.where=a.where,y.outFields=a.outFields,y.outStatistics=f.outStatistics),e=new t(g),k=[],k.push(e.execute(a)),y&&k.push(e.execute(y)));return l(k)},_setRelatedRecords:function(a,b){this._relatedInfo=[];for(var d in b)if(b.hasOwnProperty(d)&&b[d]){var l=
b[d];this._relatedInfo[d]={};this._relatedInfo[d].relatedFeatures=l[0].features;e.isDefined(l[1])&&(this._relatedInfo[d].relatedStatsFeatures=l[1].features)}},_handlerErrorResponse:function(a,e){a.reject(e)},_fromRelatedFieldName:function(a){var e=[];-1!==a.indexOf(this._relatedFieldPrefix)&&(a=a.split("/"),e=a.slice(1));return e},_toRelatedFieldName:function(a){var e="";a&&0<a.length&&(e=this._relatedFieldPrefix+a[0]+"/"+a[1]);return e}});a("extend-esri")&&(v.PopupInfo=v.PopupInfoTemplate=n);return n})},
"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),function(n,p,h,k,d,a,r,b,l,e,v,A,F,t,x,H,m,N,J,C){var I=0;p=p([J,x,H],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=
k.mixin({},C.widgets.popup)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this.template.getComponents(this.graphic).then(k.hitch(this,this._handleComponentsSuccess),k.hitch(this,this._handleComponentsError))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+
1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var b=this._mediaInfos,y=b.length,q=this.domNode,f=this._prevMedia,g=this._nextMedia;if(1<y){var c=0,w=0;d.forEach(b,function(g){"image"===g.type?c++:-1!==g.type.indexOf("chart")&&w++});c&&(e.set(this._imageCount,"innerHTML",c),a.query(".summary .image",q).removeClass("hidden"));w&&(e.set(this._chartCount,"innerHTML",w),a.query(".summary .chart",q).removeClass("hidden"))}else a.query(".summary",
q).addClass("hidden"),v.add(f,"hidden"),v.add(g,"hidden");b=this._mediaPtr;0===b?v.add(f,"hidden"):v.remove(f,"hidden");b===y-1?v.add(g,"hidden"):v.remove(g,"hidden");this._destroyFrame()},_displayMedia:function(){var b=this._mediaInfos[this._mediaPtr],d=b.title,q=b.caption,f=a.query(".mediaSection .hzLine",this.domNode)[0];e.set(this._mediaTitle,"innerHTML",d);v[d?"remove":"add"](this._mediaTitle,"hidden");e.set(this._mediaCaption,"innerHTML",q);v[q?"remove":"add"](this._mediaCaption,"hidden");v[d&&
q?"remove":"add"](f,"hidden");this._rid=null;if("image"===b.type)this._showImage(b.value);else{var g=this,d=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],q=b.value.theme||this.chartTheme;k.isString(q)&&(q=q.replace(/\./gi,"/"),-1===q.indexOf("/")&&(q="dojox/charting/themes/"+q));q||(q="./Rainbow");d.push(q);try{var c=this._rid=I++;n(d,function(a,f,w){c===g._rid&&(g._rid=null,g._showChart(b.type,b.value,a,f,w))})}catch(w){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(a){return(a=
a&&k.trim(a).toLowerCase())&&(0===a.indexOf("mailto:")||0===a.indexOf("tel:"))},_showImage:function(b){v.add(this._mediaFrame,"image");var e=F.get(this._gallery,"height"),d;b.linkURL&&(d=A.create("a",{href:b.linkURL,target:this._preventNewTab(b.linkURL)?"":"_blank"},this._mediaFrame));A.create("img",{className:"esriPopupMediaImage",src:b.sourceURL},d||this._mediaFrame);var f=a.query(".esriPopupMediaImage",this._mediaFrame)[0],g=this,c;c=h.connect(f,"onload",function(){h.disconnect(c);c=null;g._imageLoaded(f,
e)})},_showChart:function(a,b,e,f,g){v.remove(this._mediaFrame,"image");e=this._chart=new e(A.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});g&&e.setTheme(g);switch(a){case "piechart":e.addPlot("default",{type:"Pie",labels:!1});e.addSeries("Series A",b.fields);break;case "linechart":e.addPlot("default",{type:"Markers"});e.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});e.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});d.forEach(b.fields,
function(c,g){c.x=g+1});e.addSeries("Series A",b.fields);break;case "columnchart":e.addPlot("default",{type:"Columns",gap:3});e.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});e.addSeries("Series A",b.fields);break;case "barchart":e.addPlot("default",{type:"Bars",gap:3}),e.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),e.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),e.addSeries("Series A",b.fields)}this._action=new f(e);e.render()},
_destroyFrame:function(){this._rid=null;this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);e.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(a,e){var b=a.height;b<e&&(b=Math.round((e-b)/2),F.set(a,"marginTop",b+"px"))},_attListHandler:function(a,b){if(a===this._dfd){this._dfd=null;var q="";!(b instanceof Error)&&(b&&b.length)&&d.forEach(b,function(a){q+="\x3cli\x3e";q+="\x3ca href\x3d'"+N.addProxy(a.url)+"' target\x3d'_blank'\x3e"+
(a.name||"[No name]")+"\x3c/a\x3e";q+="\x3c/li\x3e"});e.set(this._attachmentsList,"innerHTML",q||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},_handleComponentsSuccess:function(b){if(b){var m=this.showTitle?b.title:"",q=b.description,f=b.fields,g=b.mediaInfos,c=this.domNode,w=this._nls,D=this,p=this.template,h=this.graphic;this._prevMedia.title=w.NLS_prevMedia;this._nextMedia.title=w.NLS_nextMedia;e.set(this._title,"innerHTML",m);m||v.add(this._title,"hidden");!b.hasDescription&&f&&(q="",d.forEach(f,
function(c){q+="\x3ctr valign\x3d'top'\x3e";q+="\x3ctd class\x3d'attrName'\x3e"+t.encode(c[0])+"\x3c/td\x3e";q+="\x3ctd class\x3d'attrValue'\x3e"+c[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+w.NLS_moreInfo+"\x3c/a\x3e")+"\x3c/td\x3e";q+="\x3c/tr\x3e"}),q&&(q="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+q+"\x3c/table\x3e"));e.set(this._description,"innerHTML",q);q||v.add(this._description,"hidden");a.query("a",
this._description).forEach(function(c){D._preventNewTab(c.href)?"_blank"===c.target&&e.remove(c,"target"):e.set(c,"target","_blank")});m&&q?a.query(".mainSection .hzLine",c).removeClass("hidden"):m||q?a.query(".mainSection .hzLine",c).addClass("hidden"):a.query(".mainSection",c).addClass("hidden");if(m=this._dfd=p.getAttachments(h))m.addBoth(k.hitch(this,this._attListHandler,m)),e.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+w.NLS_searching+"...\x3c/li\x3e"),a.query(".attachmentsSection",c).removeClass("hidden");
g&&g.length&&(a.query(".mediaSection",c).removeClass("hidden"),l.setSelectable(this._mediaFrame,!1),this._mediaInfos=g,this._mediaPtr=0,this._updateUI(),this._displayMedia());b.editSummary&&(e.set(this._editSummary,"innerHTML",b.editSummary),g&&g.length&&v.remove(this._mediaBreak,"hidden"),v.remove(this._editSummarySection,"hidden"))}},_handleComponentsError:function(a){console.log("PopupRenderer: error loading template",a)}});r("extend-esri")&&k.setObject("dijit._PopupRenderer",p,m);return p})},
"dojox/html/entities":function(){define(["dojo/_base/lang"],function(n){var p=n.getObject("dojox.html.entities",!0),h=function(d,a){var k,b;if(a._encCache&&a._encCache.regexp&&a._encCache.mapper&&a.length==a._encCache.length)k=a._encCache.mapper,b=a._encCache.regexp;else{k={};b=["["];var l;for(l=0;l<a.length;l++)k[a[l][0]]="\x26"+a[l][1]+";",b.push(a[l][0]);b.push("]");b=RegExp(b.join(""),"g");a._encCache={mapper:k,regexp:b,length:a.length}}return d=d.replace(b,function(a){return k[a]})},k=function(d,
a){var k,b;if(a._decCache&&a._decCache.regexp&&a._decCache.mapper&&a.length==a._decCache.length)k=a._decCache.mapper,b=a._decCache.regexp;else{k={};b=["("];var l;for(l=0;l<a.length;l++){var e="\x26"+a[l][1]+";";l&&b.push("|");k[e]=a[l][0];b.push(e)}b.push(")");b=RegExp(b.join(""),"g");a._decCache={mapper:k,regexp:b,length:a.length}}return d=d.replace(b,function(a){return k[a]})};p.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];p.latin=[["\u00a1","iexcl"],["\u00a2",
"cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],
["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],
["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1",
"ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],
["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],
["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],
["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],
["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665",
"hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039",
"lsaquo"],["\u203a","rsaquo"]];p.encode=function(d,a){d&&(a?d=h(d,a):(d=h(d,p.html),d=h(d,p.latin)));return d};p.decode=function(d,a){d&&(a?d=k(d,a):(d=k(d,p.html),d=k(d,p.latin)));return d};return p})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),function(n,p,h,k,d,a,r,b,l,e,v,A,F){function t(){}
function x(a){return function(b,e,d,l){return b&&"string"==typeof e&&b[e]==t?b.on(e.substring(2).toLowerCase(),r.hitch(d,l)):a.apply(h,arguments)}}n.around(h,"connect",x);a.connect&&n.around(a,"connect",x);n=k("dijit._Widget",[v,A,F],{onClick:t,onDblClick:t,onKeyDown:t,onKeyPress:t,onKeyUp:t,onMouseDown:t,onMouseMove:t,onMouseOut:t,onMouseOver:t,onMouseLeave:t,onMouseEnter:t,onMouseUp:t,constructor:function(a){this._toConnect={};for(var b in a)this[b]===t&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=
a[b],delete a[b])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===t?h.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(b,e){a.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.","","2.0");this.set(b,e)},attr:function(a,
b){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){a.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?b("[widgetId]",this.containerNode).map(e.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});d("dijit-legacy-requires")&&l(0,function(){require(["dijit/_base"])});return n})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(n,p,h,k,d,a,r,b,l,e,v,A,F,t,x,H,m,N,J,C,I,s,y){function q(g){return function(c){b[c?"set":"remove"](this.domNode,g,c);this._set(g,c)}}F.add("dijit-legacy-requires",!t.isAsync);F.add("dojo-bidi",!1);F("dijit-legacy-requires")&&m(0,function(){n(["dijit/_base/manager"])});var f={};k=a("dijit._WidgetBase",[N,I],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:q("lang"),dir:"",_setDirAttr:q("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(g){this._set("ownerDocument",g)},attributeMap:{},_blankGif:k.blankGif||n.toUrl("dojo/resources/blank.gif"),textDir:"",_introspect:function(){var g=this.constructor;if(!g._setterAttrs){var c=g.prototype,a=g._setterAttrs=[],g=g._onMap={},f;for(f in c.attributeMap)a.push(f);for(f in c)/^on/.test(f)&&(g[f.substring(2).toLowerCase()]=f),/^_set[A-Z](.*)Attr$/.test(f)&&(f=f.charAt(4).toLowerCase()+
f.substr(5,f.length-9),(!c.attributeMap||!(f in c.attributeMap))&&a.push(f))}},postscript:function(g,c){this.create(g,c)},create:function(g,c){this._introspect();this.srcNodeRef=r.byId(c);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&(this.srcNodeRef.id&&"string"==typeof this.srcNodeRef.id)&&(this.id=this.srcNodeRef.id);g&&(this.params=g,x.mixin(this,g));this.postMixInProperties();this.id||(this.id=y.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);
this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=C.body(this.ownerDocument);y.add(this);this.buildRendering();var a;if(this.domNode){this._applyAttributes();var f=this.srcNodeRef;f&&(f.parentNode&&this.domNode!==f)&&(f.parentNode.replaceChild(this.domNode,f),a=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();a&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var g={},c;for(c in this.params||
{})g[c]=this._get(c);p.forEach(this.constructor._setterAttrs,function(c){if(!(c in g)){var a=this._get(c);a&&this.set(c,a)}},this);for(c in g)this.set(c,g[c])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var g=this.baseClass.split(" ");this.isLeftToRight()||(g=g.concat(p.map(g,function(c){return c+"Rtl"})));l.add(this.domNode,g)}},postCreate:function(){},startup:function(){this._started||
(this._started=!0,p.forEach(this.getChildren(),function(g){!g._started&&(!g._destroyed&&x.isFunction(g.startup))&&(g.startup(),g._started=!0)}))},destroyRecursive:function(g){this._beingDestroyed=!0;this.destroyDescendants(g);this.destroy(g)},destroy:function(g){function c(c){c.destroyRecursive?c.destroyRecursive(g):c.destroy&&c.destroy(g)}this._beingDestroyed=!0;this.uninitialize();p.forEach(this._connects,x.hitch(this,"disconnect"));p.forEach(this._supportingWidgets,c);this.domNode&&p.forEach(y.findWidgets(this.domNode,
this.containerNode),c);this.destroyRendering(g);y.remove(this.id);this._destroyed=!0},destroyRendering:function(g){this.bgIframe&&(this.bgIframe.destroy(g),delete this.bgIframe);this.domNode&&(g?b.remove(this.domNode,"widgetId"):e.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(g||e.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(g){p.forEach(this.getChildren(),function(c){c.destroyRecursive&&c.destroyRecursive(g)})},uninitialize:function(){return!1},_setStyleAttr:function(g){var c=
this.domNode;x.isObject(g)?A.set(c,g):c.style.cssText=c.style.cssText?c.style.cssText+("; "+g):g;this._set("style",g)},_attrToDom:function(g,c,a){a=3<=arguments.length?a:this.attributeMap[g];p.forEach(x.isArray(a)?a:[a],function(a){var f=this[a.node||a||"domNode"];switch(a.type||"attribute"){case "attribute":x.isFunction(c)&&(c=x.hitch(this,c));a=a.attribute?a.attribute:/^on[A-Z][a-zA-Z]*$/.test(g)?g.toLowerCase():g;f.tagName?b.set(f,a,c):f.set(a,c);break;case "innerText":f.innerHTML="";f.appendChild(this.ownerDocument.createTextNode(c));
break;case "innerHTML":f.innerHTML=c;break;case "class":l.replace(f,c,this[g]);break;case "toggleClass":l.toggle(f,a.className||g,c)}},this)},get:function(g){var c=this._getAttrNames(g);return this[c.g]?this[c.g]():this._get(g)},set:function(g,c){if("object"===typeof g){for(var a in g)this.set(a,g[a]);return this}a=this._getAttrNames(g);var b=this[a.s];if(x.isFunction(b))var e=b.apply(this,Array.prototype.slice.call(arguments,1));else{var b=this.focusNode&&!x.isFunction(this.focusNode)?"focusNode":
"domNode",d=this[b]&&this[b].tagName,q;if(q=d)if(!(q=f[d])){q=this[b];var l={},k;for(k in q)l[k.toLowerCase()]=!0;q=f[d]=l}k=q;a=g in this.attributeMap?this.attributeMap[g]:a.s in this?this[a.s]:k&&a.l in k&&"function"!=typeof c||/^aria-|^data-|^role$/.test(g)?b:null;null!=a&&this._attrToDom(g,c,a);this._set(g,c)}return e||this},_attrPairNames:{},_getAttrNames:function(a){var c=this._attrPairNames;if(c[a])return c[a];var f=a.replace(/^[a-z]|-[a-zA-Z]/g,function(c){return c.charAt(c.length-1).toUpperCase()});
return c[a]={n:a+"Node",s:"_set"+f+"Attr",g:"_get"+f+"Attr",l:f.toLowerCase()}},_set:function(a,c){var f=this[a];this[a]=c;if(this._created&&!(f===c||f!==f&&c!==c))this._watchCallbacks&&this._watchCallbacks(a,f,c),this.emit("attrmodified-"+a,{detail:{prevValue:f,newValue:c}})},_get:function(a){return this[a]},emit:function(a,c,f){c=c||{};void 0===c.bubbles&&(c.bubbles=!0);void 0===c.cancelable&&(c.cancelable=!0);c.detail||(c.detail={});c.detail.widget=this;var b,e=this["on"+a];e&&(b=e.apply(this,
f?f:[c]));this._started&&!this._beingDestroyed&&H.emit(this.domNode,a.toLowerCase(),c);return b},on:function(a,c){var f=this._onMap(a);return f?h.after(this,f,c,!0):this.own(H(this.domNode,a,c))[0]},_onMap:function(a){var c=this.constructor,f=c._onMap;if(!f){var f=c._onMap={},b;for(b in c.prototype)/^on/.test(b)&&(f[b.replace(/^on/,"").toLowerCase()]=b)}return f["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?
y.findWidgets(this.containerNode):[]},getParent:function(){return y.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,c,f){return this.own(d.connect(a,c,this,f))[0]},disconnect:function(a){a.remove()},subscribe:function(a,c){return this.own(J.subscribe(a,x.hitch(this,c)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():v.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=A.get(this.domNode,"display")},
placeAt:function(a,c){var f=!a.tagName&&y.byId(a);f&&f.addChild&&(!c||"number"===typeof c)?f.addChild(this,c):(f=f&&"domNode"in f?f.containerNode&&!/after|before|replace/.test(c||"")?f.containerNode:f.domNode:r.byId(a,this.ownerDocument),e.place(this.domNode,f,c),!this._started&&(this.getParent()||{})._started&&this.startup());return this},defer:function(a,c){var f=setTimeout(x.hitch(this,function(){f&&(f=null,this._destroyed||x.hitch(this,a)())}),c||0);return{remove:function(){f&&(clearTimeout(f),
f=null);return null}}}});F("dojo-bidi")&&k.extend(s);return k})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(n,p,h){return h("dijit.Destroyable",null,{destroy:function(k){this._destroyed=!0},own:function(){var k=["destroyRecursive","destroy","remove"];n.forEach(arguments,function(d){function a(){b.remove();n.forEach(l,function(a){a.remove()})}var h,b=p.before(this,"destroy",function(a){d[h](a)}),l=[];d.then?(h="cancel",d.then(a,a)):n.forEach(k,
function(b){"function"===typeof d[b]&&(h||(h=b),l.push(p.after(d,b,a,!0)))})},this);return arguments}})})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(n,p,h,k,d,a){n=k("dijit._OnDijitClickMixin",null,{connect:function(d,b,l){return this.inherited(arguments,[d,"ondijitclick"==b?a:b,l])}});n.a11yclick=a;return n})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],
function(n,p,h,k){k.extend(p,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return h("dijit._FocusMixin",null,{_focusManager:n})})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(n,p,h,k){h(function(){p("highcontrast")&&n.add(k.body(),"dijit_a11y")});return p})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),
function(n,p,h,k,d,a,r){d.add("highcontrast",function(){var a=r.doc.createElement("div");try{a.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(p.blankGif||n.toUrl("./resources/blank.gif"))+'");';r.body().appendChild(a);var l=k.getComputedStyle(a),e=l.backgroundImage;return l.borderTopColor==l.borderRightColor||e&&("none"==e||"url(invalid-url:)"==e)}catch(h){return console.warn("hccss: exception detecting high-contrast mode, document is likely hidden: "+
h.toString()),!1}finally{8>=d("ie")?a.outerHTML="":r.body().removeChild(a)}});a(function(){d("highcontrast")&&h.add(r.body(),"dj_a11y")});return d})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(n,p,h,k,d,a,r){a.extend(n,{waiRole:"",waiState:""});return d("dijit._Templated",[p,h],{constructor:function(){r.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin",
"","2.0")},_processNode:function(a,d){var e=this.inherited(arguments),h=d(a,"waiRole");h&&a.setAttribute("role",h);(h=d(a,"waiState"))&&k.forEach(h.split(/\s*,\s*/),function(e){-1!=e.indexOf("-")&&(e=e.split("-"),a.setAttribute("aria-"+e[0],e[1]))});return e}})})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(n,p,h,k,d,a,r,b){var l=p("dijit._TemplatedMixin",b,{templateString:null,
templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(a){var b=this.declaredClass,d=this;return r.substitute(a,this,function(a,e){"!"==e.charAt(0)&&(a=k.getObject(e.substr(1),!1,d));if("undefined"==typeof a)throw Error(b+" template:"+e);return null==a?"":"!"==e.charAt(0)?a:this._escapeValue(""+a)},this)},_escapeValue:function(a){return a.replace(/["'<>&]/g,function(a){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[a]})},buildRendering:function(){if(!this._rendered){this.templateString||
(this.templateString=n(this.templatePath,{sanitize:!0}));var a=l.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),b;if(k.isString(a)){if(b=h.toDom(this._stringRepl(a),this.ownerDocument),1!=b.nodeType)throw Error("Invalid template: "+a);}else b=a.cloneNode(!0);this.domNode=b}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(a){var b=this.containerNode;if(a&&b)for(;a.hasChildNodes();)b.appendChild(a.firstChild)}});
l._templateCache={};l.getCachedTemplate=function(a,b,d){var k=l._templateCache,p=a,n=k[p];if(n){try{if(!n.ownerDocument||n.ownerDocument==(d||document))return n}catch(H){}h.destroy(n)}a=r.trim(a);if(b||a.match(/\$\{([^\}]+)\}/g))return k[p]=a;b=h.toDom(a,d);if(1!=b.nodeType)throw Error("Invalid template: "+a);return k[p]=b};a("ie")&&d(window,"unload",function(){var a=l._templateCache,b;for(b in a){var d=a[b];"object"==typeof d&&h.destroy(d);delete a[b]}});return l})},"dojo/cache":function(){define(["./_base/kernel",
"./text"],function(n){return n.cache})},"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(n,p,h,k,d,a,r,b,l){var e=d.delegate(b,{mouseenter:a.enter,mouseleave:a.leave,keypress:h._keypress}),v;h=k("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);
this._beforeFillContent()},_beforeFillContent:function(){},_attachTemplateNodes:function(a){for(var b=a;;)if(1==b.nodeType&&(this._processTemplateNode(b,function(a,b){return a.getAttribute(b)},this._attach)||this.searchContainerNode)&&b.firstChild)b=b.firstChild;else{if(b==a)break;for(;!b.nextSibling;)if(b=b.parentNode,b==a)return;b=b.nextSibling}},_processTemplateNode:function(a,b,e){var k=!0,l=this.attachScope||this,m=b(a,"dojoAttachPoint")||b(a,"data-dojo-attach-point");if(m)for(var h=m.split(/\s*,\s*/);m=
h.shift();)d.isArray(l[m])?l[m].push(a):l[m]=a,k="containerNode"!=m,this._attachPoints.push(m);if(b=b(a,"dojoAttachEvent")||b(a,"data-dojo-attach-event")){m=b.split(/\s*,\s*/);for(h=d.trim;b=m.shift();)if(b){var p=null;-1!=b.indexOf(":")?(p=b.split(":"),b=h(p[0]),p=h(p[1])):b=h(b);p||(p=b);this._attachEvents.push(e(a,b,d.hitch(l,p)))}}return k},_attach:function(a,b,d){b=b.replace(/^on/,"").toLowerCase();b="dijitclick"==b?v||(v=n("./a11yclick")):e[b]||b;return r(a,b,d)},_detachTemplateNodes:function(){var a=
this.attachScope||this;p.forEach(this._attachPoints,function(b){delete a[b]});this._attachPoints=[];p.forEach(this._attachEvents,function(a){a.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});d.extend(l,{dojoAttachEvent:"",dojoAttachPoint:""});return h})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(n,p,h,k,d){return h("dijit._WidgetsInTemplateMixin",
null,{_earlyTemplatedStartup:!1,contextRequire:null,_beforeFillContent:function(){if(/dojoType|data-dojo-type/i.test(this.domNode.innerHTML)){var a=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=!0);d.parse(a,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(k.hitch(this,function(a){this._startupWidgets=a;for(var b=0;b<a.length;b++)this._processTemplateNode(a[b],
function(a,b){return a[b]},function(a,b,d){return b in a?a.connect(a,b,d):a.on(b,d,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(a,d,b){return d(a,"dojoType")||d(a,"data-dojo-type")?
!0:this.inherited(arguments)},startup:function(){n.forEach(this._startupWidgets,function(a){a&&(!a._started&&a.startup)&&a.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(n,p,h,k,d,a,r,b,l,e,v,A,F,t,x,H){function m(a){return eval("("+a+")")}function N(a){var b=
a._nameCaseMap,d=a.prototype;if(!b||b._extendCnt<C){var b=a._nameCaseMap={},f;for(f in d)"_"!==f.charAt(0)&&(b[f.toLowerCase()]=f);b._extendCnt=C}return b}function J(a,b){b||(b=n);var d=b._dojoParserCtorMap||(b._dojoParserCtorMap={}),f=a.join();if(!d[f]){for(var g=[],c=0,e=a.length;c<e;c++){var k=a[c];g[g.length]=d[k]=d[k]||h.getObject(k)||~k.indexOf("/")&&b(k)}c=g.shift();d[f]=g.length?c.createSubclass?c.createSubclass(g):c.extend.apply(c,g):c}return d[f]}new Date("X");var C=0;l.after(h,"extend",
function(){C++},!0);var I={_clearCache:function(){C++;_ctorMap={}},_functionFromScript:function(a,b){var d="",f="",g=a.getAttribute(b+"args")||a.getAttribute("args"),c=a.getAttribute("with"),g=(g||"").split(/\s*,\s*/);c&&c.length&&k.forEach(c.split(/\s*,\s*/),function(a){d+="with("+a+"){";f+="}"});return new Function(g,d+a.innerHTML+f)},instantiate:function(a,b,d){b=b||{};d=d||{};var f=(d.scope||p._scopeName)+"Type",g="data-"+(d.scope||p._scopeName)+"-",c=g+"type",e=g+"mixins",l=[];k.forEach(a,function(a){var g=
f in b?b[f]:a.getAttribute(c)||a.getAttribute(f);if(g){var d=a.getAttribute(e),g=d?[g].concat(d.split(/\s*,\s*/)):[g];l.push({node:a,types:g})}});return this._instantiate(l,b,d)},_instantiate:function(a,b,d,f){function g(a){!b._started&&!d.noStart&&k.forEach(a,function(a){"function"===typeof a.startup&&!a._started&&a.startup()});return a}a=k.map(a,function(a){var f=a.ctor||J(a.types,d.contextRequire);if(!f)throw Error("Unable to resolve constructor for: '"+a.types.join()+"'");return this.construct(f,
a.node,b,d,a.scripts,a.inherited)},this);return f?e(a).then(g):g(a)},construct:function(a,d,e,f,g,c){function w(a){A&&h.setObject(A,a);for(B=0;B<C.length;B++)l[C[B].advice||"after"](a,C[B].method,h.hitch(a,C[B].func),!0);for(B=0;B<Q.length;B++)Q[B].call(a);for(B=0;B<O.length;B++)a.watch(O[B].prop,O[B].func);for(B=0;B<P.length;B++)x(a,P[B].event,P[B].func);return a}var D=a&&a.prototype;f=f||{};var n={};f.defaults&&h.mixin(n,f.defaults);c&&h.mixin(n,c);var r;F("dom-attributes-explicit")?r=d.attributes:
F("dom-attributes-specified-flag")?r=k.filter(d.attributes,function(a){return a.specified}):(c=(/^input$|^img$/i.test(d.nodeName)?d:d.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,""),r=k.map(c.split(/\s+/),function(a){var c=a.toLowerCase();return{name:a,value:"LI"==d.nodeName&&"value"==a||"enctype"==c?d.getAttribute(c):d.getAttributeNode(c).value}}));var G=f.scope||p._scopeName;c="data-"+G+"-";var u={};"dojo"!==G&&(u[c+"props"]=
"data-dojo-props",u[c+"type"]="data-dojo-type",u[c+"mixins"]="data-dojo-mixins",u[G+"type"]="dojotype",u[c+"id"]="data-dojo-id");for(var B=0,z,G=[],A,M;z=r[B++];){var E=z.name,L=E.toLowerCase();z=z.value;switch(u[L]||L){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;case "data-dojo-props":M=z;break;case "data-dojo-id":case "jsid":A=z;break;case "data-dojo-attach-point":case "dojoattachpoint":n.dojoAttachPoint=z;break;case "data-dojo-attach-event":case "dojoattachevent":n.dojoAttachEvent=
z;break;case "class":n["class"]=d.className;break;case "style":n.style=d.style&&d.style.cssText;break;default:if(E in D||(E=N(a)[L]||E),E in D)switch(typeof D[E]){case "string":n[E]=z;break;case "number":n[E]=z.length?Number(z):NaN;break;case "boolean":n[E]="false"!=z.toLowerCase();break;case "function":""===z||-1!=z.search(/[^\w\.]+/i)?n[E]=new Function(z):n[E]=h.getObject(z,!1)||new Function(z);G.push(E);break;default:L=D[E],n[E]=L&&"length"in L?z?z.split(/\s*,\s*/):[]:L instanceof Date?""==z?new Date(""):
"now"==z?new Date:v.fromISOString(z):L instanceof b?p.baseUrl+z:m(z)}else n[E]=z}}for(r=0;r<G.length;r++)u=G[r].toLowerCase(),d.removeAttribute(u),d[u]=null;if(M)try{M=m.call(f.propsThis,"{"+M+"}"),h.mixin(n,M)}catch(H){throw Error(H.toString()+" in data-dojo-props\x3d'"+M+"'");}h.mixin(n,e);g||(g=a&&(a._noScript||D._noScript)?[]:t("\x3e script[type^\x3d'dojo/']",d));var C=[],Q=[],O=[],P=[];if(g)for(B=0;B<g.length;B++)u=g[B],d.removeChild(u),e=u.getAttribute(c+"event")||u.getAttribute("event"),f=
u.getAttribute(c+"prop"),M=u.getAttribute(c+"method"),G=u.getAttribute(c+"advice"),r=u.getAttribute("type"),u=this._functionFromScript(u,c),e?"dojo/connect"==r?C.push({method:e,func:u}):"dojo/on"==r?P.push({event:e,func:u}):n[e]=u:"dojo/aspect"==r?C.push({method:M,advice:G,func:u}):"dojo/watch"==r?O.push({prop:f,func:u}):Q.push(u);a=(g=a.markupFactory||D.markupFactory)?g(n,d,a):new a(n,d);return a.then?a.then(w):w(a)},scan:function(a,b){function d(a){if(!a.inherited){a.inherited={};var c=a.node,b=
d(a.parent),c={dir:c.getAttribute("dir")||b.dir,lang:c.getAttribute("lang")||b.lang,textDir:c.getAttribute(h)||b.textDir},f;for(f in c)c[f]&&(a.inherited[f]=c[f])}return a.inherited}var f=[],g=[],c={},e=(b.scope||p._scopeName)+"Type",l="data-"+(b.scope||p._scopeName)+"-",m=l+"type",h=l+"textdir",l=l+"mixins",r=a.firstChild,u=b.inherited;if(!u){var v=function(a,c){return a.getAttribute&&a.getAttribute(c)||a.parentNode&&v(a.parentNode,c)},u={dir:v(a,"dir"),lang:v(a,"lang"),textDir:v(a,h)},z;for(z in u)u[z]||
delete u[z]}for(var u={inherited:u},t,x;;)if(r)if(1!=r.nodeType)r=r.nextSibling;else if(t&&"script"==r.nodeName.toLowerCase())(E=r.getAttribute("type"))&&/^dojo\/\w/i.test(E)&&t.push(r),r=r.nextSibling;else if(x)r=r.nextSibling;else{var E=r.getAttribute(m)||r.getAttribute(e);z=r.firstChild;if(!E&&(!z||3==z.nodeType&&!z.nextSibling))r=r.nextSibling;else{x=null;if(E){var C=r.getAttribute(l);t=C?[E].concat(C.split(/\s*,\s*/)):[E];try{x=J(t,b.contextRequire)}catch(H){}x||k.forEach(t,function(a){~a.indexOf("/")&&
!c[a]&&(c[a]=!0,g[g.length]=a)});C=x&&!x.prototype._noScript?[]:null;u={types:t,ctor:x,parent:u,node:r,scripts:C};u.inherited=d(u);f.push(u)}else u={node:r,scripts:t,parent:u};t=C;x=r.stopParser||x&&x.prototype.stopParser&&!b.template;r=z}}else{if(!u||!u.node)break;r=u.node.nextSibling;x=!1;u=u.parent;t=u.scripts}var I=new A;g.length?(F("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+g.join(", ")),(b.contextRequire||n)(g,function(){I.resolve(k.filter(f,function(a){if(!a.ctor)try{a.ctor=
J(a.types,b.contextRequire)}catch(c){}for(var f=a.parent;f&&!f.types;)f=f.parent;var g=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(g&&g.stopParser&&!b.template);a.instantiate=!f||f.instantiate&&f.instantiateChildren;return a.instantiate}))})):I.resolve(f);return I.promise},_require:function(a,b){var d=m("{"+a.innerHTML+"}"),f=[],g=[],c=new A,e=b&&b.contextRequire||n,k;for(k in d)f.push(k),g.push(d[k]);e(g,function(){for(var a=0;a<f.length;a++)h.setObject(f[a],arguments[a]);c.resolve(arguments)});
return c.promise},_scanAmd:function(a,b){var d=new A,f=d.promise;d.resolve(!0);var g=this;t("script[type\x3d'dojo/require']",a).forEach(function(a){f=f.then(function(){return g._require(a,b)});a.parentNode.removeChild(a)});return f},parse:function(b,d){b&&("string"!=typeof b&&!("nodeType"in b))&&(d=b,b=d.rootNode);var e=b?a.byId(b):r.body();d=d||{};var f=d.template?{template:!0}:{},g=[],c=this,k=this._scanAmd(e,d).then(function(){return c.scan(e,d)}).then(function(a){return c._instantiate(a,f,d,!0)}).then(function(a){return g=
g.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});h.mixin(g,k);return g}};p.parser=I;d.parseOnLoad&&H(100,I,"parse");return I})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(n,p){var h={};n.setObject("dojo.date.stamp",h);h.fromISOString=function(k,d){h._isoRegExp||(h._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);var a=h._isoRegExp.exec(k),r=null;
if(a){a.shift();a[1]&&a[1]--;a[6]&&(a[6]*=1E3);d&&(d=new Date(d),p.forEach(p.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(a){return d["get"+a]()}),function(b,d){a[d]=a[d]||b}));r=new Date(a[0]||1970,a[1]||0,a[2]||1,a[3]||0,a[4]||0,a[5]||0,a[6]||0);100>a[0]&&r.setFullYear(a[0]||1970);var b=0,l=a[7]&&a[7].charAt(0);"Z"!=l&&(b=60*(a[8]||0)+(Number(a[9])||0),"-"!=l&&(b*=-1));l&&(b-=r.getTimezoneOffset());b&&r.setTime(r.getTime()+6E4*b)}return r};h.toISOString=function(k,
d){var a=function(a){return 10>a?"0"+a:a};d=d||{};var h=[],b=d.zulu?"getUTC":"get",l="";"time"!=d.selector&&(l=k[b+"FullYear"](),l=["0000".substr((l+"").length)+l,a(k[b+"Month"]()+1),a(k[b+"Date"]())].join("-"));h.push(l);if("date"!=d.selector){l=[a(k[b+"Hours"]()),a(k[b+"Minutes"]()),a(k[b+"Seconds"]())].join(":");b=k[b+"Milliseconds"]();d.milliseconds&&(l+="."+(100>b?"0":"")+a(b));if(d.zulu)l+="Z";else if("time"!=d.selector)var b=k.getTimezoneOffset(),e=Math.abs(b),l=l+((0<b?"-":"+")+a(Math.floor(e/
60))+":"+a(e%60));h.push(l)}return h.join("T")};return h})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(n,p,h,k,d,a){return n([a,d],{_onMap:function(a){var b=this.constructor._onMap,d;if(!b||!b.FINAL)delete this.constructor._onMap,b=this.registerConnectEvents(),b.FINAL=!0;a=a.toLowerCase();b[a]?d=this[b[a].method]:(a=this._onCamelCase(a),this[a]&&(d=a));return d},on:function(a,b){var d=this._onMap(a),
e=a.replace(/\-/g,""),h="on"+e in this.domNode;return d||!h?this.inherited(arguments):this.own(k(this.domNode,e,b))[0]},emit:function(a,b,d){var e,k,h,n=a.toLowerCase(),t=this.constructor._onMap||this.registerConnectEvents();k=this[this._onMap(n)];b=b||{};b.target||(b.target=this);k&&(t&&t[n])&&(this._onObj2Arr(function(){e=Array.prototype.slice.call(arguments)},t[n].argKeys)(b),h=p.mixin({},arguments),h[2]=e,h[0]=t[n].name.replace(/^on/,""));return this.inherited(h||arguments)}})})},"esri/layers/KMLFolder":function(){define(["dojo/_base/declare",
"dojo/_base/lang","dojo/has","../kernel","../lang"],function(n,p,h,k,d){n=n(null,{declaredClass:"esri.layers.KMLFolder",constructor:function(a){p.mixin(this,a);d.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});h("extend-esri")&&p.setObject("layers.KMLFolder",n,k);return n})},"esri/layers/KMLGroundOverlay":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ./MapImage".split(" "),function(n,p,h,k,d,a){n=n([a],{declaredClass:"esri.layers.KMLGroundOverlay",
constructor:function(a){d.isDefined(this.visibility)&&(this.visible=!!this.visibility)}});h("extend-esri")&&p.setObject("layers.KMLGroundOverlay",n,k);return n})},"*noref":1}});
define("esri/layers/KMLLayer","dojo/_base/kernel dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/sniff dojo/io-query dojo/dom-construct dojo/dom-style ../kernel ../config ../lang ../request ../urlUtils ../SpatialReference ../geometry/webMercatorUtils ../dijit/PopupTemplate ./layer ./KMLFolder ./KMLGroundOverlay ./MapImageLayer ./FeatureLayer".split(" "),function(n,p,h,k,d,a,r,b,l,e,v,A,F,t,x,H,m,N,J,C,I,s,y){var q=p([J],{declaredClass:"esri.layers.KMLLayer",
serviceUrl:x.getProtocolForWebResource()+"//utility.arcgis.com/sharing/kml",constructor:function(a,b){a||console.log("KMLLayer:constructor - please provide url for the KML file");this._outSR=b&&b.outSR||new H({wkid:4326});this._options=k.mixin({},b);A.defaults.kmlService&&(this.serviceUrl=A.defaults.kmlService);var c=this.linkInfo=b&&b.linkInfo;c&&(this.visible=!!c.visibility,this._waitingForMap=!!c.viewFormat);(!c||c&&c.visibility&&!this._waitingForMap)&&this._parseKml();this.refresh=k.hitch(this,
this.refresh);this.registerConnectEvents("esri.layers.KMLLayer",!0)},getFeature:function(a){if(a){var b=a.type,c=a.id,e;switch(b){case "esriGeometryPoint":case "esriGeometryPolyline":case "esriGeometryPolygon":(a=this["_"+b])&&(e=k.getObject("_mode._featureMap."+c,!1,a));break;case "GroundOverlay":if(a=this._groundLyr){var h=a.getImages(),b=h.length;for(a=0;a<b;a++)if(h[a].id===c){e=h[a];break}}break;case "ScreenOverlay":break;case "NetworkLink":d.some(this._links,function(a){return a.linkInfo&&a.linkInfo.id===
c?(e=a,!0):!1});break;case "Folder":b=(h=this.folders)?h.length:0;for(a=0;a<b;a++)if(h[a].id===c){e=h[a];break}break;default:console.log("KMLLayer:getFeature - unknown feature type")}return e}},getLayers:function(){var a=[];this._groundLyr&&a.push(this._groundLyr);this._fLayers&&(a=a.concat(this._fLayers));this._links&&d.forEach(this._links,function(b){b.declaredClass&&a.push(b)});return a},setFolderVisibility:function(a,b){a&&(this._fireUpdateStart(),(a.visible=b)&&(b=this._areLocalAncestorsVisible(a)),
this._setState(a,b),this._fireUpdateEnd())},onRefresh:function(){},onOpacityChange:function(){},_parseKml:function(b){var g=this;this._fireUpdateStart();this._io=t({url:this.serviceUrl,content:{url:this._url.path+this._getQueryParameters(b),model:"simple",folders:"",refresh:this.loaded?!0:void 0,outSR:a.toJson(this._outSR.toJson())},callbackParamName:"callback",load:function(a){g._io=null;g._initLayer(a)},error:function(a){g._io=null;a=k.mixin(Error(),a);a.message="Unable to load KML: "+(a.message||
"");g._fireUpdateEnd(a);g.onError(a)}})},_initLayer:function(a){var b;this.loaded&&(b=[],d.forEach(this.folders,function(a){a.visible&&b.push(a.id)}),this._options.minScale=this.minScale,this._options.maxScale=this.maxScale,this._options.opacity=this.opacity,this._removeInternalLayers());this.name=a.name;this.description=a.description;this.snippet=a.snippet;this.visibility=a.visibility;this.featureInfos=a.featureInfos;var c,e,h=this.folders=a.folders,l=[],m;if(h){e=h.length;for(c=0;c<e;c++)m=h[c]=
new C(h[c]),-1===m.parentFolderId&&l.push(m)}var h=this._links=a.networkLinks,n;e=h?h.length:0;for(c=0;c<e;c++)h[c].viewRefreshMode&&-1!==h[c].viewRefreshMode.toLowerCase().indexOf("onregion")||(n=k.mixin({},this._options),n.linkInfo=h[c],n.id&&(n.id=n.id+"_"+c),h[c]=new q(h[c].href,n),h[c]._parentLayer=this,h[c]._parentFolderId=this._getLinkParentId(h[c].linkInfo.id));if((h=a.groundOverlays)&&0<h.length){n=k.mixin({},this._options);n.id&&(n.id+="_mapImage");m=this._groundLyr=new s(n);e=h.length;
for(c=0;c<e;c++)m.addImage(new I(h[c]))}if((a=k.getObject("featureCollection.layers",!1,a))&&0<a.length)this._fLayers=[],d.forEach(a,function(a,b){var c=k.getObject("featureSet.features",!1,a);c&&0<c.length&&(n=k.mixin({outFields:["*"],infoTemplate:a.popupInfo?new N(a.popupInfo):null,editable:!1},this._options),n.id&&(n.id=n.id+"_"+b),a.layerDefinition.capabilities="Query,Data",c=new y(a,n),c.geometryType&&(this["_"+c.geometryType]=c),this._fLayers.push(c))},this),0===this._fLayers.length&&delete this._fLayers;
if(!this.loaded){e=l.length;for(c=0;c<e;c++)m=l[c],this._setState(m,m.visible)}this._fireUpdateEnd();this.loaded?(this._addInternalLayers(),d.forEach(this.folders,function(a){-1<d.indexOf(b,a.id)?this.setFolderVisibility(a,!0):this.setFolderVisibility(a,!1)},this),this.onRefresh()):(this.loaded=!0,this.onLoad(this))},_addInternalLayers:function(){var a=this._map;this._fireUpdateStart();this._links&&d.forEach(this._links,function(b){b.declaredClass&&(a.addLayer(b),b._waitingForMap&&(b._waitingForMap=
null,b.visible?b._parseKml(a):b._wMap=a))});var b=a.spatialReference,c=this._outSR,e;if(!b.equals(c))if(b.isWebMercator()&&4326===c.wkid)e=m.geographicToWebMercator;else if(c.isWebMercator()&&4326===b.wkid)e=m.webMercatorToGeographic;else{console.log("KMLLayer:_setMap - unsupported workflow. Spatial reference of the map and kml layer do not match, and the conversion cannot be done on the client.");return}this._groundLyr&&(e&&d.forEach(this._groundLyr.getImages(),function(a){a.extent=e(a.extent)}),
a.addLayer(this._groundLyr));(b=this._fLayers)&&0<b.length&&d.forEach(b,function(b){if(e){var c=b.graphics,d,g,h=c?c.length:0;for(d=0;d<h;d++)(g=c[d].geometry)&&c[d].setGeometry(e(g))}a.addLayer(b)});this.onVisibilityChange(this.visible)},_removeInternalLayers:function(){var a=this._map;this._links&&d.forEach(this._links,function(a){a.declaredClass&&a._io&&a._io.cancel()});a&&d.forEach(this.getLayers(),a.removeLayer,a)},_setState:function(a,b){var c=a.featureInfos,d,e,h,k=c?c.length:0,l=b?"show":
"hide";for(h=0;h<k;h++)if(d=c[h],e=this.getFeature(d))if("Folder"===d.type)this._setState(e,b&&e.visible);else if("NetworkLink"===d.type)this._setInternalVisibility(e,b);else e[l]()},_areLocalAncestorsVisible:function(a){var b=a.parentFolderId;for(a=a.visible;a&&-1!==b;)b=this.getFeature({type:"Folder",id:b}),a=a&&b.visible,b=b.parentFolderId;return a},_setInternalVisibility:function(a,b){var c=a._parentLayer,d=a._parentFolderId;for(b=b&&a.visible;b&&c;)b=b&&c.visible,-1<d&&(b=b&&c._areLocalAncestorsVisible(c.getFeature({type:"Folder",
id:d}))),d=c._parentFolderId,c=c._parentLayer;this._setIntState(a,b)},_setIntState:function(a,b){a&&d.forEach(a.getLayers(),function(c){c.linkInfo?a._setIntState(c,b&&c.visible&&a._areLocalAncestorsVisible(a.getFeature({type:"Folder",id:c._parentFolderId}))):c.setVisibility(b)})},_getLinkParentId:function(a){var b=-1;this.folders&&d.some(this.folders,function(c){return c.networkLinkIds&&-1!==d.indexOf(c.networkLinkIds,a)?(b=c.id,!0):!1});return b},_checkAutoRefresh:function(){var a=this.linkInfo;
if(a)if(this.visible){if(this.loaded&&this._map){var b=a.refreshMode,c=a.refreshInterval,d=a.viewRefreshMode,a=a.viewRefreshTime;b&&(-1!==b.toLowerCase().indexOf("oninterval")&&0<c)&&(this._stopAutoRefresh(),this._timeoutHandle=setTimeout(this.refresh,1E3*c));d&&(-1!==d.toLowerCase().indexOf("onstop")&&0<a)&&!this._extChgHandle&&(this._extChgHandle=h.connect(this._map,"onExtentChange",this,this._extentChanged))}}else this._stopAutoRefresh(),h.disconnect(this._extChgHandle),delete this._extChgHandle},
_stopAutoRefresh:function(){clearTimeout(this._timeoutHandle);this._timeoutHandle=null},_getQueryParameters:function(a){a=a||this._map;var d={},c=this.linkInfo,e=a&&a.extent,h;this._url.query&&(k.mixin(d,this._url.query),h=!!this._url.query.token);if(v.id&&!h&&(h=v.id.findCredential(this._url.path)))d.token=h.token;if(c){h=c.viewFormat;var l=c.httpQuery,c=c.viewBoundScale;if(e&&h){var p=e,q=e,r=e.spatialReference;r&&(r.isWebMercator()?p=m.webMercatorToGeographic(e):4326===r.wkid&&(q=m.geographicToWebMercator(e)));
e=p.getCenter();q=Math.max(q.getWidth(),q.getHeight());c&&(p=p.expand(c));h=h.replace(/\[bboxWest\]/ig,p.xmin).replace(/\[bboxEast\]/ig,p.xmax).replace(/\[bboxSouth\]/ig,p.ymin).replace(/\[bboxNorth\]/ig,p.ymax).replace(/\[lookatLon\]/ig,e.x).replace(/\[lookatLat\]/ig,e.y).replace(/\[lookatRange\]/ig,q).replace(/\[lookatTilt\]/ig,0).replace(/\[lookatHeading\]/ig,0).replace(/\[lookatTerrainLon\]/ig,e.x).replace(/\[lookatTerrainLat\]/ig,e.y).replace(/\[lookatTerrainAlt\]/ig,0).replace(/\[cameraLon\]/ig,
e.x).replace(/\[cameraLat\]/ig,e.y).replace(/\[cameraAlt\]/ig,q).replace(/\[horizFov\]/ig,60).replace(/\[vertFov\]/ig,60).replace(/\[horizPixels\]/ig,a.width).replace(/\[vertPixels\]/ig,a.height).replace(/\[terrainEnabled\]/ig,0);k.mixin(d,b.queryToObject(h))}l&&(l=l.replace(/\[clientVersion\]/ig,v.version).replace(/\[kmlVersion\]/ig,2.2).replace(/\[clientName\]/ig,"ArcGIS API for JavaScript").replace(/\[language\]/ig,n.locale),k.mixin(d,b.queryToObject(l)))}a=[];for(var s in d)F.isDefined(d[s])&&
a.push(s+"\x3d"+d[s]);return(a=a.join("\x26"))?"?"+a:""},setScaleRange:function(a,b){this.inherited(arguments);d.forEach(this.getLayers(),function(c){c.setScaleRange(a,b)})},setOpacity:function(a){this.opacity!=a&&(d.forEach(this.getLayers(),function(b){b.setOpacity(a)}),this.opacity=a,this.onOpacityChange(a))},_setMap:function(a,b){this.inherited(arguments);this._map=a;var c=this._div=l.create("div",null,b);e.set(c,"position","absolute");this._addInternalLayers();this.evaluateSuspension();return c},
_unsetMap:function(a,b){this._io&&this._io.cancel();this._stopAutoRefresh();h.disconnect(this._extChgHandle);delete this._extChgHandle;this._removeInternalLayers();var c=this._div;c&&(b.removeChild(c),l.destroy(c));this._wMap=this._div=null;this.inherited(arguments)},onVisibilityChange:function(a){this.loaded?(this._fireUpdateStart(),this._setInternalVisibility(this,a),this._checkAutoRefresh(),this._fireUpdateEnd()):this.linkInfo&&a&&(this._waitingForMap||this._parseKml(this._wMap))},refresh:function(){this.loaded&&
(this._map&&!this._io&&this.visible)&&this._parseKml()},getFeatureCollection:function(a){var b,c=[];if(a=this.getFeature({type:"Folder",id:a}))(b=d.map(a.featureInfos,function(a){if("esriGeometryPoint"===a.type||"esriGeometryPolyline"===a.type||"esriGeometryPolygon"===a.type)return a.id},this))&&0<b.length&&d.forEach(this._fLayers,function(a){var e,f;e=a.toJson();e.featureSet.features&&0<e.featureSet.features.length&&(f=d.filter(e.featureSet.features,function(c){if(-1!==d.indexOf(b,c.attributes[a.objectIdField]))return c},
this));f&&0<f.length&&(e.featureSet.features=f,c.push(e))},this);return c},getFeatureCount:function(a){a=this.getFeature({type:"Folder",id:a});var b={points:0,polylines:0,polygons:0};a&&d.forEach(a.featureInfos,function(a){"esriGeometryPoint"===a.type&&(b.points+=1);"esriGeometryPolyline"===a.type&&(b.polylines+=1);"esriGeometryPolygon"===a.type&&(b.polygons+=1)});return b},_extentChanged:function(){this._stopAutoRefresh();this._timeoutHandle=setTimeout(this.refresh,1E3*this.linkInfo.viewRefreshTime)}});
r("extend-esri")&&k.setObject("layers.KMLLayer",q,v);return q});