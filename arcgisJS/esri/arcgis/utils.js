// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.14/esri/copyright.txt for details.
//>>built
require({cache:{"esri/layers/OnDemandMode":function(){define("dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/has ../kernel ../geometry/Point ../tasks/query ./RenderMode ./GridLayout".split(" "),function(p,l,h,q,r,f,w,m,b,e){p=p([b],{declaredClass:"esri.layers._OnDemandMode",constructor:function(c){this.featureLayer=c;this._featureMap={};this._queryErrorHandler=h.hitch(this,this._queryErrorHandler)},initialize:function(c){this.inherited(arguments);var g=this.featureLayer,
d=g._srInfo;this._gridLayer=new e(new w(d?d.valid[0]:c.extent.xmin,d?d.valid[1]:c.extent.ymax,c.spatialReference),{width:g._tileWidth,height:g._tileHeight},{width:c.width,height:c.height},d);this._cellMap={};this._gridLayer.setResolution(c.extent)},startup:function(){this._ioQueue=[];this.featureLayer.suspended||(this._zoomHandler(),this._enableConnectors())},propertyChangeHandler:function(c){this._init&&(2>c?this._zoomHandler():console.log("FeatureLayer: layer in on-demand mode does not support time definitions. Layer id \x3d "+
this.featureLayer.id+", Layer URL \x3d "+this.featureLayer.url))},destroy:function(){this._disableConnectors();this.inherited(arguments)},drawFeature:function(c){var g=this._gridLayer,d=c.geometry,b=[];if(d)for(var b=g.getCellsInExtent("point"===d.type?{xmin:d.x,ymin:d.y,xmax:d.x,ymax:d.y}:d.getExtent(),!1).cells,g=this._cellMap,e,a=c.attributes[this.featureLayer.objectIdField],k,t,x,d=0;d<b.length;d++)e=b[d],k=e.latticeID,t=e.row,x=e.col,k?e=g[k]=g[k]||e:(g[t]=g[t]||{},e=g[t][x]=g[t][x]||e),e.features=
e.features||[],e.features.push(c),this._addFeatureIIf(a,c),this._incRefCount(a)},suspend:function(){this._init&&this._disableConnectors()},resume:function(){this._init&&(this._enableConnectors(),this._zoomHandler())},refresh:function(){this._zoomHandler()},_enableConnectors:function(){var c=this.map;this._zoomConnect=l.connect(c,"onZoomEnd",this,this._zoomHandler);this._panConnect=l.connect(c,"onPanEnd",this,this._panHandler);this._resizeConnect=l.connect(c,"onResize",this,this._panHandler)},_disableConnectors:function(){l.disconnect(this._zoomConnect);
l.disconnect(this._panConnect);l.disconnect(this._resizeConnect)},_zoomHandler:function(){this._processIOQueue(!0);var c=this.featureLayer,g=this.map;c.suspended||(c._fireUpdateStart(),this._clearIIf(),(c=c._trackManager)&&c.clearTracks(),this._cellMap={},this._gridLayer.setResolution(g.extent),this._sendRequest())},_panHandler:function(c){this.featureLayer._fireUpdateStart();this._sendRequest(this.featureLayer._resized&&c)},_getRequestId:function(c,g){return("_"+c.name+c.layerId+c._ulid+"_"+g.resolution+
"_"+(g.latticeID||g.row+"_"+g.col)).replace(/[^a-zA-Z0-9\_]+/g,"_")},_sendRequest:function(c){this._exceeds=!1;var g=this.featureLayer,d=this.map;c=c||d.extent;d=this._gridLayer.getCellsInExtent(c,g.latticeTiling).cells;if(!g.isEditable())var b=this._cellMap,d=q.filter(d,function(a){if(a.lattice){if(b[a.latticeID])return!1}else if(b[a.row]&&b[a.row][a.col])return!1;return!0});var e=g.getOutFields(),a=g.getDefinitionExpression(),k=g._getOffsettedTE(g._mapTimeExtent),t=g.supportsAdvancedQueries?g.getOrderByFields():
null,x=g._usePatch,v=this._ioQueue,A,s=this,n=this._drawFeatures,u,f,J;this._pending=this._pending||0;for(A=0;A<d.length;A++){u=d[A];f=new m;f.geometry=u.extent||u.lattice;f.outFields=e;f.where=a;g.latticeTiling&&u.extent&&(f.spatialRelationship=m.SPATIAL_REL_CONTAINS);f.returnGeometry=!0;f.timeExtent=k;g._ts&&(f._ts=(new Date).getTime());f.orderByFields=t;f.multipatchOption=g.multipatchOption;f.maxAllowableOffset=g._maxOffset;f.quantizationParameters=g._quantizationParameters;J=null;if(x&&(J=this._getRequestId(g,
u),this._isPending(J)))continue;this._pending++;v.push(g._task.execute(f,function(){var a=u;return function(k){n.apply(s,[k,a])}}.call(this),this._queryErrorHandler,J))}this._removeOldCells(c);this._endCheck()},_drawFeatures:function(c,g){this._exceeds=this._exceeds||c.exceededTransferLimit;this._finalizeIO();var d=this.map.extent,b=g.extent,e=g.row,a=g.col,k=this.featureLayer.objectIdField,t=c.features,x=this._gridLayer,v=this._cellMap,A=g.latticeID,s=A?v[A]:v[e]&&v[e][a];if(g.resolution!=x._resolution||
(A?A!==x.getLatticeID(d):!x.intersects(b,d)))s&&this._removeCell(e,a,A);else if(s)this._updateCell(s,t);else{g.features=t;A?v[A]=g:(v[e]=v[e]||{},v[e][a]=g);b=t.length;for(d=0;d<b;d++)e=t[d],a=e.attributes[k],this._addFeatureIIf(a,e),this._incRefCount(a)}this._endCheck()},_queryErrorHandler:function(c){this._finalizeIO();this.featureLayer._errorHandler(c);this._endCheck(!0)},_finalizeIO:function(){this._purgeRequests();this._pending--},_endCheck:function(c){if(0===this._pending){this._processIOQueue();
var g=this.featureLayer,d=g._trackManager;d&&(d.clearTracks(),d.addFeatures(g.graphics),g._ager&&q.forEach(g.graphics,function(c){c._shape&&g._repaint(c)}),d.moveLatestToFront(),d.drawTracks());this.featureLayer._fireUpdateEnd(c&&Error("FeatureLayer: an error occurred while updating the layer"),this._exceeds?{queryLimitExceeded:!0}:null);if(this._exceeds)g.onQueryLimitExceeded()}},_processIOQueue:function(c){this._ioQueue=q.filter(this._ioQueue,function(c){return-1<c.fired?!1:!0});c&&q.forEach(this._ioQueue,
this._cancelPendingRequest)},_removeOldCells:function(c){var g=this._cellMap,d=this._gridLayer,b,e;for(b in g)if(g[b]){var a=g[b],k=a.latticeID,t=0,x=0;if(k)t++,k!==d.getLatticeID(c)&&(this._removeCell(null,null,k),x++);else for(e in a)a[e]&&(t++,d.intersects(a[e].extent,c)||(this._removeCell(b,e),x++));x===t&&delete g[b]}},_updateCell:function(c,g){var d=this.featureLayer,b=d.objectIdField,d=d._selectedFeatures,e,a=g.length;c.features=c.features||[];for(e=0;e<a;e++){var k=g[e],t=k.attributes[b],
x=this._addFeatureIIf(t,k);x===k?(this._incRefCount(t),c.features.push(x)):t in d||(x.setGeometry(k.geometry),x.setAttributes(k.attributes))}},_removeCell:function(c,g,d){var b=this._cellMap,e=this.featureLayer,a=e.objectIdField,k=d?b[d]:b[c]&&b[c][g];if(k){d?delete b[d]:delete b[c][g];c=k.features;for(g=0;g<c.length;g++)d=c[g].attributes[a],this._decRefCount(d),d in e._selectedFeatures||this._removeFeatureIIf(d)}}});r("extend-esri")&&h.setObject("layers._OnDemandMode",p,f);return p})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),
function(p,l,h,q,r,f){return p([f,r],{_onMap:function(f){var m=this.constructor._onMap,b;if(!m||!m.FINAL)delete this.constructor._onMap,m=this.registerConnectEvents(),m.FINAL=!0;f=f.toLowerCase();m[f]?b=this[m[f].method]:(f=this._onCamelCase(f),this[f]&&(b=f));return b},on:function(f,m){var b=this._onMap(f),e=f.replace(/\-/g,""),c="on"+e in this.domNode;return b||!c?this.inherited(arguments):this.own(q(this.domNode,e,m))[0]},emit:function(f,m,b){var e,c,g,d=f.toLowerCase(),h=this.constructor._onMap||
this.registerConnectEvents();c=this[this._onMap(d)];m=m||{};m.target||(m.target=this);c&&(h&&h[d])&&(this._onObj2Arr(function(){e=Array.prototype.slice.call(arguments)},h[d].argKeys)(m),g=l.mixin({},arguments),g[2]=e,g[0]=h[d].name.replace(/^on/,""));return this.inherited(g||arguments)}})})},"esri/layers/HeatmapManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/_base/array require ../kernel ../sniff ../geometry/Point ../geometry/webMercatorUtils ./MapImage ../renderers/HeatmapRenderer ../tasks/query dojo/_base/fx".split(" "),
function(p,l,h,q,r,f,w,m,b,e,c,g,d){function y(){}function z(a){var k=a.layer;return{geometry:a.geometry,attributes:a.attributes,getLayer:function(){return k}}}p=p(null,{declaredClass:"esri.layers.HeatmapManager",heatmapRenderer:null,sourceLayer:null,imageLayer:null,useTiles:!0,useWorker:!1,map:null,constructor:function(a){this.sourceLayer=a;this._hndls=[]},initialize:function(a){this.map=a;var k=this.sourceLayer,t=k.renderer;k.setDrawMode(!1);this.imageLayer=a._getMapImageLyr();var d=this;this.heatmapRenderer=
t instanceof c?t:(t.getRendererInfoByZoom(a.getZoom())||t.getRendererInfoByScale(a.getScale())).renderer;this._setupDraw=this._setupDraw.bind(this);this.recalculateHeatmap=this.recalculateHeatmap.bind(this);this._removeRenderer=this._removeRenderer.bind(this);this._handleRendererChange=this._handleRendererChange.bind(this);this._rendererChangeHandle=this.sourceLayer.on("renderer-change",this._handleRendererChange);this._handleOpacityChange=this._handleOpacityChange.bind(this);this._reprojectFeature=
this._reprojectFeature.bind(this);r(["../workers/heatmapCalculator"],function(a){d._calculator=new a(l.mixin({width:d.map.width,height:d.map.height},d._getOptions()));d._setupRenderer();d.heatmapRenderer.getStats=a.calculateStats;d.heatmapRenderer.getHistogramData=a.getHistogramData})},destroy:function(){this._removeHandlers();this._rendererChangeHandle&&this._rendererChangeHandle.remove();this._rendererChangeHandle=this.sourceLayer=this.imageLayer=this.map=this.heatmapRenderer=this._hndls=null},
_handleRendererChange:function(a){var k=a.renderer,t=k instanceof c;this.heatmapRenderer?t?this.heatmapRenderer=k:this._removeRenderer(a):t&&(this.heatmapRenderer=k,this.sourceLayer&&this.map&&this._setupRenderer())},_handleOpacityChange:function(a){a=a.opacity;var k=this._getImageBySourceId(this.sourceLayer.id);k&&k.setOpacity(a)},_setupRenderer:function(){var a=this._hndls,k=this.sourceLayer,c=this.map,d=this;k._originalDraw=k._draw;k._draw=y;k._div.clear();clearTimeout(this._resetTimer);this._resetTimer=
setTimeout(this._resetGraphics.bind(this),250);a.push(k.on("update-end",this._setupDraw));a.push(k.on("suspend",function(a){(a=d._getImageBySourceId(d.sourceLayer.id))&&a.hide()}));a.push(k.on("resume",function(a){(a=d._getImageBySourceId(d.sourceLayer.id))&&a.show()}));a.push(h.after(k,"redraw",this._setupDraw));a.push(c.on("layer-remove",function(a){a.layer==k&&((a=d._getImageBySourceId(d.sourceLayer.id))&&d.imageLayer.removeImage(a),d._removeRenderer({target:k}))}));k._collection&&a.push(k.on("graphic-add",
function(a){d._reprojectFeature(a.graphic);d._setupDraw()}));1!==k.mode&&(a.push(c.on("resize, pan-end",this._setupDraw)),a.push(c.on("zoom-end",this._setupDraw)));a.push(k.on("opacity-change",this._handleOpacityChange));this.imageLayer.suspended&&this.imageLayer.resume();k.graphics&&k.graphics.length&&(k.graphics[0].geometry&&!c.spatialReference.equals(k.graphics[0].geometry.spatialReference)&&q.forEach(k.graphics,function(a){this._reprojectFeature(a)}.bind(this)),this._setupDraw())},_setupDraw:function(){if(!this._drawTimer){var a=
this;this._drawTimer=setTimeout(function(){clearTimeout(a._drawTimer);a._drawTimer=null;a.sourceLayer._getRenderer().isInstanceOf(c)&&a.recalculateHeatmap()},16)}},_removeRenderer:function(a){var k=a.target;k._draw=k._originalDraw;delete k._originalDraw;k.setDrawMode(!0);this._removeHandlers();this._hndls=[];var c=this._getImageBySourceId(this.sourceLayer.id);c&&this.imageLayer.removeImage(c);clearTimeout(this._drawTimer);clearTimeout(this._resetTimer);this._drawTimer=this._resetTimer=null;k.renderer!=
a.renderer&&k.renderer.getRendererInfo?this.heatmapRenderer=null:(k.redraw(),this.destroy())},recalculateHeatmap:function(){this._calculator?this._doMainCalculation():this._calculatorClient&&this._doWorkerCalculation()},_reprojectFeature:function(a){if(a&&a.geometry){var k=a.geometry,c=this.map.spatialReference;c.equals(k.spatialReference)||(k=b.project(k,c),null==k?console.log("Unable to reproject features to map's spatial reference. Please convert feature geometry before adding to layer"):a.geometry=
k)}},_doWorkerCalculation:function(){},_doMainCalculation:function(){var a=this.sourceLayer,k=this.map,c=this.heatmapRenderer,d=this.map.extent,b=this.map.width,A=this.map.height,s=this._calculator,n=this,u=function(g){g=n._getScreenPoints(g.features,k,a);g=s.calculateImageData(l.mixin({screenPoints:g,mapinfo:{extent:[d.xmin,d.ymin,d.xmax,d.ymax],resolution:k.getResolution()},width:b,height:A},n._getOptions()));g=c.getSymbol(z({geometry:k.extent,attributes:{size:[b,A],imageData:g},layer:a}));g=new e({extent:k.extent,
href:g.url,opacity:0,sourceId:a.id});n._swapMapImages(g,n._getImageBySourceId(a.id));a.suspended&&g.hide()},f={geometry:k.extent,timeExtent:a.useMapTime?k.timeExtent:void 0,spatialRelationship:g.SPATIAL_REL_INTERSECTS};null!=a._canDoClientSideQuery(f)?a.queryFeatures(f,u):u({features:a.graphics})},_getScreenPoints:function(a,k,c){var d=[],g=a.length,b=0,e=0,n,u=new m(k.extent.xmin,k.extent.ymax,k.spatialReference),f=k.toScreen(u),J=f.x,f=f.y,h=k.getResolution(),B;for((e=k.extent.getCacheValue("_parts"))&&
(B=q.map(e,function(a){return c._intersects(k,a.extent)[0]}));g--;)e=a[g],e.geometry&&(n={x:Math.ceil((e.geometry.x-u.x)/h+J),y:Math.floor((u.y-e.geometry.y)/h-f),attributes:e.attributes},B&&(e=1<B.length&&n.x<-B[0]?B[1]:B[0],n.x+=e),d[b++]=n);return d},_getImageBySourceId:function(a){var k=this.imageLayer.getImages(),k=q.filter(k,function(k){return k.sourceId==a});if(k.length)return k[k.length-1]},_swapMapImages:function(a,k){function c(){g.removeImage(k)}var g=this.imageLayer,b=this.sourceLayer.opacity||
1;g.addImage(a);d.anim(a._node,{opacity:b},null,null,function(){a.opacity=b});null!=k&&d.anim(k._node,{opacity:0},null,null,c)},_removeHandlers:function(){if(null!=this._hndls)for(var a=this._hndls.length;a--;)this._hndls[a].remove()},_getOptions:function(){var a=this.heatmapRenderer;return{blurRadius:a.blurRadius,gradient:a.gradient,maxPixelIntensity:a.maxPixelIntensity,minPixelIntensity:a.minPixelIntensity,field:a.field,fieldOffset:a.fieldOffset}},_resetGraphics:function(){clearTimeout(this._resetTimer);
this._resetTimer=null;for(var a=this.sourceLayer.graphics,k=a.length,c;k--;)c=a[k],c._shape=c._offsets=void 0}});w("extend-esri")&&l.setObject("layers.HeatmapManager",p,f);return p})},"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(p,l,h,q,r,f,w){var m={_isElementShown:function(b){var e=q.get(b);return"hidden"!=e.visibility&&"collapsed"!=e.visibility&&"none"!=e.display&&"hidden"!=h.get(b,"type")},hasDefaultTabStop:function(b){switch(b.nodeName.toLowerCase()){case "a":return h.has(b,
"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;case "iframe":var e;try{var c=b.contentDocument;if("designMode"in c&&"on"==c.designMode)return!0;e=c.body}catch(g){try{e=b.contentWindow.document.body}catch(d){return!1}}return e&&("true"==e.contentEditable||e.firstChild&&"true"==e.firstChild.contentEditable);default:return"true"==b.contentEditable}},effectiveTabIndex:function(b){return h.get(b,"disabled")?void 0:h.has(b,"tabIndex")?+h.get(b,"tabIndex"):
m.hasDefaultTabStop(b)?0:void 0},isTabNavigable:function(b){return 0<=m.effectiveTabIndex(b)},isFocusable:function(b){return-1<=m.effectiveTabIndex(b)},_getTabNavigable:function(b){function e(a){return a&&"input"==a.tagName.toLowerCase()&&a.type&&"radio"==a.type.toLowerCase()&&a.name&&a.name.toLowerCase()}var c,g,d,l,r,a,k={},t=m._isElementShown,x=m.effectiveTabIndex,v=function(b){for(b=b.firstChild;b;b=b.nextSibling)if(!(1!=b.nodeType||9>=f("ie")&&"HTML"!==b.scopeName||!t(b))){var s=x(b);if(0<=s){if(0==
s)c||(c=b),g=b;else if(0<s){if(!d||s<l)l=s,d=b;if(!r||s>=a)a=s,r=b}s=e(b);h.get(b,"checked")&&s&&(k[s]=b)}"SELECT"!=b.nodeName.toUpperCase()&&v(b)}};t(b)&&v(b);return{first:k[e(c)]||c,last:k[e(g)]||g,lowest:k[e(d)]||d,highest:k[e(r)]||r}},getFirstInTabbingOrder:function(b,e){var c=m._getTabNavigable(l.byId(b,e));return c.lowest?c.lowest:c.first},getLastInTabbingOrder:function(b,e){var c=m._getTabNavigable(l.byId(b,e));return c.last?c.last:c.highest}};r.mixin(w,m);return m})},"esri/layers/StreamMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../tasks/query ../tasks/QueryTask ../geometry/jsonUtils ./RenderMode".split(" "),
function(p,l,h,q,r,f,w,m,b,e){p=p([e],{declaredClass:"esri.layers._StreamMode",constructor:function(c,b){this.featureLayer=c;this._featureMap={};this._setRefreshRate();this._drawBuffer={adds:[],updates:[]};this._timeoutId=null;this._flushDrawBuffer=l.hitch(this,this._flushDrawBuffer);this._featuresByTime={};this._lastEndTimeCheck=null;this._maxFeatureAge=0;c.purgeOptions&&(c.purgeOptions.age&&"number"===typeof c.purgeOptions.age)&&(this._maxFeatureAge=1E3*Math.ceil(60*c.purgeOptions.age));this._drawFeatures=
l.hitch(this,this._drawFeatures);this._queryErrorHandler=l.hitch(this,this._queryErrorHandler)},startup:function(){},propertyChangeHandler:function(c){this._init&&(0===c?this._applyTimeFilter():3===c?this._redrawAllTracks():console.debug("StreamLayer: Stream Layer only supports changing map time or maximumTrackPoints. Layer id \x3d "+this.featureLayer.id))},drawFeature:function(c){var b=this.featureLayer,d=b.objectIdField;this._timeoutId||(this._timeoutId=setTimeout(this._flushDrawBuffer,this._refreshRate));
b._joinField&&this._getFeature(c.attributes[d])?this._drawBuffer.updates.push({oid:c.attributes[d],updates:c}):this._drawBuffer.adds.push(c)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var c=this.featureLayer;c&&(!c._relatedUrl&&!c._keepLatestUrl?(c._fireUpdateStart(),c.clear(),c._fireUpdateEnd()):(c._fireUpdateStart(),c._refreshing=!0,c.disconnect(),c.clear(),c._relatedQueried=!1,c._keepLatestQueried=!1,c.connect()))},_drawFeatures:function(c){this._purgeRequests();var b=
this.featureLayer;b._create(c.features||[]);b._fireUpdateEnd(null,null)},_applyTimeFilter:function(c){this.inherited(arguments);this._redrawAllTracks()},_removeFeatures:function(c){var b=this.featureLayer,d=b.objectIdField;c&&h.forEach(c,function(c){c=c.attributes[d];b._unSelectFeatureIIf(c,this);this._decRefCount(c);this._removeFeatureIIf(c)},this)},_addFeatures:function(c){var b=this.featureLayer,d=b._endTimeField,e=b._startTimeField,f,a,k,t=[],x=[],v=[];f=b._trackManager;a=b.objectIdField;if(f)for(k in c=
f.addFeatures(c),c)c.hasOwnProperty(k)&&(t.push(k),c[k].adds&&(x=x.concat(c[k].adds)),c[k].deletes&&(v=v.concat(c[k].deletes)));else x=c;h.forEach(x,function(k){var c=k.attributes[a],b;b=d&&k.attributes[d];!b&&this._maxFeatureAge&&(b=e&&k.attributes[e]?k.attributes[e]+this._maxFeatureAge:Date.now()+this._maxFeatureAge);b&&(b=1E3*Math.ceil(b/1E3),this._featuresByTime[b]?this._featuresByTime[b].push(c):this._featuresByTime[b]=[c]);this._addFeatureIIf(c,k);this._incRefCount(c)},this);v.length&&this._removeFeatures(v);
f&&f.refreshTracks(t)},_updateFeatures:function(c){var b=this.featureLayer,d,e,f=[];d=b._trackManager;e=b._trackIdField;h.forEach(c,function(a){var k=a.updates;a=this._getFeature(a.oid);var c;if(a){k.geometry&&a.setGeometry(k.geometry);k=k.attributes||{};for(c in k)k.hasOwnProperty(c)&&(a.attributes[c]=k[c]);a.visible=this._checkFeatureTimeIntersects(a);d&&a.attributes[e]?f.push(a.attributes[e]):b._repaint(a,null,!0)}},this);f.length&&d.refreshTracks(f)},_redrawAllTracks:function(){var c=this.featureLayer._trackManager,
b;if(c&&(b=c.trimTracks())&&0<b.length)this._removeFeatures(b),c.refreshTracks()},_flushDrawBuffer:function(){clearTimeout(this._timeoutId);var c=this._drawBuffer,b=c.adds.splice(0,c.adds.length),d=c.updates.splice(0,c.updates.length),c=this.featureLayer;if(!c)return!1;c.updating||c._fireUpdateStart();this._addFeatures(b);this._updateFeatures(d);if((b=this._getExpiredFeatures())&&b.length)this._removeFeatures(b),c._trackManager&&c._trackManager.removeFeatures(b);c._purge();c._fireUpdateEnd();this._timeoutId=
null},_clearDrawBuffer:function(){var c=this._timeoutId,b=this._drawBuffer,d=b.adds,b=b.updates;c&&clearTimeout(c);d.splice(0,d.length);b.splice(0,b.length);this._timeoutId=null},_clearTimeBin:function(){this._featuresByTime={};this._lastEndTimeCheck=1E3*Math.ceil(Date.now()/1E3)},_clearFeatureMap:function(){this._featureMap={}},_setRefreshRate:function(b){b=b||0===b?b:200;0>b&&(b=200);this._refreshRate=b},_checkFeatureTimeIntersects:function(b){var e=this.featureLayer,d=e.getMap().timeExtent;return!d||
!e.timeInfo||!e.timeInfo.startTimeField&&!e.timeInfo.endTimeField?!0:0<e._filterByTime([b],d.startTime,d.endTime).match.length},_getRequestId:function(b){return("_"+b.name+b.layerId+b._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchArchive:function(c){var e=this.featureLayer,d,h,l,a,k,t;e._fireUpdateStart();if(c&&this.map)c=new m(c),d=new w,h=this.map,l=e.getFilter()||{},a=l.where||"1\x3d1",k=l.geometry?b.fromJson(l.geometry):null,l=l.outFields?l.outFields.split(","):["*"],d.geometry=k,d.where=a,d.outFields=
l,d.returnGeometry=!0,d.outSpatialReference=new f(h.spatialReference.toJson()),e._usePatch&&(t=this._getRequestId(e),this._cancelPendingRequest(null,t)),c.execute(d,this._drawFeatures,this._queryErrorHandler,t);else return this._fireUpdateEnd({error:"Archive data cannot be fetched if no feature service url is provided or if the layer is not added to a map"}),!1},_queryErrorHandler:function(b){this._purgeRequests();var e=this.featureLayer;e._errorHandler(b);e._fireUpdateEnd(b)},_getExpiredFeatures:function(){var b,
e,d,f=[],m=[];if(!this.featureLayer._endTimeField&&!this._maxFeatureAge)return m;b=1E3*Math.floor(this._lastEndTimeCheck/1E3);this._lastEndTimeCheck=e=1E3*Math.ceil(Date.now()/1E3);if(b&&b!==e)for(d=this._featuresByTime;b<=e;b+=1E3)d[b]&&(f=f.concat(d[b]),delete d[b]);h.forEach(f,function(a){(a=this._getFeature(a))&&m.push(a)},this);return m}});q("extend-esri")&&l.setObject("layers._StreamMode",p,r);return p})},"esri/PopupInfo":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/i18n dojo/has dojo/Deferred dojo/sniff dojo/promise/all ./lang ./kernel ./request ./tasks/query ./tasks/QueryTask ./tasks/StatisticDefinition dojo/i18n!dojo/cldr/nls/number".split(" "),
function(p,l,h,q,r,f,w,m,b,e,c,g,d,y,z,a){p=p(null,{declaredClass:"esri.PopupInfo",initialize:function(a,b){if(a){l.mixin(this,b);this.info=a;this.title=this.getTitle;this.content=this.getContent;var c=this._fieldLabels={},d=this._fieldsMap={};a.fieldInfos&&h.forEach(a.fieldInfos,function(a){var k=a.fieldName.toLowerCase();c[k]=a.label;d[k]=a});this._relatedFieldPrefix="relationships/";this.titleHasRelatedFields=!!(a.title&&-1!==a.title.indexOf("{"+this._relatedFieldPrefix))}},toJson:function(){return q.fromJson(q.toJson(this.info))},
getTitle:function(){},getContent:function(){},getFieldInfo:function(a){var b;h.some(this.info&&this.info.fieldInfos,function(c){c.fieldName===a&&(b=c);return!!b});return b},getComponents:function(a){var b=this.info,c=new w,d,e;b.fieldInfos&&(e=h.filter(b.fieldInfos,function(a){return-1!==a.fieldName.indexOf(this._relatedFieldPrefix)},this));e&&0<e.length&&(d=this._getRelatedRecords({graphic:a,fieldsInfo:e}));d?d.always(l.hitch(this,function(){c.resolve(this._getPopupValues(a))})):c.resolve(this._getPopupValues(a));
return c.promise},getAttachments:function(a){var b=a.getLayer();a=a.attributes;if(this.info.showAttachments&&(b&&b.hasAttachments&&b.objectIdField)&&(a=a&&a[b.objectIdField]))return b.queryAttachmentInfos(a)},_getPopupValues:function(a,b){var c=this.info,d=a.getLayer(),g=l.clone(a.attributes)||{},s=l.clone(g),n=c.fieldInfos,u="",f="",m,G,B,r,y,q=d&&d._getDateOpts&&d._getDateOpts().properties,q=q&&q.slice(0),p={dateFormat:{properties:q,formatter:"DateFormat"+this._insertOffset(this._dateFormats.shortDateShortTime)}};
if(this._relatedInfo)for(r in this._relatedInfo)if(this._relatedInfo.hasOwnProperty(r)){var z=this._relatedInfo[r],w=this._relatedLayersInfo[r];z&&(h.forEach(z.relatedFeatures,function(a){for(y in a.attributes)if(a.attributes.hasOwnProperty(y)&&"esriRelCardinalityOneToOne"===w.relation.cardinality){var b=this._toRelatedFieldName([w.relation.id,y]);g[b]=s[b]=a.attributes[y]}},this),h.forEach(z.relatedStatsFeatures,function(a){for(y in a.attributes)if(a.attributes.hasOwnProperty(y)){var b=this._toRelatedFieldName([w.relation.id,
y]);g[b]=s[b]=a.attributes[y]}},this))}n&&h.forEach(n,function(a){G=a.fieldName;var b=this._getLayerFieldInfo(d,G);b&&(G=a.fieldName=b.name);s[G]=this._formatValue(s[G],G,p);q&&(a.format&&a.format.dateFormat)&&(a=h.indexOf(q,G),-1<a&&q.splice(a,1))},this);if(d){r=d.types;var F=(z=d.typeIdField)&&g[z];for(G in g)if(g.hasOwnProperty(G)&&-1===G.indexOf(this._relatedFieldPrefix)&&(B=g[G],e.isDefined(B))){var D=this._getDomainName(d,a,r,F,G,B);e.isDefined(D)?s[G]=D:G===z&&(D=this._getTypeName(d,a,B),e.isDefined(D)&&
(s[G]=D))}}c.title&&(u=this._processFieldsInLinks(this._fixTokens(c.title,d),g),u=l.trim(e.substitute(s,u,p)||""));if(b)return{title:u};c.description&&(f=this._processFieldsInLinks(this._fixTokens(c.description,d),g),f=l.trim(e.substitute(s,f,p)||""));n&&(m=[],h.forEach(n,function(a){(G=a.fieldName)&&a.visible&&m.push([a.label||G,e.substitute(s,"${"+G+"}",p)||""])}));var O,L;c.mediaInfos&&(O=[],h.forEach(c.mediaInfos,function(a){L=0;B=a.value;switch(a.type){case "image":var b=B.sourceURL,b=b&&l.trim(e.substitute(g,
this._fixTokens(b,d)));L=!!b;break;case "piechart":case "linechart":case "columnchart":case "barchart":var k,b=B.normalizeField;B.fields=h.map(B.fields,function(a){return(k=this._getLayerFieldInfo(d,a))?k.name:a},this);b&&(k=this._getLayerFieldInfo(d,b),B.normalizeField=k?k.name:b);L=h.some(B.fields,function(a){return e.isDefined(g[a])||-1!==a.indexOf(this._relatedFieldPrefix)&&this._relatedInfo},this);break;default:return}if(L){a=l.clone(a);B=a.value;var b=a.title?this._processFieldsInLinks(this._fixTokens(a.title,
d),g):"",c=a.caption?this._processFieldsInLinks(this._fixTokens(a.caption,d),g):"";a.title=b?l.trim(e.substitute(s,b,p)||""):"";a.caption=c?l.trim(e.substitute(s,c,p)||""):"";if("image"===a.type)B.sourceURL=e.substitute(g,this._fixTokens(B.sourceURL,d)),B.linkURL&&(B.linkURL=l.trim(e.substitute(g,this._fixTokens(B.linkURL,d))||""));else{var n,u;h.forEach(B.fields,function(a,b){if(-1!==a.indexOf(this._relatedFieldPrefix))u=this._getRelatedChartInfos(a,B,g,p),u instanceof Array?B.fields=u:B.fields[b]=
u;else{var k=g[a],k=void 0===k?null:k;n=g[B.normalizeField]||0;k&&n&&(k/=n);B.fields[b]={y:k,tooltip:(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(k,a,p,!!n)}}},this)}O.push(a)}},this));return{title:u,description:f,hasDescription:!!c.description,fields:m&&m.length?m:null,mediaInfos:O&&O.length?O:null,formatted:s,editSummary:d&&d.getEditSummary?d.getEditSummary(a):""}},_getRelatedChartInfos:function(a,b,c,d){var e,g,n,u,f,m;e=[];m=this._fromRelatedFieldName(a);f=m[0];g=this._relatedInfo[f];
f=this._relatedLayersInfo[f];g&&h.forEach(g.relatedFeatures,function(g){g=g.attributes;var f,s;for(s in g)if(g.hasOwnProperty(s)&&s===m[1]){f={};u=g[s];b.normalizeField&&(n=-1!==b.normalizeField.indexOf(this._relatedFieldPrefix)?g[this._fromRelatedFieldName(b.normalizeField)[1]]:c[b.normalizeField]);u&&n&&(u/=n);if(b.tooltipField)if(-1!==b.tooltipField.indexOf(this._relatedFieldPrefix)){var h=this._fromRelatedFieldName(b.tooltipField)[1];f.tooltip=g[h]&&"string"===typeof g[h]?g[h]+":\x3cbr/\x3e"+
this._formatValue(u,g[h],d,!!n):h+":\x3cbr/\x3e"+this._formatValue(u,h,d,!!n)}else f.tooltip=(this._fieldLabels[a.toLowerCase()]||a)+":\x3cbr/\x3e"+this._formatValue(u,b.tooltipField,d,!!n);else f.tooltip=u;f.y=u;e.push(f)}},this);return"esriRelCardinalityOneToMany"===f.relation.cardinality||"esriRelCardinalityManyToMany"===f.relation.cardinality?e:e[0]},_dateFormats:{shortDate:"(datePattern: 'M/d/y', selector: 'date')",shortDateLE:"(datePattern: 'd/M/y', selector: 'date')",longMonthDayYear:"(datePattern: 'MMMM d, y', selector: 'date')",
dayShortMonthYear:"(datePattern: 'd MMM y', selector: 'date')",longDate:"(datePattern: 'EEEE, MMMM d, y', selector: 'date')",shortDateShortTime:"(datePattern: 'M/d/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateLEShortTime:"(datePattern: 'd/M/y', timePattern: 'h:mm a', selector: 'date and time')",shortDateShortTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm', selector: 'date and time')",shortDateLEShortTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm', selector: 'date and time')",
shortDateLongTime:"(datePattern: 'M/d/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLELongTime:"(datePattern: 'd/M/y', timePattern: 'h:mm:ss a', selector: 'date and time')",shortDateLongTime24:"(datePattern: 'M/d/y', timePattern: 'H:mm:ss', selector: 'date and time')",shortDateLELongTime24:"(datePattern: 'd/M/y', timePattern: 'H:mm:ss', selector: 'date and time')",longMonthYear:"(datePattern: 'MMMM y', selector: 'date')",shortMonthYear:"(datePattern: 'MMM y', selector: 'date')",
year:"(datePattern: 'y', selector: 'date')"},_reHref:/href\s*=\s*\"([^\"]+)\"/ig,_reHrefApos:/href\s*=\s*\'([^\']+)\'/ig,_fixTokens:function(a,b){var c=this;return a.replace(/(\{([^\{\r\n]+)\})/g,function(a,k,d){a=c._getLayerFieldInfo(b,d);return"$"+(a?"{"+a.name+"}":k)})},_encodeAttributes:function(a){a=l.clone(a)||{};var b,c;for(b in a)if((c=a[b])&&"string"===typeof c)c=encodeURIComponent(c).replace(/\'/g,"\x26apos;"),a[b]=c;return a},_processFieldsInLinks:function(a,b){var c=this._encodeAttributes(b),
d=this;a&&(a=a.replace(this._reHref,function(a,k){return d._addValuesToHref(a,k,b,c)}).replace(this._reHrefApos,function(a,k){return d._addValuesToHref(a,k,b,c)}));return a},_addValuesToHref:function(a,b,c,d){b=b&&l.trim(b);return e.substitute(b&&0===b.indexOf("${")?c:d,a)},_getLayerFieldInfo:function(a,b){return a&&a.getField?a.getField(b):null},_formatValue:function(b,c,d,g){var f=this._fieldsMap[c.toLowerCase()],s=f&&f.format,n=-1!==h.indexOf(d.dateFormat.properties,c);c="number"===typeof b&&!n&&
(!s||!s.dateFormat);if(!e.isDefined(b)||!f||!e.isDefined(s))return c?this._forceLTR(b):b;var u="",m=[],f=s.hasOwnProperty("places")||s.hasOwnProperty("digitSeparator"),J=s.hasOwnProperty("digitSeparator")?s.digitSeparator:!0;if(f&&!n)u="NumberFormat",m.push("places: "+(e.isDefined(s.places)&&(!g||0<s.places)?Number(s.places):"Infinity")),m.length&&(u+="("+m.join(",")+")");else if(s.dateFormat)u="DateFormat"+this._insertOffset(this._dateFormats[s.dateFormat]||this._dateFormats.shortDateShortTime);
else return c?this._forceLTR(b):b;b=e.substitute({myKey:b},"${myKey:"+u+"}",d)||"";f&&!J&&a.group&&(b=b.replace(RegExp("\\"+a.group,"g"),""));return c?this._forceLTR(b):b},_forceLTR:function(a){var b=m("ie");return b&&10>=b?a:"\x3cspan class\x3d'esriNumericValue'\x3e"+a+"\x3c/span\x3e"},_insertOffset:function(a){a&&(a=e.isDefined(this.utcOffset)?a.replace(/\)\s*$/,", utcOffset:"+this.utcOffset+")"):a);return a},_getDomainName:function(a,b,c,d,e,g){return(a=a.getDomain&&a.getDomain(e,{feature:b}))&&
a.codedValues?a.getName(g):null},_getTypeName:function(a,b,c){return(a=a.getType&&a.getType(b))&&a.name},_getRelatedRecords:function(a){var b=a.graphic,c=new w,d;this._relatedLayersInfo?this._queryRelatedLayers(b).then(l.hitch(this,function(a){this._setRelatedRecords(b,a);c.resolve(a)}),l.hitch(this,this._handlerErrorResponse,c)):this._getRelatedLayersInfo(a).then(l.hitch(this,function(a){for(d in a)a.hasOwnProperty(d)&&a[d]&&(this._relatedLayersInfo[d].relatedLayerInfo=a[d]);this._queryRelatedLayers(b).then(l.hitch(this,
function(a){this._setRelatedRecords(b,a);c.resolve(a)}),l.hitch(this,this._handlerErrorResponse,c))}),l.hitch(this,this._handlerErrorResponse,c));return c.promise},_getRelatedLayersInfo:function(a){var c=a.fieldsInfo,d,e,f={};d=a.graphic.getLayer();this._relatedLayersInfo||(this._relatedLayersInfo={});h.forEach(c,function(a){var b,c,k,e;b=this._fromRelatedFieldName(a.fieldName);c=b[0];b=b[1];c&&(this._relatedLayersInfo[c]||(h.some(d.relationships,function(a){if(a.id==c)return e=a,!0}),e&&(this._relatedLayersInfo[c]=
{relation:e,relatedFields:[],outStatistics:[]})),this._relatedLayersInfo[c]&&(this._relatedLayersInfo[c].relatedFields.push(b),a.statisticType&&(k=new z,k.statisticType=a.statisticType,k.onStatisticField=b,k.outStatisticFieldName=b,this._relatedLayersInfo[c].outStatistics.push(k))))},this);for(e in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(e)&&this._relatedLayersInfo[e]&&(a=this._relatedLayersInfo[e].relation,a=d.url.replace(/[0-9]+$/,a.relatedTableId),this._relatedLayersInfo[e].relatedLayerUrl=
a,f[e]=g({url:a,content:{f:"json"},callbackParamName:"callback"}));return b(f)},_queryRelatedLayers:function(a){var c={},d;for(d in this._relatedLayersInfo)this._relatedLayersInfo.hasOwnProperty(d)&&(c[d]=this._queryRelatedLayer({graphic:a,relatedInfo:this._relatedLayersInfo[d]}));return b(c)},_queryRelatedLayer:function(a){var c,e,g,f,s,n,u,m,J,l;c=a.graphic;e=c.getLayer().url.match(/[0-9]+$/g)[0];m=a.relatedInfo;u=m.relatedLayerInfo;J=m.relatedLayerUrl;l=m.relation;h.some(u.relationships,function(a){if(a.relatedTableId===
parseInt(e,10))return g=a,!0},this);g&&(a=new d,h.some(u.fields,function(a){if(a.name===g.keyField)return s=-1!==h.indexOf(["esriFieldTypeSmallInteger","esriFieldTypeInteger","esriFieldTypeSingle","esriFieldTypeDouble"],a.type)?"number":"string",!0}),f="string"===s?g.keyField+"\x3d'"+c.attributes[l.keyField]+"'":g.keyField+"\x3d"+c.attributes[l.keyField],a.where=f,a.outFields=m.relatedFields,m.outStatistics&&(0<m.outStatistics.length&&u.supportsStatistics)&&(n=new d,n.where=a.where,n.outFields=a.outFields,
n.outStatistics=m.outStatistics),c=new y(J),f=[],f.push(c.execute(a)),n&&f.push(c.execute(n)));return b(f)},_setRelatedRecords:function(a,b){this._relatedInfo=[];for(var c in b)if(b.hasOwnProperty(c)&&b[c]){var d=b[c];this._relatedInfo[c]={};this._relatedInfo[c].relatedFeatures=d[0].features;e.isDefined(d[1])&&(this._relatedInfo[c].relatedStatsFeatures=d[1].features)}},_handlerErrorResponse:function(a,b){a.reject(b)},_fromRelatedFieldName:function(a){var b=[];-1!==a.indexOf(this._relatedFieldPrefix)&&
(a=a.split("/"),b=a.slice(1));return b},_toRelatedFieldName:function(a){var b="";a&&0<a.length&&(b=this._relatedFieldPrefix+a[0]+"/"+a[1]);return b}});f("extend-esri")&&(c.PopupInfo=c.PopupInfoTemplate=p);return p})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),function(p,l,h,q,r,f,w){r.add("highcontrast",function(){var f=w.doc.createElement("div");f.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+
(l.blankGif||p.toUrl("./resources/blank.gif"))+'");';w.body().appendChild(f);var b=q.getComputedStyle(f),e=b.backgroundImage,b=b.borderTopColor==b.borderRightColor||e&&("none"==e||"url(invalid-url:)"==e);8>=r("ie")?f.outerHTML="":w.body().removeChild(f);return b});f(function(){r("highcontrast")&&h.add(w.body(),"dj_a11y")});return r})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),
function(p,l,h,q,r,f,w,m,b,e,c,g,d,y,z,a,k,t,x,v,A,s,n){function u(a){return function(b){m[b?"set":"remove"](this.domNode,a,b);this._set(a,b)}}d.add("dijit-legacy-requires",!y.isAsync);d.add("dojo-bidi",!1);d("dijit-legacy-requires")&&k(0,function(){p(["dijit/_base/manager"])});var R={};q=f("dijit._WidgetBase",[t,A],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:u("lang"),dir:"",_setDirAttr:u("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",
baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",a)},attributeMap:{},_blankGif:q.blankGif||p.toUrl("dojo/resources/blank.gif"),_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,c=a._setterAttrs=[],a=a._onMap={},d;for(d in b.attributeMap)c.push(d);for(d in b)/^on/.test(d)&&(a[d.substring(2).toLowerCase()]=d),/^_set[A-Z](.*)Attr$/.test(d)&&(d=d.charAt(4).toLowerCase()+d.substr(5,
d.length-9),(!b.attributeMap||!(d in b.attributeMap))&&c.push(d))}},postscript:function(a,b){this.create(a,b)},create:function(a,b){this._introspect();this.srcNodeRef=w.byId(b);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,z.mixin(this,a));this.postMixInProperties();this.id||(this.id=n.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||
(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=v.body(this.ownerDocument);n.add(this);this.buildRendering();var c;if(this.domNode){this._applyAttributes();var d=this.srcNodeRef;d&&(d.parentNode&&this.domNode!==d)&&(d.parentNode.replaceChild(this.domNode,d),c=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();c&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||{})a[b]=this._get(b);l.forEach(this.constructor._setterAttrs,
function(b){if(!(b in a)){var c=this._get(b);c&&this.set(b,c)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(l.map(a,function(a){return a+"Rtl"})));b.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,l.forEach(this.getChildren(),function(a){!a._started&&
(!a._destroyed&&z.isFunction(a.startup))&&(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(c){c.destroyRecursive?c.destroyRecursive(a):c.destroy&&c.destroy(a)}this._beingDestroyed=!0;this.uninitialize();l.forEach(this._connects,z.hitch(this,"disconnect"));l.forEach(this._supportingWidgets,b);this.domNode&&l.forEach(n.findWidgets(this.domNode,this.containerNode),b);this.destroyRendering(a);
n.remove(this.id);this._destroyed=!0},destroyRendering:function(a){this.bgIframe&&(this.bgIframe.destroy(a),delete this.bgIframe);this.domNode&&(a?m.remove(this.domNode,"widgetId"):e.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(a||e.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){l.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var b=this.domNode;z.isObject(a)?
g.set(b,a):b.style.cssText=b.style.cssText?b.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(a,c,d){d=3<=arguments.length?d:this.attributeMap[a];l.forEach(z.isArray(d)?d:[d],function(d){var e=this[d.node||d||"domNode"];switch(d.type||"attribute"){case "attribute":z.isFunction(c)&&(c=z.hitch(this,c));d=d.attribute?d.attribute:/^on[A-Z][a-zA-Z]*$/.test(a)?a.toLowerCase():a;e.tagName?m.set(e,d,c):e.set(d,c);break;case "innerText":e.innerHTML="";e.appendChild(this.ownerDocument.createTextNode(c));
break;case "innerHTML":e.innerHTML=c;break;case "class":b.replace(e,c,this[a])}},this)},get:function(a){var b=this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var c in a)this.set(c,a[c]);return this}c=this._getAttrNames(a);var d=this[c.s];if(z.isFunction(d))var e=d.apply(this,Array.prototype.slice.call(arguments,1));else{var d=this.focusNode&&!z.isFunction(this.focusNode)?"focusNode":"domNode",k=this[d]&&this[d].tagName,g;if(g=k)if(!(g=
R[k])){g=this[d];var f={},n;for(n in g)f[n.toLowerCase()]=!0;g=R[k]=f}n=g;c=a in this.attributeMap?this.attributeMap[a]:c.s in this?this[c.s]:n&&c.l in n&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?d:null;null!=c&&this._attrToDom(a,b,c);this._set(a,b)}return e||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var c=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});return b[a]={n:a+"Node",s:"_set"+c+"Attr",
g:"_get"+c+"Attr",l:c.toLowerCase()}},_set:function(a,b){var c=this[a];this[a]=b;if(this._created&&!(c===b||c!==c&&b!==b))this._watchCallbacks&&this._watchCallbacks(a,c,b),this.emit("attrmodified-"+a,{detail:{prevValue:c,newValue:b}})},_get:function(a){return this[a]},emit:function(b,c,d){c=c||{};void 0===c.bubbles&&(c.bubbles=!0);void 0===c.cancelable&&(c.cancelable=!0);c.detail||(c.detail={});c.detail.widget=this;var e,k=this["on"+b];k&&(e=k.apply(this,d?d:[c]));this._started&&!this._beingDestroyed&&
a.emit(this.domNode,b.toLowerCase(),c);return e},on:function(b,c){var d=this._onMap(b);return d?h.after(this,d,c,!0):this.own(a(this.domNode,b,c))[0]},_onMap:function(a){var b=this.constructor,c=b._onMap;if(!c){var c=b._onMap={},d;for(d in b.prototype)/^on/.test(d)&&(c[d.replace(/^on/,"").toLowerCase()]=d)}return c["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?n.findWidgets(this.containerNode):
[]},getParent:function(){return n.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,b,c){return this.own(r.connect(a,b,this,c))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(x.subscribe(a,z.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():c.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=g.get(this.domNode,"display")},placeAt:function(a,b){var c=
!a.tagName&&n.byId(a);c&&c.addChild&&(!b||"number"===typeof b)?c.addChild(this,b):(c=c&&"domNode"in c?c.containerNode&&!/after|before|replace/.test(b||"")?c.containerNode:c.domNode:w.byId(a,this.ownerDocument),e.place(this.domNode,c,b),!this._started&&(this.getParent()||{})._started&&this.startup());return this},defer:function(a,b){var c=setTimeout(z.hitch(this,function(){c&&(c=null,this._destroyed||z.hitch(this,a)())}),b||0);return{remove:function(){c&&(clearTimeout(c),c=null);return null}}}});d("dojo-bidi")&&
q.extend(s);return q})},"esri/layers/FeatureLayer":function(){define("require module dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/date/locale dojo/sniff dojo/io-query dojo/dom-construct dojo/i18n dojo/when dojo/promise/all ../kernel ../lang ../request ../config ../deferredUtils ../SpatialReference ../symbols/SimpleMarkerSymbol ../symbols/SimpleLineSymbol ../symbols/SimpleFillSymbol ../symbols/jsonUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/jsonUtils ../tasks/QueryTask ../tasks/query ../tasks/FeatureSet ../tasks/StatisticDefinition ../geometry/Extent ../geometry/jsonUtils ../geometry/normalizeUtils ../geometry/scaleUtils ./GraphicsLayer ./Field ./TimeInfo ./FeatureType ./FeatureTemplate ./FeatureEditResult ./LabelClass ./SnapshotMode ./OnDemandMode ./SelectionMode ./StreamMode ./TrackManager ./HeatmapManager dojo/i18n!../nls/jsapi dojo/has!extend-esri?./agscommon".split(" "),
function(p,l,h,q,r,f,w,m,b,e,c,g,d,y,z,a,k,t,x,v,A,s,n,u,R,J,G,B,S,P,W,$,aa,E,F,D,O,L,H,K,Y,I,U,Q,T,za,ba,ca,Z,da){var ea=x.defaults,M=h(O,{declaredClass:"esri.layers.FeatureLayer",invalidParams:"query contains one or more unsupported parameters",reHostedFS:/https?:\/\/services.*\.arcgis\.com/i,maxPointCountForAuto:4E3,maxRecordCountForAuto:2E3,maxVertexCountForAuto:25E4,generalizeForScale:4E3,_eventMap:{"add-attachment-complete":["result"],"before-apply-edits":["adds","updates","deletes"],"delete-attachments-complete":["results"],
"edits-complete":["adds","updates","deletes"],"query-attachment-infos-complete":["results"],"query-count-complete":["count"],"query-features-complete":["featureSet"],"query-ids-complete":["objectIds"],"query-related-features-complete":["featureSets"],"selection-complete":["features","method"],"update-end":["error","info"]},constructor:function(a,b){this._preventInit||this._initFeatureLayer(a,b)},_initFeatureLayer:function(a,b){this.i18n=da;b=b||{};this.showLabels=null!=b.showLabels?b.showLabels:!0;
this._outFields=b.outFields;this._defnExpr=b.definitionExpression;this._loadCallback=b.loadCallback;var c=b._usePatch;this._usePatch=null===c||void 0===c?!0:c;this._trackIdField=b.trackIdField;this.objectIdField=b.objectIdField;this._maxOffset=null!=b.maxAllowableOffset?b.maxAllowableOffset:this.maxAllowableOffset;this.quantize=null!=b.quantize?b.quantize:!0;this._optEditable=b.editable;this._optAutoGen=b.autoGeneralize;this.editSummaryCallback=b.editSummaryCallback;this.userId=b.userId;this.userIsAdmin=
b.userIsAdmin;this.useMapTime=b.hasOwnProperty("useMapTime")?!!b.useMapTime:!0;this.source=b.source;this.gdbVersion=b.gdbVersion;this.orderByFields=b.orderByFields;this.maxPointCountForAuto=null!=b.maxPointCountForAuto?b.maxPointCountForAuto:this.maxPointCountForAuto;this.maxRecordCountForAuto=null!=b.maxRecordCountForAuto?b.maxRecordCountForAuto:this.maxRecordCountForAuto;this.maxVertexCountForAuto=null!=b.maxVertexCountForAuto?b.maxVertexCountForAuto:this.maxVertexCountForAuto;this.generalizeForScale=
null!=b.generalizeForScale?b.generalizeForScale:this.generalizeForScale;this.queryPagination=null!=b.queryPagination?b.queryPagination:this.url?this.reHostedFS.test(this.url):!1;this.multipatchOption=b.multipatchOption;this._selectedFeatures={};this._selectedFeaturesArr=[];this._newFeatures=[];this._deletedFeatures={};this._ulid=this._getUniqueId();var d=M,c=this.mode=k.isDefined(b.mode)?b.mode:d.MODE_ONDEMAND;this._isStream&&(this.mode=c=d.MODE_STREAM);switch(c){case d.MODE_SNAPSHOT:this.currentMode=
d.MODE_SNAPSHOT;this._mode=new Q(this);this._isSnapshot=!0;break;case d.MODE_ONDEMAND:case d.MODE_AUTO:this.currentMode=d.MODE_ONDEMAND;this._tileWidth=b.tileWidth||512;this._tileHeight=b.tileHeight||512;this._mode=new T(this);this.latticeTiling=b.latticeTiling;break;case d.MODE_SELECTION:this.currentMode=d.MODE_SELECTION;this._mode=new za(this);this._isSelOnly=!0;break;case d.MODE_STREAM:this.currentMode=d.MODE_STREAM,this._mode=new ba(this),this._isStream=!0}this._initLayer=r.hitch(this,this._initLayer);
this._selectHandler=r.hitch(this,this._selectHandler);this._editable=!1;if(r.isObject(a)&&a.layerDefinition)return this._collection=!0,this.mode=this._isStream?d.MODE_STREAM:d.MODE_SNAPSHOT,this._initLayer(a),this;this._task=new S(this.url,{source:this.source,gdbVersion:this.gdbVersion});c=this._url.path;this._fserver=!1;-1!==c.search(/\/FeatureServer\//i)&&(this._fserver=!0);this.mode===d.MODE_AUTO&&this.reHostedFS.test(this.url)&&this._queryLimit();(d=b.resourceInfo)?this._initLayer(d):(this.source&&
(d={source:this.source.toJson()},this._url.query=r.mixin(this._url.query,{layer:w.toJson(d)})),this.gdbVersion&&(this._url.query=r.mixin(this._url.query,{gdbVersion:this.gdbVersion})),t({url:c,content:r.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler}));this.registerConnectEvents()},_initLayer:function(a,b){if(a||b){this._json=a;this._findCredential();if(this.credential&&this.credential.ssl||a&&a._ssl)this._useSSL(),this._task._useSSL();
this.version=a.currentVersion;this.version||(this.version="capabilities"in a||"drawingInfo"in a||"hasAttachments"in a||"htmlPopupType"in a||"relationships"in a||"timeInfo"in a||"typeIdField"in a||"types"in a?10:9.3);this._collection&&(this._isStream||(this.currentMode=M.MODE_SNAPSHOT,this._mode=new Q(this)),this._isSnapshot=!0,this._featureSet=a.featureSet,this._nextId=a.nextObjectId,a=a.layerDefinition);this.geometryType=a.geometryType;"string"!==typeof this.multipatchOption&&"esriGeometryMultiPatch"===
this.geometryType&&(this.multipatchOption="xyFootprint");if(a.hasOwnProperty("capabilities")){var c=this.capabilities=a.capabilities;c&&-1!==c.toLowerCase().indexOf("editing")?this._editable=!0:this._editable=!1}else this._collection||(this._editable=this._fserver);k.isDefined(this._optEditable)?(this._editable=this._optEditable,delete this._optEditable):"esriGeometryMultiPatch"===this.geometryType&&(this._editable=!1);this._json=w.toJson(this._json);if(this.isEditable())this._setMaxOffset(null);
else if(this.mode!==M.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint()))this._autoGeneralize=k.isDefined(this._optAutoGen)?this._optAutoGen:this.mode===M.MODE_ONDEMAND||this.mode===M.MODE_AUTO,delete this._optAutoGen;var c=a.effectiveMinScale||a.minScale,d=a.effectiveMaxScale||a.maxScale;!this._hasMin&&c&&this.setMinScale(c);!this._hasMax&&d&&this.setMaxScale(d);this.layerId=a.id;this.name=a.name;this.description=a.description;
this.copyright=a.copyrightText;this.type=a.type;this.displayField=a.displayField;this.defaultDefinitionExpression=a.definitionExpression;this.fullExtent=new aa(a.extent);this.initialExtent=new aa(this.fullExtent.toJson());this.fullExtent.spatialReference&&(this.spatialReference=new A(this.fullExtent.spatialReference.toJson()));this.defaultVisibility=a.defaultVisibility;if("esriGeometryPoint"===this.geometryType||"esriGeometryMultipoint"===this.geometryType)this.latticeTiling=!1;this.hasM=a.hasM||
!1;this.hasZ=a.hasZ||!1;this.indexedFields=a.indexedFields;this.maxRecordCount=a.maxRecordCount;this.canModifyLayer=a.canModifyLayer;this.supportsStatistics=a.supportsStatistics;this.supportsAdvancedQueries=this._collection?!1:a.supportsAdvancedQueries;this.supportsCalculate=a.supportsCalculate;this.supportsAttachmentsByUploadId=a.supportsAttachmentsByUploadId;this.supportsCoordinatesQuantization=a.supportsCoordinatesQuantization;this.quantize=this.quantize&&this.supportsCoordinatesQuantization;this.hasLabels=
a.hasLabels;this.canScaleSymbols=a.canScaleSymbols;this.supportsRollbackOnFailureParameter=this.supportsRollbackOnFailure=a.supportsRollbackOnFailure;this.syncCanReturnChanges=a.syncCanReturnChanges;this.isDataVersioned=a.isDataVersioned;this.editFieldsInfo=a.editFieldsInfo;this.ownershipBasedAccessControlForFeatures=a.ownershipBasedAccessControlForFeatures;this.editFieldsInfo&&this.ownershipBasedAccessControlForFeatures&&(this.creatorField=this.editFieldsInfo.creatorField);this.relationships=a.relationships;
this.allowGeometryUpdates=k.isDefined(a.allowGeometryUpdates)?a.allowGeometryUpdates:!0;this.advancedQueryCapabilities=a.advancedQueryCapabilities||{supportsStatistics:this.supportsStatistics,supportsOrderBy:this.supportsAdvancedQueries,supportsDistinct:this.supportsAdvancedQueries};this._setMaxOffset(this._maxOffset,!0);this._isTable="Table"===this.type;for(var g=this.fields=[],d=a.fields,c=0;c<d.length;c++)g.push(new L(d[c]));if(!this.objectIdField){this.objectIdField=a.objectIdField;if(!this.objectIdField){d=
a.fields;for(c=0;c<d.length;c++)if(g=d[c],"esriFieldTypeOID"===g.type){this.objectIdField=g.name;break}}!this.objectIdField&&!this._isStream&&console.debug("esri.layers.FeatureLayer: "+k.substitute({url:this.url},"objectIdField is not set [url: ${url}]"))}if(!k.isDefined(this._nextId)){d=this.objectIdField;g=-1;if(this._collection&&d)for(var m=(c=this._featureSet)&&c.features,h=m?m.length:0,t,c=0;c<h;c++)t=(t=m[c].attributes)&&t[d],t>g&&(g=t);this._nextId=g+1}this.globalIdField=a.globalIdField;if(c=
this.typeIdField=a.typeIdField)if(c=!this._getField(c)&&this._getField(c,!0))this.typeIdField=c.name;this.visibilityField=a.visibilityField;if(d=a.defaultSymbol)this.defaultSymbol=R.fromJson(d);var x=this.types=[],l=a.types,v,y,g=(c=this.editFieldsInfo)&&c.creatorField,m=c&&c.editorField;t=g||m;h=[];if(l)for(c=0;c<l.length;c++)v=new K(l[c]),y=v.templates,t&&(y&&y.length)&&(h=h.concat(y)),x.push(v);l=a.templates;v=this.templates=[];if(l)for(c=0;c<l.length;c++)x=new Y(l[c]),t&&h.push(x),v.push(x);for(c=
0;c<h.length;c++)if(t=r.getObject("prototype.attributes",!1,h[c]))g&&delete t[g],m&&delete t[m];if(c=a.timeInfo)this.timeInfo=new H(c),this._startTimeField=c.startTimeField,this._endTimeField=c.endTimeField,this._startTimeField&&this._endTimeField&&(this._twoTimeFields=!0),this._trackIdField?c.trackIdField=this._trackIdField:this._trackIdField=c.trackIdField;this.hasAttachments=!this._collection&&a.hasAttachments?!0:!1;this.htmlPopupType=a.htmlPopupType;var c=a.drawingInfo,q;if((g=c&&c.labelingInfo)&&
!this.labelingInfo)this.labelingInfo=f.map(g,function(a){return new U(a)}),this._fixLabelExpr();if(!this.renderer)if(c&&c.renderer){if(q=c.renderer,this.setRenderer(B.fromJson(q)),"classBreaks"===q.type&&this.renderer.setMaxInclusive(!0),!this._collection){var p=q.type,d=[];q=this.renderer;switch(p){case "simple":d.push(q.symbol);break;case "uniqueValue":case "classBreaks":d.push(q.defaultSymbol),d=d.concat(f.map(q.infos,function(a){return a.symbol}))}var d=f.filter(d,k.isDefined),z=this._url.path+
"/images/",P=this._getToken();f.forEach(d,function(a){var b=a.url;b&&(-1===b.search(/https?\:/)&&-1===b.indexOf("data:")&&(a.url=z+b),P&&-1!==a.url.search(/https?\:/)&&(a.url+="?token\x3d"+P))})}}else if(d)l=this.types,0<l.length?(q=new G(this.defaultSymbol,this.typeIdField),f.forEach(l,function(a){q.addValue(a.id,a.symbol)})):q=new J(this.defaultSymbol),this.setRenderer(q);else if(!this._isTable){switch(this.geometryType){case "esriGeometryPoint":case "esriGeometryMultipoint":p=new s;break;case "esriGeometryPolyline":p=
new n;break;case "esriGeometryPolygon":p=new u;break;default:this.hasXYFootprint()&&(p=new u)}this.setRenderer(p?new J(p):null)}p=c&&c.transparency||0;!this.hasOwnProperty("opacity")&&0<p&&(this.opacity=1-p/100);if((e("ie")||7<=e("trident")||e("safari"))&&this.isEditable()&&10.02>this.version)this._ts=!0;this.statistics=a.statistics;this._fixRendererFields();this._checkFields();this._updateCaps();var S=function(){this.currentMode!==M.MODE_SNAPSHOT&&(this.queryPagination=!1);null!=this._maxOffset&&
!this._isFractionalOffsetAllowed()&&this._setMaxOffset(this._maxOffset);this.loaded=!0;this.onLoad(this);var a=this._loadCallback;a&&(delete this._loadCallback,a(this))};this._collection?(p=this._featureSet,this._featureSet=null,this._mode._drawFeatures(new W(p)),this._fcAdded=!0,S.call(this)):this._forceIdentity(this._limitPromise?function(){var a=this;this._limitPromise.then(function(b){a._checkMode(b)});this._limitPromise.always(function(){a._limitPromise=null;S.call(a)})}:S)}},setShowLabels:function(a){this.showLabels=
a;this.onShowLabelsChange()},onShowLabelsChange:function(){},onRendererChange:function(a){this.inherited(arguments);var b=this._map;this._ager=!(!a||!a.observationAger||!a.observationRenderer);a&&"colors"in a&&"blurRadius"in a&&"maxPixelIntensity"in a?"esriGeometryPoint"==this.geometryType&&(!this._heatmapManager&&b)&&(this._heatmapManager=new Z(this),this._heatmapManager.initialize(b)):this.renderer&&this.renderer.getRendererInfo?f.some(this.renderer.rendererInfos,function(a){return a.renderer&&
"colors"in a.renderer&&"blurRadius"in a.renderer})||(this._heatmapManager=null):this._heatmapManager=null;if(a){var c=[],b=f.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],k.isDefined),d=function(a){return null!=a&&"function"!=typeof a&&a};f.forEach(b,function(a){var b=d(a.attributeField),fa=d(a.attributeField2);a=d(a.attributeField3);!1!==b&&c.push(b);!1!==fa&&c.push(fa);!1!==a&&c.push(a)});this._rendererFields=c}else this._rendererFields=[];this.loaded&&(this._fixRendererFields(),
this._checkFields(this._rendererFields),this._collection&&(this._typesDirty=!0))},redraw:function(){this.inherited(arguments);this._trackManager&&this._trackManager.container&&this._trackManager.container.redraw()},_evalSDRenderer:function(){this.inherited(arguments);var a=this._getRenderer();this._ager=!(!a||!a.observationAger||!a.observationRenderer);this._trackManager&&this._trackManager.container&&this._trackManager.container.setRenderer(a&&a.trackRenderer)},_setMap:function(a){var b=this.inherited(arguments),
c=this._mode,d=this;c&&c.initialize(a);this.geometryType&&this.attr("data-geometry-type",this.geometryType.replace(/esriGeometry/i,"").toLowerCase());this._addHandle=this.on("graphic-node-add",function(a){a=a.graphic.attributes;(a=d._selectedFeatures[a&&a[d.objectIdField]])&&a.attr("data-selected","")});return b},_unsetMap:function(a){var b=this._mode;b&&b.suspend();this._trackManager&&(this._trackManager.destroy(),this._trackManager=null);q.disconnect(this._zoomConnect);q.disconnect(this._addHandle);
this._zoomConnect=this._addHandle=null;this._toggleTime(!1);this.inherited("_unsetMap",arguments)},refresh:function(){this._needsRefresh=!1;var a=this._mode;a&&a.refresh()},hasXYFootprint:function(){return"esriGeometryMultiPatch"===this.geometryType&&"xyFootprint"===this.multipatchOption},getOutFields:function(){return f.filter(this._getOutFields(),function(a){return"*"===a||!!this._getField(a)},this)},getField:function(a){return this._getField(a,!0)},getDomain:function(a,b){var c,d,e=b&&b.feature,
k=e&&this.typeIdField&&e.attributes&&e.attributes[this.typeIdField];null!=k&&f.some(this.types,function(b){if(b.id==k){if((c=b.domains&&b.domains[a])&&"inherited"===c.type)c=this._getLayerDomain(a),d=!0;return!0}return!1},this);!d&&!c&&(c=this._getLayerDomain(a));return c},_getLayerDomain:function(a){var b;f.some(this.fields,function(c){c.name===a&&(b=c.domain);return!!b});return b},getType:function(a){var b,c=a&&this.typeIdField&&a.attributes&&a.attributes[this.typeIdField];f.some(this.types,function(a){a.id==
c&&(b=a);return!!b});return b},setEditable:function(a){if(!this._collection)return console.log("FeatureLayer:setEditable - this functionality is not yet supported for layer in a feature service"),this;if(!this.loaded)return this._optEditable=a,this;var b=this._editable;this._editable=a;this._updateCaps();if(b!==a)this.onCapabilitiesChange();return this},getEditCapabilities:function(a){var b={canCreate:!1,canUpdate:!1,canDelete:!1};if(!this.loaded||!this.isEditable())return b;var c=a&&a.feature;a=
a&&a.userId;var d=f.map(this.capabilities?this.capabilities.toLowerCase().split(","):[],r.trim),e=-1<f.indexOf(d,"editing"),k=e&&-1<f.indexOf(d,"create"),b=e&&-1<f.indexOf(d,"update"),d=e&&-1<f.indexOf(d,"delete"),g=this.ownershipBasedAccessControlForFeatures,n=this.editFieldsInfo,u=n&&n.creatorField,n=n&&n.realm,c=(c=c&&c.attributes)&&u?c[u]:void 0,m=!!this.userIsAdmin,u=!g||m||!(!g.allowOthersToUpdate&&!g.allowUpdateToOthers),g=!g||m||!(!g.allowOthersToDelete&&!g.allowDeleteToOthers);if(m||e&&!k&&
!b&&!d)k=b=d=!0;e={canCreate:k,canUpdate:b,canDelete:d};null===c?(e.canUpdate=b&&u,e.canDelete=d&&g):""!==c&&c&&((a=a||this.getUserId())&&n&&(a=a+"@"+n),a.toLowerCase()!==c.toLowerCase()&&(e.canUpdate=b&&u,e.canDelete=d&&g));return e},getUserId:function(){var a;this.loaded&&(a=this.credential&&this.credential.userId||this.userId||"");return a},setUserIsAdmin:function(a){this.userIsAdmin=a},setEditSummaryCallback:function(a){this.editSummaryCallback=a},getEditSummary:function(a,b,c){c=k.isDefined(c)?
c:(new Date).getTime();var d="";c=this.getEditInfo(a,b,c);(b=b&&b.callback||this.editSummaryCallback)&&(c=b(a,c)||"");if(r.isString(c))d=c;else{if(c){a=c.action;b=c.userId;var e=c.timeValue,g=0;a&&g++;b&&g++;k.isDefined(e)&&g++;1<g&&(d=("edit"===a?"edit":"create")+(b?"User":"")+(k.isDefined(e)?c.displayPattern:""))}d=d&&k.substitute(c,this.i18n.layers.FeatureLayer[d])}return d},getEditInfo:function(a,b,c){if(this.loaded){c=k.isDefined(c)?c:(new Date).getTime();b=b&&b.action||"last";var d=this.editFieldsInfo,
e=d&&d.creatorField,g=d&&d.creationDateField,f=d&&d.editorField,d=d&&d.editDateField,f=(a=a&&a.attributes)&&f?a[f]:void 0,d=a&&d?a[d]:null,e=this._getEditData(a&&e?a[e]:void 0,a&&g?a[g]:null,c);c=this._getEditData(f,d,c);var n;switch(b){case "creation":n=e;break;case "edit":n=c;break;case "last":n=c||e}n&&(n.action=n===c?"edit":"creation");return n}},_getEditData:function(a,c,d){var e,g,n;k.isDefined(c)&&(g=d-c,n=0>g?"Full":6E4>g?"Seconds":12E4>g?"Minute":36E5>g?"Minutes":72E5>g?"Hour":864E5>g?"Hours":
6048E5>g?"WeekDay":"Full");if(void 0!==a||n)e=e||{},e.userId=a,n&&(a=b.format,d=new Date(c),e.minutes=Math.floor(g/6E4),e.hours=Math.floor(g/36E5),e.weekDay=a(d,{datePattern:"EEEE",selector:"date"}),e.formattedDate=a(d,{selector:"date"}),e.formattedTime=a(d,{selector:"time"}),e.displayPattern=n,e.timeValue=c);return e},isEditable:function(){return!(!this._editable&&!this.userIsAdmin)},setMaxAllowableOffset:function(a){this.isEditable()||this._setMaxOffset(a,!0);return this},getMaxAllowableOffset:function(){var a=
this._quantizationParameters?this._quantizationParameters.tolerance:void 0;return null!=this._maxOffset?this._maxOffset:a},_setMaxOffset:function(a,b){if(null==a)return delete this._maxOffset,delete this._quantizationParameters,this;if(this.quantize&&this.supportsCoordinatesQuantization)"esriGeometryPolyline"===this.geometryType?this._maxOffset=a:delete this._maxOffset,this._quantizationParameters={mode:"view",originPosition:"upperLeft",tolerance:a,extent:this.fullExtent};else{if(!this._isFractionalOffsetAllowed()||
!b)a=Math.floor(a);isNaN(a)||0===a?delete this._maxOffset:this._maxOffset=a;delete this._quantizationParameters}return this},_isFractionalOffsetAllowed:function(){return null==this.version||10.1<=this.version||navigator.languages&&this._isLangWithDot(navigator.languages[0])},_isLangWithDot:function(a){a=(a=a&&a.split("-"))&&a[0]&&a[0].toLowerCase();return-1!==f.indexOf(this._langsWithDot,a)},_langsWithDot:"ar en et fr he ja ko th vi zh".split(" "),setAutoGeneralize:function(a){if(this.loaded){if(!this.isEditable()&&
this.mode!==M.MODE_SNAPSHOT&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint()))(this._autoGeneralize=a)?(this._autoSnapshot&&(this._prevScale=null),this._updateMaxOffset()):this._setMaxOffset(null)}else this._optAutoGen=a;return this},setGDBVersion:function(a){if(!this._collection&&a!==this.gdbVersion&&(a||this.gdbVersion))this.gdbVersion=a,this._task.gdbVersion=a,this._url.query=r.mixin(this._url.query,{gdbVersion:a}),this.loaded&&(this.clearSelection(),
this._map&&this.refresh()),this.onGDBVersionChange();return this},setDefinitionExpression:function(a){this._defnExpr=a;(a=this._mode)&&a.propertyChangeHandler(1);return this},getDefinitionExpression:function(){return this._defnExpr},setTimeDefinition:function(a){this._isSnapshot?(this._timeDefn=a,(a=this._mode)&&a.propertyChangeHandler(2)):console.log("FeatureLayer.setTimeDefinition: layer in on-demand or selection mode does not support time definitions. Layer id \x3d "+this.id+", Layer URL \x3d "+
this.url);return this},getTimeDefinition:function(){return this._timeDefn},setTimeOffset:function(a,b){this._timeOffset=a;this._timeOffsetUnits=b;var c=this._mode;c&&c.propertyChangeHandler(0);return this},setUseMapTime:function(a){this.useMapTime=a;this._toggleTime(!this.suspended);(a=this._mode)&&a.propertyChangeHandler(0)},selectFeatures:function(a,b,c,d){b=b||M.SELECTION_NEW;a=this._getShallowClone(a);var e=this._map,g,k=this,n=v._fixDfd(new m(v._dfdCanceller));a.outFields=this.getOutFields();
a.returnGeometry=!0;a.multipatchOption=this.multipatchOption;e&&(a.outSpatialReference=new A(e.spatialReference.toJson()));if(!this._applyQueryFilters(a,!0))return g={features:[]},this._selectHandler(g,b,c,d,n),n;if(e=this._canDoClientSideQuery(a))n._pendingDfd=y(this._doQuery(a,e)),n._pendingDfd.then(function(a){g={features:a};k._selectHandler(g,b,c,d,n)});else{if(this._collection)return this._resolve([Error("FeatureLayer::selectFeatures - "+this.invalidParams)],null,d,n,!0),n;var f=this;this._ts&&
(a._ts=(new Date).getTime());(n._pendingDfd=this._task.execute(a)).addCallbacks(function(a){f._selectHandler(a,b,c,d,n)},function(a){f._resolve([a],null,d,n,!0)})}return n},getSelectedFeatures:function(){var a=this._selectedFeatures,b=[],c;for(c in a)a.hasOwnProperty(c)&&b.push(a[c]);return b},clearSelection:function(a){var b=this._selectedFeatures,c=this._mode,d;for(d in b)b.hasOwnProperty(d)&&(this._unSelectFeatureIIf(d,c),c._removeFeatureIIf(d));this._selectedFeatures={};this._isSelOnly&&c._applyTimeFilter(!0);
if(!a)this.onSelectionClear();return this},setSelectionSymbol:function(a){if(this._selectionSymbol=a){var b=this._selectedFeatures,c;for(c in b)b.hasOwnProperty(c)&&b[c].setSymbol(a)}return this},getSelectionSymbol:function(){return this._selectionSymbol},setLabelingInfo:function(a){a?(this.labelingInfo=a,this._fixLabelExpr()):delete this.labelingInfo;this._collection&&(this._typesDirty=!0);this.onLabelingInfoChange()},_fixLabelExpr:function(){var a=/\[([^\[\]]+)\]/ig,b,c=this,d=function(a,b){var d=
c._getField(b,!0);return"["+(d&&d.name||b)+"]"};f.forEach(this.labelingInfo,function(c){if(b=c.labelExpression)c.labelExpression=b.replace(a,d)})},__msigns:[{n:"applyEdits",c:5,a:[{i:0},{i:1}],e:4,f:1}],applyEdits:function(a,b,c,d,e,g){var k=g.assembly,n=g.dfd;this._applyNormalized(a,k&&k[0]);this._applyNormalized(b,k&&k[1]);this.onBeforeApplyEdits(a,b,c);var u={},m=this.objectIdField,k={f:"json"},s=!1;if(this._collection)g={},g.addResults=a?f.map(a,function(){s=!0;return{objectId:this._nextId++,
success:!0}},this):null,g.updateResults=b?f.map(b,function(a){s=!0;var b=a.attributes[m];u[b]=a;return{objectId:b,success:!0}},this):null,g.deleteResults=c?f.map(c,function(a){s=!0;return{objectId:a.attributes[m],success:!0}},this):null,s?this._editHandler(g,a,u,d,e,n):this._resolve([g.addResults,g.updateResults,g.deleteResults],null,d,n);else{a&&0<a.length&&(k.adds=this._convertFeaturesToJson(a,0,1),s=!0);if(b&&0<b.length){for(g=0;g<b.length;g++){var h=b[g];u[h.attributes[m]]=h}k.updates=this._convertFeaturesToJson(b,
0,0,1);s=!0}if(c&&0<c.length){b=[];for(g=0;g<c.length;g++)b.push(c[g].attributes[m]);k.deletes=b.join(",");s=!0}if(s){var x=this;return t({url:this._url.path+"/applyEdits",content:r.mixin(k,this._url.query),callbackParamName:"callback",load:function(b){x._editHandler(b,a,u,d,e,n)},error:function(a){x._resolve([a],null,e,n,!0)}},{usePost:!0})}this._resolve([],null,d,n)}},queryFeatures:function(a,b,c){return this._query("execute","onQueryFeaturesComplete",a,b,c)},queryRelatedFeatures:function(a,b,c){return this._query("executeRelationshipQuery",
"onQueryRelatedFeaturesComplete",a,b,c)},queryIds:function(a,b,c){return this._query("executeForIds","onQueryIdsComplete",a,b,c)},queryCount:function(a,b,c){return this._query("executeForCount","onQueryCountComplete",a,b,c)},queryExtent:function(a,b,c){return this._query("executeForExtent","onQueryExtentComplete",a,b,c)},queryAttachmentInfos:function(a,b,d){var e=this._url.path+"/"+a+"/attachments",g=new m(v._dfdCanceller),k=this;g._pendingDfd=t({url:e,content:r.mixin({f:"json"},this._url.query),
callbackParamName:"callback",load:function(d){d=d.attachmentInfos;var n;f.forEach(d,function(b){n=c.objectToQuery({gdbVersion:k._url.query&&k._url.query.gdbVersion,layer:k._url.query&&k._url.query.layer,token:k._getToken()});b.url=e+"/"+b.id+(n?"?"+n:"");b.objectId=a});k._resolve([d],"onQueryAttachmentInfosComplete",b,g)},error:function(a){k._resolve([a],null,d,g,!0)}});return g},addAttachment:function(a,b,c,d){return this._sendAttachment("add",a,b,c,d)},updateAttachment:function(a,b,c,d,e){c.appendChild(g.create("input",
{type:"hidden",name:"attachmentId",value:b}));return this._sendAttachment("update",a,c,d,e)},deleteAttachments:function(a,b,c,d){var e=this._url.path+"/"+a+"/deleteAttachments",g=new m(v._dfdCanceller),k=this;b={f:"json",attachmentIds:b.join(",")};g._pendingDfd=t({url:e,content:r.mixin(b,this._url.query),callbackParamName:"callback",load:r.hitch(this,function(b){b=b.deleteAttachmentResults;b=f.map(b,function(b){b=new I(b);b.attachmentId=b.objectId;b.objectId=a;return b});k._resolve([b],"onDeleteAttachmentsComplete",
c,g)}),error:function(a){k._resolve([a],null,d,g,!0)}},{usePost:!0});return g},addType:function(a){var b=this.types;if(b){if(f.some(b,function(b){return b.id==a.id?!0:!1}))return!1;b.push(a)}else this.types=[a];return this._typesDirty=!0},deleteType:function(a){if(this._collection){var b=this.types;if(b){var c=-1;f.some(b,function(b,d){return b.id==a?(c=d,!0):!1});if(-1<c)return this._typesDirty=!0,b.splice(c,1)[0]}}},toJson:function(){var a=this._json;if(a=r.isString(a)?w.fromJson(a):r.clone(a)){var a=
a.layerDefinition?a:{layerDefinition:a},b=a.layerDefinition,c=this._collection;if(c&&this._typesDirty){b.types=f.map(this.types||[],function(a){return a.toJson()});var d=this.renderer,e=this.labelingInfo,g=b.drawingInfo;if((d||e)&&!g)g=b.drawingInfo={};g&&(d&&-1===d.declaredClass.indexOf("TemporalRenderer"))&&(g.renderer=d.toJson());e&&(g.labelingInfo=f.map(e,function(a){return a.toJson()}))}d=null;if(!c||this._fcAdded)d={geometryType:b.geometryType,features:this._convertFeaturesToJson(this.graphics,
!0)};a.featureSet=r.mixin({},a.featureSet||{},d);a.featureSet.transform&&(e=a.featureSet.transform,delete a.featureSet.transform,d=new W(a.featureSet),d.quantize(e),a.featureSet=d.toJson());c&&(a.nextObjectId=this._nextId,b.capabilities=this.capabilities);return a}},onSelectionComplete:function(){},onSelectionClear:function(){},onBeforeApplyEdits:function(){},onEditsComplete:function(){},onQueryFeaturesComplete:function(){},onQueryRelatedFeaturesComplete:function(){},onQueryIdsComplete:function(){},
onQueryCountComplete:function(){},onQueryExtentComplete:function(){},onQueryAttachmentInfosComplete:function(){},onAddAttachmentComplete:function(){},onUpdateAttachmentComplete:function(){},onDeleteAttachmentsComplete:function(){},onCapabilitiesChange:function(){},onGDBVersionChange:function(){},onQueryLimitExceeded:function(){},onLabelingInfoChange:function(){},_forceIdentity:function(b){function c(a){var b=["allowOthersToUpdate","allowOthersToDelete","allowOthersToQuery"];return a&&f.some(b,function(b){return a.hasOwnProperty(b)&&
!a[b]})}var d=this,e,g=this._url&&this._url.path;e=g&&g.toLowerCase().indexOf("/rest/services");(this.userIsAdmin||c(this.ownershipBasedAccessControlForFeatures))&&!this._getToken()&&-1<e&&a.id?(e=g.substring(0,e)+"/rest/info",t({url:e,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}).then(function(b){if(b.owningSystemUrl)return a.id.checkSignInStatus(b.owningSystemUrl+"/sharing")}).then(function(b){if(b)return a.id.getCredential(g)}).then(function(a){a&&d._findCredential()}).always(function(){b.call(d)})):
b.call(this)},_checkMode:function(a){var b=this.geometryType,c=this.maxRecordCount;a=(a=a&&a.features&&a.features[0])&&a.attributes&&a.attributes.exceedslimit;if(this.mode===M.MODE_AUTO&&!this.isEditable()&&0===a&&(this.queryPagination||("esriGeometryPolyline"===b||"esriGeometryPolygon"===b||"esriGeometryMultipoint"===b||this.hasXYFootprint())&&c>=this.maxRecordCountForAuto||"esriGeometryPoint"===b&&c>=this.maxPointCountForAuto))this.currentMode=M.MODE_SNAPSHOT,this._mode=new Q(this),this._isSnapshot=
this._autoSnapshot=!0},_queryLimit:function(){var a=this,b=new m;this._limitPromise=b.promise;setTimeout(function(){var c=new P,d=new $;d.statisticType="exceedslimit";d.maxPointCount=a.maxPointCountForAuto;d.maxRecordCount=a.maxRecordCountForAuto;d.maxVertexCount=a.maxVertexCountForAuto;d.outStatisticFieldName="exceedslimit";c.outStatistics=[d];a.queryFeatures(c).promise.then(function(a){b.resolve(a)},function(a){b.reject(a)})},0)},_updateCaps:function(){var a=this._editable,b=r.trim(this.capabilities||
""),c=f.map(b?b.split(","):[],r.trim),d=f.map(b?b.toLowerCase().split(","):[],r.trim),b=f.indexOf(d,"editing"),e,d={Create:f.indexOf(d,"create"),Update:f.indexOf(d,"update"),Delete:f.indexOf(d,"delete")};if(a&&-1===b)c.push("Editing");else if(!a&&-1<b){a=[b];for(e in d)-1<d[e]&&a.push(d[e]);a.sort();for(e=a.length-1;0<=e;e--)c.splice(a[e],1)}this.capabilities=c.join(",")},_counter:{value:0},_getUniqueId:function(){return this._counter.value++},onSuspend:function(){this.inherited(arguments);this._toggleTime(!1);
var a=this._mode;a&&a.suspend()},onResume:function(a){this.inherited(arguments);this._toggleTime(!0);var b=this._mode,c=this._map,d=this._getRenderer();if(a.firstOccurrence){this._fixRendererFields();this._checkFields();this.clearSelection();if(this.timeInfo&&!this._trackManager&&(this._trackIdField||d&&(d.latestObservationRenderer||d.trackRenderer)))this._trackManager=new ca(this),this._trackManager.initialize(c);d&&("colors"in d&&"blurRadius"in d&&"maxPixelIntensity"in d)&&("esriGeometryPoint"==
this.geometryType&&!this._heatmapManager)&&(this._heatmapManager=new Z(this),this._heatmapManager.initialize(c));if(this._autoSnapshot&&this._autoGeneralize&&("esriGeometryPolyline"===this.geometryType||"esriGeometryPolygon"===this.geometryType||this.hasXYFootprint())&&!this.isEditable()&&null==this.getMaxAllowableOffset())d=this.generalizeForScale,this._calculatedScale=d=this.maxScale?this.maxScale:this.minScale?Math.min(d,this.minScale):Math.min(d,D.getScale(c,this.initialExtent)),this._calcMaxOffset=
c.extent.getWidth()/c.width/c.getScale()*d;this._zoomConnect=q.connect(c,"onZoomEnd",this,this._zoomEndHandler);this._updateMaxOffset();this._needsRefresh=!1;b&&b.startup()}else this._zoomEndHandler(),b&&b.resume()},_zoomEndHandler:function(){var a=this._map;this._updateMaxOffset();this._prevScale=a.getScale();!this.suspended&&this._needsRefresh&&this.refresh()},_updateMaxOffset:function(){var a=this._map;a&&a.loaded&&this._autoGeneralize&&(this._autoSnapshot?(a=this.getMaxAllowableOffset(),this._setMaxOffset(this._getMaxOffsetForScale(),
!0),this._needsRefresh||(this._needsRefresh=a!=this.getMaxAllowableOffset())):this._setMaxOffset(a.extent.getWidth()/a.width,!a.extent.spatialReference.isWebMercator()))},_getMaxOffsetForScale:function(){if(this._map){var a=this._map.getScale(),b=this._calculatedScale,c=this._calcMaxOffset,d=this._prevScale;return a>=b&&(null==d||d<b)?c:a<b&&(null==d||d>=b)?null:this.getMaxAllowableOffset()}},_toggleTime:function(a){var b=this._map;a&&this.timeInfo&&this.useMapTime&&b?(this._mapTimeExtent=b.timeExtent,
this._timeConnect||(this._timeConnect=q.connect(b,"onTimeExtentChange",this,this._timeChangeHandler))):(this._mapTimeExtent=null,q.disconnect(this._timeConnect),this._timeConnect=null)},_timeChangeHandler:function(a){this._mapTimeExtent=a;(a=this._mode)&&a.propertyChangeHandler(0)},_getOffsettedTE:function(a){var b=this._timeOffset,c=this._timeOffsetUnits;return a&&b&&c?a.offset(-1*b,c):a},_getTimeOverlap:function(a,b){return a&&b?a.intersection(b):a||b},_getTimeFilter:function(a){var b=this.getTimeDefinition(),
c;if(b&&(c=this._getTimeOverlap(b,null),!c))return[!1];if(a){if(a=c?this._getTimeOverlap(a,c):a,!a)return[!1]}else a=c;return[!0,a]},_getAttributeFilter:function(a){var b=this.getDefinitionExpression();return a?b?"("+b+") AND ("+a+")":a:b},_applyQueryFilters:function(a,b){a.where=this._getAttributeFilter(a.where);a.maxAllowableOffset||(a.maxAllowableOffset=this._maxOffset);a.quantizationParameters=this._quantizationParameters;b&&this.supportsAdvancedQueries&&(a.orderByFields=a.orderByFields||this.getOrderByFields());
if(this.timeInfo){var c=this._getTimeFilter(a.timeExtent);if(c[0])a.timeExtent=c[1];else return!1}return!0},_add:function(a){var b=this._selectionSymbol,c=a.attributes,d=this.visibilityField;b&&this._isSelOnly&&a.setSymbol(b);if(d&&c&&c.hasOwnProperty(d))a[c[d]?"show":"hide"]();return this.add.apply(this,arguments)},_remove:function(){return this.remove.apply(this,arguments)},_canDoClientSideQuery:function(a){var b=[],c=this._map;if(!(this._isTable||!c&&!this._collection))if(!a.text&&!(a.where&&a.where!==
this.getDefinitionExpression()||a.orderByFields&&a.orderByFields.length||a.outStatistics||a.returnDistinctValues)){var d=this._isSnapshot,e=this._isSelOnly,g=a.geometry;if(g)if(!e&&a.spatialRelationship===P.SPATIAL_REL_INTERSECTS&&"extent"===g.type&&(d||c.extent.contains(g)))b.push(1);else return;if(c=a.objectIds)if(d)b.push(2);else{var g=c.length,k=this._mode,n=0,u;for(u=0;u<g;u++)k._getFeature(c[u])&&n++;if(n===g)b.push(2);else return}if(this.timeInfo)if(a=a.timeExtent,c=this._mapTimeExtent,d)a&&
b.push(3);else if(e){if(a)return}else if(c)if(-1!==f.indexOf(b,2))a&&b.push(3);else if(-1!==f.indexOf(b,1))a==c&&b.push(3);else return;else if(0<b.length)a&&b.push(3);else if(a)return;return 0<b.length?b:null}},_getAbsMid:function(a){return p.toAbsMid?p.toAbsMid(a):l.id.replace(/\/[^\/]*$/ig,"/")+a},_doQuery:function(a,b,c){var d=[],e=this.objectIdField,g=this,k=new m,n=new m,u=this.graphics;if(-1!==f.indexOf(b,1)){var s=this.spatialIndex||this._map&&this._map.spatialIndex,h,t=a.geometry._normalize(null,
!0);null==s&&ea.autoSpatialIndexing?h=(this._map||this).addPlugin(this._getAbsMid("../plugins/spatialIndex")).then(r.hitch(this,r.partial(this._getFromIndex,t,s)),function(a){n.resolve(r.hitch(this,r.partial(this._filterByExtent,u,t)))}):s&&(h=this._getFromIndex(t,s));h?h.then(function(a){for(var b=0;b<a.length;b++)a[b].results&&(d=d.concat(a[b].results));n.resolve(d)}).otherwise(function(a){n.reject(a)}):n.resolve(this._filterByExtent(u,t))}else n.resolve(u);n.then(function(n){d=n;if(-1!==f.indexOf(b,
2)){var u=a.objectIds;d=f.filter(d,function(a){return-1<f.indexOf(u,a.attributes[e])})}-1!==f.indexOf(b,3)&&g.timeInfo&&(n=a.timeExtent,d=g._filterByTime(d,n.startTime,n.endTime).match);c&&(d=f.map(d,function(a){return a.attributes[e]},this));k.resolve(d)});return k},_getFromIndex:function(a,b){b=b||this.spatialIndex||this._map.spatialIndex;a instanceof Array||(a=[a]);var c=this.id;return z(f.map(a,function(a){return b.intersects(a,c)}))},_filterByExtent:function(a,b){for(var c=[],d=0,e=a.length;d<
e;d++){var g=a[d],k=g.geometry;k&&(this.normalization&&b.length?(b[0].intersects(k)||b[1].intersects(k))&&c.push(g):b.intersects(k)&&c.push(g))}return c},_filterByTime:function(a,b,c){var d=this._startTimeField,e=this._endTimeField,g;this._twoTimeFields||(g=d||e);var n=k.isDefined,f=[],u=[],s,m=a.length,h,t;b=b?b.getTime():-Infinity;c=c?c.getTime():Infinity;if(g)for(s=0;s<m;s++)h=a[s],t=h.attributes,d=t[g],d>=b&&d<=c?f.push(h):u.push(h);else for(s=0;s<m;s++)h=a[s],t=h.attributes,g=t[d],t=t[e],g=n(g)?
g:-Infinity,t=n(t)?t:Infinity,g>=b&&g<=c||t>=b&&t<=c||b>=g&&c<=t?f.push(h):u.push(h);return{match:f,noMatch:u}},_resolve:function(a,b,c,d,e){b&&this[b].apply(this,a);c&&c.apply(null,a);d&&v._resDfd(d,a,e)},_getShallowClone:function(a){var b=new P,c;for(c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},_query:function(a,b,c,d,e){var g=this,k=this._map,n=new m(v._dfdCanceller),f=c,u;if("executeRelationshipQuery"!==a){f=this._getShallowClone(c);f.outFields||(f.outFields=this.getOutFields());f.returnGeometry=
c.hasOwnProperty("returnGeometry")?c.returnGeometry:!c.outStatistics;f.returnGeometry&&(f.multipatchOption=this.multipatchOption);var s;k&&(c=k&&k.spatialReference,(k=f.outSpatialReference)?u=!k.equals(c):f.outSpatialReference=new A(c.toJson()));if(!this._applyQueryFilters(f,"execute"===a&&!f.outStatistics)){switch(a){case "execute":s=new W({features:[]});break;case "executeForIds":s=[];break;case "executeForCount":s=0;break;case "executeForExtent":s={}}this._resolve([s],b,d,n);return n}if(c="executeForExtent"!==
a&&!u&&this._canDoClientSideQuery(f))return n._pendingDfd=y(this._doQuery(f,c,"executeForIds"===a||"executeForCount"===a)),n._pendingDfd.then(function(c){switch(a){case "execute":s=new W;s.features=c;break;case "executeForIds":s=c;break;case "executeForCount":s=c.length}g._resolve([s],b,d,n)}),n}if(this._collection)return this._resolve([Error("FeatureLayer::_query - "+this.invalidParams)],null,e,n,!0),n;this._ts&&(f._ts=(new Date).getTime());(n._pendingDfd=this._task[a](f)).addCallbacks(function(c){var e=
!!f.outStatistics||u;if("execute"===a||"executeRelationshipQuery"===a){var k,s;if("execute"===a){k=c.features;s=k.length;for(s-=1;0<=s;s--)if(k[s]._layer=g,!e&&!g._isTable){var m=g._mode._getFeature(k[s].attributes[g.objectIdField]);m&&k.splice(s,1,m)}}else for(m in c)if(c.hasOwnProperty(m)){k=c[m].features;s=k.length;for(s-=1;0<=s;s--)k[s]._layer=g}}g._resolve([c],b,d,n)},function(a){g._resolve([a],null,e,n,!0)});return n},_convertFeaturesToJson:function(a,b,c,d){var e=[],g=this._selectionSymbol,
k=this.visibilityField,n,u=this.objectIdField;if(this.loaded&&(c||d))n=f.filter(this.fields,function(a){return!1===a.editable&&(!d||a.name!==u)});for(c=0;c<a.length;c++){var s=a[c],m={},t=s.geometry,h=s.attributes,x=s.symbol;if(t&&(!d||!this.loaded||this.allowGeometryUpdates))m.geometry=t.toJson();k?(m.attributes=h=r.mixin({},h),h[k]=s.visible?1:0):h&&(m.attributes=r.mixin({},h));m.attributes&&(n&&n.length)&&f.forEach(n,function(a){delete m.attributes[a.name]});x&&x!==g&&(m.symbol=x.toJson());e.push(m)}return b?
e:w.toJson(e)},_selectHandler:function(a,b,c,d,e){var g;d=M;switch(b){case d.SELECTION_NEW:this.clearSelection(!0);g=!0;break;case d.SELECTION_ADD:g=!0;break;case d.SELECTION_SUBTRACT:g=!1}d=a.features;var k=this._mode,n=[],f=this.objectIdField,s,u;if(g)for(g=0;g<d.length;g++)s=d[g],u=s.attributes[f],s=k._addFeatureIIf(u,s),n.push(s),this._selectFeatureIIf(u,s,k);else for(g=0;g<d.length;g++)s=d[g],u=s.attributes[f],this._unSelectFeatureIIf(u,k),u=k._removeFeatureIIf(u),n.push(u||s);this._isSelOnly&&
k._applyTimeFilter(!0);this._resolve([n,b,a.exceededTransferLimit?{queryLimitExceeded:!0}:null],"onSelectionComplete",c,e);if(a.exceededTransferLimit)this.onQueryLimitExceeded()},_selectFeatureIIf:function(a,b,c){var d=this._selectedFeatures,e=d[a];e||(c._incRefCount(a),d[a]=b,this._isTable||(this._setSelectSymbol(b),b.attr("data-selected","")));return e||b},_unSelectFeatureIIf:function(a,b){var c=this._selectedFeatures[a];c&&(b._decRefCount(a),delete this._selectedFeatures[a],this._isTable||(this._setUnSelectSymbol(c),
c.attr("data-selected")));return c},_isSelected:function(a){},_setSelectSymbol:function(a){var b=this._selectionSymbol;b&&!this._isSelOnly&&a.setSymbol(b)},_setUnSelectSymbol:function(a){var b=this._selectionSymbol;b&&!this._isSelOnly&&b===a.symbol&&a.setSymbol(null,!0)},_getOutFields:function(){var a=[this.objectIdField,this.typeIdField,this.creatorField,this._startTimeField,this._endTimeField,this._trackIdField].concat(this._rendererFields).concat(this.dataAttributes),a=f.filter(a,function(a,b,
c){return!!a&&f.indexOf(c,a)===b}),b=r.clone(this._outFields);if(b){if(-1!==f.indexOf(b,"*"))return b;f.forEach(a,function(a){-1===f.indexOf(b,a)&&b.push(a)});return b}return a},_checkFields:function(a){var b=a||this._getOutFields();f.forEach(b,function(a){"*"!==a&&(this._getField(a)||console.debug("esri.layers.FeatureLayer: "+k.substitute({url:this.url,field:a},"unable to find '${field}' field in the layer 'fields' information [url: ${url}]")))},this);!a&&(!this._isTable&&!this._fserver&&!this._collection&&
!this._isStream)&&(f.some(this.fields,function(a){return a&&"esriFieldTypeGeometry"===a.type?!0:!1})||console.debug("esri.layers.FeatureLayer: "+k.substitute({url:this.url},"unable to find a field of type 'esriFieldTypeGeometry' in the layer 'fields' information. If you are using a map service layer, features will not have geometry [url: ${url}]")))},_fixFieldCase:function(a,b,c){var d=a&&a[b],e;if(d&&!r.isFunction(d)){if(e=!this._getField(d)&&this._getField(d,!0))d=a[b]=e.name;c&&c.push(d)}return d},
_fixRendererFields:function(){var a=this.renderer;this._orderBy=null;if(a&&0<this.fields.length){var b=[],c,a=f.filter([a,a.observationRenderer,a.latestObservationRenderer,a.trackRenderer],k.isDefined),d=[].concat(a);f.forEach(a,function(a){f.forEach(a.rendererInfos,function(a){a.renderer&&d.push(a.renderer)})});f.forEach(d,function(a){this._fixFieldCase(a,"attributeField",b);this._fixFieldCase(a,"attributeField2",b);this._fixFieldCase(a,"attributeField3",b);this._fixFieldCase(a.rotationInfo,"field",
b);if((c=this._fixFieldCase(a.sizeInfo,"field",b))&&!this._orderBy)this._orderBy=[c+" DESC"];this._fixFieldCase(a.sizeInfo,"normalizationField",b);this._fixFieldCase(a.colorInfo,"field",b);this._fixFieldCase(a.colorInfo,"normalizationField",b);this._fixFieldCase(a.field,"field",b);this._fixFieldCase(a.opacityInfo,"field",b);this._fixFieldCase(a.opacityInfo,"normalizationField",b);f.forEach(a.visualVariables,function(a){c=this._fixFieldCase(a,"field",b);"sizeInfo"===a.type&&(c&&!this._orderBy)&&(this._orderBy=
[c+" DESC"]);this._fixFieldCase(a,"normalizationField",b)},this);if(!this._orderBy&&a.addBreak&&!r.isFunction(a.attributeField)&&(a.backgroundFillSymbol||this._hasSizeDiff(a)))this._orderBy=[a.attributeField+" DESC"]},this);this._rendererFields=f.filter(b,k.isDefined)}},_hasSizeDiff:function(a){var b=Number.MAX_VALUE,c=-Number.MAX_VALUE,d,e;f.forEach(a.infos,function(a){if(e=a.symbol){d=0;switch(e.type){case "simplemarkersymbol":d=e.size;break;case "picturemarkersymbol":d=(e.width+e.height)/2;break;
case "simplelinesymbol":case "cartographiclinesymbol":d=e.width;break;case "simplefillsymbol":case "picturefillsymbol":d=e.outline&&e.outline.width}d&&(b=Math.min(b,d),c=Math.max(c,d))}});return b!==Number.MAX_VALUE&&c!==-Number.MAX_VALUE&&1<Math.abs(c-b)},getOrderByFields:function(){var a=this.orderByFields||this._orderBy;return this.supportsAdvancedQueries&&a?f.filter(a,function(a){a=a.split(" ")[0];return!!this._getField(a,!0)},this):null},_getField:function(a,b){var c=this.fields;if(!c||0===c.length)return null;
var d;b&&(a=a.toLowerCase());f.some(c,function(c){var e=!1;(e=b?c&&c.name.toLowerCase()===a?!0:!1:c&&c.name===a?!0:!1)&&(d=c);return e});return d},_getDateOpts:function(){this._dtOpts||(this._dtOpts={properties:f.map(f.filter(this.fields,function(a){return!!(a&&"esriFieldTypeDate"===a.type)}),function(a){return a.name})});return this._dtOpts},_applyNormalized:function(a,b){a&&b&&f.forEach(a,function(a,c){a&&b[c]&&a.setGeometry(b[c])})},_editHandler:function(a,b,c,d,e,g){e=a.addResults;var k=a.updateResults;
a=a.deleteResults;var n,s,u,m,h=this.objectIdField,t=this._mode,x=this._isTable;n=this.editFieldsInfo;var l=this.getOutFields()||[],v=n&&n.creatorField,A=n&&n.creationDateField,q=n&&n.editorField,y=n&&n.editDateField;n=n&&n.realm;-1===f.indexOf(l,"*")&&(v&&-1===f.indexOf(l,v)&&(v=null),A&&-1===f.indexOf(l,A)&&(A=null),q&&-1===f.indexOf(l,q)&&(q=null),y&&-1===f.indexOf(l,y)&&(y=null));var l=A||y?(new Date).getTime():null,p=v||q?this.getUserId():void 0;p&&n&&(p=p+"@"+n);if(e)for(n=0;n<e.length;n++)e[n]=
new I(e[n]),x||(s=e[n],s.success&&(s=s.objectId,u=b[n],(m=u._graphicsLayer)&&m!==this&&m.remove(u),m=u.attributes||{},m[h]=s,v&&(m[v]=p),q&&(m[q]=p),A&&(m[A]=l),y&&(m[y]=l),u.setAttributes(m),t._init&&t.drawFeature(u)));if(k)for(n=0;n<k.length;n++)if(k[n]=new I(k[n]),!x&&(s=k[n],s.success)){s=s.objectId;u=c[s];if(b=t._getFeature(s))b.geometry!==u.geometry&&u.geometry&&b.setGeometry(E.fromJson(u.geometry.toJson())),b.attributes!==u.attributes&&u.attributes&&b.setAttributes(r.mixin(b.attributes,u.attributes)),
this._repaint(b,s);u=b||u;m=u.attributes||{};q&&(m[q]=p);y&&(m[y]=l);u.setAttributes(m)}if(a){c=[];for(n=0;n<a.length;n++)if(a[n]=new I(a[n]),!x&&(s=a[n],s.success&&(s=s.objectId,u=t._getFeature(s))))this._unSelectFeatureIIf(s,t)&&c.push(u),u._count=0,t._removeFeatureIIf(s);if(0<c.length)this.onSelectionComplete(c,M.SELECTION_SUBTRACT)}this._resolve([e,k,a],"onEditsComplete",d,g)},_sendAttachment:function(a,b,c,d,e){var g=this;return t({url:this._url.path+"/"+b+"/"+("add"===a?"addAttachment":"updateAttachment"),
form:c,content:r.mixin(this._url.query,{f:"json",token:this._getToken()||void 0}),callbackParamName:"callback.html",handleAs:"json"}).addCallback(function(c){var e="add"===a?"onAddAttachmentComplete":"onUpdateAttachmentComplete";c=new I(c["add"===a?"addAttachmentResult":"updateAttachmentResult"]);c.attachmentId=c.objectId;c.objectId=b;g._resolve([c],e,d);return c}).addErrback(function(a){g._resolve([a],null,e,null,!0)})},_repaint:function(a,b,c){b=k.isDefined(b)?b:a.attributes[this.objectIdField];
(!(b in this._selectedFeatures)||!this._selectionSymbol)&&a.setSymbol(a.symbol,c)},_getKind:function(a){var b=this._trackManager;return b?b.isLatestObservation(a)?1:0:0}});r.mixin(M,{MODE_SNAPSHOT:0,MODE_ONDEMAND:1,MODE_SELECTION:2,SELECTION_NEW:3,SELECTION_ADD:4,SELECTION_SUBTRACT:5,MODE_AUTO:6,MODE_STREAM:7,POPUP_NONE:"esriServerHTMLPopupTypeNone",POPUP_HTML_TEXT:"esriServerHTMLPopupTypeAsHTMLText",POPUP_URL:"esriServerHTMLPopupTypeAsURL"});F._createWrappers(M);e("extend-esri")&&r.setObject("layers.FeatureLayer",
M,a);return M})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(p,l,h,q,r,f,w,m,b,e){function c(a,b,c){return z&&c?function(a,b){return f(a,c,b)}:k?function(c,d){var e=f(c,b,function(a){d.call(this,a);G=(new Date).getTime()}),g=f(c,a,function(a){(!G||(new Date).getTime()>G+1E3)&&d.call(this,a)});return{remove:function(){e.remove();g.remove()}}}:function(b,c){return f(b,a,c)}}function g(a){do if(void 0!==
a.dojoClick)return a;while(a=a.parentNode)}function d(a,b,c){var d=g(a.target);if(x=!a.target.disabled&&d&&d.dojoClick)if(A=(v="useTarget"==x)?d:a.target,v&&a.preventDefault(),s=a.changedTouches?a.changedTouches[0].pageX-e.global.pageXOffset:a.clientX,n=a.changedTouches?a.changedTouches[0].pageY-e.global.pageYOffset:a.clientY,u=("object"==typeof x?x.x:"number"==typeof x?x:0)||4,R=("object"==typeof x?x.y:"number"==typeof x?x:0)||4,!t){t=!0;var k=function(a){x=v?h.isDescendant(e.doc.elementFromPoint(a.changedTouches?
a.changedTouches[0].pageX-e.global.pageXOffset:a.clientX,a.changedTouches?a.changedTouches[0].pageY-e.global.pageYOffset:a.clientY),A):x&&(a.changedTouches?a.changedTouches[0].target:a.target)==A&&Math.abs((a.changedTouches?a.changedTouches[0].pageX-e.global.pageXOffset:a.clientX)-s)<=u&&Math.abs((a.changedTouches?a.changedTouches[0].pageY-e.global.pageYOffset:a.clientY)-n)<=R};e.doc.addEventListener(b,function(a){k(a);v&&a.preventDefault()},!0);e.doc.addEventListener(c,function(a){k(a);if(x){J=(new Date).getTime();
var b=v?A:a.target;"LABEL"===b.tagName&&(b=h.byId(b.getAttribute("for"))||b);var c=a.changedTouches?a.changedTouches[0]:a,d=document.createEvent("MouseEvents");d._dojo_click=!0;d.initMouseEvent("click",!0,!0,a.view,a.detail,c.screenX,c.screenY,c.clientX,c.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null);setTimeout(function(){f.emit(b,"click",d);J=(new Date).getTime()},0)}},!0);a=function(a){e.doc.addEventListener(a,function(b){!b._dojo_click&&((new Date).getTime()<=J+1E3&&!("INPUT"==b.target.tagName&&
q.contains(b.target,"dijitOffScreen")))&&(b.stopPropagation(),b.stopImmediatePropagation&&b.stopImmediatePropagation(),"click"==a&&(("INPUT"!=b.target.tagName||"radio"==b.target.type||"checkbox"==b.target.type)&&"TEXTAREA"!=b.target.tagName&&"AUDIO"!=b.target.tagName&&"VIDEO"!=b.target.tagName)&&b.preventDefault())},!0)};a("click");a("mousedown");a("mouseup")}}var y=5>w("ios"),z=w("pointer-events")||w("MSPointer"),a=function(){var a={},b;for(b in{down:1,move:1,up:1,cancel:1,over:1,out:1})a[b]=w("MSPointer")?
"MSPointer"+b.charAt(0).toUpperCase()+b.slice(1):"pointer"+b;return a}(),k=w("touch-events"),t,x,v=!1,A,s,n,u,R,J,G,B;z?b(function(){e.doc.addEventListener(a.down,function(b){d(b,a.move,a.up)},!0)}):k&&b(function(){function a(b){var c=r.delegate(b,{bubbles:!0});6<=w("ios")&&(c.touches=b.touches,c.altKey=b.altKey,c.changedTouches=b.changedTouches,c.ctrlKey=b.ctrlKey,c.metaKey=b.metaKey,c.shiftKey=b.shiftKey,c.targetTouches=b.targetTouches);return c}B=e.body();e.doc.addEventListener("touchstart",function(a){G=
(new Date).getTime();var b=B;B=a.target;f.emit(b,"dojotouchout",{relatedTarget:B,bubbles:!0});f.emit(B,"dojotouchover",{relatedTarget:b,bubbles:!0});d(a,"touchmove","touchend")},!0);f(e.doc,"touchmove",function(b){G=(new Date).getTime();var c=e.doc.elementFromPoint(b.pageX-(y?0:e.global.pageXOffset),b.pageY-(y?0:e.global.pageYOffset));c&&(B!==c&&(f.emit(B,"dojotouchout",{relatedTarget:c,bubbles:!0}),f.emit(c,"dojotouchover",{relatedTarget:B,bubbles:!0}),B=c),f.emit(c,"dojotouchmove",a(b))||b.preventDefault())});
f(e.doc,"touchend",function(b){G=(new Date).getTime();var c=e.doc.elementFromPoint(b.pageX-(y?0:e.global.pageXOffset),b.pageY-(y?0:e.global.pageYOffset))||e.body();f.emit(c,"dojotouchend",a(b))})});l={press:c("mousedown","touchstart",a.down),move:c("mousemove","dojotouchmove",a.move),release:c("mouseup","dojotouchend",a.up),cancel:c(m.leave,"touchcancel",z?a.cancel:null),over:c("mouseover","dojotouchover",a.over),out:c("mouseout","dojotouchout",a.out),enter:m._eventHandler(c("mouseover","dojotouchover",
a.over)),leave:m._eventHandler(c("mouseout","dojotouchout",a.out))};return p.touch=l})},"dijit/_WidgetsInTemplateMixin":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare","dojo/_base/lang","dojo/parser"],function(p,l,h,q,r){return h("dijit._WidgetsInTemplateMixin",null,{_earlyTemplatedStartup:!1,widgetsInTemplate:!0,contextRequire:null,_beforeFillContent:function(){if(this.widgetsInTemplate){var f=this.domNode;this.containerNode&&!this.searchContainerNode&&(this.containerNode.stopParser=
!0);r.parse(f,{noStart:!this._earlyTemplatedStartup,template:!0,inherited:{dir:this.dir,lang:this.lang,textDir:this.textDir},propsThis:this,contextRequire:this.contextRequire,scope:"dojo"}).then(q.hitch(this,function(f){this._startupWidgets=f;for(var m=0;m<f.length;m++)this._processTemplateNode(f[m],function(b,e){return b[e]},function(b,e,c){return e in b?b.connect(b,e,c):b.on(e,c,!0)});this.containerNode&&this.containerNode.stopParser&&delete this.containerNode.stopParser}));if(!this._startupWidgets)throw Error(this.declaredClass+
": parser returned unfilled promise (probably waiting for module auto-load), unsupported by _WidgetsInTemplateMixin.   Must pre-load all supporting widgets before instantiation.");}},_processTemplateNode:function(f,h,m){return h(f,"dojoType")||h(f,"data-dojo-type")?!0:this.inherited(arguments)},startup:function(){p.forEach(this._startupWidgets,function(f){f&&(!f._started&&f.startup)&&f.startup()});this._startupWidgets=null;this.inherited(arguments)}})})},"esri/layers/RenderMode":function(){define("dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has dojo/io/script ../kernel".split(" "),
function(p,l,h,q,r,f,w){l=l(null,{declaredClass:"esri.layers._RenderMode",constructor:function(){this._prefix="jsonp_"+(p._scopeName||"dojo")+"IoScript"},initialize:function(f){this.map=f;this._init=!0},startup:function(){},propertyChangeHandler:function(f){},destroy:function(){this._init=!1},drawFeature:function(f){},suspend:function(){},resume:function(){},refresh:function(){},_incRefCount:function(f){(f=this._featureMap[f])&&f._count++},_decRefCount:function(f){(f=this._featureMap[f])&&f._count--},
_getFeature:function(f){return this._featureMap[f]},_addFeatureIIf:function(f,b){var e=this._featureMap,c=e[f],g=this.featureLayer;c||(e[f]=b,g._add(b),b._count=0);return c||b},_removeFeatureIIf:function(f){var b=this._featureMap[f],e=this.featureLayer;if(b){if(b._count)return;delete this._featureMap[f];e._remove(b)}return b},_clearIIf:function(){var f;f=this.featureLayer;var b=f.graphics,e=f._selectedFeatures,c=f.objectIdField;for(f=b.length-1;0<=f;f--){var g=b[f],d=g.attributes[c];d in e?g._count=
1:(g._count=0,this._removeFeatureIIf(d))}},_isPending:function(m){return f[this._prefix+m]?!0:!1},_cancelPendingRequest:function(m,b){if(m=m||f[this._prefix+b])try{m.cancel(),f._validCheck(m)}catch(e){}},_purgeRequests:function(){f._validCheck(null)},_toggleVisibility:function(f){var b=this.featureLayer,e=b.graphics,c=f?"show":"hide",g,d=e.length;f=f&&b._ager;for(g=0;g<d;g++){var h=e[g];h[c]();f&&b._repaint(h)}},_applyTimeFilter:function(f){var b=this.featureLayer;if(b.timeInfo&&!b.suspended){f||
b._fireUpdateStart();var e=b._trackManager;e&&e.clearTracks();var c=b.getTimeDefinition(),g=b._getOffsettedTE(b._mapTimeExtent);g?(g=b._getTimeOverlap(c,g))?(c=b._filterByTime(b.graphics,g.startTime,g.endTime),e&&e.addFeatures(c.match),q.forEach(c.match,function(c){var e=c._shape;c.visible||(c.show(),(e=c._shape)&&e._moveToFront());b._ager&&e&&b._repaint(c)}),q.forEach(c.noMatch,function(b){b.visible&&b.hide()})):this._toggleVisibility(!1):(e&&e.addFeatures(b.graphics),this._toggleVisibility(!0));
e&&(e.moveLatestToFront(),e.drawTracks());f||b._fireUpdateEnd()}}});r("extend-esri")&&h.setObject("layers._RenderMode",l,w);return l})},"esri/layers/FeatureType":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../symbols/jsonUtils ./RangeDomain ./CodedValueDomain ./InheritedDomain ./FeatureTemplate".split(" "),function(p,l,h,q,r,f,w,m,b,e,c){p=p(null,{declaredClass:"esri.layers.FeatureType",constructor:function(g){if(g&&l.isObject(g)){this.id=g.id;
this.name=g.name;var d=g.symbol;d&&(this.symbol=w.fromJson(d));var d=g.domains,f,h=this.domains={};for(f in d)if(d.hasOwnProperty(f)){var a=d[f];switch(a.type){case "range":h[f]=new m(a);break;case "codedValue":h[f]=new b(a);break;case "inherited":h[f]=new e(a)}}if(f=g.templates){d=this.templates=[];for(g=0;g<f.length;g++)d.push(new c(f[g]))}}},toJson:function(){var b={id:this.id,name:this.name,symbol:this.symbol&&this.symbol.toJson()},c,e=this.domains,m=this.templates,a=f.fixJson;if(e){var k=b.domains=
{};for(c in e)e.hasOwnProperty(c)&&(k[c]=e[c]&&e[c].toJson());a(k)}m&&(b.templates=h.map(m,function(a){return a.toJson()}));return a(b)}});q("extend-esri")&&l.setObject("layers.FeatureType",p,r);return p})},"esri/layers/TrackManager":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../graphic ../geometry/Polyline ./GraphicsLayer".split(" "),function(p,l,h,q,r,f,w,m){p=p(null,{declaredClass:"esri.layers._TrackManager",constructor:function(b){this.layer=b;this.trackMap=
{};this.trackLineMap={}},initialize:function(b){this.map=b;var e=this.layer,c=e._getRenderer(),c=c&&c.trackRenderer;if("esriGeometryPoint"===e.geometryType){var g=this.container=new m._GraphicsLayer({id:e.id+"_tracks",_child:!0});g.loaded=!0;g.onLoad(g);g._setMap(b,e._div);g.setRenderer(c)}},addFeatures:function(b){var e=this.trackMap,c=this.layer,g=c._trackIdField,d=[];h.forEach(b,function(a){var b=a.attributes[g];(e[b]=e[b]||[]).push(a);-1===h.indexOf(d,b)&&d.push(b)});var f=c._startTimeField,m=
c.objectIdField,a=function(a,b){var c=a.attributes[f],d=b.attributes[f];return c===d?a.attributes[m]<b.attributes[m]?-1:1:c<d?-1:1};h.forEach(d,function(b){e[b].sort(a)})},trimTracks:function(b){function e(b){for(b=c[b]||[];b.length>g;)d.push(b.shift())}var c=this.trackMap,g=this.layer.maximumTrackPoints||0,d=[],f;if(!g)return d;if(b)h.forEach(b,function(b){e(b)});else for(f in c)c.hasOwnProperty(f)&&e(f);return d},drawTracks:function(b){function e(a){var b=d[a],e,h,r;h=c.trackLineMap[a];g.remove(h);
delete c.trackLineMap[a];if(!b||2>b.length)return!1;h=[];for(e=b.length-1;0<=e;e--)(r=b[e].geometry)&&h.push([r.x,r.y]);b={};b[l]=a;1<h.length&&(h=new f(new w({paths:[h],spatialReference:m}),null,b),g.add(h),c.trackLineMap[a]=h)}var c=this,g=this.container,d,m,l,a;if(g)if(d=this.trackMap,m=this.map.spatialReference,l=this.layer._trackIdField,b)h.forEach(b,function(a){e(a)});else for(a in d)d.hasOwnProperty(a)&&e(a)},refreshTracks:function(b){function e(a){var b,e;c.drawTracks([a]);if(f&&f.latestObservationRenderer){a=
g[a]||[];b=a.length;for(e=0;e<b;e++)d._repaint(a[e],null,!0)}}var c=this,g=this.trackMap,d=this.layer,f=d._getRenderer(),m;if(b)h.forEach(b,function(a){e(a)});else for(m in g)g.hasOwnProperty(m)&&e(m);this.moveLatestToFront()},moveLatestToFront:function(b){h.forEach(this.getLatestObservations(b),function(b){var c=b._shape;c&&c._moveToFront();this._repaint(b,null,!0)},this.layer)},getLatestObservations:function(b){function e(b){b=d[b];return b[b.length-1]}var c=[],g=this.layer._getRenderer(),d=this.trackMap,
f;if(!g.latestObservationRenderer)return c;if(b)h.forEach(b,function(b){c.push(e(b))});else for(f in d)d.hasOwnProperty(f)&&c.push(e(f));return c},clearTracks:function(b){var e=this.getLatestObservations(b),c=this.container,g;b?h.forEach(b,function(b){delete this.trackMap[b];c&&(g=this.trackLineMap[b],c.remove(g),delete this.trackLineMap[b])},this):(this.trackMap={},this.trackLineMap={},c&&c.clear());h.forEach(e,function(b){this._repaint(b,null,!0)},this.layer)},isLatestObservation:function(b){var e=
this.trackMap[b.attributes[this.layer._trackIdField]];return e?e[e.length-1]===b:!1},destroy:function(){var b=this.container;b&&(b.clear(),b._unsetMap(this.map,this.layer._div));this.map=this.layer=this.trackMap=this.container=null}});q("extend-esri")&&l.setObject("layers._TrackManager",p,r);return p})},"esri/layers/GridLayout":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../SpatialReference ../geometry/Extent ../geometry/Polyline".split(" "),function(p,
l,h,q,r,f,w,m){p=p(null,{declaredClass:"esri.layers._GridLayout",constructor:function(b,e,c,g){this.origin=b;this.cellWidth=e.width;this.cellHeight=e.height;this.mapWidth=c.width;this.mapHeight=c.height;this.srInfo=g},setResolution:function(b){this._resolution=(b.xmax-b.xmin)/this.mapWidth;this.srInfo&&(b=Math.round(2*this.srInfo.valid[1]/this._resolution),b=Math.round(b/this.cellWidth),this._frameStats=[b,0,b-1])},getCellCoordinates:function(b){var e=this._resolution,c=this.origin;return{row:Math.floor((c.y-
b.y)/(this.cellHeight*e)),col:Math.floor((b.x-c.x)/(this.cellWidth*e))}},normalize:function(b){var e=this._frameStats;if(e){var c=e[0],g=e[1],e=e[2];b<g?(b%=c,b=b<g?b+c:b):b>e&&(b%=c)}return b},intersects:function(b,e){var c=this.srInfo;return c?h.some(e._getParts(c),function(c){return b.intersects(c.extent)}):b.intersects(e)},getCellExtent:function(b,e){var c=this._resolution,g=this.origin,d=this.cellWidth,m=this.cellHeight;return new w(e*d*c+g.x,g.y-(b+1)*m*c,(e+1)*d*c+g.x,g.y-b*m*c,new f(g.spatialReference.toJson()))},
getLatticeID:function(b){var e=this.getCellCoordinates({x:b.xmin,y:b.ymax}),c=this.getCellCoordinates({x:b.xmax,y:b.ymin});b=e.row;var g=c.row,e=this.normalize(e.col),c=this.normalize(c.col);return b+"_"+g+"_"+e+"_"+c},sorter:function(b,e){return b<e?-1:1},getCellsInExtent:function(b,e){var c=this.getCellCoordinates({x:b.xmin,y:b.ymax}),g=this.getCellCoordinates({x:b.xmax,y:b.ymin}),d=c.row,f=g.row,c=c.col,g=g.col,h=[],a,k,t,l=[],v=[],r,s,n,u=[];for(a=d;a<=f;a++)for(k=c;k<=g;k++)t=this.normalize(k),
b=this.getCellExtent(a,t),h.push({row:a,col:t,extent:b,resolution:this._resolution}),e&&(l.push(b.xmin,b.xmax),v.push(b.ymin,b.ymax));c=this.normalize(c);g=this.normalize(g);l.sort(this.sorter);v.sort(this.sorter);k=l.length;for(a=k-1;0<=a;a--)a<k-1&&l[a]===l[a+1]&&l.splice(a,1);k=v.length;for(a=k-1;0<=a;a--)a<k-1&&v[a]===v[a+1]&&v.splice(a,1);if(l.length&&v.length){t=l[0];r=l[l.length-1];s=v[0];n=v[v.length-1];k=l.length;for(a=0;a<k;a++)u.push([[l[a],n],[l[a],s]]);k=v.length;for(a=0;a<k;a++)u.push([[t,
v[a]],[r,v[a]]]);a=new m({paths:u,spatialReference:this.origin.spatialReference.toJson()});h.push({latticeID:d+"_"+f+"_"+c+"_"+g,lattice:a,resolution:this._resolution})}return{minRow:d,maxRow:f,minCol:c,maxCol:g,cells:h}}});q("extend-esri")&&l.setObject("layers._GridLayout",p,r);return p})},"dojo/date/stamp":function(){define(["../_base/lang","../_base/array"],function(p,l){var h={};p.setObject("dojo.date.stamp",h);h.fromISOString=function(q,r){h._isoRegExp||(h._isoRegExp=/^(?:(\d{4})(?:-(\d{2})(?:-(\d{2}))?)?)?(?:T(\d{2}):(\d{2})(?::(\d{2})(.\d+)?)?((?:[+-](\d{2}):(\d{2}))|Z)?)?$/);
var f=h._isoRegExp.exec(q),p=null;if(f){f.shift();f[1]&&f[1]--;f[6]&&(f[6]*=1E3);r&&(r=new Date(r),l.forEach(l.map("FullYear Month Date Hours Minutes Seconds Milliseconds".split(" "),function(b){return r["get"+b]()}),function(b,c){f[c]=f[c]||b}));p=new Date(f[0]||1970,f[1]||0,f[2]||1,f[3]||0,f[4]||0,f[5]||0,f[6]||0);100>f[0]&&p.setFullYear(f[0]||1970);var m=0,b=f[7]&&f[7].charAt(0);"Z"!=b&&(m=60*(f[8]||0)+(Number(f[9])||0),"-"!=b&&(m*=-1));b&&(m-=p.getTimezoneOffset());m&&p.setTime(p.getTime()+6E4*
m)}return p};h.toISOString=function(h,l){var f=function(b){return 10>b?"0"+b:b};l=l||{};var p=[],m=l.zulu?"getUTC":"get",b="";"time"!=l.selector&&(b=h[m+"FullYear"](),b=["0000".substr((b+"").length)+b,f(h[m+"Month"]()+1),f(h[m+"Date"]())].join("-"));p.push(b);if("date"!=l.selector){b=[f(h[m+"Hours"]()),f(h[m+"Minutes"]()),f(h[m+"Seconds"]())].join(":");m=h[m+"Milliseconds"]();l.milliseconds&&(b+="."+(100>m?"0":"")+f(m));if(l.zulu)b+="Z";else if("time"!=l.selector)var m=h.getTimezoneOffset(),e=Math.abs(m),
b=b+((0<m?"-":"+")+f(Math.floor(e/60))+":"+f(e%60));p.push(b)}return p.join("T")};return h})},"dijit/_Templated":function(){define("./_WidgetBase ./_TemplatedMixin ./_WidgetsInTemplateMixin dojo/_base/array dojo/_base/declare dojo/_base/lang dojo/_base/kernel".split(" "),function(p,l,h,q,r,f,w){f.extend(p,{waiRole:"",waiState:""});return r("dijit._Templated",[l,h],{widgetsInTemplate:!1,constructor:function(){w.deprecated(this.declaredClass+": dijit._Templated deprecated, use dijit._TemplatedMixin and if necessary dijit._WidgetsInTemplateMixin",
"","2.0")},_processNode:function(f,b){var e=this.inherited(arguments),c=b(f,"waiRole");c&&f.setAttribute("role",c);(c=b(f,"waiState"))&&q.forEach(c.split(/\s*,\s*/),function(b){-1!=b.indexOf("-")&&(b=b.split("-"),f.setAttribute("aria-"+b[0],b[1]))});return e}})})},"esri/dijit/PopupRenderer":function(){define("require dojo/_base/declare dojo/_base/connect dojo/_base/lang dojo/_base/array dojo/_base/kernel dojo/sniff dojo/query dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-style dojox/html/entities dijit/_Widget dijit/_Templated ../kernel ../urlUtils ./_EventedWidget dojo/i18n!../nls/jsapi dojo/NodeList-dom".split(" "),
function(p,l,h,q,r,f,w,m,b,e,c,g,d,y,z,a,k,t,x,v){var A=0;l=l([x,z,a],{declaredClass:"esri.dijit._PopupRenderer",constructor:function(){this._nls=q.mixin({},v.widgets.popup)},templateString:"\x3cdiv class\x3d'esriViewPopup'\x3e\x3cdiv class\x3d'mainSection'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_title'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv dojoAttachPoint\x3d'_description'\x3e\x3c/div\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'attachmentsSection hidden'\x3e\x3cdiv\x3e${_nls.NLS_attach}:\x3c/div\x3e\x3cul dojoAttachPoint\x3d'_attachmentsList'\x3e\x3c/ul\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaSection hidden'\x3e\x3cdiv class\x3d'header' dojoAttachPoint\x3d'_mediaTitle'\x3e\x3c/div\x3e\x3cdiv class\x3d'hzLine'\x3e\x3c/div\x3e\x3cdiv class\x3d'caption' dojoAttachPoint\x3d'_mediaCaption'\x3e\x3c/div\x3e\x3cdiv class\x3d'gallery' dojoAttachPoint\x3d'_gallery'\x3e\x3cdiv class\x3d'mediaHandle prev' dojoAttachPoint\x3d'_prevMedia' dojoAttachEvent\x3d'onclick: _goToPrevMedia'\x3e\x3c/div\x3e\x3cdiv class\x3d'mediaHandle next' dojoAttachPoint\x3d'_nextMedia' dojoAttachEvent\x3d'onclick: _goToNextMedia'\x3e\x3c/div\x3e\x3cul class\x3d'summary'\x3e\x3cli class\x3d'image mediaCount hidden' dojoAttachPoint\x3d'_imageCount'\x3e0\x3c/li\x3e\x3cli class\x3d'image mediaIcon hidden'\x3e\x3c/li\x3e\x3cli class\x3d'chart mediaCount hidden' dojoAttachPoint\x3d'_chartCount'\x3e0\x3c/li\x3e\x3cli class\x3d'chart mediaIcon hidden'\x3e\x3c/li\x3e\x3c/ul\x3e\x3cdiv class\x3d'frame' dojoAttachPoint\x3d'_mediaFrame'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummarySection hidden' dojoAttachPoint\x3d'_editSummarySection'\x3e\x3cdiv class\x3d'break'\x3e\x3c/div\x3e\x3cdiv class\x3d'break hidden' dojoAttachPoint\x3d'_mediaBreak'\x3e\x3c/div\x3e\x3cdiv class\x3d'editSummary' dojoAttachPoint\x3d'_editSummary'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e",
showTitle:!0,startup:function(){this.inherited(arguments);this.template.getComponents(this.graphic).then(q.hitch(this,this._handleComponentsSuccess),q.hitch(this,this._handleComponentsError))},destroy:function(){this._dfd&&this._dfd.cancel();this._destroyFrame();this.template=this.graphic=this._nls=this._mediaInfos=this._mediaPtr=this._dfd=null;this.inherited(arguments)},_goToPrevMedia:function(){0>this._mediaPtr-1||(this._mediaPtr--,this._updateUI(),this._displayMedia())},_goToNextMedia:function(){this._mediaPtr+
1!==this._mediaInfos.length&&(this._mediaPtr++,this._updateUI(),this._displayMedia())},_updateUI:function(){var a=this._mediaInfos,b=a.length,d=this.domNode,g=this._prevMedia,k=this._nextMedia;if(1<b){var h=0,m=0;r.forEach(a,function(a){"image"===a.type?h++:-1!==a.type.indexOf("chart")&&m++});h&&(e.set(this._imageCount,"innerHTML",h),f.query(".summary .image",d).removeClass("hidden"));m&&(e.set(this._chartCount,"innerHTML",m),f.query(".summary .chart",d).removeClass("hidden"))}else f.query(".summary",
d).addClass("hidden"),c.add(g,"hidden"),c.add(k,"hidden");a=this._mediaPtr;0===a?c.add(g,"hidden"):c.remove(g,"hidden");a===b-1?c.add(k,"hidden"):c.remove(k,"hidden");this._destroyFrame()},_displayMedia:function(){var a=this._mediaInfos[this._mediaPtr],b=a.title,d=a.caption,g=f.query(".mediaSection .hzLine",this.domNode)[0];e.set(this._mediaTitle,"innerHTML",b);c[b?"remove":"add"](this._mediaTitle,"hidden");e.set(this._mediaCaption,"innerHTML",d);c[d?"remove":"add"](this._mediaCaption,"hidden");c[b&&
d?"remove":"add"](g,"hidden");this._rid=null;if("image"===a.type)this._showImage(a.value);else{var k=this,b=["dojox/charting/Chart2D","dojox/charting/action2d/Tooltip"],d=a.value.theme||this.chartTheme;q.isString(d)&&(d=d.replace(/\./gi,"/"),-1===d.indexOf("/")&&(d="dojox/charting/themes/"+d));d||(d="./Rainbow");b.push(d);try{var h=this._rid=A++;p(b,function(b,c,d){h===k._rid&&(k._rid=null,k._showChart(a.type,a.value,b,c,d))})}catch(m){console.log("PopupRenderer: error loading modules")}}},_preventNewTab:function(a){return(a=
a&&q.trim(a).toLowerCase())&&(0===a.indexOf("mailto:")||0===a.indexOf("tel:"))},_showImage:function(a){c.add(this._mediaFrame,"image");var b=d.get(this._gallery,"height"),e;a.linkURL&&(e=g.create("a",{href:a.linkURL,target:this._preventNewTab(a.linkURL)?"":"_blank"},this._mediaFrame));g.create("img",{className:"esriPopupMediaImage",src:a.sourceURL},e||this._mediaFrame);var k=f.query(".esriPopupMediaImage",this._mediaFrame)[0],m=this,l;l=h.connect(k,"onload",function(){h.disconnect(l);l=null;m._imageLoaded(k,
b)})},_showChart:function(a,b,d,e,f){c.remove(this._mediaFrame,"image");d=this._chart=new d(g.create("div",{"class":"chart"},this._mediaFrame),{margins:{l:4,t:4,r:4,b:4}});f&&d.setTheme(f);switch(a){case "piechart":d.addPlot("default",{type:"Pie",labels:!1});d.addSeries("Series A",b.fields);break;case "linechart":d.addPlot("default",{type:"Markers"});d.addAxis("x",{min:0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1});d.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});r.forEach(b.fields,
function(a,b){a.x=b+1});d.addSeries("Series A",b.fields);break;case "columnchart":d.addPlot("default",{type:"Columns",gap:3});d.addAxis("y",{includeZero:!0,vertical:!0,fixUpper:"minor"});d.addSeries("Series A",b.fields);break;case "barchart":d.addPlot("default",{type:"Bars",gap:3}),d.addAxis("x",{includeZero:!0,fixUpper:"minor",minorLabels:!1}),d.addAxis("y",{vertical:!0,majorTicks:!1,minorTicks:!1,majorLabels:!1,minorLabels:!1}),d.addSeries("Series A",b.fields)}this._action=new e(d);d.render()},
_destroyFrame:function(){this._rid=null;this._chart&&(this._chart.destroy(),this._chart=null);this._action&&(this._action.destroy(),this._action=null);e.set(this._mediaFrame,"innerHTML","")},_imageLoaded:function(a,b){var c=a.height;c<b&&(c=Math.round((b-c)/2),d.set(a,"marginTop",c+"px"))},_attListHandler:function(a,b){if(a===this._dfd){this._dfd=null;var c="";!(b instanceof Error)&&(b&&b.length)&&r.forEach(b,function(a){c+="\x3cli\x3e";c+="\x3ca href\x3d'"+t.addProxy(a.url)+"' target\x3d'_blank'\x3e"+
(a.name||"[No name]")+"\x3c/a\x3e";c+="\x3c/li\x3e"});e.set(this._attachmentsList,"innerHTML",c||"\x3cli\x3e"+this._nls.NLS_noAttach+"\x3c/li\x3e")}},_handleComponentsSuccess:function(a){if(a){var d=this.showTitle?a.title:"",g=a.description,k=a.fields,h=a.mediaInfos,m=this.domNode,l=this._nls,t=this,x=this.template,v=this.graphic;this._prevMedia.title=l.NLS_prevMedia;this._nextMedia.title=l.NLS_nextMedia;e.set(this._title,"innerHTML",d);d||c.add(this._title,"hidden");!a.hasDescription&&k&&(g="",r.forEach(k,
function(a){g+="\x3ctr valign\x3d'top'\x3e";g+="\x3ctd class\x3d'attrName'\x3e"+y.encode(a[0])+"\x3c/td\x3e";g+="\x3ctd class\x3d'attrValue'\x3e"+a[1].replace(/^\s*(https?:\/\/[^\s]+)\s*$/i,"\x3ca target\x3d'_blank' href\x3d'$1' title\x3d'$1'\x3e"+l.NLS_moreInfo+"\x3c/a\x3e")+"\x3c/td\x3e";g+="\x3c/tr\x3e"}),g&&(g="\x3ctable class\x3d'attrTable' cellpadding\x3d'0px' cellspacing\x3d'0px'\x3e"+g+"\x3c/table\x3e"));e.set(this._description,"innerHTML",g);g||c.add(this._description,"hidden");f.query("a",
this._description).forEach(function(a){t._preventNewTab(a.href)?"_blank"===a.target&&e.remove(a,"target"):e.set(a,"target","_blank")});d&&g?f.query(".mainSection .hzLine",m).removeClass("hidden"):d||g?f.query(".mainSection .hzLine",m).addClass("hidden"):f.query(".mainSection",m).addClass("hidden");if(d=this._dfd=x.getAttachments(v))d.addBoth(q.hitch(this,this._attListHandler,d)),e.set(this._attachmentsList,"innerHTML","\x3cli\x3e"+l.NLS_searching+"...\x3c/li\x3e"),f.query(".attachmentsSection",m).removeClass("hidden");
h&&h.length&&(f.query(".mediaSection",m).removeClass("hidden"),b.setSelectable(this._mediaFrame,!1),this._mediaInfos=h,this._mediaPtr=0,this._updateUI(),this._displayMedia());a.editSummary&&(e.set(this._editSummary,"innerHTML",a.editSummary),h&&h.length&&c.remove(this._mediaBreak,"hidden"),c.remove(this._editSummarySection,"hidden"))}},_handleComponentsError:function(a){console.log("PopupRenderer: error loading template",a)}});w("extend-esri")&&q.setObject("dijit._PopupRenderer",l,k);return l})},
"dijit/_AttachMixin":function(){define("require dojo/_base/array dojo/_base/connect dojo/_base/declare dojo/_base/lang dojo/mouse dojo/on dojo/touch ./_WidgetBase".split(" "),function(p,l,h,q,r,f,w,m,b){var e=r.delegate(m,{mouseenter:f.enter,mouseleave:f.leave,keypress:h._keypress}),c;h=q("dijit._AttachMixin",null,{constructor:function(){this._attachPoints=[];this._attachEvents=[]},buildRendering:function(){this.inherited(arguments);this._attachTemplateNodes(this.domNode);this._beforeFillContent()},
_beforeFillContent:function(){},_attachTemplateNodes:function(b){for(var c=b;;)if(1==c.nodeType&&(this._processTemplateNode(c,function(b,c){return b.getAttribute(c)},this._attach)||this.searchContainerNode)&&c.firstChild)c=c.firstChild;else{if(c==b)break;for(;!c.nextSibling;)if(c=c.parentNode,c==b)return;c=c.nextSibling}},_processTemplateNode:function(b,c,e){var f=!0,a=this.attachScope||this,k=c(b,"dojoAttachPoint")||c(b,"data-dojo-attach-point");if(k)for(var h=k.split(/\s*,\s*/);k=h.shift();)r.isArray(a[k])?
a[k].push(b):a[k]=b,f="containerNode"!=k,this._attachPoints.push(k);if(c=c(b,"dojoAttachEvent")||c(b,"data-dojo-attach-event")){k=c.split(/\s*,\s*/);for(h=r.trim;c=k.shift();)if(c){var m=null;-1!=c.indexOf(":")?(m=c.split(":"),c=h(m[0]),m=h(m[1])):c=h(c);m||(m=c);this._attachEvents.push(e(b,c,r.hitch(a,m)))}}return f},_attach:function(b,d,f){d=d.replace(/^on/,"").toLowerCase();d="dijitclick"==d?c||(c=p("./a11yclick")):e[d]||d;return w(b,d,f)},_detachTemplateNodes:function(){var b=this.attachScope||
this;l.forEach(this._attachPoints,function(c){delete b[c]});this._attachPoints=[];l.forEach(this._attachEvents,function(b){b.remove()});this._attachEvents=[]},destroyRendering:function(){this._detachTemplateNodes();this.inherited(arguments)}});r.extend(b,{dojoAttachEvent:"",dojoAttachPoint:""});return h})},"esri/layers/SnapshotMode":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../SpatialReference ../tasks/query ./RenderMode".split(" "),function(p,l,h,q,r,f,w){p=p([w],{declaredClass:"esri.layers._SnapshotMode",
constructor:function(f){this.featureLayer=f;this.pagination=f.queryPagination;this._featureMap={};this._drawFeatures=l.hitch(this,this._drawFeatures);this._queryErrorHandler=l.hitch(this,this._queryErrorHandler)},startup:function(){this.pagination=this.pagination&&null!=this.featureLayer.maxRecordCount;this.featureLayer._collection?this._applyTimeFilter():this._fetchAll()},propertyChangeHandler:function(f){this._init&&(f?this.featureLayer._collection?console.log("FeatureLayer: layer created by value (from a feature collection) does not support definition expressions and time definitions. Layer id \x3d "+
this.featureLayer.id):this._fetchAll():this._applyTimeFilter())},drawFeature:function(f){var b=f.attributes[this.featureLayer.objectIdField];this._addFeatureIIf(b,f);this._incRefCount(b)},resume:function(){this.propertyChangeHandler(0)},refresh:function(){var f=this.featureLayer;f._collection?(f._fireUpdateStart(),f._refresh(!0),f._fireUpdateEnd()):this._fetchAll()},_getRequestId:function(f){return("_"+f.name+f.layerId+f._ulid).replace(/[^a-zA-Z0-9\_]+/g,"_")},_fetchAll:function(){var f=this.featureLayer;
!f._collection&&!f.suspended&&(f._fireUpdateStart(),this._clearIIf(),this._sendRequest())},_sendRequest:function(h){var b=this.map,e=this.featureLayer,c=e.getDefinitionExpression(),g=new f;g.outFields=e.getOutFields();g.where=c||"1\x3d1";g.returnGeometry=!0;g.outSpatialReference=new r(b.spatialReference.toJson());g.timeExtent=e.getTimeDefinition();g.maxAllowableOffset=e._maxOffset;g.quantizationParameters=e._quantizationParameters;e._ts&&(g._ts=(new Date).getTime());g.orderByFields=e.supportsAdvancedQueries?
e.getOrderByFields():null;g.multipatchOption=e.multipatchOption;this.pagination&&(this._start=g.start=null==h?0:h,g.num=e.maxRecordCount);var d;e._usePatch&&(d=this._getRequestId(e),this._cancelPendingRequest(null,d));e._task.execute(g,this._drawFeatures,this._queryErrorHandler,d)},_drawFeatures:function(f){this._purgeRequests();var b=f.features,e=this.featureLayer,c=e.objectIdField,g,d=b.length,h=f.exceededTransferLimit&&!e._collection,l=e._selectedFeatures,a=e.mode===e.constructor.MODE_AUTO,k,t,
x;for(g=0;g<d;g++)t=b[g],x=t.attributes[c],k=this._addFeatureIIf(x,t),this._incRefCount(x),a&&(k!==t&&l[x])&&(k.setGeometry(t.geometry),k.setAttributes(t.attributes));this._applyTimeFilter(!0);if(!this.pagination||!h)e._fireUpdateEnd(null,f.exceededTransferLimit?{queryLimitExceeded:!0}:null);h&&(this.pagination&&this._sendRequest(this._start+e.maxRecordCount),e.onQueryLimitExceeded())},_queryErrorHandler:function(f){this._purgeRequests();var b=this.featureLayer;b._errorHandler(f);b._fireUpdateEnd(f)}});
h("extend-esri")&&l.setObject("layers._SnapshotMode",p,q);return p})},"esri/layers/SelectionMode":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","./RenderMode"],function(p,l,h,q,r){p=p([r],{declaredClass:"esri.layers._SelectionMode",constructor:function(f){this.featureLayer=f;this._featureMap={}},propertyChangeHandler:function(f){this._init&&0===f&&this._applyTimeFilter()},resume:function(){this.propertyChangeHandler(0)}});h("extend-esri")&&l.setObject("layers._SelectionMode",
p,q);return p})},"esri/tasks/Task":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/json dojo/has ../kernel ../deferredUtils ../urlUtils ../Evented".split(" "),function(p,l,h,q,r,f,w,m){p=p(m,{declaredClass:"esri.tasks._Task",_eventMap:{error:["error"],complete:["result"]},constructor:function(b,e){b&&l.isString(b)&&(this._url=w.urlToObject(this.url=b));e&&e.requestOptions&&(this.requestOptions=e.requestOptions);this.normalization=!0;this._errorHandler=l.hitch(this,this._errorHandler);
this.registerConnectEvents()},_useSSL:function(){var b=this._url,e=/^http:/i;this.url&&(this.url=this.url.replace(e,"https:"));b&&b.path&&(b.path=b.path.replace(e,"https:"))},_encode:function(b,e,c){var g,d,f={},m,a;for(m in b)if("declaredClass"!==m&&(g=b[m],d=typeof g,null!==g&&void 0!==g&&"function"!==d))if(l.isArray(g)){f[m]=[];a=g.length;for(d=0;d<a;d++)f[m][d]=this._encode(g[d])}else"object"===d?g.toJson&&(d=g.toJson(c&&c[m]),"esri.tasks.FeatureSet"===g.declaredClass&&d.spatialReference&&(d.sr=
d.spatialReference,delete d.spatialReference),f[m]=e?d:h.toJson(d)):f[m]=g;return f},_successHandler:function(b,e,c,g){e&&this[e].apply(this,b);c&&c.apply(null,b);g&&f._resDfd(g,b)},_errorHandler:function(b,e,c){this.onError(b);e&&e(b);c&&c.errback(b)},setNormalization:function(b){this.normalization=b},onError:function(){}});q("extend-esri")&&(r.Task=p);return p})},"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(p,l,h){p.DeferredList=function(p,
r,f,w,m){var b=[];l.call(this);var e=this;0===p.length&&!r&&this.resolve([0,[]]);var c=0;h.forEach(p,function(g,d){function h(g,a){b[d]=[g,a];c++;c===p.length&&e.resolve(b)}g.then(function(b){r?e.resolve([d,b]):h(!0,b)},function(b){f?e.reject(b):h(!1,b);if(w)return null;throw b;})})};p.DeferredList.prototype=new l;p.DeferredList.prototype.gatherResults=function(l){l=new p.DeferredList(l,!1,!0,!1);l.addCallback(function(l){var f=[];h.forEach(l,function(h){f.push(h[1])});return f});return l};return p.DeferredList})},
"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(p,l,h,q,r,f){p=q("dijit._OnDijitClickMixin",null,{connect:function(h,m,b){return this.inherited(arguments,[h,"ondijitclick"==m?f:m,b])}});p.a11yclick=f;return p})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(p,l,h,q){function r(f){if((f.keyCode===p.ENTER||f.keyCode===p.SPACE)&&!/input|button|textarea/i.test(f.target.nodeName))for(f=
f.target;f;f=f.parentNode)if(f.dojoClick)return!0}var f;h(document,"keydown",function(h){r(h)?(f=h.target,h.preventDefault()):f=null});h(document,"keyup",function(m){r(m)&&m.target==f&&(f=null,h.emit(m.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:m.ctrlKey,shiftKey:m.shiftKey,metaKey:m.metaKey,altKey:m.altKey,_origType:m.type}))});var w=function(f,b){f.dojoClick=!0;return h(f,"click",b)};w.click=w;w.press=function(f,b){var e=h(f,q.press,function(c){("mousedown"!=c.type||l.isLeft(c))&&b(c)}),c=
h(f,"keydown",function(c){(c.keyCode===p.ENTER||c.keyCode===p.SPACE)&&b(c)});return{remove:function(){e.remove();c.remove()}}};w.release=function(f,b){var e=h(f,q.release,function(c){("mouseup"!=c.type||l.isLeft(c))&&b(c)}),c=h(f,"keyup",function(c){(c.keyCode===p.ENTER||c.keyCode===p.SPACE)&&b(c)});return{remove:function(){e.remove();c.remove()}}};w.move=q.move;return w})},"dijit/hccss":function(){define(["dojo/dom-class","dojo/hccss","dojo/domReady","dojo/_base/window"],function(p,l,h,q){h(function(){l("highcontrast")&&
p.add(q.body(),"dijit_a11y")});return l})},"dijit/_TemplatedMixin":function(){define("dojo/cache dojo/_base/declare dojo/dom-construct dojo/_base/lang dojo/on dojo/sniff dojo/string ./_AttachMixin".split(" "),function(p,l,h,q,r,f,w,m){var b=l("dijit._TemplatedMixin",m,{templateString:null,templatePath:null,_skipNodeCache:!1,searchContainerNode:!0,_stringRepl:function(b){var c=this.declaredClass,f=this;return w.substitute(b,this,function(b,e){"!"==e.charAt(0)&&(b=q.getObject(e.substr(1),!1,f));if("undefined"==
typeof b)throw Error(c+" template:"+e);return null==b?"":"!"==e.charAt(0)?b:this._escapeValue(""+b)},this)},_escapeValue:function(b){return b.replace(/["'<>&]/g,function(b){return{"\x26":"\x26amp;","\x3c":"\x26lt;","\x3e":"\x26gt;",'"':"\x26quot;","'":"\x26#x27;"}[b]})},buildRendering:function(){if(!this._rendered){this.templateString||(this.templateString=p(this.templatePath,{sanitize:!0}));var e=b.getCachedTemplate(this.templateString,this._skipNodeCache,this.ownerDocument),c;if(q.isString(e)){if(c=
h.toDom(this._stringRepl(e),this.ownerDocument),1!=c.nodeType)throw Error("Invalid template: "+e);}else c=e.cloneNode(!0);this.domNode=c}this.inherited(arguments);this._rendered||this._fillContent(this.srcNodeRef);this._rendered=!0},_fillContent:function(b){var c=this.containerNode;if(b&&c)for(;b.hasChildNodes();)c.appendChild(b.firstChild)}});b._templateCache={};b.getCachedTemplate=function(e,c,f){var d=b._templateCache,l=e,m=d[l];if(m){try{if(!m.ownerDocument||m.ownerDocument==(f||document))return m}catch(a){}h.destroy(m)}e=
w.trim(e);if(c||e.match(/\$\{([^\}]+)\}/g))return d[l]=e;c=h.toDom(e,f);if(1!=c.nodeType)throw Error("Invalid template: "+e);return d[l]=c};f("ie")&&r(window,"unload",function(){var e=b._templateCache,c;for(c in e){var f=e[c];"object"==typeof f&&h.destroy(f);delete e[c]}});return b})},"esri/tasks/GeometryService":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/json dojo/_base/Deferred dojo/has ../kernel ../request ../deferredUtils ./Task ../geometry/Extent ../geometry/Polyline ../geometry/Polygon ../geometry/Multipoint ../geometry/jsonUtils".split(" "),
function(p,l,h,q,r,f,w,m,b,e,c,g,d,y,z){p=p(e,{declaredClass:"esri.tasks.GeometryService",_eventMap:{"areas-and-lengths-complete":["result"],"auto-complete-complete":["geometries"],"buffer-complete":["geometries"],"convex-hull-complete":["geometry"],"cut-complete":["result"],"densify-complete":["geometries"],"difference-complete":["geometries"],"distance-complete":["distance"],"generalize-complete":["geometries"],"intersect-complete":["geometries"],"label-points-complete":["geometries"],"lengths-complete":["result"],
"offset-complete":["geometries"],"project-complete":["geometries"],"relation-complete":["relations"],"reshape-complete":["geometry"],"simplify-complete":["geometries"],"trim-extend-complete":["geometries"],"union-complete":["geometry"]},constructor:function(a){a=l.hitch;this._projectHandler=a(this,this._projectHandler);this._simplifyHandler=a(this,this._simplifyHandler);this._bufferHandler=a(this,this._bufferHandler);this._areasAndLengthsHandler=a(this,this._areasAndLengthsHandler);this._lengthsHandler=
a(this,this._lengthsHandler);this._labelPointsHandler=a(this,this._labelPointsHandler);this._relationHandler=a(this,this._relationHandler);this._convexHullHandler=a(this,this._convexHullHandler);this._unionHandler=a(this,this._unionHandler);this._autoCompleteHandler=a(this,this._autoCompleteHandler);this._reshapeHandler=a(this,this._reshapeHandler);this._cutHandler=a(this,this._cutHandler);this._intersectHandler=a(this,this._intersectHandler);this._differenceHandler=a(this,this._differenceHandler);
this._trimExtendHandler=a(this,this._trimExtendHandler);this._densifyHandler=a(this,this._densifyHandler);this._generalizeHandler=a(this,this._densifyHandler);this._offsetHandler=a(this,this._offsetHandler);this._distanceHandler=a(this,this._distanceHandler);this._toGeoCoordinateHandler=a(this,this._toGeoCoordinateHandler);this._fromGeoCoordinateHandler=a(this,this._fromGeoCoordinateHandler);this.registerConnectEvents()},_encodeGeometries:function(a){var b=[],c,d=a.length;for(c=0;c<d;c++)b.push(a[c].toJson());
return{geometryType:z.getJsonType(a[0]),geometries:b}},_decodeGeometries:function(a,b,c){var d=z.getGeometryType(b);a=a.geometries;var e=[],f={spatialReference:c.toJson()},g=l.mixin;h.forEach(a,function(a,b){e[b]=new d(g(a,f))});return e},_toProjectGeometry:function(a){var b=a.spatialReference.toJson();return a instanceof c?new d({rings:[[[a.xmin,a.ymin],[a.xmin,a.ymax],[a.xmax,a.ymax],[a.xmax,a.ymin],[a.xmin,a.ymin]]],spatialReference:b}):new g({paths:[[].concat(a.points)],spatialReference:b})},
_fromProjectedGeometry:function(a,b,d){return"esriGeometryEnvelope"===b?(a=a.rings[0],new c(a[0][0],a[0][1],a[2][0],a[2][1],d)):new y({points:a.paths[0],spatialReference:d.toJson()})},project:function(a,c,d,e){var f=l.mixin({},this._url.query,{f:"json"}),g;a.geometries?(e=d,d=c,c=a.outSR,g=a.geometries[0],f=l.mixin(f,a.toJson())):(g=a[0],f=l.mixin(f,{outSR:c.wkid||q.toJson(c.toJson()),inSR:g.spatialReference.wkid||q.toJson(g.spatialReference.toJson()),geometries:q.toJson(this._encodeGeometries(a))}));
var h=z.getJsonType(g),n=this._projectHandler,u=this._errorHandler,p=new r(b._dfdCanceller);p._pendingDfd=m({url:this._url.path+"/project",content:f,callbackParamName:"callback",load:function(a,b){n(a,b,h,c,d,e,p)},error:function(a){u(a,e,p)}});return p},_projectHandler:function(a,b,c,d,e,f,g){try{var n=this._decodeGeometries(a,c,d);this._successHandler([n],"onProjectComplete",e,g)}catch(h){this._errorHandler(h,f,g)}},onProjectComplete:function(){},simplify:function(a,c,d){var e=a[0].spatialReference,
f=l.mixin({},this._url.query,{f:"json",sr:e.wkid?e.wkid:q.toJson(e.toJson()),geometries:q.toJson(this._encodeGeometries(a))}),g=z.getJsonType(a[0]),h=this._simplifyHandler,n=this._errorHandler,u=new r(b._dfdCanceller);u._pendingDfd=m({url:this._url.path+"/simplify",content:f,callbackParamName:"callback",load:function(a,b){h(a,b,g,e,c,d,u)},error:function(a){n(a,d,u)}});return u},_simplifyHandler:function(a,b,c,d,e,f,g){try{var n=this._decodeGeometries(a,c,d);this._successHandler([n],"onSimplifyComplete",
e,g)}catch(h){this._errorHandler(h,f,g)}},onSimplifyComplete:function(){},convexHull:function(a,c,d){var e=a[0].spatialReference;a=l.mixin({},this._url.query,{f:"json",sr:q.toJson(e.toJson()),geometries:q.toJson(this._encodeGeometries(a))});var f=this._convexHullHandler,g=this._errorHandler,h=new r(b._dfdCanceller);h._pendingDfd=m({url:this._url.path+"/convexHull",content:a,callbackParamName:"callback",load:function(a,b){f(a,b,e,c,d,h)},error:function(a){g(a,d,h)}});return h},_convexHullHandler:function(a,
b,c,d,e,f){try{var g=z.fromJson(a.geometry).setSpatialReference(c);this._successHandler([g],"onConvexHullComplete",d,f)}catch(n){this._errorHandler(n,e,f)}},onConvexHullComplete:function(){},union:function(a,c,d){var e=a[0].spatialReference;a=l.mixin({},this._url.query,{f:"json",sr:q.toJson(e.toJson()),geometries:q.toJson(this._encodeGeometries(a))});var f=this._unionHandler,g=this._errorHandler,h=new r(b._dfdCanceller);h._pendingDfd=m({url:this._url.path+"/union",content:a,callbackParamName:"callback",
load:function(a,b){f(a,b,e,c,d,h)},error:function(a){g(a,d,h)}});return h},_unionHandler:function(a,b,c,d,e,f){try{var g=z.fromJson(a.geometry).setSpatialReference(c);this._successHandler([g],"onUnionComplete",d,f)}catch(n){this._errorHandler(n,e,f)}},onUnionComplete:function(){},autoComplete:function(a,c,d,e){var f=a[0].spatialReference;a=l.mixin({},this._url.query,{f:"json",sr:q.toJson(f.toJson()),polygons:q.toJson(this._encodeGeometries(a).geometries),polylines:q.toJson(this._encodeGeometries(c).geometries)});
var g=this._autoCompleteHandler,h=this._errorHandler,n=new r(b._dfdCanceller);n._pendingDfd=m({url:this._url.path+"/autoComplete",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,f,d,e,n)},error:function(a){h(a,e,n)}});return n},_autoCompleteHandler:function(a,b,c,e,f,g){try{var h=a.geometries;a=[];var n,u=h.length;for(n=0;n<u;n++)a[n]=new d({spatialReference:c,rings:h[n].rings});this._successHandler([a],"onAutoCompleteComplete",e,g)}catch(l){this._errorHandler(l,f,g)}},onAutoCompleteComplete:function(){},
reshape:function(a,c,d,e){var f=a.spatialReference;a=l.mixin({},this._url.query,{f:"json",sr:q.toJson(f.toJson()),target:q.toJson({geometryType:z.getJsonType(a),geometry:a.toJson()}),reshaper:q.toJson(c.toJson())});var g=this._reshapeHandler,h=this._errorHandler,n=new r(b._dfdCanceller);n._pendingDfd=m({url:this._url.path+"/reshape",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,f,d,e,n)},error:function(a){h(a,e,n)}});return n},_reshapeHandler:function(a,b,c,d,e,f){try{var g=z.fromJson(a.geometry).setSpatialReference(c);
this._successHandler([g],"onReshapeComplete",d,f)}catch(n){this._errorHandler(n,e,f)}},onReshapeComplete:function(){},cut:function(a,c,d,e){var f=a[0].spatialReference,g=h.map(a,function(a){return a.toJson()});a=l.mixin({},this._url.query,{f:"json",sr:q.toJson(f.toJson()),target:q.toJson({geometryType:z.getJsonType(a[0]),geometries:g}),cutter:q.toJson(c.toJson())});var s=this._cutHandler,n=this._errorHandler,u=new r(b._dfdCanceller);u._pendingDfd=m({url:this._url.path+"/cut",content:a,callbackParamName:"callback",
load:function(a,b){s(a,b,f,d,e,u)},error:function(a){n(a,e,u)}});return u},_cutHandler:function(a,b,c,d,e,f){try{var g=a.geometries,n={};n.cutIndexes=a.cutIndexes;n.geometries=[];h.forEach(g,function(a){n.geometries.push(z.fromJson(a).setSpatialReference(c))});this._successHandler([n],"onCutComplete",d,f)}catch(l){this._errorHandler(l,e,f)}},onCutComplete:function(){},intersect:function(a,c,d,e){var f=a[0].spatialReference;a=l.mixin({},this._url.query,{f:"json",sr:q.toJson(f.toJson()),geometries:q.toJson(this._encodeGeometries(a)),
geometry:q.toJson({geometryType:z.getJsonType(c),geometry:c.toJson()})});var g=this._intersectHandler,h=this._errorHandler,n=new r(b._dfdCanceller);n._pendingDfd=m({url:this._url.path+"/intersect",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,f,d,e,n)},error:function(a){h(a,e,n)}});return n},_intersectHandler:function(a,b,c,d,e,f){try{var g=[];h.forEach(a.geometries,function(a){g.push(z.fromJson(a).setSpatialReference(c))});this._successHandler([g],"onIntersectComplete",d,f)}catch(n){this._errorHandler(n,
e,f)}},onIntersectComplete:function(){},difference:function(a,c,d,e){var f=a[0].spatialReference;a=l.mixin({},this._url.query,{f:"json",sr:q.toJson(f.toJson()),geometries:q.toJson(this._encodeGeometries(a)),geometry:q.toJson({geometryType:z.getJsonType(c),geometry:c.toJson()})});var g=this._differenceHandler,h=this._errorHandler,n=new r(b._dfdCanceller);n._pendingDfd=m({url:this._url.path+"/difference",content:a,callbackParamName:"callback",load:function(a,b){g(a,b,f,d,e,n)},error:function(a){h(a,
e,n)}});return n},_differenceHandler:function(a,b,c,d,e,f){try{var g=[];h.forEach(a.geometries,function(a){g.push(z.fromJson(a).setSpatialReference(c))});this._successHandler([g],"onDifferenceComplete",d,f)}catch(n){this._errorHandler(n,e,f)}},onDifferenceComplete:function(){},buffer:function(a,c,d){var e=l.mixin({},this._url.query,{f:"json"},a.toJson()),f=a.outSpatialReference||a.geometries[0].spatialReference,g=this._bufferHandler,h=this._errorHandler,n=new r(b._dfdCanceller);n._pendingDfd=m({url:this._url.path+
"/buffer",content:e,callbackParamName:"callback",load:function(a,b){g(a,b,f,c,d,n)},error:function(a){h(a,d,n)}});return n},_bufferHandler:function(a,b,c,e,f,g){try{var h=a.geometries;a=[];var n,l=h.length;for(n=0;n<l;n++)a[n]=new d({spatialReference:c,rings:h[n].rings});this._successHandler([a],"onBufferComplete",e,g)}catch(m){this._errorHandler(m,f,g)}},onBufferComplete:function(){},areasAndLengths:function(a,c,d){a=l.mixin({},this._url.query,{f:"json"},a.toJson());var e=this._areasAndLengthsHandler,
f=this._errorHandler,g=new r(b._dfdCanceller);g._pendingDfd=m({url:this._url.path+"/areasAndLengths",content:a,callbackParamName:"callback",load:function(a,b){e(a,b,c,d,g)},error:function(a){f(a,d,g)}});return g},_areasAndLengthsHandler:function(a,b,c,d,e){try{this._successHandler([a],"onAreasAndLengthsComplete",c,e)}catch(f){this._errorHandler(f,d,e)}},onAreasAndLengthsComplete:function(){},lengths:function(a,c,d){a=l.mixin({},this._url.query,{f:"json"},a.toJson());var e=this._lengthsHandler,f=this._errorHandler,
g=new r(b._dfdCanceller);g._pendingDfd=m({url:this._url.path+"/lengths",content:a,callbackParamName:"callback",load:function(a,b){e(a,b,c,d,g)},error:function(a){f(a,d,g)}});return g},_lengthsHandler:function(a,b,c,d,e){try{this._successHandler([a],"onLengthsComplete",c,e)}catch(f){this._errorHandler(f,d,e)}},onLengthsComplete:function(){},labelPoints:function(a,c,d){var e=h.map(a,function(a){return a.toJson()}),f=a[0].spatialReference,e=l.mixin({},this._url.query,{f:"json",sr:f.wkid?f.wkid:q.toJson(f.toJson()),
polygons:q.toJson(e)}),g=this._labelPointsHandler,s=this._errorHandler,n=new r(b._dfdCanceller);n._pendingDfd=m({url:this._url.path+"/labelPoints",content:e,callbackParamName:"callback",load:function(b,e){g(b,e,a,f,c,d,n)},error:function(a){s(a,d,n)}});return n},_labelPointsHandler:function(a,b,c,d,e,f,g){try{var n=[];h.forEach(a.labelPoints,function(a){n.push(z.fromJson(a).setSpatialReference(d))});this._successHandler([n],"onLabelPointsComplete",e,g)}catch(l){this._errorHandler(l,f,g)}},onLabelPointsComplete:function(){},
relation:function(a,c,d){a=l.mixin({},this._url.query,{f:"json"},a.toJson());var e=this._relationHandler,f=this._errorHandler,g=new r(b._dfdCanceller);g._pendingDfd=m({url:this._url.path+"/relation",content:a,callbackParamName:"callback",load:function(a,b){e(a,b,c,d,g)},error:function(a){f(a,d,g)}});return g},_relationHandler:function(a,b,c,d,e){try{this._successHandler([a.relations],"onRelationComplete",c,e)}catch(f){this._errorHandler(f,d,e)}},onRelationComplete:function(){},trimExtend:function(a,
c,d){var e=l.mixin({},this._url.query,{f:"json"},a.toJson()),f=a.sr,g=this._trimExtendHandler,h=this._errorHandler,n=new r(b._dfdCanceller);n._pendingDfd=m({url:this._url.path+"/trimExtend",content:e,callbackParamName:"callback",load:function(a,b){g(a,b,f,c,d,n)},error:function(a){h(a,d,n)}});return n},_trimExtendHandler:function(a,b,c,d,e,f){try{var h=a.geometries;a=[];var n,l=h.length;for(n=0;n<l;n++)a[n]=new g({spatialReference:c,paths:h[n].paths});this._successHandler([a],"onTrimExtendComplete",
d,f)}catch(m){this._errorHandler(m,e,f)}},onTrimExtendComplete:function(){},densify:function(a,c,d){var e=l.mixin({},this._url.query,{f:"json"},a.toJson()),f=a.geometries[0].spatialReference,g=this._densifyHandler,h=this._errorHandler,n=new r(b._dfdCanceller);n._pendingDfd=m({url:this._url.path+"/densify",content:e,callbackParamName:"callback",load:function(a,b){g(a,b,f,c,d,n)},error:function(a){h(a,d,n)}});return n},_densifyHandler:function(a,b,c,d,e,f){try{var g=[];h.forEach(a.geometries,function(a){g.push(z.fromJson(a).setSpatialReference(c))});
this._successHandler([g],"onDensifyComplete",d,f)}catch(n){this._errorHandler(n,e,f)}},onDensifyComplete:function(){},generalize:function(a,c,d){var e=l.mixin({},this._url.query,{f:"json"},a.toJson()),f=a.geometries[0].spatialReference,g=this._generalizeHandler,h=this._errorHandler,n=new r(b._dfdCanceller);n._pendingDfd=m({url:this._url.path+"/generalize",content:e,callbackParamName:"callback",load:function(a,b){g(a,b,f,c,d,n)},error:function(a){h(a,d,n)}});return n},_generalizeHandler:function(a,
b,c,d,e,f){try{var g=[];h.forEach(a.geometries,function(a){g.push(z.fromJson(a).setSpatialReference(c))});this._successHandler([g],"onGeneralizeComplete",d,f)}catch(n){this._errorHandler(n,e,f)}},onGeneralizeComplete:function(){},offset:function(a,c,d){var e=l.mixin({},this._url.query,{f:"json"},a.toJson()),f=a.geometries[0].spatialReference,g=this._offsetHandler,h=this._errorHandler,n=new r(b._dfdCanceller);n._pendingDfd=m({url:this._url.path+"/offset",content:e,callbackParamName:"callback",load:function(a,
b){g(a,b,f,c,d,n)},error:function(a){h(a,d,n)}});return n},_offsetHandler:function(a,b,c,d,e,f){try{var g=[];h.forEach(a.geometries,function(a){g.push(z.fromJson(a).setSpatialReference(c))});this._successHandler([g],"onOffsetComplete",d,f)}catch(n){this._errorHandler(n,e,f)}},onOffsetComplete:function(){},distance:function(a,c,d){var e=l.mixin({},this._url.query,{f:"json"},a.toJson()),f=a.geometry1.spatialReference,g=this._distanceHandler,h=this._errorHandler,n=new r(b._dfdCanceller);n._pendingDfd=
m({url:this._url.path+"/distance",content:e,callbackParamName:"callback",load:function(a,b){g(a,b,f,c,d,n)},error:function(a){h(a,d,n)}});return n},_distanceHandler:function(a,b,c,d,e,f){try{a=a&&a.distance,this._successHandler([a],"onDistanceComplete",d,f)}catch(g){this._errorHandler(g,e,f)}},onDistanceComplete:function(){},toGeoCoordinateString:function(a,c,d){var e={};l.isObject(a.sr)?e.sr=a.sr.wkid||q.toJson(a.sr.toJson()):e.sr=a.sr;e.coordinates=q.toJson(a.coordinates);e.conversionType=a.conversionType||
"MGRS";e.conversionMode=a.conversionMode;e.numOfDigits=a.numOfDigits;e.rounding=a.rounding;e.addSpaces=a.addSpaces;a=l.mixin({},this._url.query,{f:"json"},e);var f=this._toGeoCoordinateHandler,g=this._errorHandler,h=new r(b._dfdCanceller);h._pendingDfd=m({url:this._url.path+"/toGeoCoordinateString",content:a,callbackParamName:"callback",load:function(a,b){f(a,b,c,d,h)},error:function(a){g(a,d,h)}});return h},_toGeoCoordinateHandler:function(a,b,c,d,e){try{this._successHandler([a.strings],"onToGeoCoordinateStringComplete",
c,e)}catch(f){this._errorHandler(f,d,e)}},onToGeoCoordinateStringComplete:function(){},fromGeoCoordinateString:function(a,c,d){var e={};l.isObject(a.sr)?e.sr=a.sr.wkid||q.toJson(a.sr.toJson()):e.sr=a.sr;e.strings=q.toJson(a.strings);e.conversionType=a.conversionType||"MGRS";e.conversionMode=a.conversionMode;a=l.mixin({},this._url.query,{f:"json"},e);var f=this._fromGeoCoordinateHandler,g=this._errorHandler,h=new r(b._dfdCanceller);h._pendingDfd=m({url:this._url.path+"/fromGeoCoordinateString",content:a,
callbackParamName:"callback",load:function(a,b){f(a,b,c,d,h)},error:function(a){g(a,d,h)}});return h},_fromGeoCoordinateHandler:function(a,b,c,d,e){try{this._successHandler([a.coordinates],"onToGeoCoordinateStringComplete",c,e)}catch(f){this._errorHandler(f,d,e)}},onFromGeoCoordinateStringComplete:function(){}});l.mixin(p,{UNIT_METER:9001,UNIT_GERMAN_METER:9031,UNIT_FOOT:9002,UNIT_SURVEY_FOOT:9003,UNIT_CLARKE_FOOT:9005,UNIT_FATHOM:9014,UNIT_NAUTICAL_MILE:9030,UNIT_SURVEY_CHAIN:9033,UNIT_SURVEY_LINK:9034,
UNIT_SURVEY_MILE:9035,UNIT_KILOMETER:9036,UNIT_CLARKE_YARD:9037,UNIT_CLARKE_CHAIN:9038,UNIT_CLARKE_LINK:9039,UNIT_SEARS_YARD:9040,UNIT_SEARS_FOOT:9041,UNIT_SEARS_CHAIN:9042,UNIT_SEARS_LINK:9043,UNIT_BENOIT_1895A_YARD:9050,UNIT_BENOIT_1895A_FOOT:9051,UNIT_BENOIT_1895A_CHAIN:9052,UNIT_BENOIT_1895A_LINK:9053,UNIT_BENOIT_1895B_YARD:9060,UNIT_BENOIT_1895B_FOOT:9061,UNIT_BENOIT_1895B_CHAIN:9062,UNIT_BENOIT_1895B_LINK:9063,UNIT_INDIAN_FOOT:9080,UNIT_INDIAN_1937_FOOT:9081,UNIT_INDIAN_1962_FOOT:9082,UNIT_INDIAN_1975_FOOT:9083,
UNIT_INDIAN_YARD:9084,UNIT_INDIAN_1937_YARD:9085,UNIT_INDIAN_1962_YARD:9086,UNIT_INDIAN_1975_YARD:9087,UNIT_FOOT_1865:9070,UNIT_RADIAN:9101,UNIT_DEGREE:9102,UNIT_ARCMINUTE:9103,UNIT_ARCSECOND:9104,UNIT_GRAD:9105,UNIT_GON:9106,UNIT_MICRORADIAN:9109,UNIT_ARCMINUTE_CENTESIMAL:9112,UNIT_ARCSECOND_CENTESIMAL:9113,UNIT_MIL6400:9114,UNIT_BRITISH_1936_FOOT:9095,UNIT_GOLDCOAST_FOOT:9094,UNIT_INTERNATIONAL_CHAIN:109003,UNIT_INTERNATIONAL_LINK:109004,UNIT_INTERNATIONAL_YARD:109001,UNIT_STATUTE_MILE:9093,UNIT_SURVEY_YARD:109002,
UNIT_50KILOMETER_LENGTH:109030,UNIT_150KILOMETER_LENGTH:109031,UNIT_DECIMETER:109005,UNIT_CENTIMETER:109006,UNIT_MILLIMETER:109007,UNIT_INTERNATIONAL_INCH:109008,UNIT_US_SURVEY_INCH:109009,UNIT_INTERNATIONAL_ROD:109010,UNIT_US_SURVEY_ROD:109011,UNIT_US_NAUTICAL_MILE:109012,UNIT_UK_NAUTICAL_MILE:109013,UNIT_SQUARE_INCHES:"esriSquareInches",UNIT_SQUARE_FEET:"esriSquareFeet",UNIT_SQUARE_YARDS:"esriSquareYards",UNIT_ACRES:"esriAcres",UNIT_SQUARE_MILES:"esriSquareMiles",UNIT_SQUARE_MILLIMETERS:"esriSquareMillimeters",
UNIT_SQUARE_CENTIMETERS:"esriSquareCentimeters",UNIT_SQUARE_DECIMETERS:"esriSquareDecimeters",UNIT_SQUARE_METERS:"esriSquareMeters",UNIT_ARES:"esriAres",UNIT_HECTARES:"esriHectares",UNIT_SQUARE_KILOMETERS:"esriSquareKilometers"});f("extend-esri")&&l.setObject("tasks.GeometryService",p,w);return p})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(p){var l=p.getObject("dojox.html.entities",!0),h=function(h,f){var l,m;if(f._encCache&&f._encCache.regexp&&f._encCache.mapper&&f.length==
f._encCache.length)l=f._encCache.mapper,m=f._encCache.regexp;else{l={};m=["["];var b;for(b=0;b<f.length;b++)l[f[b][0]]="\x26"+f[b][1]+";",m.push(f[b][0]);m.push("]");m=RegExp(m.join(""),"g");f._encCache={mapper:l,regexp:m,length:f.length}}return h=h.replace(m,function(b){return l[b]})},q=function(h,f){var l,m;if(f._decCache&&f._decCache.regexp&&f._decCache.mapper&&f.length==f._decCache.length)l=f._decCache.mapper,m=f._decCache.regexp;else{l={};m=["("];var b;for(b=0;b<f.length;b++){var e="\x26"+f[b][1]+
";";b&&m.push("|");l[e]=f[b][0];m.push(e)}m.push(")");m=RegExp(m.join(""),"g");f._decCache={mapper:l,regexp:m,length:f.length}}return h=h.replace(m,function(b){return l[b]})};l.html=[["\x26","amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];l.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],
["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7","middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],
["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],
["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],
["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396","Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8",
"Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba","kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],
["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],
["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e","infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284",
"nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329","lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009",
"thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d","rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];l.encode=function(p,f){p&&(f?p=h(p,f):(p=h(p,l.html),p=h(p,l.latin)));return p};l.decode=function(h,f){h&&(f?h=q(h,f):(h=q(h,l.html),h=q(h,l.latin)));return h};return l})},
"dojo/parser":function(){define("require ./_base/kernel ./_base/lang ./_base/array ./_base/config ./dom ./_base/window ./_base/url ./aspect ./promise/all ./date/stamp ./Deferred ./has ./query ./on ./ready".split(" "),function(p,l,h,q,r,f,w,m,b,e,c,g,d,y,z,a){function k(a){return eval("("+a+")")}function t(a){var b=a._nameCaseMap,c=a.prototype;if(!b||b._extendCnt<v){var b=a._nameCaseMap={},d;for(d in c)"_"!==d.charAt(0)&&(b[d.toLowerCase()]=d);b._extendCnt=v}return b}function x(a,b){var c=a.join();
if(!A[c]){for(var d=[],e=0,f=a.length;e<f;e++){var g=a[e];d[d.length]=A[g]=A[g]||h.getObject(g)||~g.indexOf("/")&&(b?b(g):p(g))}e=d.shift();A[c]=d.length?e.createSubclass?e.createSubclass(d):e.extend.apply(e,d):e}return A[c]}new Date("X");var v=0;b.after(h,"extend",function(){v++},!0);var A={},s={_clearCache:function(){v++;A={}},_functionFromScript:function(a,b){var c="",d="",e=a.getAttribute(b+"args")||a.getAttribute("args"),f=a.getAttribute("with"),e=(e||"").split(/\s*,\s*/);f&&f.length&&q.forEach(f.split(/\s*,\s*/),
function(a){c+="with("+a+"){";d+="}"});return new Function(e,c+a.innerHTML+d)},instantiate:function(a,b,c){b=b||{};c=c||{};var d=(c.scope||l._scopeName)+"Type",e="data-"+(c.scope||l._scopeName)+"-",f=e+"type",g=e+"mixins",h=[];q.forEach(a,function(a){var c=d in b?b[d]:a.getAttribute(f)||a.getAttribute(d);if(c){var e=a.getAttribute(g),c=e?[c].concat(e.split(/\s*,\s*/)):[c];h.push({node:a,types:c})}});return this._instantiate(h,b,c)},_instantiate:function(a,b,c,d){function f(a){!b._started&&!c.noStart&&
q.forEach(a,function(a){"function"===typeof a.startup&&!a._started&&a.startup()});return a}a=q.map(a,function(a){var d=a.ctor||x(a.types,c.contextRequire);if(!d)throw Error("Unable to resolve constructor for: '"+a.types.join()+"'");return this.construct(d,a.node,b,c,a.scripts,a.inherited)},this);return d?e(a).then(f):f(a)},construct:function(a,e,f,g,s,p){function r(a){O&&h.setObject(O,a);for(F=0;F<I.length;F++)b[I[F].advice||"after"](a,I[F].method,h.hitch(a,I[F].func),!0);for(F=0;F<U.length;F++)U[F].call(a);
for(F=0;F<Q.length;F++)a.watch(Q[F].prop,Q[F].func);for(F=0;F<T.length;F++)z(a,T[F].event,T[F].func);return a}var x=a&&a.prototype;g=g||{};var v={};g.defaults&&h.mixin(v,g.defaults);p&&h.mixin(v,p);var w;d("dom-attributes-explicit")?w=e.attributes:d("dom-attributes-specified-flag")?w=q.filter(e.attributes,function(a){return a.specified}):(p=(/^input$|^img$/i.test(e.nodeName)?e:e.cloneNode(!1)).outerHTML.replace(/=[^\s"']+|="[^"]*"|='[^']*'/g,"").replace(/^\s*<[a-zA-Z0-9]*\s*/,"").replace(/\s*>.*$/,
""),w=q.map(p.split(/\s+/),function(a){var b=a.toLowerCase();return{name:a,value:"LI"==e.nodeName&&"value"==a||"enctype"==b?e.getAttribute(b):e.getAttributeNode(b).value}}));var A=g.scope||l._scopeName;p="data-"+A+"-";var E={};"dojo"!==A&&(E[p+"props"]="data-dojo-props",E[p+"type"]="data-dojo-type",E[p+"mixins"]="data-dojo-mixins",E[A+"type"]="dojoType",E[p+"id"]="data-dojo-id");for(var F=0,D,A=[],O,L;D=w[F++];){var H=D.name,K=H.toLowerCase();D=D.value;switch(E[K]||K){case "data-dojo-type":case "dojotype":case "data-dojo-mixins":break;
case "data-dojo-props":L=D;break;case "data-dojo-id":case "jsid":O=D;break;case "data-dojo-attach-point":case "dojoattachpoint":v.dojoAttachPoint=D;break;case "data-dojo-attach-event":case "dojoattachevent":v.dojoAttachEvent=D;break;case "class":v["class"]=e.className;break;case "style":v.style=e.style&&e.style.cssText;break;default:if(H in x||(H=t(a)[K]||H),H in x)switch(typeof x[H]){case "string":v[H]=D;break;case "number":v[H]=D.length?Number(D):NaN;break;case "boolean":v[H]="false"!=D.toLowerCase();
break;case "function":""===D||-1!=D.search(/[^\w\.]+/i)?v[H]=new Function(D):v[H]=h.getObject(D,!1)||new Function(D);A.push(H);break;default:K=x[H],v[H]=K&&"length"in K?D?D.split(/\s*,\s*/):[]:K instanceof Date?""==D?new Date(""):"now"==D?new Date:c.fromISOString(D):K instanceof m?l.baseUrl+D:k(D)}else v[H]=D}}for(w=0;w<A.length;w++)E=A[w].toLowerCase(),e.removeAttribute(E),e[E]=null;if(L)try{L=k.call(g.propsThis,"{"+L+"}"),h.mixin(v,L)}catch(Y){throw Error(Y.toString()+" in data-dojo-props\x3d'"+
L+"'");}h.mixin(v,f);s||(s=a&&(a._noScript||x._noScript)?[]:y("\x3e script[type^\x3d'dojo/']",e));var I=[],U=[],Q=[],T=[];if(s)for(F=0;F<s.length;F++)E=s[F],e.removeChild(E),f=E.getAttribute(p+"event")||E.getAttribute("event"),g=E.getAttribute(p+"prop"),L=E.getAttribute(p+"method"),A=E.getAttribute(p+"advice"),w=E.getAttribute("type"),E=this._functionFromScript(E,p),f?"dojo/connect"==w?I.push({method:f,func:E}):"dojo/on"==w?T.push({event:f,func:E}):v[f]=E:"dojo/aspect"==w?I.push({method:L,advice:A,
func:E}):"dojo/watch"==w?Q.push({prop:g,func:E}):U.push(E);a=(s=a.markupFactory||x.markupFactory)?s(v,e,a):new a(v,e);return a.then?a.then(r):r(a)},scan:function(a,b){function c(a){if(!a.inherited){a.inherited={};var b=a.node,d=c(a.parent),b={dir:b.getAttribute("dir")||d.dir,lang:b.getAttribute("lang")||d.lang,textDir:b.getAttribute(r)||d.textDir},e;for(e in b)b[e]&&(a.inherited[e]=b[e])}return a.inherited}var e=[],f=[],h={},k=(b.scope||l._scopeName)+"Type",m="data-"+(b.scope||l._scopeName)+"-",s=
m+"type",r=m+"textdir",m=m+"mixins",t=a.firstChild,v=b.inherited;if(!v){var y=function(a,b){return a.getAttribute&&a.getAttribute(b)||a.parentNode&&y(a.parentNode,b)},v={dir:y(a,"dir"),lang:y(a,"lang"),textDir:y(a,r)},w;for(w in v)v[w]||delete v[w]}for(var v={inherited:v},A,z;;)if(t)if(1!=t.nodeType)t=t.nextSibling;else if(A&&"script"==t.nodeName.toLowerCase())(H=t.getAttribute("type"))&&/^dojo\/\w/i.test(H)&&A.push(t),t=t.nextSibling;else if(z)t=t.nextSibling;else{var H=t.getAttribute(s)||t.getAttribute(k);
w=t.firstChild;if(!H&&(!w||3==w.nodeType&&!w.nextSibling))t=t.nextSibling;else{z=null;if(H){var K=t.getAttribute(m);A=K?[H].concat(K.split(/\s*,\s*/)):[H];try{z=x(A,b.contextRequire)}catch(Y){}z||q.forEach(A,function(a){~a.indexOf("/")&&!h[a]&&(h[a]=!0,f[f.length]=a)});K=z&&!z.prototype._noScript?[]:null;v={types:A,ctor:z,parent:v,node:t,scripts:K};v.inherited=c(v);e.push(v)}else v={node:t,scripts:A,parent:v};A=K;z=t.stopParser||z&&z.prototype.stopParser&&!b.template;t=w}}else{if(!v||!v.node)break;
t=v.node.nextSibling;z=!1;v=v.parent;A=v.scripts}var I=new g;f.length?(d("dojo-debug-messages")&&console.warn("WARNING: Modules being Auto-Required: "+f.join(", ")),(b.contextRequire||p)(f,function(){I.resolve(q.filter(e,function(a){if(!a.ctor)try{a.ctor=x(a.types,b.contextRequire)}catch(c){}for(var d=a.parent;d&&!d.types;)d=d.parent;var e=a.ctor&&a.ctor.prototype;a.instantiateChildren=!(e&&e.stopParser&&!b.template);a.instantiate=!d||d.instantiate&&d.instantiateChildren;return a.instantiate}))})):
I.resolve(e);return I.promise},_require:function(a,b){var c=k("{"+a.innerHTML+"}"),d=[],e=[],f=new g,l=b&&b.contextRequire||p,m;for(m in c)d.push(m),e.push(c[m]);l(e,function(){for(var a=0;a<d.length;a++)h.setObject(d[a],arguments[a]);f.resolve(arguments)});return f.promise},_scanAmd:function(a,b){var c=new g,d=c.promise;c.resolve(!0);var e=this;y("script[type\x3d'dojo/require']",a).forEach(function(a){d=d.then(function(){return e._require(a,b)});a.parentNode.removeChild(a)});return d},parse:function(a,
b){var c;!b&&a&&a.rootNode?(b=a,c=b.rootNode):a&&h.isObject(a)&&!("nodeType"in a)?b=a:c=a;c=c?f.byId(c):w.body();b=b||{};var d=b.template?{template:!0}:{},e=[],g=this,k=this._scanAmd(c,b).then(function(){return g.scan(c,b)}).then(function(a){return g._instantiate(a,d,b,!0)}).then(function(a){return e=e.concat(a)}).otherwise(function(a){console.error("dojo/parser::parse() error",a);throw a;});h.mixin(e,k);return e}};l.parser=s;r.parseOnLoad&&a(100,s,"parse");return s})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(p,l,h,q,r,f,w,m,b,e,c,g,d){function y(){}function z(a){return function(b,c,d,e){return b&&"string"==typeof c&&b[c]==y?b.on(c.substring(2).toLowerCase(),w.hitch(d,e)):a.apply(h,arguments)}}p.around(h,"connect",z);f.connect&&p.around(f,"connect",z);p=q("dijit._Widget",[c,g,d],{onClick:y,onDblClick:y,onKeyDown:y,onKeyPress:y,onKeyUp:y,onMouseDown:y,onMouseMove:y,onMouseOut:y,onMouseOver:y,onMouseLeave:y,onMouseEnter:y,onMouseUp:y,constructor:function(a){this._toConnect={};for(var b in a)this[b]===
y&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=a[b],delete a[b])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===y?h.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,b){f.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(a,b)},attr:function(a,b){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){f.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?m("[widgetId]",this.containerNode).map(e.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});r("dijit-legacy-requires")&&b(0,function(){require(["dijit/_base"])});
return p})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(p,l,h,q){q.extend(l,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return h("dijit._FocusMixin",null,{_focusManager:p})})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),
function(p,l,h,q,r,f,w,m,b,e,c,g,d,y,z,a,k){var t,x,v=new (l([g,w],{curNode:null,activeStack:[],constructor:function(){var a=m.hitch(this,function(a){h.isDescendant(this.curNode,a)&&this.set("curNode",null);h.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});p.before(f,"empty",a);p.before(f,"destroy",a)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,d){var e=this,f=a.document&&a.document.body;if(f){var g=c("pointer-events")?"pointerdown":c("MSPointer")?
"MSPointerDown":c("touch-events")?"mousedown, touchstart":"mousedown",h=b(a.document,g,function(a){if(!a||!(a.target&&null==a.target.parentNode))e._onTouchNode(d||a.target,"mouse")}),k=b(f,"focusin",function(a){if(a.target.tagName){var b=a.target.tagName.toLowerCase();"#document"==b||"body"==b||(z.isFocusable(a.target)?e._onFocusNode(d||a.target):e._onTouchNode(d||a.target))}}),l=b(f,"focusout",function(a){e._onBlurNode(d||a.target)});return{remove:function(){h.remove();k.remove();l.remove();f=h=
k=l=null}}}},_onBlurNode:function(a){a=(new Date).getTime();a<t+100||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(m.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),a<x+100||(this._clearActiveWidgetsTimer=setTimeout(m.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(b,c){x=(new Date).getTime();
this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);r.contains(b,"dijitPopup")&&(b=b.firstChild);var e=[];try{for(;b;){var f=q.get(b,"dijitPopupParent");if(f)b=a.byId(f).domNode;else if(b.tagName&&"body"==b.tagName.toLowerCase()){if(b===d.body())break;b=y.get(b.ownerDocument).frameElement}else{var g=b.getAttribute&&b.getAttribute("widgetId"),h=g&&a.byId(g);h&&!("mouse"==c&&h.get("disabled"))&&e.unshift(g);b=b.parentNode}}}catch(k){}this._setStack(e,
c)},_onFocusNode:function(a){a&&9!=a.nodeType&&(t=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(b,c){var d=this.activeStack,e=d.length-1,f=b.length-1;if(b[f]!=d[e]){this.set("activeStack",b);var g;for(g=e;0<=g&&d[g]!=b[g];g--)if(e=a.byId(d[g]))e._hasBeenBlurred=!0,e.set("focused",!1),e._focusManager==this&&e._onBlur(c),
this.emit("widget-blur",e,c);for(g++;g<=f;g++)if(e=a.byId(b[g]))e.set("focused",!0),e._focusManager==this&&e._onFocus(c),this.emit("widget-focus",e,c)}},focus:function(a){if(a)try{a.focus()}catch(b){}}}));e(function(){var a=v.registerWin(y.get(document));c("ie")&&b(window,"unload",function(){a&&(a.remove(),a=null)})});k.focus=function(a){v.focus(a)};for(var A in v)/^_/.test(A)||(k.focus[A]="function"==typeof v[A]?m.hitch(v,A):v[A]);v.watch(function(a,b,c){k.focus[a]=c});return v})},"esri/tasks/QueryTask":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/Deferred dojo/_base/json dojo/has ../kernel ../request ../deferredUtils ../geometry/Extent ../geometry/normalizeUtils ./Task ./FeatureSet".split(" "),
function(p,l,h,q,r,f,w,m,b,e,c,g,d){p=p(g,{declaredClass:"esri.tasks.QueryTask",_eventMap:{complete:["featureSet"],"execute-for-count-complete":["count"],"execute-for-ids-complete":["objectIds"],"execute-relationship-query-complete":["featureSets"]},constructor:function(b,c){this._handler=l.hitch(this,this._handler);this._relationshipQueryHandler=l.hitch(this,this._relationshipQueryHandler);this._executeForIdsHandler=l.hitch(this,this._executeForIdsHandler);this._countHandler=l.hitch(this,this._countHandler);
this._extentHandler=l.hitch(this,this._extentHandler);this.source=c&&c.source;this.gdbVersion=c&&c.gdbVersion;this.registerConnectEvents()},__msigns:[{n:"execute",c:4,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForIds",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForCount",c:3,a:[{i:0,p:["geometry"]}],e:2},{n:"executeForExtent",c:3,a:[{i:0,p:["geometry"]}],e:2}],onComplete:function(){},onExecuteRelationshipQueryComplete:function(){},onExecuteForIdsComplete:function(){},onExecuteForCountComplete:function(){},
onExecuteForExtentComplete:function(){},execute:function(b,c,a,d,e){var f=e.assembly;b=this._encode(l.mixin({},this._url.query,{f:"json"},b.toJson(f&&f[0])));var g=this._handler,h=this._errorHandler;this.source&&(f={source:this.source.toJson()},b.layer=r.toJson(f));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return m({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,d){g(b,d,c,a,e.dfd)},error:function(b){h(b,a,e.dfd)},callbackSuffix:d},this.requestOptions)},executeRelationshipQuery:function(c,
d,a){c=this._encode(l.mixin({},this._url.query,{f:"json"},c.toJson()));var e=this._relationshipQueryHandler,f=this._errorHandler;this.gdbVersion&&(c.gdbVersion=this.gdbVersion);var g=new q(b._dfdCanceller);g._pendingDfd=m({url:this._url.path+"/queryRelatedRecords",content:c,callbackParamName:"callback",load:function(b,c){e(b,c,d,a,g)},error:function(b){f(b,a,g)}},this.requestOptions);return g},executeForIds:function(b,c,a,d){var e=d.assembly;b=this._encode(l.mixin({},this._url.query,{f:"json",returnIdsOnly:!0},
b.toJson(e&&e[0])));var f=this._executeForIdsHandler,g=this._errorHandler;this.source&&(e={source:this.source.toJson()},b.layer=r.toJson(e));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return m({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,e){f(b,e,c,a,d.dfd)},error:function(b){g(b,a,d.dfd)}},this.requestOptions)},executeForCount:function(b,c,a,d){var e=d.assembly;b=this._encode(l.mixin({},this._url.query,{f:"json",returnIdsOnly:!0,returnCountOnly:!0},b.toJson(e&&
e[0])));var f=this._countHandler,g=this._errorHandler;this.source&&(e={source:this.source.toJson()},b.layer=r.toJson(e));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return m({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,e){f(b,e,c,a,d.dfd)},error:function(b){g(b,a,d.dfd)}},this.requestOptions)},executeForExtent:function(b,c,a,d){var e=d.assembly;b=this._encode(l.mixin({},this._url.query,{f:"json",returnExtentOnly:!0,returnCountOnly:!0},b.toJson(e&&e[0])));
var f=this._extentHandler,g=this._errorHandler;this.source&&(e={source:this.source.toJson()},b.layer=r.toJson(e));this.gdbVersion&&(b.gdbVersion=this.gdbVersion);return m({url:this._url.path+"/query",content:b,callbackParamName:"callback",load:function(b,e){f(b,e,c,a,d.dfd)},error:function(b){g(b,a,d.dfd)}},this.requestOptions)},_handler:function(b,c,a,e,f){try{var g=new d(b);this._successHandler([g],"onComplete",a,f)}catch(h){this._errorHandler(h,e,f)}},_relationshipQueryHandler:function(b,c,a,e,
f){try{var g=b.geometryType,l=b.spatialReference,m={};h.forEach(b.relatedRecordGroups,function(a){var b={};b.geometryType=g;b.spatialReference=l;b.features=a.relatedRecords;b=new d(b);if(null!=a.objectId)m[a.objectId]=b;else for(var c in a)a.hasOwnProperty(c)&&"relatedRecords"!==c&&(m[a[c]]=b)});this._successHandler([m],"onExecuteRelationshipQueryComplete",a,f)}catch(p){this._errorHandler(p,e,f)}},_executeForIdsHandler:function(b,c,a,d,e){try{this._successHandler([b.objectIds],"onExecuteForIdsComplete",
a,e)}catch(f){this._errorHandler(f,d,e)}},_countHandler:function(b,c,a,d,e){try{var f,g=b.features,h=b.objectIds;if(h)f=h.length;else{if(g)throw Error("Unable to perform query. Please check your parameters.");f=b.count}this._successHandler([f],"onExecuteForCountComplete",a,e)}catch(l){this._errorHandler(l,d,e)}},_extentHandler:function(b,c,a,d,f){try{b.extent&&(b.extent=new e(b.extent)),this._successHandler([b],"onExecuteForExtentComplete",a,f)}catch(g){this._errorHandler(g,d,f)}}});c._createWrappers(p);
f("extend-esri")&&l.setObject("tasks.QueryTask",p,w);return p})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(p,l,h){return h("dijit.Destroyable",null,{destroy:function(h){this._destroyed=!0},own:function(){var h=["destroyRecursive","destroy","remove"];p.forEach(arguments,function(r){function f(){m.remove();p.forEach(b,function(b){b.remove()})}var w,m=l.before(this,"destroy",function(b){r[w](b)}),b=[];r.then?(w="cancel",r.then(f,f)):p.forEach(h,
function(e){"function"===typeof r[e]&&(w||(w=e),b.push(l.after(r,e,f,!0)))})},this);return arguments}})})},"esri/layers/FeatureEditResult":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(p,l,h,q){p=p(null,{declaredClass:"esri.layers.FeatureEditResult",constructor:function(h){h&&l.isObject(h)&&(this.objectId=h.objectId,this.success=h.success,h.success||(h=h.error,this.error=Error(),this.error.code=h.code,this.error.message=h.description))}});h("extend-esri")&&
l.setObject("layers.FeatureEditResult",p,q);return p})},"dojo/cache":function(){define(["./_base/kernel","./text"],function(p){return p.cache})},"esri/tasks/FeatureSet":function(){define("dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/has ../kernel ../lang ../graphic ../SpatialReference ../graphicsUtils ../geometry/jsonUtils ../symbols/jsonUtils".split(" "),function(p,l,h,q,r,f,w,m,b,e,c){p=p(null,{declaredClass:"esri.tasks.FeatureSet",constructor:function(b){if(b){l.mixin(this,b);var d=
this.features,f=b.spatialReference,p=e.getGeometryType(b.geometryType),f=this.spatialReference=new m(f);this.geometryType=b.geometryType;b.fields&&(this.fields=b.fields);h.forEach(d,function(a,b){var e=a.geometry&&a.geometry.spatialReference;d[b]=new w(p&&a.geometry?new p(a.geometry):null,a.symbol&&c.fromJson(a.symbol),a.attributes);d[b].geometry&&!e&&d[b].geometry.setSpatialReference(f)});this._hydrate()}else this.features=[]},displayFieldName:null,geometryType:null,spatialReference:null,fieldAliases:null,
toJson:function(c){var d={};this.displayFieldName&&(d.displayFieldName=this.displayFieldName);this.fields&&(d.fields=this.fields);this.spatialReference?d.spatialReference=this.spatialReference.toJson():this.features[0]&&this.features[0].geometry&&(d.spatialReference=this.features[0].geometry.spatialReference.toJson());this.features[0]&&(this.features[0].geometry&&(d.geometryType=e.getJsonType(this.features[0].geometry)),d.features=b._encodeGraphics(this.features,c));d.exceededTransferLimit=this.exceededTransferLimit;
d.transform=this.transform;return f.fixJson(d)},_hydrate:function(){var b=this.transform;if(b){var c=this.features,e,f=b.translate[0],a=b.translate[1],h=b.scale[0],l=b.scale[1],m=function(a,b,c){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=c(a.y)};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){a=a.rings||a.paths;var d,e,f,g,h,k,l,m;d=0;for(e=a.length;d<e;d++){h=a[d];f=0;for(g=h.length;f<g;f++)k=h[f],0<f?(l+=k[0],m+=k[1]):(l=k[0],m=k[1]),k[0]=b(l),k[1]=
c(m)}};if("esriGeometryEnvelope"===a)return function(a){a.xmin=b(a.xmin);a.ymin=c(a.ymin);a.xmax=b(a.xmax);a.ymax=c(a.ymax)};if("esriGeometryMultipoint"===a)return function(a){a=a.points;var d,e,f,g,h;d=0;for(e=a.length;d<e;d++)f=a[d],0<d?(g+=f[0],h+=f[1]):(g=f[0],h=f[1]),f[0]=b(g),f[1]=c(h)}}(this.geometryType,function(a){return a*h+f},function(b){return a-b*l}),b=0;for(e=c.length;b<e;b++)c[b].geometry&&m(c[b].geometry);this.transform=null}},quantize:function(b){var c=b.translate[0],e=b.translate[1],
f=b.scale[0],a=b.scale[1],h=this.features,l=function(a,b,c){var d,e,f,g,h,k,l=[];d=0;for(e=a.length;d<e;d++)if(f=a[d],0<d){if(k=b(f[0]),f=c(f[1]),k!==g||f!==h)l.push([k-g,f-h]),g=k,h=f}else g=b(f[0]),h=c(f[1]),l.push([g,h]);return 0<l.length?l:null},m=function(a,b,c){if("esriGeometryPoint"===a)return function(a){a.x=b(a.x);a.y=c(a.y);return a};if("esriGeometryPolyline"===a||"esriGeometryPolygon"===a)return function(a){var d,e,f,g,h;f=a.rings||a.paths;h=[];d=0;for(e=f.length;d<e;d++)g=f[d],(g=l(g,
b,c))&&h.push(g);return 0<h.length?(a.rings?a.rings=h:a.paths=h,a):null};if("esriGeometryMultipoint"===a)return function(a){var d;d=l(a.points,b,c);return 0<d.length?(a.points=d,a):null};if("esriGeometryEnvelope"===a)return function(a){return a}}(this.geometryType,function(a){return Math.round((a-c)/f)},function(b){return Math.round((e-b)/a)}),p,q;p=0;for(q=h.length;p<q;p++)m(h[p].geometry)||(h.splice(p,1),p--,q--);this.transform=b;return this}});q("extend-esri")&&l.setObject("tasks.FeatureSet",p,
r);return p})},"esri/layers/FeatureTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has ../kernel ../lang ../graphic".split(" "),function(p,l,h,q,r,f){p=p(null,{declaredClass:"esri.layers.FeatureTemplate",constructor:function(h){h&&l.isObject(h)&&(this.name=h.name,this.description=h.description,this.drawingTool=h.drawingTool,h=h.prototype,this.prototype=new f(h.geometry,null,h.attributes))},toJson:function(){return r.fixJson({name:this.name,description:this.description,drawingTool:this.drawingTool,
prototype:this.prototype&&this.prototype.toJson()})}});l.mixin(p,{TOOL_AUTO_COMPLETE_POLYGON:"esriFeatureEditToolAutoCompletePolygon",TOOL_CIRCLE:"esriFeatureEditToolCircle",TOOL_ELLIPSE:"esriFeatureEditToolEllipse",TOOL_FREEHAND:"esriFeatureEditToolFreehand",TOOL_LINE:"esriFeatureEditToolLine",TOOL_NONE:"esriFeatureEditToolNone",TOOL_POINT:"esriFeatureEditToolPoint",TOOL_POLYGON:"esriFeatureEditToolPolygon",TOOL_RECTANGLE:"esriFeatureEditToolRectangle",TOOL_ARROW:"esriFeatureEditToolArrow",TOOL_TRIANGLE:"esriFeatureEditToolTriangle",
TOOL_LEFT_ARROW:"esriFeatureEditToolLeftArrow",TOOL_RIGHT_ARROW:"esriFeatureEditToolRightArrow",TOOL_UP_ARROW:"esriFeatureEditToolUpArrow",TOOL_DOWN_ARROW:"esriFeatureEditToolDownArrow"});h("extend-esri")&&l.setObject("layers.FeatureTemplate",p,q);return p})},"esri/tasks/StatisticDefinition":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(p,l,h,q){p=p(null,{declaredClass:"esri.tasks.StatisticDefinition",toJson:function(){return{statisticType:this.statisticType,
onStatisticField:this.onStatisticField,outStatisticFieldName:this.outStatisticFieldName,maxPointCount:this.maxPointCount,maxRecordCount:this.maxRecordCount,maxVertexCount:this.maxVertexCount}}});h("extend-esri")&&l.setObject("tasks.StatisticDefinition",p,q);return p})},"esri/dijit/PopupTemplate":function(){define("dojo/_base/declare dojo/_base/lang dojo/has dojo/dom-construct ../kernel ../InfoTemplate ../PopupInfo ./PopupRenderer".split(" "),function(p,l,h,q,r,f,w,m){p=p([f,w],{declaredClass:"esri.dijit.PopupTemplate",
"-chains-":{constructor:"manual"},chartTheme:null,constructor:function(b,e){l.mixin(this,e);this.initialize(b,e)},getTitle:function(b){var e;this.info&&(e=this.titleHasRelatedFields?"":this._getPopupValues(b,!0).title);return e||""},getContent:function(b){return this.info?(new m({template:this,graphic:b,chartTheme:this.chartTheme},q.create("div"))).domNode:""}});h("extend-esri")&&l.setObject("dijit.PopupTemplate",p,r);return p})},"*noref":1}});
define("esri/arcgis/utils","require dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/Deferred dojo/_base/json dojo/_base/url dojo/on dojo/DeferredList dojo/dom-construct ../kernel ../config ../lang ../request ../SpatialReference ../map ../urlUtils ../geometry/ScreenPoint ../geometry/Extent ../geometry/webMercatorUtils ../symbols/jsonUtils ../renderers/jsonUtils ../dijit/PopupTemplate ../dijit/Popup ../tasks/query ../tasks/GeometryService ../layers/ArcGISTiledMapServiceLayer ../layers/FeatureLayer dojo/i18n!../nls/jsapi".split(" "),function(p,
l,h,q,r,f,w,m,b,e,c,g,d,y,z,a,k,t,x,v,A,s,n,u,R,J,G,B,S){function P(a){return y({url:N.arcgisUrl+"/"+a.itemId+"/data",content:{f:"json"},callbackParamName:"callback"},{disableIdentityLookup:!0,_preLookup:!0})}function W(a,b){var c={f:"json"};b&&(c.token=b);return y({url:a,content:c,callbackParamName:"callback"},{disableIdentityLookup:!0})}function $(a){a.itemProperties.layerDefinition&&(a.layerDefinition?(a.layerDefinition.drawingInfo||(a.layerDefinition.drawingInfo=a.itemProperties.layerDefinition.drawingInfo),
d.isDefined(a.layerDefinition.definitionExpression)||(a.layerDefinition.definitionExpression=a.itemProperties.layerDefinition.definitionExpression),d.isDefined(a.layerDefinition.minScale)||(a.layerDefinition.minScale=a.itemProperties.layerDefinition.minScale),d.isDefined(a.layerDefinition.maxScale)||(a.layerDefinition.maxScale=a.itemProperties.layerDefinition.maxScale)):a.layerDefinition=a.itemProperties.layerDefinition);a.itemProperties.popupInfo&&(!a.popupInfo&&!a.disablePopup)&&(a.popupInfo=a.itemProperties.popupInfo);
d.isDefined(a.itemProperties.showLabels)&&!d.isDefined(a.showLabels)&&(a.showLabels=a.itemProperties.showLabels);d.isDefined(a.itemProperties.showLegend)&&!d.isDefined(a.showLegend)&&(a.showLegend=a.itemProperties.showLegend);d.isDefined(a.itemProperties.refreshInterval)&&!d.isDefined(a.refreshInterval)&&(a.refreshInterval=a.itemProperties.refreshInterval)}function aa(a){$(a);a.itemProperties.layerDefinition&&a.layerDefinition&&(!d.isDefined(a.layerDefinition.maximumTrackPoints)&&d.isDefined(a.itemProperties.layerDefinition.maximumTrackPoints)&&
(a.layerDefinition.maximumTrackPoints=a.itemProperties.layerDefinition.maximumTrackPoints),!a.layerDefinition.definitionGeometry&&a.itemProperties.layerDefinition.definitionGeometry&&(a.layerDefinition.definitionGeometry=a.itemProperties.layerDefinition.definitionGeometry));a.itemProperties.purgeOptions&&!a.purgeOptions&&(a.purgeOptions=a.itemProperties.purgeOptions)}function E(a,c){var e=new r,f=a.itemData,g=[],k=[];h.forEach(f.operationalLayers,function(a){if(a.itemId&&!a.type){var b=a.url.toLowerCase();
-1<b.indexOf("/featureserver")||-1<b.indexOf("/mapserver/")?(k.push(a),g.push(P(a))):-1<b.indexOf("/mapserver")&&-1===b.indexOf("/mapserver/")&&(!a.layers||!d.isDefined(a.minScale)&&!d.isDefined(a.maxScale))?(k.push(a),g.push(P(a))):-1<b.indexOf("/imageserver")&&!d.isDefined(a.minScale)&&!d.isDefined(a.maxScale)?(k.push(a),g.push(P(a))):-1<b.indexOf("/streamserver")&&(k.push(a),g.push(P(a)))}});f.baseMap&&f.baseMap.baseMapLayers&&h.forEach(f.baseMap.baseMapLayers,function(a){a.itemId&&(k.push(a),
g.push(P(a)))});if(0<g.length){var l={};(new b(g)).addCallback(function(b){h.forEach(k,function(a,c){var e=b[c][1];if(e&&!(e instanceof Error)&&(l[a.itemId]=e,!a.type)){var f=a.url.toLowerCase();if((-1<f.indexOf("/featureserver")||-1<f.indexOf("/mapserver/"))&&e.layers)h.forEach(e.layers,function(b){if(f.match("/featureserver/"+b.id+"$")=="/featureserver/"+b.id||f.match("/mapserver/"+b.id+"$")=="/mapserver/"+b.id)a.itemProperties=b,$(a)});else if(-1<f.indexOf("/streamserver"))a.itemProperties=e,aa(a);
else if(-1<f.indexOf("/mapserver"))e.layers&&!a.layers&&(a.layers=e.layers),d.isDefined(e.minScale)&&!d.isDefined(a.minScale)&&(a.minScale=e.minScale),d.isDefined(e.maxScale)&&!d.isDefined(a.maxScale)&&(a.maxScale=e.maxScale),d.isDefined(e.refreshInterval)&&!d.isDefined(a.refreshInterval)&&(a.refreshInterval=e.refreshInterval),e.visibleLayers&&!a.visibleLayers&&(a.visibleLayers=e.visibleLayers);else if(-1<f.indexOf("/imageserver")&&(d.isDefined(e.minScale)&&!d.isDefined(a.minScale)&&(a.minScale=e.minScale),
d.isDefined(e.maxScale)&&!d.isDefined(a.maxScale)&&(a.maxScale=e.maxScale),d.isDefined(e.refreshInterval)&&!d.isDefined(a.refreshInterval)&&(a.refreshInterval=e.refreshInterval),e.popupInfo&&(!a.popupInfo&&!a.disablePopup)&&(a.popupInfo=e.popupInfo),e.renderingRule&&!a.renderingRule&&(a.renderingRule=e.renderingRule,e.renderingRule.functionName&&(a.renderingRule.rasterFunction=e.renderingRule.functionName)),e.bandIds&&!a.bandIds&&(a.bandIds=e.bandIds),e.mosaicRule&&!a.mosaicRule&&(a.mosaicRule=e.mosaicRule),
e.format&&!a.format&&(a.format=e.format),d.isDefined(e.compressionQuality)&&!d.isDefined(a.compressionQuality)&&(a.compressionQuality=e.compressionQuality),e.layerDefinition&&e.layerDefinition.definitionExpression&&(!d.isDefined(a.layerDefinition)||!d.isDefined(a.layerDefinition.definitionExpression))))a.layerDefinition=a.layerDefinition||{},a.layerDefinition.definitionExpression=e.layerDefinition.definitionExpression}});a.relatedItemsData=l;e.callback(a)})}else e.callback(a);return e}function F(a,
b){var d=new r,e=a.itemData,f=e.baseMap.baseMapLayers[0];if("BingMapsAerial"===f.type||"BingMapsRoad"===f.type||"BingMapsHybrid"===f.type)if(f.portalUrl&&c.id)delete b.bingMapsKey,c.id.checkSignInStatus(k.urlToObject(N.arcgisUrl).path).then(l.hitch(null,function(a,b,c,d,e){W(f.portalUrl,e.token).then(l.hitch(null,D,a,b,c,d),l.hitch(null,O,a,b,c,d))},a,b,e,d),l.hitch(null,function(a,b,c,d,e){W(f.portalUrl).then(l.hitch(null,D,a,b,c,d),l.hitch(null,O,a,b,c,d))},a,b,e,d));else if(b.bingMapsKey){var g=
new V({bingMapsKey:b.bingMapsKey,mapStyle:V.MAP_STYLE_AERIAL});q.connect(g,"onLoad",l.hitch(this,function(){d.callback([a,b])}));q.connect(g,"onError",function(c){delete b.bingMapsKey;a.itemData=L(e);f=a.itemData.baseMap.baseMapLayers[0];f.errors=[];f.errors.push({message:"The owner of the application has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});d.callback([a,b])})}else a.itemData=L(e),f=a.itemData.baseMap.baseMapLayers[0],f.errors=[],f.errors.push({message:"The owner of the application has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."}),
d.callback([a,b]);else d.callback([a,b]);return d}function D(a,b,c,d,e){e.bingKey?(b.bingMapsKey=e.bingKey,e=new V({bingMapsKey:b.bingMapsKey,mapStyle:V.MAP_STYLE_AERIAL}),q.connect(e,"onLoad",l.hitch(this,function(){d.callback([a,b])})),q.connect(e,"onError",function(e){delete b.bingMapsKey;a.itemData=L(c);e=a.itemData.baseMap.baseMapLayers[0];e.errors=[];e.errors.push({message:"The owner of the map has not provided a valid Bing Key for the Bing Map it includes. Switching to Esri layers."});d.callback([a,
b])})):O(a,b,c,d)}function O(a,b,c,d){delete b.bingMapsKey;a.itemData=L(c);c=a.itemData.baseMap.baseMapLayers[0];c.errors=[];c.errors.push({message:"The owner of the map has not provided a Bing Key for the Bing Map it includes. Switching to Esri layers."});d.callback([a,b])}function L(a){a.baseMap="BingMapsAerial"===a.baseMap.baseMapLayers[0].type?{title:"Imagery",baseMapLayers:[{id:"World_Imagery_2017",visibility:!0,opacity:1,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"}]}:
"BingMapsRoad"===a.baseMap.baseMapLayers[0].type?{title:"Streets",baseMapLayers:[{id:"World_Street_Map_8421",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Street_Map/MapServer"}]}:{title:"Imagery with Labels",baseMapLayers:[{id:"World_Imagery_6611",opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer"},{id:"World_Boundaries_and_Places_1145",isReference:!0,opacity:1,visibility:!0,url:"http://services.arcgisonline.com/ArcGIS/rest/services/Reference/World_Boundaries_and_Places/MapServer"}]};
return a}function H(a,b,c,e){var f=a.dynamicLayerInfos||a.layerInfos,g=b.layers;if(g&&f)if(e.usePopupManager){var k;h.forEach(f,function(a){var b=a.id;if(!a.subLayerIds)for(a=0;a<g.length;a++){var d=g[a];if(d.id===b&&d.popupInfo){k||(k={});k[b]={infoTemplate:new c(d.popupInfo),layerUrl:d.layerUrl};break}}});k&&a.setInfoTemplates(k)}else{var l=[],m=[],n=[],p=[],q=[],r=[];h.forEach(f,function(b){var c=b.id;if(!b.subLayerIds&&-1!==h.indexOf(a.visibleLayers,c))for(b=0;b<g.length;b++){var e=g[b];if(e.id===
c){m.push(c);l.push(e.popupInfo);n.push(e.layerUrl||"");e.layerDefinition&&e.layerDefinition.definitionExpression?p.push(e.layerDefinition.definitionExpression):p.push("");q.push(d.isDefined(e.minScale)?e.minScale:null);r.push(d.isDefined(e.maxScale)?e.maxScale:null);break}}});l.length&&(a.__popups=l,a.__popupIds=m,a.__popupUrls=n,a.__popupWhereClauses=p,a.__popupMinScales=q,a.__popupMaxScales=r,a.__resourceInfo=b.resourceInfo)}}function K(a){if(!a)return!1;var b=(new w(N.arcgisUrl)).authority;return-1!==
a.indexOf(".arcgis.com/")||-1!==a.indexOf(b)}function Y(a){return!a?!1:-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/")}function I(a){if("https:"===location.protocol&&(K(a)||Y(a)))a=a.replace("http:","https:");return a}function U(a,b,c){var d=[],e;a.displayLevels||(d=h.map(a.resourceInfo.tileInfo.lods,function(a){return a.level}));a.exclusionAreas&&(e=l.clone(a.exclusionAreas),e=h.map(e,function(a){a.geometry=new x(a.geometry);return a}));d=new G(I(a.url),
{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,displayLevels:a.displayLevels||d,id:a.id,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval,exclusionAreas:e});c.ignorePopups||H(d,a,b,c);return d}function Q(a,b){if(!a||!b||0===b.length)return[];var c=","+b+",",d=[],e,f=",";for(e=0;e<a.length;e++)if(null!==a[e].subLayerIds){if(-1===c.indexOf(","+a[e].id+",")||-1<f.indexOf(","+a[e].id+","))f+=a[e].subLayerIds.toString()+","}else-1<c.indexOf(","+a[e].id+",")&&
-1===f.indexOf(","+a[e].id+",")&&d.push(a[e].id);return d}function T(a,b,c){var d=new Sa;d.format="png24";a.resourceInfo&&(a.resourceInfo.supportedImageFormatTypes&&-1<a.resourceInfo.supportedImageFormatTypes.indexOf("PNG32"))&&(d.format="png32");var d=new Ta(I(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageParameters:d,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval}),e=a.visibleLayers;if(!a.visibleLayers){var f="";h.forEach(d.layerInfos,
function(a){a.defaultVisibility&&(f+=(0<f.length?",":"")+a.id)});e=f}if(a.layers&&0<a.layers.length){var g=[],k=[],m,n=[],p,q;h.forEach(a.layers,function(b){b.layerDefinition&&b.layerDefinition.definitionExpression&&(g[b.id]=b.layerDefinition.definitionExpression);if(b.layerDefinition&&b.layerDefinition.source){m=null;q=b.layerDefinition.source;if("mapLayer"===q.type){var c=h.filter(a.resourceInfo.layers,function(a){return a.id===q.mapLayerId});c.length&&(m=l.mixin(c[0],b))}else m=l.mixin({},b);m&&
(m.source=q,delete m.popupInfo,m=new Ua(m),a.visibleLayers&&(c="string"==typeof a.visibleLayers?a.visibleLayers.split(","):a.visibleLayers,-1<h.indexOf(c,b.id)?m.defaultVisibility=!0:m.defaultVisibility=!1),k.push(m))}b.layerDefinition&&(b.layerDefinition.source&&b.layerDefinition.drawingInfo)&&(p=new Va(b.layerDefinition.drawingInfo),n[b.id]=p)},this);0<g.length&&d.setLayerDefinitions(g);0<k.length?(d.setDynamicLayerInfos(k,!0),0<n.length&&d.setLayerDrawingOptions(n,!0)):(e=Q(d.layerInfos,e),d.setVisibleLayers(e))}else e=
Q(d.layerInfos,e),d.setVisibleLayers(e);c.ignorePopups||H(d,a,b,c);return d}function za(a,b,c){var e=new Wa;e.bandIds=a.bandIds;null!=a.format&&(e.format=a.format,null!=a.compressionQuality&&(e.compressionQuality=a.compressionQuality));if(a.renderingRule&&a.renderingRule.rasterFunction){var f=new Xa(a.renderingRule);e.renderingRule=f}a.mosaicRule&&(f=new Ya(a.mosaicRule),e.mosaicRule=f);d.isDefined(a.noData)&&(e.noData=a.noData);d.isDefined(a.noDataInterpretation)&&(e.noDataInterpretation=a.noDataInterpretation);
d.isDefined(a.interpolation)&&(e.interpolation=a.interpolation);f=a.layerType?"ArcGISImageServiceVectorLayer"===a.layerType:!1;d.isDefined(a.layerType)||(f=a.resourceInfo.hasMultidimensions&&("esriImageServiceDataTypeVector-UV"===a.resourceInfo.serviceDataType||"esriImageServiceDataTypeVector-MagDir"===a.resourceInfo.serviceDataType));e={resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,imageServiceParameters:e,minScale:a.minScale,maxScale:a.maxScale,refreshInterval:a.refreshInterval};
e=f?new Za(I(a.url),e):new $a(I(a.url),e);a.layerDefinition&&(a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&(f=s.fromJson(a.layerDefinition.drawingInfo.renderer),e.setRenderer(f)),a.layerDefinition.definitionExpression&&e.setDefinitionExpression(a.layerDefinition.definitionExpression,!0));!c.ignorePopups&&a.popupInfo&&e.setInfoTemplate(new b(a.popupInfo));return e}function ba(a,b,c){var e=[102113,102100,3857],f=c||new z(b[0].layerObject.fullExtent.spatialReference),g=new z(a.resourceInfo.fullExtent.spatialReference);
return f.wkt==g.wkt&&(f.wkid==g.wkid||d.isDefined(f.latestWkid)&&f.latestWkid==g.wkid||d.isDefined(g.latestWkid)&&f.wkid==g.latestWkid||d.isDefined(f.latestWkid)&&f.latestWkid==g.latestWkid)||f.wkid&&g.wkid&&h.some(e,function(a){return a===g.wkid})&&h.some(e,function(a){return a===f.wkid})?!0:!1}function ca(a,b,c){if(!b[0].layerObject.tileInfo)return!1;a=a.resourceInfo.tileInfo;b=b[0].layerObject.tileInfo;c=c.width>c.height?c.width:c.height;for(var d=!1,e=!1,f=0;f<a.lods.length;f++){for(var g=a.lods[f].scale/
a.dpi,h=0;h<b.lods.length;h++){var k=b.lods[h].scale/b.dpi;if(Math.abs(k-g)/k<1/c)if(d){e=!0;break}else d=!0}if(e)break}return e||d&&(1===a.lods.length||1===b.lods.length)?!0:!1}function Z(a,b,e,g,p,r){var C,t=e._clazz;if("OpenStreetMap"===a.type)C=new ab({id:a.id,opacity:a.opacity,visible:null!==a.visibility&&void 0!==a.visibility?a.visibility:!0});else if("WMS"===a.type){var u=[],v=[];h.forEach(a.layers,function(a){v.push(new bb({name:a.name,title:a.title,legendURL:a.legendURL}));u.push(a.name)},
this);a.visibleLayers&&(u=a.visibleLayers);g={extent:new x(a.extent[0][0],a.extent[0][1],a.extent[1][0],a.extent[1][1],new z({wkid:4326})),layerInfos:v,version:a.version,maxWidth:a.maxWidth,maxHeight:a.maxHeight,getMapURL:a.mapUrl,spatialReferences:a.spatialReferences,title:a.title,copyright:a.copyright,minScale:a.minScale||0,maxScale:a.maxScale||0,format:a.format};C=new cb(a.url,{id:a.id,visibleLayers:u,format:"png",transparent:a.baseMapLayer?!1:!0,opacity:a.opacity,visible:null!==a.visibility?a.visibility:
!0,resourceInfo:g,refreshInterval:a.refreshInterval});C.spatialReference.wkid=g.spatialReferences[0]}else if("KML"===a.type){e=a.url;if(c.id&&(t=c.id.findCredential(k.urlToObject(N.arcgisUrl).path))){var w=N.arcgisUrl.substring(N.arcgisUrl.indexOf("//")+2,N.arcgisUrl.indexOf("/",N.arcgisUrl.indexOf("//")+3)),y=w.split("."),y=y[y.length-2]+"."+y[y.length-1];b=e.indexOf(y);-1<b&&(e="https://"+w+e.substring(b+y.length),e+="?token\x3d"+t.token)}C=new db(e,{id:a.id,visible:null!==a.visibility?a.visibility:
!0,outSR:g,refreshInterval:a.refreshInterval});q.connect(C,"onLoad",function(){(a.opacity||0===a.opacity)&&C.setOpacity(a.opacity);d.isDefined(a.minScale)&&d.isDefined(a.maxScale)&&C.setScaleRange(a.minScale,a.maxScale);a.visibleFolders&&h.forEach(C.folders,function(b){-1<h.indexOf(a.visibleFolders,b.id)?C.setFolderVisibility(b,!0):C.setFolderVisibility(b,!1)},this)})}else"WebTiledLayer"===a.type?(C=new eb(a.templateUrl,{id:a.id,visible:null!==a.visibility?a.visibility:!0,opacity:a.opacity,copyright:a.copyright,
fullExtent:a.fullExtent&&new x(a.fullExtent),initialExtent:a.fullExtent&&new x(a.fullExtent),subDomains:a.subDomains,tileInfo:a.tileInfo?new fb(a.tileInfo):null,refreshInterval:a.refreshInterval}),q.connect(C,"onLoad",function(){(d.isDefined(a.minScale)||d.isDefined(a.maxScale))&&C.setScaleRange(a.minScale,a.maxScale)})):"GeoRSS"===a.type?(C=new gb(a.url,{id:a.id,opacity:a.opacity,outSpatialReference:g,refreshInterval:a.refreshInterval}),q.connect(C,"onLoad",function(){!1===a.visibility&&C.hide();
d.isDefined(a.minScale)&&d.isDefined(a.maxScale)&&C.setScaleRange(a.minScale,a.maxScale);var b=C.getFeatureLayers();h.forEach(b,function(c){a.pointSymbol&&"esriGeometryPoint"===c.geometryType?(c.renderer.symbol=A.fromJson(a.pointSymbol),1===b.length&&(C.pointSymbol=A.fromJson(a.pointSymbol))):a.lineSymbol&&"esriGeometryPolyline"===c.geometryType?(c.renderer.symbol=A.fromJson(a.lineSymbol),1===b.length&&(C.polylineSymbol=A.fromJson(a.lineSymbol))):a.polygonSymbol&&"esriGeometryPolygon"===c.geometryType&&
(c.renderer.symbol=A.fromJson(a.polygonSymbol),1===b.length&&(C.polygonSymbol=A.fromJson(a.polygonSymbol)))})})):"CSV"==a.type&&a.url?(g={layerDefinition:a.layerDefinition,columnDelimiter:a.columnDelimiter,id:a.id?a.id:null,visible:null!==a.visibility?a.visibility:!0,opacity:a.opacity,refreshInterval:a.refreshInterval},a.locationInfo&&(g.latitudeFieldName=a.locationInfo.latitudeFieldName,g.longitudeFieldName=a.locationInfo.longitudeFieldName),e.ignorePopups||(g.infoTemplate=new n(a.popupInfo?a.popupInfo:
hb.generateDefaultPopupInfo(a))),C=new ib(a.url,g)):a.layerDefinition&&!a.url?(g=f.fromJson(f.toJson(a)),delete g.id,delete g.opacity,delete g.visibility,C=new B(g,{id:a.id,opacity:a.opacity,visible:a.visibility,outFields:["*"],autoGeneralize:!0}),!e.ignorePopups&&g.popupInfo&&C.setInfoTemplate(new t(g.popupInfo)),fa(C)):"BingMapsAerial"===a.type||"BingMapsRoad"===a.type||"BingMapsHybrid"===a.type?e.bingMapsKey?(g=V.MAP_STYLE_AERIAL_WITH_LABELS,"BingMapsAerial"===a.type?g=V.MAP_STYLE_AERIAL:"BingMapsRoad"===
a.type&&(g=V.MAP_STYLE_ROAD),C=new V({bingMapsKey:e.bingMapsKey,mapStyle:g,opacity:a.opacity,id:a.id}),q.connect(C,"onError",l.hitch(this,function(a){a.errors=a.errors||[];a.errors.push({message:"This application does not have a valid Bing Key for the Bing layer that is included in this map. [type:"+a.type+"]"})},a))):(a.errors=a.errors||[],a.errors.push({message:"This application does not provide a Bing Key for the Bing layer that is included in this map. [type:"+a.type+"]"})):a.resourceInfo&&a.resourceInfo.mapName?
C=!0===a.resourceInfo.singleFusedMapCache&&(a.baseMapLayer||ba(a,b,g)&&ca(a,p,r))?U(a,t,e):T(a,t,e):a.resourceInfo&&a.resourceInfo.pixelSizeX?C=!0===a.resourceInfo.singleFusedMapCache&&(a.baseMapLayer||ba(a,b,g)&&ca(a,p,r))?U(a,t,e):za(a,t,e):a.resourceInfo&&"Feature Layer"===a.resourceInfo.type?(a.capabilities&&(a.resourceInfo.capabilities=a.capabilities),C=new B(I(a.url),{resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id,mode:K(a.url)?B.MODE_AUTO:d.isDefined(a.mode)?a.mode:
B.MODE_ONDEMAND,editable:!1===e.editable?!1:void 0,outFields:["*"],autoGeneralize:!0,refreshInterval:a.refreshInterval}),!e.ignorePopups&&a.popupInfo&&C.setInfoTemplate(new t(a.popupInfo)),a.layerDefinition&&(a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.renderer&&(g=s.fromJson(a.layerDefinition.drawingInfo.renderer),g.isMaxInclusive=!0,C.setRenderer(g)),a.layerDefinition.drawingInfo&&a.layerDefinition.drawingInfo.labelingInfo&&(g=h.map(a.layerDefinition.drawingInfo.labelingInfo,function(a){return new jb(a)}),
C.setLabelingInfo(g)),a.layerDefinition.definitionExpression&&C.setDefinitionExpression(a.layerDefinition.definitionExpression),d.isDefined(a.layerDefinition.minScale)&&C.setMinScale(a.layerDefinition.minScale),d.isDefined(a.layerDefinition.maxScale)&&C.setMaxScale(a.layerDefinition.maxScale)),fa(C)):a.resourceInfo&&a.resourceInfo.streamUrls&&(g={resourceInfo:a.resourceInfo,opacity:a.opacity,visible:a.visibility,id:a.id},a.layerDefinition&&(y=a.layerDefinition.drawingInfo,a.layerDefinition.definitionGeometry&&
(w=w||{},w.geometry=a.layerDefinition.definitionGeometry),d.isDefined(a.layerDefinition.definitionExpression)&&(w=w||{},w.where=a.layerDefinition.definitionExpression),d.isDefined(a.layerDefinition.maximumTrackPoints)&&(g.maximumTrackPoints=a.layerDefinition.maximumTrackPoints)),w&&(g.filter=w),a.purgeOptions&&(g.purgeOptions=a.purgeOptions),C=new kb(I(a.url),g),y&&y.renderer&&(g=y.renderer,C.setRenderer(s.fromJson(g))),!e.ignorePopups&&a.popupInfo&&C.setInfoTemplate(new t(a.popupInfo)),a.layerDefinition&&
(d.isDefined(a.layerDefinition.minScale)&&C.setMinScale(a.layerDefinition.minScale),d.isDefined(a.layerDefinition.maxScale)&&C.setMaxScale(a.layerDefinition.maxScale)),m.once(C,"error",function(b){a.errors.push({message:"Error loading stream layer. Check websocket url"})}));C&&(C.arcgisProps={title:a.title},a.baseMapLayer&&(a.isReference?(C.attr("data-reference",!0),C._basemapGalleryLayerType="reference"):C._basemapGalleryLayerType="basemap"));return C}function da(a,b,c,d,e){h.forEach(a,function(f,
g){if(f.url&&!f.type){if(0===g||a[0].layerObject)f.layerObject=Z(f,a,b,c,d,e)}else f.layerObject=Z(f,a,b,c,d,e)});var f=h.filter(a,function(a){return!a.isReference}),g=h.filter(a,function(a){return!!a.isReference});return a=f.concat(g)}function ea(a){var b=null;a=a[0];a.url&&!a.type?a.resourceInfo.spatialReference&&(b=new z,a.resourceInfo.spatialReference.wkid&&(b.wkid=a.resourceInfo.spatialReference.wkid),a.resourceInfo.spatialReference.wkt&&(b.wkt=a.resourceInfo.spatialReference.wkt)):-1<a.type.indexOf("BingMaps")||
"OpenStreetMap"==a.type?b=new z({wkid:102100}):"WMS"==a.type&&(b=new z({wkid:a.spatialReferences[0]}));return b}function M(a,b,c,d,e,f,g,k){h.forEach(b,function(b){b.url&&!b.type&&(b.resourceInfo=a[b.deferredsPos][1],delete b.deferredsPos)});f=f||ea(b);b=da(b,c,f,g,k);e.callback(b);return e}function fa(a){!window.CanvasRenderingContext2D&&(a.renderer&&"esri.renderer.HeatmapRenderer"===a.renderer.declaredClass)&&a.setRenderer(s.fromJson({type:"simple",symbol:{color:[77,77,77,255],size:6,angle:0,xoffset:0,
yoffset:0,type:"esriSMS",style:"esriSMSCircle",outline:{color:[255,255,255,255],width:0.75,type:"esriSLS",style:"esriSLSSolid"}}}))}function Ha(a,b){var c=I(a);return y({url:c,content:{f:"json"},callbackParamName:"callback",error:function(a,d){a.message=a.message?a.message+(" [url:"+c+"]"):"[url:"+c+"]";b.push(a);g.defaults.io.errorHandler(a,d)}})}function Ia(a){var b=N.arcgisUrl+"/"+a.itemId+"/data";return y({url:b,content:{f:"json"},callbackParamName:"callback",error:function(c,d){c.message=c.message?
c.message+(" [url:"+b+"]"):"[url:"+b+"]";a.errors=a.errors||[];a.errors.push(c);g.defaults.io.errorHandler(c,d)}})}function Ja(a,b,c){var e=new r;if((!c.featureCollection||!c.featureCollection.layers)&&!c.layers)return console.log("Invalid Feature Collection item data [item id: "+a.itemId+"]: ",c),a.errors=a.errors||[],a.errors.push({message:"Invalid Feature Collection item data. [item id: "+a.itemId+"]"}),e.errback(),e;c.layers&&(c.featureCollection={layers:c.layers},delete c.layers,d.isDefined(c.showLegend)&&
(c.featureCollection.showLegend=c.showLegend,delete c.showLegend));Ka(a,c.featureCollection,b).then(function(b){c.featureCollection=b;a.featureCollection&&a.featureCollection.layers?h.forEach(c.featureCollection.layers,function(b,c){var e=a.featureCollection.layers[c];if(!e.poupInfo&&!e.layerDefinition)e.popupInfo=b.popupInfo,e.layerDefinition=b.layerDefinition;else if(e.layerDefinition){if(d.isDefined(e.layerDefinition.minScale)&&d.isDefined(e.layerDefinition.maxScale)&&(e.layerDefinition.minScale!==
b.layerDefinition.minScale||e.layerDefinition.maxScale!==b.layerDefinition.maxScale))delete b.layerDefinition.minscale,delete b.layerDefinition.maxScale;e.layerDefinition.drawingInfo&&f.toJson(e.layerDefinition.drawingInfo)!==f.toJson(b.layerDefinition.drawingInfo)&&delete b.layerDefinition.drawingInfo;e.layerDefinition.showLegend!==b.layerDefinition.showLegend&&delete b.layerDefinition.showLegend;e.layerDefinition=l.mixin(e.layerDefinition,b.layerDefinition)}else e.layerDefinition=b.layerDefinition;
e.featureSet=b.featureSet;e.nextObjectId=b.nextObjectId}):(a.featureCollection=a.featureCollection||{},a.featureCollection=l.mixin(a.featureCollection,c.featureCollection));e.callback(a)});return e}function Ka(a,c,e){var f=new r;p(["./csv"],function(g){var k=[];h.forEach(c.layers,function(a){a.featureSet&&(a.featureSet.features&&a.featureSet.features.length&&a.featureSet.features[0].geometry&&a.featureSet.features[0].geometry.spatialReference)&&(a.deferredsPos=k.length,k.push(g.projectFeatureCollection(a,
e,a.featureSet.features[0].geometry.spatialReference)))});(new b(k)).addCallback(function(){h.forEach(c.layers,function(b){d.isDefined(b.deferredsPos)&&(k[b.deferredsPos].results&&k[b.deferredsPos].results.length?b=k[b.deferredsPos].results[0]:(console.log("Errors projecting feature collection. ["+a.title+" - "+b.layerDefinition.name+"]"),b.errors=b.errors||[],b.errors.push({message:"Errors projecting feature collection. ["+a.title+" - "+b.layerDefinition.name+"]"})),delete b.deferredsPos)});f.callback(c)})});
return f}function ga(a,c,d,e,f){var g=new r,k=new r,n=[],q;h.forEach(a.operationalLayers,function(a){a.itemId&&"Feature Collection"==a.type&&n.push(Ia(a).then(l.hitch(null,Ja,a,d)))});0===n.length?La(a,c,d,e,k,f):(q=new b(n),q.addCallback(function(b){La(a,c,d,e,k,f)}));k.then(function(a){n=[];h.forEach(a,function(a){a=a.layerObject;if(a instanceof B&&!a.loaded&&!a.loadError){var b=new r;m.once(a,"load, error",function(){b.callback(a)});n.push(b)}});if(n.length){var c=new r;q=new b(n);q.addCallback(function(){c.callback(a)});
return c.promise}return a}).then(function(a){var b=[];h.forEach(a,function(a){if(a.layerObject instanceof B){var c=a.layerObject;c.loaded&&(c.labelingInfo&&(a.showLabels||c._collection))&&b.push(c)}});b.length?p(["../layers/LabelLayer"],function(c){var d=new c;h.forEach(b,function(a){d.addFeatureLayer(a)});a.push({layerObject:d});g.callback(a)}):g.callback(a)});return g}function La(a,c,d,e,f,g){var k=[],l=[],m=[];h.forEach(a.operationalLayers,function(a,b){if(a.featureCollection&&a.featureCollection.layers){var c=
a.featureCollection.layers.length;h.forEach(a.featureCollection.layers,function(d,e){var f=!0;a.visibleLayers&&-1==h.indexOf(a.visibleLayers,e)&&(f=!1);d.visibility=a.visibility&&f;d.opacity=a.opacity;d.id=(a.id||"operational"+b)+"_"+e;a.title&&(d.title=1===c||!d.layerDefinition.name||a.title===d.layerDefinition.name?a.title:a.title+" - "+d.layerDefinition.name);m.push(d)},this)}else m.push(a)});h.forEach(a.baseMap.baseMapLayers,function(a,b){a.baseMapLayer=!0;a.id=a.id||"base"+b;k.push(a)});h.forEach(m,
function(a,b){a.id=a.id||"operational"+b;k.push(a)});h.forEach(k,function(a){a.url&&!a.type&&(a.deferredsPos=l.length,a.errors=a.errors||[],l.push(Ha(a.url,a.errors)))});0===l.length?(d=d||ea(k),k=da(k,c,d,e,g),f.callback(k)):(new b(l)).addCallback(function(a){M(a,k,c,l,f,d,e,g)});return f}function ha(a,b,c,d){var e=a.minScale,f=a.maxScale;if(10.1>=c.version&&b)for(a=b.length-1;0<=a;a--){if(b[a].id==d)if(0==e&&0<b[a].minScale?e=b[a].minScale:0<e&&0==b[a].minScale?e=c.minScale:0<e&&0<b[a].minScale&&
(e=Math.min(e,b[a].minScale)),f=Math.max(c.maxScale||0,b[a].maxScale||0),c.setScaleRange(e,f),-1<b[a].parentLayerId)d=b[a].parentLayerId;else break}else 10.1<c.version&&(h.forEach(a.layerInfos,function(a){a.id==d&&(0==e&&0<a.minScale?e=a.minScale:0<e&&0==a.minScale||0<e&&0<a.minScale&&(e=Math.min(e,a.minScale)),f=Math.max(f||0,a.maxScale||0))}),c.setScaleRange(e,f))}function ia(a,b,c,e){var f=a.url,g=a.__popupIds,k=a.__popupUrls,m=a.__popupWhereClauses,n=a.__popupMinScales,p=a.__popupMaxScales,r=
a.__resourceInfo,s=[];h.forEach(a.__popups,function(e,l){if(e){var t,u=[];h.forEach(e.fieldInfos,function(a){"shape"!==a.fieldName.toLowerCase()&&u.push(a.fieldName)});if(a.dynamicLayerInfos&&0<a.dynamicLayerInfos.length){var v=h.filter(a.dynamicLayerInfos,function(a){return g[l]==a.id})[0].source;t=new B(f+"/dynamicLayer",{id:a.id+"_"+g[l],source:v,outFields:u,mode:B.MODE_SELECTION,infoTemplate:e&&new c(e),drawMode:!1,visible:a.visible,autoGeneralize:!0});var w=function(c,e){0<m[c].length&&e.setDefinitionExpression(m[c]);
if(!d.isDefined(n[c])&&!d.isDefined(p[c]))ha(a,b||r.layers,e,g[c]);else if(d.isDefined(a.minScale)||d.isDefined(a.maxScale)){var f=a.minScale,h=a.maxScale;0==f&&0<n[c]?f=n[c]:0<f&&0==n[c]||0<f&&0<n[c]&&(f=Math.min(f,n[c]));h=Math.max(h||0,p[c]||0);e.setScaleRange(f,h)}else e.setScaleRange(n[c],p[c])};t.loaded?w(l,t):q.connect(t,"onLoad",function(a){w(l,t)})}else{var x=null,y=f+"/"+g[l];if(k[l].length)y=k[l];else if(b)for(v=0;v<b.length;v++)if(b[v].id===g[l]){x=b[v];break}t=new B(I(y),{id:a.id+"_"+
g[l],outFields:u,mode:B.MODE_SELECTION,infoTemplate:e&&new c(e),drawMode:!1,visible:a.visible,resourceInfo:x,autoGeneralize:!0});t.loaded?(0<m[l].length&&t.setDefinitionExpression(m[l]),ha(a,b||r.layers,t,g[l])):q.connect(t,"onLoad",function(c){0<m[l].length&&t.setDefinitionExpression(m[l]);ha(a,b||r.layers,c,g[l])})}s.push(t)}});0<s.length&&(q.connect(a,"onVisibilityChange",l.hitch(this,function(a,b){h.forEach(a,function(a){b?a.show():a.hide()})},s)),q.connect(e,"onLayerRemove",l.hitch(this,function(a,
b,c){a.id===c.id&&h.forEach(b,function(a){e.removeLayer(a)})},a,s)));delete a.__popups;delete a.__popupIds;delete a.__popupUrls;delete a.__popupWhereClauses;delete a.__popupMinScales;delete a.__popupMaxScales;delete a.__resourceInfo;return s}function Ma(a){return y({url:I(a.url+"/layers"),content:{f:"json"},callbackParamName:"callback",error:function(){}})}function Na(a,c,d){var e=[];h.forEach(a,function(a){var b=a.__popups;b&&(1<b.length&&10<=a.version)&&(a.__deferredsPos=e.length,e.push(Ma(a)))});
var f=[];0<e.length?(new b(e)).addCallback(function(b){h.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(a.__deferredsPos||0===a.__deferredsPos?(f=f.concat(ia(a,b[a.__deferredsPos][1].layers,d,c)),delete a.__deferredsPos):f=f.concat(ia(a,null,d,c)))});c.addLayers(f)}):(h.forEach(a,function(a){a.__popups&&0<a.__popups.length&&(f=f.concat(ia(a,null,d,c)))}),c.addLayers(f))}function Oa(a){h.forEach(a,function(a){var b=a.layer;b.toJson&&(a=b.toJson(),a.featureSet&&(b.name&&-1<b.name.indexOf("Text"))&&
h.forEach(a.featureSet.features,function(a,c){if(a.attributes.TEXT){var d=b.graphics[c];d.symbol.setText(a.attributes.TEXT);a.symbol.horizontalAlignment&&(d.symbol.align=a.symbol.horizontalAlignment);d.setSymbol(d.symbol);d.setAttributes(a.attributes)}},this))})}function Pa(a){var b=6;h.forEach(a,function(a){if(a=a.renderer)"esri.renderer.SimpleRenderer"===a.declaredClass?((a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset))),a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))):("esri.renderer.UniqueValueRenderer"===
a.declaredClass||"esri.renderer.ClassBreaksRenderer"===a.declaredClass)&&h.forEach(a.infos,function(a){(a=a.symbol)&&a.xoffset&&(b=Math.max(b,Math.abs(a.xoffset)));a&&a.yoffset&&(b=Math.max(b,Math.abs(a.yoffset)))})});return b}function Aa(a){var b=this,c=b.infoWindow,d=a.graphic;if(b.loaded){c.hide();c.clearFeatures();var e=[];h.forEach(b.graphicsLayerIds,function(a){if((a=b.getLayer(a))&&a instanceof B&&a.loaded&&a.visible)a.clearSelection(),a.infoTemplate&&!a.suspended&&e.push(a)});h.forEach(b.layerIds,
function(a){(a=b.getLayer(a))&&(-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")&&a.loaded&&a.visible&&a.infoTemplate)&&e.push(a)});d=d&&d.getInfoTemplate()?d:null;if(e.length||d){var f=Pa(e),g=a.screenPoint,k=b.toMap(new t(g.x-f,g.y+f)),f=b.toMap(new t(g.x+f,g.y-f)),k=new x(k.x,k.y,f.x,f.y,b.spatialReference),l=new R;l.geometry=k;l.timeExtent=b.timeExtent;var m=!0,k=h.map(e,function(b){var c;-1!==b.declaredClass.indexOf("ArcGISImageServiceLayer")?(l.geometry=a.mapPoint,m=!1,c=b.queryVisibleRasters(l,
{rasterAttributeTableFieldPrefix:"Raster.",returnDomainValues:!0}),c.addCallback(function(){return b.getVisibleRasters()})):(c=b.selectFeatures(l),c.addCallback(function(){return b.getSelectedFeatures()}));return c});d&&(f=new r,f.callback([d]),k.splice(0,0,f));if(!h.some(k,function(a){return-1===a.fired})){var n=d?1:0;h.forEach(e,function(a){n=-1!==a.declaredClass.indexOf("ArcGISImageServiceLayer")?n+a.getVisibleRasters().length:n+a.getSelectedFeatures().length});if(!n)return}c.setFeatures(k);c.show(a.mapPoint,
{closestFirst:m})}}}function nb(b,c){var f=c.mapOptions||{},g;f.infoWindow||(g=new u({visibleWhenEmpty:!1},e.create("div")),f.infoWindow=g);!d.isDefined(f.showInfoWindowOnClick)&&!c.usePopupManager&&(f.showInfoWindowOnClick=!1);f=new a(b,f);q.connect(f,"onLayersAddResult",Oa);return f}function X(a,b,c,d,e,f){var g,k,l,m;d.map?(g=d.map,k=d.clickEventHandle,l=d.clickEventListener,m=d.errors):(g=nb(d,e),!e.ignorePopups&&(!e.disableClickBehavior&&!e.usePopupManager)&&(k=q.connect(g,"onClick",Aa),l=Aa));
g.addLayers(a);!e.ignorePopups&&!e.usePopupManager&&Na(a,g,e._clazz);var n=m||[];h.forEach(b,function(a){a.errors&&(n=n.concat(a.errors))},this);g.loaded?f.callback({map:g,itemInfo:c,errors:n,clickEventHandle:k,clickEventListener:l}):q.connect(g,"onLoad",function(){f.callback({map:g,itemInfo:c,errors:n,clickEventHandle:k,clickEventListener:l})})}function ja(a,b,c,d,e){var f=[];h.forEach(e,function(a){l.isArray(a.layerObject)?h.forEach(a.layerObject,function(a){f.push(a)}):f.push(a.layerObject)});
if("BingMapsAerial"===e[0].type||"BingMapsRoad"===e[0].type||"BingMapsHybrid"===e[0].type)var g=setInterval(function(){if(e[0].layerObject&&e[0].layerObject.loaded)clearInterval(g),Qa(a,b,c,d,e,f);else if(e[0].errors){clearInterval(g);var h="";e[0].errors&&e[0].errors.length&&(h=" ("+e[0].errors[0].message+")");d.errback(Error(S.arcgis.utils.baseLayerError+h))}},10);else if(!f[0]&&e[0].baseMapLayer){var k="";e[0].errors&&e[0].errors.length&&(k=" ("+e[0].errors[0].message+")");d.errback(Error(S.arcgis.utils.baseLayerError+
k))}else Qa(a,b,c,d,e,f)}function Qa(a,b,c,e,f,k){try{var l=c.mapOptions||{};c.mapOptions=l;var m=a.item;k=h.filter(k,d.isDefined);if(m)if(m.extent&&m.extent.length)if(l.extent)X(k,f,a,b,c,e);else{var n=new x(m.extent[0][0],m.extent[0][1],m.extent[1][0],m.extent[1][1],new z({wkid:4326})),p=k[0].spatialReference;4326===p.wkid?(l.extent=n,X(k,f,a,b,c,e)):102100===p.wkid||102113===p.wkid||3857===p.wkid?(n.xmin=Math.max(n.xmin,-180),n.xmax=Math.min(n.xmax,180),n.ymin=Math.max(n.ymin,-89.99),n.ymax=Math.min(n.ymax,
89.99),l.extent=v.geographicToWebMercator(n),X(k,f,a,b,c,e)):c.geometryServiceURL||g.defaults.geometryService?(c.geometryServiceURL?new J(c.geometryServiceURL):g.defaults.geometryService).project([n],p,function(d){d=d[0];l.extent=l.extent||d;X(k,f,a,b,c,e)},function(){X(k,f,a,b,c,e)}):e.errback(Error(S.arcgis.utils.geometryServiceError))}else X(k,f,a,b,c,e);else X(k,f,a,b,c,e)}catch(q){e.errback(q)}}function ob(a){var b=[];h.forEach(a.operationalLayers,function(a){a.featureCollection?b.push({featureCollection:a.featureCollection,
visibility:a.visibility,title:a.title}):a.layerObject&&b.push({layer:a.layerObject,visibility:a.visibility,title:a.title})});return b}function Ra(a){var b=[];a=a.baseMap.baseMapLayers.concat(a.operationalLayers);h.forEach(a,function(a){var c={};if(a.featureCollection&&"CSV"!==a.type)!0===a.featureCollection.showLegend&&h.forEach(a.featureCollection.layers,function(d){!1!==d.showLegend&&(c={layer:d.layerObject,title:a.title,defaultSymbol:d.renderer&&d.renderer.defaultSymbol&&d.renderer.defaultLabel?
!0:!1},1<a.featureCollection.layers.length&&(c.title+=" - "+d.layerDefinition.name),b.push(c))});else if(a.baseMapLayer&&!0===a.showLegend&&a.layerObject||!a.baseMapLayer&&!1!==a.showLegend&&a.layerObject){var d=a.layerObject.renderer,e=a.layerObject.declaredClass,d=!d||d&&d.defaultSymbol&&d.defaultLabel?!0:!1;if(10.1>a.layerObject.version&&("esri.layers.ArcGISDynamicMapServiceLayer"===e||"esri.layers.ArcGISTiledMapServiceLayer"===e)||"esri.layers.ArcGISImageServiceLayer"===e)d=!0;c={layer:a.layerObject,
title:a.title,defaultSymbol:d};a.layers&&(e=h.map(h.filter(a.layers,function(a){return!1===a.showLegend}),function(a){return a.id}),e.length&&(c.hideLayers=e));b.push(c)}});return b}function pb(a,b){function c(a,b){h.forEach(a,function(a,c){switch(a){case ka:Ta=b[c];break;case la:$a=b[c];break;case ma:Za=b[c];break;case Ba:hb=b[c];break;case na:ib=b[c];break;case Ca:Ua=b[c];break;case oa:gb=b[c];break;case Da:Sa=b[c];break;case pa:Wa=b[c];break;case qa:db=b[c];break;case ra:jb=b[c];break;case Ea:Va=
b[c];break;case sa:Ya=b[c];break;case ta:ab=b[c];break;case ua:Xa=b[c];break;case va:kb=b[c];break;case Fa:fb=b[c];break;case wa:V=b[c];break;case xa:eb=b[c];break;case ya:cb=b[c];break;case Ga:bb=b[c]}})}var d=new r,e=a.itemData,f=[];e.baseMap&&e.baseMap.baseMapLayers&&(f=f.concat(e.baseMap.baseMapLayers));e.operationalLayers&&(f=f.concat(e.operationalLayers));for(var e=h.map(f,function(a){return a&&a.layerType}),g=[],k=[],f=!1,l=0;l<e.length;l++){switch(e[l]){case "ArcGISFeatureLayer":-1===h.indexOf(g,
ra)&&g.push(ra);break;case "ArcGISImageServiceLayer":case "ArcGISTiledImageServiceLayer":-1===h.indexOf(g,la)&&(g.push(la),k.push(pa),k.push(sa),k.push(ua));break;case "ArcGISImageServiceVectorLayer":-1===h.indexOf(g,ma)&&(g.push(ma),k.push(pa),k.push(sa),k.push(ua));break;case "ArcGISMapServiceLayer":case "ArcGISTiledMapServiceLayer":-1===h.indexOf(g,ka)&&(g.push(ka),k.push(Ca),k.push(Da),k.push(Ea));break;case "ArcGISStreamLayer":-1===h.indexOf(g,va)&&g.push(va);break;case "BingMapsAerial":case "BingMapsHybrid":case "BingMapsRoad":-1===
h.indexOf(g,wa)&&g.push(wa);break;case "CSV":-1===h.indexOf(g,na)&&(g.push(na),k.push(Ba));break;case "GeoRSS":-1===h.indexOf(g,oa)&&g.push(oa);break;case "KML":-1===h.indexOf(g,qa)&&g.push(qa);break;case "OpenStreetMap":-1===h.indexOf(g,ta)&&g.push(ta);break;case "WebTiledLayer":-1===h.indexOf(g,xa)&&(g.push(xa),k.push(Fa));break;case "WMS":-1===h.indexOf(g,ya)&&(g.push(ya),k.push(Ga));break;default:f=!0}if(f)break}f&&(g=qb,k=rb);g.length?p(g,function(){c(g,arguments);k.length?p(k,function(){c(k,
arguments);d.resolve()}):d.resolve()}):d.resolve();return d}function lb(a,b,c,d){var e=d.itemData,f=b.layerMixins,g=f&&f.length;if(g){var k=function(a){for(var b=0;b<g;b++){var c=f[b];if(c.mixin)if(c.hasOwnProperty("id")){if(a.id===c.id){l.mixin(a,c.mixin);break}}else if(a.url===c.url){l.mixin(a,c.mixin);break}}};h.forEach(e.baseMap&&e.baseMap.baseMapLayers,k);h.forEach(e.operationalLayers,k)}pb(d,b).then(function(){F(d,b).then(function(b){var d=b[0],e=b[1];if(!d.itemData.operationalLayers||0===d.itemData.operationalLayers.length)E(d,
e).addCallback(function(b){ga(b.itemData,e).addCallback(l.hitch(null,ja,b,a,e,c))});else{var f=new r,g=d.itemData.baseMap.baseMapLayers.slice(),k=h.filter(d.itemData.baseMap.baseMapLayers,function(a){return!a.isReference});b={item:d.item,itemData:{baseMap:{baseMapLayers:k}}};d.itemData.baseMap.baseMapLayers=h.filter(d.itemData.baseMap.baseMapLayers,function(a){return a.isReference});E(b,e).addCallback(function(b){ga(b.itemData,e).addCallback(l.hitch(null,ja,b,a,e,f))});f.then(function(a){E(d,e).addCallback(function(b){ga(b.itemData,
e,a.map.spatialReference,k,a.map).addCallback(function(d){b.itemData.baseMap.baseMapLayers=g;ja(b,a,e,c,d)})})},l.hitch(c,c.errback))}})})}function mb(a){N._arcgisUrl&&0<N._arcgisUrl.length&&(N.arcgisUrl=N._arcgisUrl);var b=N.arcgisUrl+"/"+a,c={},d=new r;y({url:b,content:{f:"json"},callbackParamName:"callback",load:function(a){c.item=a;y({url:b+"/data",content:{f:"json"},callbackParamName:"callback",load:function(a){c.itemData=a;d.callback(c)},error:function(a){d.errback(a)}})},error:function(a){d.errback(a)}});
return d}var N,Ta,$a,Za,hb,ib,Ua,gb,Sa,Wa,db,jb,Va,Ya,ab,Xa,kb,fb,V,eb,cb,bb,ka="../layers/ArcGISDynamicMapServiceLayer",la="../layers/ArcGISImageServiceLayer",ma="../layers/ArcGISImageServiceVectorLayer",Ba="./csv",na="../layers/CSVLayer",Ca="../layers/DynamicLayerInfo",oa="../layers/GeoRSSLayer",Da="../layers/ImageParameters",pa="../layers/ImageServiceParameters",qa="../layers/KMLLayer",ra="../layers/LabelClass",Ea="../layers/LayerDrawingOptions",sa="../layers/MosaicRule",ta="../layers/OpenStreetMapLayer",
ua="../layers/RasterFunction",va="../layers/StreamLayer",Fa="../layers/TileInfo",wa="../virtualearth/VETiledLayer",xa="../layers/WebTiledLayer",ya="../layers/WMSLayer",Ga="../layers/WMSLayerInfo",qb=[ka,la,ma,na,oa,qa,ra,ta,va,wa,xa,ya],rb=[Ba,Ca,Da,pa,Ea,sa,ua,Fa,Ga];N={arcgisUrl:location.protocol+"//www.arcgis.com/sharing/rest/content/items",getItem:mb,createMap:function(a,b,c){var d=new r;c=c||{};var e=c.infoTemplateClass;c._clazz=e&&(l.isObject(e)?e:l.getObject(e))||n;l.isString(a)?mb(a).addCallback(l.hitch(null,
lb,b,c,d)).addErrback(l.hitch(d,d.errback)):lb(b,c,d,a);return d},getLayerList:function(a){return a&&a.itemInfo&&a.itemInfo.itemData?ob(a.itemInfo.itemData):[]},getLegendLayers:function(a){return a&&a.itemInfo&&a.itemInfo.itemData?Ra(a.itemInfo.itemData):[]},_arcgisUrl:null,_getItemProps:E,_getItemData:P,_getBingKey:W,_portalUrlResponse:D,_portalUrlFailure:O,_processFSItemProperties:$,_processSSItemProperties:aa,_getLayers:ga,_preBuildLayerObjects:M,_buildLayerObjects:da,_preCreateMap:ja,_getMapSR:ea,
_createMap:X,_addSelectionLayers:Na,_createSelectionFeatureLayers:ia,_getServiceInfo:Ha,_getFeatureCollectionItem:Ia,_mergeFeatureCollectionItem:Ja,_projectFeatureCollection:Ka,_getLayersInfo:Ma,_initLayer:Z,_loadAsCached:U,_loadAsDynamic:T,_processPopups:H,_onLayersAddResult:Oa,_sameSpatialReferenceAsBasemap:ba,_sameTilingSchemeAsBasemap:ca,_showPopup:Aa,_calculateClickTolerance:Pa,_getVisibleFeatureLayers:Q,_updateLayerScaleInfo:ha,_checkUrl:I,_isHostedService:K,_isAgolService:Y,_getLegendLayers:Ra};
l.setObject("arcgis.utils",N,c);return N});