// All material copyright ESRI, All Rights Reserved, unless otherwise specified.
// See http://js.arcgis.com/3.14/esri/copyright.txt for details.
//>>built
require({cache:{"dijit/a11y":function(){define("dojo/_base/array dojo/dom dojo/dom-attr dojo/dom-style dojo/_base/lang dojo/sniff ./main".split(" "),function(k,l,g,c,h,d,e){var a={_isElementShown:function(a){var e=c.get(a);return"hidden"!=e.visibility&&"collapsed"!=e.visibility&&"none"!=e.display&&"hidden"!=g.get(a,"type")},hasDefaultTabStop:function(a){switch(a.nodeName.toLowerCase()){case "a":return g.has(a,"href");case "area":case "button":case "input":case "object":case "select":case "textarea":return!0;
case "iframe":var e;try{var c=a.contentDocument;if("designMode"in c&&"on"==c.designMode)return!0;e=c.body}catch(d){try{e=a.contentWindow.document.body}catch(f){return!1}}return e&&("true"==e.contentEditable||e.firstChild&&"true"==e.firstChild.contentEditable);default:return"true"==a.contentEditable}},effectiveTabIndex:function(b){return g.get(b,"disabled")?void 0:g.has(b,"tabIndex")?+g.get(b,"tabIndex"):a.hasDefaultTabStop(b)?0:void 0},isTabNavigable:function(b){return 0<=a.effectiveTabIndex(b)},
isFocusable:function(b){return-1<=a.effectiveTabIndex(b)},_getTabNavigable:function(b){function e(a){return a&&"input"==a.tagName.toLowerCase()&&a.type&&"radio"==a.type.toLowerCase()&&a.name&&a.name.toLowerCase()}var c,h,f,p,k,v,l={},u=a._isElementShown,x=a.effectiveTabIndex,t=function(a){for(a=a.firstChild;a;a=a.nextSibling)if(!(1!=a.nodeType||9>=d("ie")&&"HTML"!==a.scopeName||!u(a))){var b=x(a);if(0<=b){if(0==b)c||(c=a),h=a;else if(0<b){if(!f||b<p)p=b,f=a;if(!k||b>=v)v=b,k=a}b=e(a);g.get(a,"checked")&&
b&&(l[b]=a)}"SELECT"!=a.nodeName.toUpperCase()&&t(a)}};u(b)&&t(b);return{first:l[e(c)]||c,last:l[e(h)]||h,lowest:l[e(f)]||f,highest:l[e(k)]||k}},getFirstInTabbingOrder:function(b,e){var c=a._getTabNavigable(l.byId(b,e));return c.lowest?c.lowest:c.first},getLastInTabbingOrder:function(b,e){var c=a._getTabNavigable(l.byId(b,e));return c.last?c.last:c.highest}};h.mixin(e,a);return a})},"dijit/a11yclick":function(){define(["dojo/keys","dojo/mouse","dojo/on","dojo/touch"],function(k,l,g,c){function h(a){if((a.keyCode===
k.ENTER||a.keyCode===k.SPACE)&&!/input|button|textarea/i.test(a.target.nodeName))for(a=a.target;a;a=a.parentNode)if(a.dojoClick)return!0}var d;g(document,"keydown",function(a){h(a)?(d=a.target,a.preventDefault()):d=null});g(document,"keyup",function(a){h(a)&&a.target==d&&(d=null,g.emit(a.target,"click",{cancelable:!0,bubbles:!0,ctrlKey:a.ctrlKey,shiftKey:a.shiftKey,metaKey:a.metaKey,altKey:a.altKey,_origType:a.type}))});var e=function(a,b){a.dojoClick=!0;return g(a,"click",b)};e.click=e;e.press=function(a,
b){var e=g(a,c.press,function(a){("mousedown"!=a.type||l.isLeft(a))&&b(a)}),d=g(a,"keydown",function(a){(a.keyCode===k.ENTER||a.keyCode===k.SPACE)&&b(a)});return{remove:function(){e.remove();d.remove()}}};e.release=function(a,b){var e=g(a,c.release,function(a){("mouseup"!=a.type||l.isLeft(a))&&b(a)}),d=g(a,"keyup",function(a){(a.keyCode===k.ENTER||a.keyCode===k.SPACE)&&b(a)});return{remove:function(){e.remove();d.remove()}}};e.move=c.move;return e})},"dijit/hccss":function(){define(["dojo/dom-class",
"dojo/hccss","dojo/domReady","dojo/_base/window"],function(k,l,g,c){g(function(){l("highcontrast")&&k.add(c.body(),"dijit_a11y")});return l})},"dijit/Destroyable":function(){define(["dojo/_base/array","dojo/aspect","dojo/_base/declare"],function(k,l,g){return g("dijit.Destroyable",null,{destroy:function(c){this._destroyed=!0},own:function(){var c=["destroyRecursive","destroy","remove"];k.forEach(arguments,function(h){function d(){a.remove();k.forEach(b,function(a){a.remove()})}var e,a=l.before(this,
"destroy",function(a){h[e](a)}),b=[];h.then?(e="cancel",h.then(d,d)):k.forEach(c,function(a){"function"===typeof h[a]&&(e||(e=a),b.push(l.after(h,a,d,!0)))})},this);return arguments}})})},"esri/dijit/_EventedWidget":function(){define("dojo/_base/declare dojo/_base/lang dojo/aspect dojo/on ../Evented dijit/_WidgetBase".split(" "),function(k,l,g,c,h,d){return k([d,h],{_onMap:function(e){var a=this.constructor._onMap,b;if(!a||!a.FINAL)delete this.constructor._onMap,a=this.registerConnectEvents(),a.FINAL=
!0;e=e.toLowerCase();a[e]?b=this[a[e].method]:(e=this._onCamelCase(e),this[e]&&(b=e));return b},on:function(e,a){var b=this._onMap(e),d=e.replace(/\-/g,""),h="on"+d in this.domNode;return b||!h?this.inherited(arguments):this.own(c(this.domNode,d,a))[0]},emit:function(e,a,b){var c,d,h,f=e.toLowerCase(),g=this.constructor._onMap||this.registerConnectEvents();d=this[this._onMap(f)];a=a||{};a.target||(a.target=this);d&&(g&&g[f])&&(this._onObj2Arr(function(){c=Array.prototype.slice.call(arguments)},g[f].argKeys)(a),
h=l.mixin({},arguments),h[2]=c,h[0]=g[f].name.replace(/^on/,""));return this.inherited(h||arguments)}})})},"dojox/html/entities":function(){define(["dojo/_base/lang"],function(k){var l=k.getObject("dojox.html.entities",!0),g=function(c,d){var e,a;if(d._encCache&&d._encCache.regexp&&d._encCache.mapper&&d.length==d._encCache.length)e=d._encCache.mapper,a=d._encCache.regexp;else{e={};a=["["];var b;for(b=0;b<d.length;b++)e[d[b][0]]="\x26"+d[b][1]+";",a.push(d[b][0]);a.push("]");a=RegExp(a.join(""),"g");
d._encCache={mapper:e,regexp:a,length:d.length}}return c=c.replace(a,function(a){return e[a]})},c=function(c,d){var e,a;if(d._decCache&&d._decCache.regexp&&d._decCache.mapper&&d.length==d._decCache.length)e=d._decCache.mapper,a=d._decCache.regexp;else{e={};a=["("];var b;for(b=0;b<d.length;b++){var g="\x26"+d[b][1]+";";b&&a.push("|");e[g]=d[b][0];a.push(g)}a.push(")");a=RegExp(a.join(""),"g");d._decCache={mapper:e,regexp:a,length:d.length}}return c=c.replace(a,function(a){return e[a]})};l.html=[["\x26",
"amp"],['"',"quot"],["\x3c","lt"],["\x3e","gt"],["\u00a0","nbsp"]];l.latin=[["\u00a1","iexcl"],["\u00a2","cent"],["\u00a3","pound"],["\u20ac","euro"],["\u00a4","curren"],["\u00a5","yen"],["\u00a6","brvbar"],["\u00a7","sect"],["\u00a8","uml"],["\u00a9","copy"],["\u00aa","ordf"],["\u00ab","laquo"],["\u00ac","not"],["\u00ad","shy"],["\u00ae","reg"],["\u00af","macr"],["\u00b0","deg"],["\u00b1","plusmn"],["\u00b2","sup2"],["\u00b3","sup3"],["\u00b4","acute"],["\u00b5","micro"],["\u00b6","para"],["\u00b7",
"middot"],["\u00b8","cedil"],["\u00b9","sup1"],["\u00ba","ordm"],["\u00bb","raquo"],["\u00bc","frac14"],["\u00bd","frac12"],["\u00be","frac34"],["\u00bf","iquest"],["\u00c0","Agrave"],["\u00c1","Aacute"],["\u00c2","Acirc"],["\u00c3","Atilde"],["\u00c4","Auml"],["\u00c5","Aring"],["\u00c6","AElig"],["\u00c7","Ccedil"],["\u00c8","Egrave"],["\u00c9","Eacute"],["\u00ca","Ecirc"],["\u00cb","Euml"],["\u00cc","Igrave"],["\u00cd","Iacute"],["\u00ce","Icirc"],["\u00cf","Iuml"],["\u00d0","ETH"],["\u00d1","Ntilde"],
["\u00d2","Ograve"],["\u00d3","Oacute"],["\u00d4","Ocirc"],["\u00d5","Otilde"],["\u00d6","Ouml"],["\u00d7","times"],["\u00d8","Oslash"],["\u00d9","Ugrave"],["\u00da","Uacute"],["\u00db","Ucirc"],["\u00dc","Uuml"],["\u00dd","Yacute"],["\u00de","THORN"],["\u00df","szlig"],["\u00e0","agrave"],["\u00e1","aacute"],["\u00e2","acirc"],["\u00e3","atilde"],["\u00e4","auml"],["\u00e5","aring"],["\u00e6","aelig"],["\u00e7","ccedil"],["\u00e8","egrave"],["\u00e9","eacute"],["\u00ea","ecirc"],["\u00eb","euml"],
["\u00ec","igrave"],["\u00ed","iacute"],["\u00ee","icirc"],["\u00ef","iuml"],["\u00f0","eth"],["\u00f1","ntilde"],["\u00f2","ograve"],["\u00f3","oacute"],["\u00f4","ocirc"],["\u00f5","otilde"],["\u00f6","ouml"],["\u00f7","divide"],["\u00f8","oslash"],["\u00f9","ugrave"],["\u00fa","uacute"],["\u00fb","ucirc"],["\u00fc","uuml"],["\u00fd","yacute"],["\u00fe","thorn"],["\u00ff","yuml"],["\u0192","fnof"],["\u0391","Alpha"],["\u0392","Beta"],["\u0393","Gamma"],["\u0394","Delta"],["\u0395","Epsilon"],["\u0396",
"Zeta"],["\u0397","Eta"],["\u0398","Theta"],["\u0399","Iota"],["\u039a","Kappa"],["\u039b","Lambda"],["\u039c","Mu"],["\u039d","Nu"],["\u039e","Xi"],["\u039f","Omicron"],["\u03a0","Pi"],["\u03a1","Rho"],["\u03a3","Sigma"],["\u03a4","Tau"],["\u03a5","Upsilon"],["\u03a6","Phi"],["\u03a7","Chi"],["\u03a8","Psi"],["\u03a9","Omega"],["\u03b1","alpha"],["\u03b2","beta"],["\u03b3","gamma"],["\u03b4","delta"],["\u03b5","epsilon"],["\u03b6","zeta"],["\u03b7","eta"],["\u03b8","theta"],["\u03b9","iota"],["\u03ba",
"kappa"],["\u03bb","lambda"],["\u03bc","mu"],["\u03bd","nu"],["\u03be","xi"],["\u03bf","omicron"],["\u03c0","pi"],["\u03c1","rho"],["\u03c2","sigmaf"],["\u03c3","sigma"],["\u03c4","tau"],["\u03c5","upsilon"],["\u03c6","phi"],["\u03c7","chi"],["\u03c8","psi"],["\u03c9","omega"],["\u03d1","thetasym"],["\u03d2","upsih"],["\u03d6","piv"],["\u2022","bull"],["\u2026","hellip"],["\u2032","prime"],["\u2033","Prime"],["\u203e","oline"],["\u2044","frasl"],["\u2118","weierp"],["\u2111","image"],["\u211c","real"],
["\u2122","trade"],["\u2135","alefsym"],["\u2190","larr"],["\u2191","uarr"],["\u2192","rarr"],["\u2193","darr"],["\u2194","harr"],["\u21b5","crarr"],["\u21d0","lArr"],["\u21d1","uArr"],["\u21d2","rArr"],["\u21d3","dArr"],["\u21d4","hArr"],["\u2200","forall"],["\u2202","part"],["\u2203","exist"],["\u2205","empty"],["\u2207","nabla"],["\u2208","isin"],["\u2209","notin"],["\u220b","ni"],["\u220f","prod"],["\u2211","sum"],["\u2212","minus"],["\u2217","lowast"],["\u221a","radic"],["\u221d","prop"],["\u221e",
"infin"],["\u2220","ang"],["\u2227","and"],["\u2228","or"],["\u2229","cap"],["\u222a","cup"],["\u222b","int"],["\u2234","there4"],["\u223c","sim"],["\u2245","cong"],["\u2248","asymp"],["\u2260","ne"],["\u2261","equiv"],["\u2264","le"],["\u2265","ge"],["\u2282","sub"],["\u2283","sup"],["\u2284","nsub"],["\u2286","sube"],["\u2287","supe"],["\u2295","oplus"],["\u2297","otimes"],["\u22a5","perp"],["\u22c5","sdot"],["\u2308","lceil"],["\u2309","rceil"],["\u230a","lfloor"],["\u230b","rfloor"],["\u2329",
"lang"],["\u232a","rang"],["\u25ca","loz"],["\u2660","spades"],["\u2663","clubs"],["\u2665","hearts"],["\u2666","diams"],["\u0152","OElig"],["\u0153","oelig"],["\u0160","Scaron"],["\u0161","scaron"],["\u0178","Yuml"],["\u02c6","circ"],["\u02dc","tilde"],["\u2002","ensp"],["\u2003","emsp"],["\u2009","thinsp"],["\u200c","zwnj"],["\u200d","zwj"],["\u200e","lrm"],["\u200f","rlm"],["\u2013","ndash"],["\u2014","mdash"],["\u2018","lsquo"],["\u2019","rsquo"],["\u201a","sbquo"],["\u201c","ldquo"],["\u201d",
"rdquo"],["\u201e","bdquo"],["\u2020","dagger"],["\u2021","Dagger"],["\u2030","permil"],["\u2039","lsaquo"],["\u203a","rsaquo"]];l.encode=function(c,d){c&&(d?c=g(c,d):(c=g(c,l.html),c=g(c,l.latin)));return c};l.decode=function(h,d){h&&(d?h=c(h,d):(h=c(h,l.html),h=c(h,l.latin)));return h};return l})},"dijit/_Widget":function(){define("dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/has dojo/_base/kernel dojo/_base/lang dojo/query dojo/ready ./registry ./_WidgetBase ./_OnDijitClickMixin ./_FocusMixin dojo/uacss ./hccss".split(" "),
function(k,l,g,c,h,d,e,a,b,s,z,w,f){function p(){}function r(a){return function(b,c,f,d){return b&&"string"==typeof c&&b[c]==p?b.on(c.substring(2).toLowerCase(),e.hitch(f,d)):a.apply(g,arguments)}}k.around(g,"connect",r);d.connect&&k.around(d,"connect",r);k=c("dijit._Widget",[z,w,f],{onClick:p,onDblClick:p,onKeyDown:p,onKeyPress:p,onKeyUp:p,onMouseDown:p,onMouseMove:p,onMouseOut:p,onMouseOver:p,onMouseLeave:p,onMouseEnter:p,onMouseUp:p,constructor:function(a){this._toConnect={};for(var b in a)this[b]===
p&&(this._toConnect[b.replace(/^on/,"").toLowerCase()]=a[b],delete a[b])},postCreate:function(){this.inherited(arguments);for(var a in this._toConnect)this.on(a,this._toConnect[a]);delete this._toConnect},on:function(a,b){return this[this._onMap(a)]===p?g.connect(this.domNode,a.toLowerCase(),this,b):this.inherited(arguments)},_setFocusedAttr:function(a){this._focused=a;this._set("focused",a)},setAttribute:function(a,b){d.deprecated(this.declaredClass+"::setAttribute(attr, value) is deprecated. Use set() instead.",
"","2.0");this.set(a,b)},attr:function(a,b){return 2<=arguments.length||"object"===typeof a?this.set.apply(this,arguments):this.get(a)},getDescendants:function(){d.deprecated(this.declaredClass+"::getDescendants() is deprecated. Use getChildren() instead.","","2.0");return this.containerNode?a("[widgetId]",this.containerNode).map(s.byNode):[]},_onShow:function(){this.onShow()},onShow:function(){},onHide:function(){},onClose:function(){return!0}});h("dijit-legacy-requires")&&b(0,function(){require(["dijit/_base"])});
return k})},"dijit/_WidgetBase":function(){define("require dojo/_base/array dojo/aspect dojo/_base/config dojo/_base/connect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/dom-geometry dojo/dom-style dojo/has dojo/_base/kernel dojo/_base/lang dojo/on dojo/ready dojo/Stateful dojo/topic dojo/_base/window ./Destroyable dojo/has!dojo-bidi?./_BidiMixin ./registry".split(" "),function(k,l,g,c,h,d,e,a,b,s,z,w,f,p,r,v,G,u,x,t,F,B,C){function H(b){return function(c){a[c?
"set":"remove"](this.domNode,b,c);this._set(b,c)}}f.add("dijit-legacy-requires",!p.isAsync);f.add("dojo-bidi",!1);f("dijit-legacy-requires")&&G(0,function(){k(["dijit/_base/manager"])});var K={};c=d("dijit._WidgetBase",[u,F],{id:"",_setIdAttr:"domNode",lang:"",_setLangAttr:H("lang"),dir:"",_setDirAttr:H("dir"),"class":"",_setClassAttr:{node:"domNode",type:"class"},_setTypeAttr:null,style:"",title:"",tooltip:"",baseClass:"",srcNodeRef:null,domNode:null,containerNode:null,ownerDocument:null,_setOwnerDocumentAttr:function(a){this._set("ownerDocument",
a)},attributeMap:{},_blankGif:c.blankGif||k.toUrl("dojo/resources/blank.gif"),_introspect:function(){var a=this.constructor;if(!a._setterAttrs){var b=a.prototype,c=a._setterAttrs=[],a=a._onMap={},e;for(e in b.attributeMap)c.push(e);for(e in b)/^on/.test(e)&&(a[e.substring(2).toLowerCase()]=e),/^_set[A-Z](.*)Attr$/.test(e)&&(e=e.charAt(4).toLowerCase()+e.substr(5,e.length-9),(!b.attributeMap||!(e in b.attributeMap))&&c.push(e))}},postscript:function(a,b){this.create(a,b)},create:function(a,b){this._introspect();
this.srcNodeRef=e.byId(b);this._connects=[];this._supportingWidgets=[];this.srcNodeRef&&"string"==typeof this.srcNodeRef.id&&(this.id=this.srcNodeRef.id);a&&(this.params=a,r.mixin(this,a));this.postMixInProperties();this.id||(this.id=C.getUniqueId(this.declaredClass.replace(/\./g,"_")),this.params&&delete this.params.id);this.ownerDocument=this.ownerDocument||(this.srcNodeRef?this.srcNodeRef.ownerDocument:document);this.ownerDocumentBody=t.body(this.ownerDocument);C.add(this);this.buildRendering();
var c;if(this.domNode){this._applyAttributes();var f=this.srcNodeRef;f&&(f.parentNode&&this.domNode!==f)&&(f.parentNode.replaceChild(this.domNode,f),c=!0);this.domNode.setAttribute("widgetId",this.id)}this.postCreate();c&&delete this.srcNodeRef;this._created=!0},_applyAttributes:function(){var a={},b;for(b in this.params||{})a[b]=this._get(b);l.forEach(this.constructor._setterAttrs,function(b){if(!(b in a)){var c=this._get(b);c&&this.set(b,c)}},this);for(b in a)this.set(b,a[b])},postMixInProperties:function(){},
buildRendering:function(){this.domNode||(this.domNode=this.srcNodeRef||this.ownerDocument.createElement("div"));if(this.baseClass){var a=this.baseClass.split(" ");this.isLeftToRight()||(a=a.concat(l.map(a,function(a){return a+"Rtl"})));b.add(this.domNode,a)}},postCreate:function(){},startup:function(){this._started||(this._started=!0,l.forEach(this.getChildren(),function(a){!a._started&&(!a._destroyed&&r.isFunction(a.startup))&&(a.startup(),a._started=!0)}))},destroyRecursive:function(a){this._beingDestroyed=
!0;this.destroyDescendants(a);this.destroy(a)},destroy:function(a){function b(c){c.destroyRecursive?c.destroyRecursive(a):c.destroy&&c.destroy(a)}this._beingDestroyed=!0;this.uninitialize();l.forEach(this._connects,r.hitch(this,"disconnect"));l.forEach(this._supportingWidgets,b);this.domNode&&l.forEach(C.findWidgets(this.domNode,this.containerNode),b);this.destroyRendering(a);C.remove(this.id);this._destroyed=!0},destroyRendering:function(b){this.bgIframe&&(this.bgIframe.destroy(b),delete this.bgIframe);
this.domNode&&(b?a.remove(this.domNode,"widgetId"):s.destroy(this.domNode),delete this.domNode);this.srcNodeRef&&(b||s.destroy(this.srcNodeRef),delete this.srcNodeRef)},destroyDescendants:function(a){l.forEach(this.getChildren(),function(b){b.destroyRecursive&&b.destroyRecursive(a)})},uninitialize:function(){return!1},_setStyleAttr:function(a){var b=this.domNode;r.isObject(a)?w.set(b,a):b.style.cssText=b.style.cssText?b.style.cssText+("; "+a):a;this._set("style",a)},_attrToDom:function(c,e,f){f=3<=
arguments.length?f:this.attributeMap[c];l.forEach(r.isArray(f)?f:[f],function(f){var d=this[f.node||f||"domNode"];switch(f.type||"attribute"){case "attribute":r.isFunction(e)&&(e=r.hitch(this,e));f=f.attribute?f.attribute:/^on[A-Z][a-zA-Z]*$/.test(c)?c.toLowerCase():c;d.tagName?a.set(d,f,e):d.set(f,e);break;case "innerText":d.innerHTML="";d.appendChild(this.ownerDocument.createTextNode(e));break;case "innerHTML":d.innerHTML=e;break;case "class":b.replace(d,e,this[c])}},this)},get:function(a){var b=
this._getAttrNames(a);return this[b.g]?this[b.g]():this._get(a)},set:function(a,b){if("object"===typeof a){for(var c in a)this.set(c,a[c]);return this}c=this._getAttrNames(a);var e=this[c.s];if(r.isFunction(e))var f=e.apply(this,Array.prototype.slice.call(arguments,1));else{var e=this.focusNode&&!r.isFunction(this.focusNode)?"focusNode":"domNode",d=this[e]&&this[e].tagName,h;if(h=d)if(!(h=K[d])){h=this[e];var g={},B;for(B in h)g[B.toLowerCase()]=!0;h=K[d]=g}B=h;c=a in this.attributeMap?this.attributeMap[a]:
c.s in this?this[c.s]:B&&c.l in B&&"function"!=typeof b||/^aria-|^data-|^role$/.test(a)?e:null;null!=c&&this._attrToDom(a,b,c);this._set(a,b)}return f||this},_attrPairNames:{},_getAttrNames:function(a){var b=this._attrPairNames;if(b[a])return b[a];var c=a.replace(/^[a-z]|-[a-zA-Z]/g,function(a){return a.charAt(a.length-1).toUpperCase()});return b[a]={n:a+"Node",s:"_set"+c+"Attr",g:"_get"+c+"Attr",l:c.toLowerCase()}},_set:function(a,b){var c=this[a];this[a]=b;if(this._created&&!(c===b||c!==c&&b!==
b))this._watchCallbacks&&this._watchCallbacks(a,c,b),this.emit("attrmodified-"+a,{detail:{prevValue:c,newValue:b}})},_get:function(a){return this[a]},emit:function(a,b,c){b=b||{};void 0===b.bubbles&&(b.bubbles=!0);void 0===b.cancelable&&(b.cancelable=!0);b.detail||(b.detail={});b.detail.widget=this;var e,f=this["on"+a];f&&(e=f.apply(this,c?c:[b]));this._started&&!this._beingDestroyed&&v.emit(this.domNode,a.toLowerCase(),b);return e},on:function(a,b){var c=this._onMap(a);return c?g.after(this,c,b,
!0):this.own(v(this.domNode,a,b))[0]},_onMap:function(a){var b=this.constructor,c=b._onMap;if(!c){var c=b._onMap={},e;for(e in b.prototype)/^on/.test(e)&&(c[e.replace(/^on/,"").toLowerCase()]=e)}return c["string"==typeof a&&a.toLowerCase()]},toString:function(){return"[Widget "+this.declaredClass+", "+(this.id||"NO ID")+"]"},getChildren:function(){return this.containerNode?C.findWidgets(this.containerNode):[]},getParent:function(){return C.getEnclosingWidget(this.domNode.parentNode)},connect:function(a,
b,c){return this.own(h.connect(a,b,this,c))[0]},disconnect:function(a){a.remove()},subscribe:function(a,b){return this.own(x.subscribe(a,r.hitch(this,b)))[0]},unsubscribe:function(a){a.remove()},isLeftToRight:function(){return this.dir?"ltr"==this.dir.toLowerCase():z.isBodyLtr(this.ownerDocument)},isFocusable:function(){return this.focus&&"none"!=w.get(this.domNode,"display")},placeAt:function(a,b){var c=!a.tagName&&C.byId(a);c&&c.addChild&&(!b||"number"===typeof b)?c.addChild(this,b):(c=c&&"domNode"in
c?c.containerNode&&!/after|before|replace/.test(b||"")?c.containerNode:c.domNode:e.byId(a,this.ownerDocument),s.place(this.domNode,c,b),!this._started&&(this.getParent()||{})._started&&this.startup());return this},defer:function(a,b){var c=setTimeout(r.hitch(this,function(){c&&(c=null,this._destroyed||r.hitch(this,a)())}),b||0);return{remove:function(){c&&(clearTimeout(c),c=null);return null}}}});f("dojo-bidi")&&c.extend(B);return c})},"esri/numberUtils":function(){define(["dojo/has","dojo/number",
"dojo/i18n!dojo/cldr/nls/number","./kernel"],function(k,l,g,c){var h=function(c,a){return c-a},d={_reNumber:/^-?(\d+)(\.(\d+))?$/i,getDigits:function(c){var a=String(c),b=a.match(d._reNumber);c={integer:0,fractional:0};b&&b[1]?(c.integer=b[1].split("").length,c.fractional=b[3]?b[3].split("").length:0):-1<a.toLowerCase().indexOf("e")&&(b=a.split("e"),a=b[0],b=b[1],a&&b&&(a=Number(a),b=Number(b),(c=0<b)||(b=Math.abs(b)),a=d.getDigits(a),c?(a.integer+=b,a.fractional=b>a.fractional?0:a.fractional-b):
(a.fractional+=b,a.integer=b>a.integer?1:a.integer-b),c=a));return c},getFixedNumbers:function(c,a){var b,d;b=Number(c.toFixed(a));d=b<c?b+1/Math.pow(10,a):b-1/Math.pow(10,a);return[b,d]},getPctChange:function(c,a,b,d){var h={prev:null,next:null},g;null!=b&&(g=c-b,b=a-b-g,h.prev=Math.floor(Math.abs(100*b/g)));null!=d&&(g=d-c,b=d-a-g,h.next=Math.floor(Math.abs(100*b/g)));return h},round:function(c,a){var b=c.slice(0),g,k,l,f,p,r,v,G,u,x=!a||null==a.tolerance?2:a.tolerance,t=a&&a.indexes;if(t)t.sort(h);
else{t=[];for(r=0;r<b.length;r++)t.push(r)}for(r=0;r<t.length;r++)if(u=t[r],g=b[u],k=0===u?null:b[u-1],l=u===b.length-1?null:b[u+1],f=d.getDigits(g),f=f.fractional){v=0;for(G=!1;v<=f&&!G;)p=d.getFixedNumbers(g,v),p=p[0],G=d.hasMinimalChange(g,p,k,l,x),v++;G&&(b[u]=p)}return b},hasMinimalChange:function(c,a,b,g,h){c=d.getPctChange(c,a,b,g);a=null==c.prev||c.prev<=h;b=null==c.next||c.next<=h;return a&&b||c.prev+c.next<=2*h},_reAllZeros:RegExp("\\"+g.decimal+"0+$","g"),_reSomeZeros:RegExp("(\\d)0*$",
"g"),format:function(c,a){a=a||{places:20,round:-1};var b=l.format(c,a);b&&(b=b.replace(d._reSomeZeros,"$1").replace(d._reAllZeros,""));return b}};k("extend-esri")&&(c.numberUtils=d);return d})},"dijit/_FocusMixin":function(){define(["./focus","./_WidgetBase","dojo/_base/declare","dojo/_base/lang"],function(k,l,g,c){c.extend(l,{focused:!1,onFocus:function(){},onBlur:function(){},_onFocus:function(){this.onFocus()},_onBlur:function(){this.onBlur()}});return g("dijit._FocusMixin",null,{_focusManager:k})})},
"dojo/DeferredList":function(){define(["./_base/kernel","./_base/Deferred","./_base/array"],function(k,l,g){k.DeferredList=function(c,h,d,e,a){var b=[];l.call(this);var k=this;0===c.length&&!h&&this.resolve([0,[]]);var z=0;g.forEach(c,function(a,f){function g(a,e){b[f]=[a,e];z++;z===c.length&&k.resolve(b)}a.then(function(a){h?k.resolve([f,a]):g(!0,a)},function(a){d?k.reject(a):g(!1,a);if(e)return null;throw a;})})};k.DeferredList.prototype=new l;k.DeferredList.prototype.gatherResults=function(c){c=
new k.DeferredList(c,!1,!0,!1);c.addCallback(function(c){var d=[];g.forEach(c,function(c){d.push(c[1])});return d});return c};return k.DeferredList})},"dijit/focus":function(){define("dojo/aspect dojo/_base/declare dojo/dom dojo/dom-attr dojo/dom-class dojo/dom-construct dojo/Evented dojo/_base/lang dojo/on dojo/domReady dojo/sniff dojo/Stateful dojo/_base/window dojo/window ./a11y ./registry ./main".split(" "),function(k,l,g,c,h,d,e,a,b,s,z,w,f,p,r,v,G){var u,x,t=new (l([w,e],{curNode:null,activeStack:[],
constructor:function(){var c=a.hitch(this,function(a){g.isDescendant(this.curNode,a)&&this.set("curNode",null);g.isDescendant(this.prevNode,a)&&this.set("prevNode",null)});k.before(d,"empty",c);k.before(d,"destroy",c)},registerIframe:function(a){return this.registerWin(a.contentWindow,a)},registerWin:function(a,c){var f=this,e=a.document&&a.document.body;if(e){var d=z("pointer-events")?"pointerdown":z("MSPointer")?"MSPointerDown":z("touch-events")?"mousedown, touchstart":"mousedown",g=b(a.document,
d,function(a){if(!a||!(a.target&&null==a.target.parentNode))f._onTouchNode(c||a.target,"mouse")}),h=b(e,"focusin",function(a){if(a.target.tagName){var b=a.target.tagName.toLowerCase();"#document"==b||"body"==b||(r.isFocusable(a.target)?f._onFocusNode(c||a.target):f._onTouchNode(c||a.target))}}),k=b(e,"focusout",function(a){f._onBlurNode(c||a.target)});return{remove:function(){g.remove();h.remove();k.remove();e=g=h=k=null}}}},_onBlurNode:function(c){c=(new Date).getTime();c<u+100||(this._clearFocusTimer&&
clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(a.hitch(this,function(){this.set("prevNode",this.curNode);this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),c<x+100||(this._clearActiveWidgetsTimer=setTimeout(a.hitch(this,function(){delete this._clearActiveWidgetsTimer;this._setStack([])}),0)))},_onTouchNode:function(a,b){x=(new Date).getTime();this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer);
h.contains(a,"dijitPopup")&&(a=a.firstChild);var e=[];try{for(;a;){var d=c.get(a,"dijitPopupParent");if(d)a=v.byId(d).domNode;else if(a.tagName&&"body"==a.tagName.toLowerCase()){if(a===f.body())break;a=p.get(a.ownerDocument).frameElement}else{var g=a.getAttribute&&a.getAttribute("widgetId"),k=g&&v.byId(g);k&&!("mouse"==b&&k.get("disabled"))&&e.unshift(g);a=a.parentNode}}}catch(l){}this._setStack(e,b)},_onFocusNode:function(a){a&&9!=a.nodeType&&(u=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),
delete this._clearFocusTimer),this._onTouchNode(a),a!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",a)))},_setStack:function(a,c){var b=this.activeStack,f=b.length-1,e=a.length-1;if(a[e]!=b[f]){this.set("activeStack",a);var d;for(d=f;0<=d&&b[d]!=a[d];d--)if(f=v.byId(b[d]))f._hasBeenBlurred=!0,f.set("focused",!1),f._focusManager==this&&f._onBlur(c),this.emit("widget-blur",f,c);for(d++;d<=e;d++)if(f=v.byId(a[d]))f.set("focused",!0),f._focusManager==this&&f._onFocus(c),this.emit("widget-focus",
f,c)}},focus:function(a){if(a)try{a.focus()}catch(c){}}}));s(function(){var a=t.registerWin(p.get(document));z("ie")&&b(window,"unload",function(){a&&(a.remove(),a=null)})});G.focus=function(a){t.focus(a)};for(var F in t)/^_/.test(F)||(G.focus[F]="function"==typeof t[F]?a.hitch(t,F):t[F]);t.watch(function(a,c,b){G.focus[a]=b});return t})},"dojo/touch":function(){define("./_base/kernel ./aspect ./dom ./dom-class ./_base/lang ./on ./has ./mouse ./domReady ./_base/window".split(" "),function(k,l,g,c,
h,d,e,a,b,s){function z(a,c,b){return r&&b?function(a,c){return d(a,b,c)}:G?function(b,f){var e=d(b,c,function(a){f.call(this,a);O=(new Date).getTime()}),g=d(b,a,function(a){(!O||(new Date).getTime()>O+1E3)&&f.call(this,a)});return{remove:function(){e.remove();g.remove()}}}:function(c,b){return d(c,a,b)}}function w(a){do if(void 0!==a.dojoClick)return a;while(a=a.parentNode)}function f(a,b,f){var e=w(a.target);if(x=!a.target.disabled&&e&&e.dojoClick)if(F=(t="useTarget"==x)?e:a.target,t&&a.preventDefault(),
B=a.changedTouches?a.changedTouches[0].pageX-s.global.pageXOffset:a.clientX,C=a.changedTouches?a.changedTouches[0].pageY-s.global.pageYOffset:a.clientY,H=("object"==typeof x?x.x:"number"==typeof x?x:0)||4,K=("object"==typeof x?x.y:"number"==typeof x?x:0)||4,!u){u=!0;var h=function(a){x=t?g.isDescendant(s.doc.elementFromPoint(a.changedTouches?a.changedTouches[0].pageX-s.global.pageXOffset:a.clientX,a.changedTouches?a.changedTouches[0].pageY-s.global.pageYOffset:a.clientY),F):x&&(a.changedTouches?a.changedTouches[0].target:
a.target)==F&&Math.abs((a.changedTouches?a.changedTouches[0].pageX-s.global.pageXOffset:a.clientX)-B)<=H&&Math.abs((a.changedTouches?a.changedTouches[0].pageY-s.global.pageYOffset:a.clientY)-C)<=K};s.doc.addEventListener(b,function(a){h(a);t&&a.preventDefault()},!0);s.doc.addEventListener(f,function(a){h(a);if(x){N=(new Date).getTime();var c=t?F:a.target;"LABEL"===c.tagName&&(c=g.byId(c.getAttribute("for"))||c);var b=a.changedTouches?a.changedTouches[0]:a,y=document.createEvent("MouseEvents");y._dojo_click=
!0;y.initMouseEvent("click",!0,!0,a.view,a.detail,b.screenX,b.screenY,b.clientX,b.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,0,null);setTimeout(function(){d.emit(c,"click",y);N=(new Date).getTime()},0)}},!0);a=function(a){s.doc.addEventListener(a,function(b){!b._dojo_click&&((new Date).getTime()<=N+1E3&&!("INPUT"==b.target.tagName&&c.contains(b.target,"dijitOffScreen")))&&(b.stopPropagation(),b.stopImmediatePropagation&&b.stopImmediatePropagation(),"click"==a&&(("INPUT"!=b.target.tagName||"radio"==
b.target.type||"checkbox"==b.target.type)&&"TEXTAREA"!=b.target.tagName&&"AUDIO"!=b.target.tagName&&"VIDEO"!=b.target.tagName)&&b.preventDefault())},!0)};a("click");a("mousedown");a("mouseup")}}var p=5>e("ios"),r=e("pointer-events")||e("MSPointer"),v=function(){var a={},b;for(b in{down:1,move:1,up:1,cancel:1,over:1,out:1})a[b]=e("MSPointer")?"MSPointer"+b.charAt(0).toUpperCase()+b.slice(1):"pointer"+b;return a}(),G=e("touch-events"),u,x,t=!1,F,B,C,H,K,N,O,I;r?b(function(){s.doc.addEventListener(v.down,
function(a){f(a,v.move,v.up)},!0)}):G&&b(function(){function a(b){var c=h.delegate(b,{bubbles:!0});6<=e("ios")&&(c.touches=b.touches,c.altKey=b.altKey,c.changedTouches=b.changedTouches,c.ctrlKey=b.ctrlKey,c.metaKey=b.metaKey,c.shiftKey=b.shiftKey,c.targetTouches=b.targetTouches);return c}I=s.body();s.doc.addEventListener("touchstart",function(a){O=(new Date).getTime();var b=I;I=a.target;d.emit(b,"dojotouchout",{relatedTarget:I,bubbles:!0});d.emit(I,"dojotouchover",{relatedTarget:b,bubbles:!0});f(a,
"touchmove","touchend")},!0);d(s.doc,"touchmove",function(b){O=(new Date).getTime();var c=s.doc.elementFromPoint(b.pageX-(p?0:s.global.pageXOffset),b.pageY-(p?0:s.global.pageYOffset));c&&(I!==c&&(d.emit(I,"dojotouchout",{relatedTarget:c,bubbles:!0}),d.emit(c,"dojotouchover",{relatedTarget:I,bubbles:!0}),I=c),d.emit(c,"dojotouchmove",a(b))||b.preventDefault())});d(s.doc,"touchend",function(b){O=(new Date).getTime();var c=s.doc.elementFromPoint(b.pageX-(p?0:s.global.pageXOffset),b.pageY-(p?0:s.global.pageYOffset))||
s.body();d.emit(c,"dojotouchend",a(b))})});l={press:z("mousedown","touchstart",v.down),move:z("mousemove","dojotouchmove",v.move),release:z("mouseup","dojotouchend",v.up),cancel:z(a.leave,"touchcancel",r?v.cancel:null),over:z("mouseover","dojotouchover",v.over),out:z("mouseout","dojotouchout",v.out),enter:a._eventHandler(z("mouseover","dojotouchover",v.over)),leave:a._eventHandler(z("mouseout","dojotouchout",v.out))};return k.touch=l})},"dojo/hccss":function(){define("require ./_base/config ./dom-class ./dom-style ./has ./domReady ./_base/window".split(" "),
function(k,l,g,c,h,d,e){h.add("highcontrast",function(){var a=e.doc.createElement("div");a.style.cssText='border: 1px solid; border-color:red green; position: absolute; height: 5px; top: -999px;background-image: url("'+(l.blankGif||k.toUrl("./resources/blank.gif"))+'");';e.body().appendChild(a);var b=c.getComputedStyle(a),d=b.backgroundImage,b=b.borderTopColor==b.borderRightColor||d&&("none"==d||"url(invalid-url:)"==d);8>=h("ie")?a.outerHTML="":e.body().removeChild(a);return b});d(function(){h("highcontrast")&&
g.add(e.body(),"dj_a11y")});return h})},"dijit/_OnDijitClickMixin":function(){define("dojo/on dojo/_base/array dojo/keys dojo/_base/declare dojo/has ./a11yclick".split(" "),function(k,l,g,c,h,d){k=c("dijit._OnDijitClickMixin",null,{connect:function(c,a,b){return this.inherited(arguments,[c,"ondijitclick"==a?d:a,b])}});k.a11yclick=d;return k})},"*noref":1}});
define("esri/dijit/Legend","dojo/_base/kernel dojo/_base/declare dojo/_base/lang dojo/_base/array dojo/_base/connect dojo/_base/json dojo/_base/Color dojo/has dojo/sniff dojo/DeferredList dojo/json dojo/dom dojo/dom-construct dojo/dom-style dijit/_Widget dojox/gfx dojox/gfx/matrix dojox/html/entities ../kernel ../config ../request ../lang ../numberUtils ../renderers/SimpleRenderer ../renderers/UniqueValueRenderer ../renderers/ClassBreaksRenderer ../renderers/ScaleDependentRenderer ../renderers/DotDensityRenderer ../renderers/TemporalRenderer ../renderers/VectorFieldRenderer ../renderers/HeatmapRenderer ../symbols/PictureFillSymbol ../symbols/jsonUtils ./_EventedWidget dojo/i18n!../nls/jsapi".split(" "),function(k,
l,g,c,h,d,e,a,b,s,z,w,f,p,r,v,G,u,x,t,F,B,C,H,K,N,O,I,U,R,S,V,Q,W,T){var P=l([W,r],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,gradientHeight:30,defaultText:"Aa",gradientWidth:34,colorRampBorder:"1px solid",_specialChars:{lt:"\x3c",gt:"\x3e"},_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,constructor:function(y,a){g.mixin(this,T.widgets.legend);this._i18n=T.widgets.legend;y=y||{};y.map?
a?(this.map=y.map,this.layerInfos=y.layerInfos,this._respectCurrentMapScale=!1===y.respectCurrentMapScale?!1:!0,this._respectVisibility=!1===y.respectVisibility?!1:!0,this.arrangement=y.arrangement===P.ALIGN_RIGHT?P.ALIGN_RIGHT:P.ALIGN_LEFT,this.arrangement===P.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===y.autoUpdate?!1:!0,this._surfaceItems=[],this.hideLayersInLegend={}):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},
postMixInProperties:function(){this.inherited(arguments);var a=["ar","he"],J,b;for(J=0;J<a.length;J+=1)b=a[J],k.locale&&-1!==k.locale.indexOf(b)&&(-1!==k.locale.indexOf("-")?-1!==k.locale.indexOf(b+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},
startup:function(){this.inherited(arguments);this._initialize();9>a("ie")&&(this._repaintItems=g.hitch(this,this._repaintItems),setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeHoverHandlers();this.inherited(arguments)},refresh:function(a){if(this.domNode){a?(this.layerInfos=a,this.layers=[],c.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?
!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)f.destroy(this.domNode.children[a]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",
_initialize:function(){this.layerInfos&&(this.layers=[],c.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(this.hideLayersInLegend[a.layer.id]=a.hideLayers,this._addSubLayersToHide(a)):this.hideLayersInLegend[a.layer.id]=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=
!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var a=[],b=[];c.forEach(this.map.layerIds,function(m){m=this.map.getLayer(m);var q;this._isSupportedLayerType(m)&&(m.arcgisProps&&m.arcgisProps.title&&(m._titleForLegend=m.arcgisProps.title),this.layers.push(m));"esri.layers.KMLLayer"==m.declaredClass&&(q=m.getLayers(),c.forEach(q,function(b){a.push(b.id)},this));"esri.layers.GeoRSSLayer"==m.declaredClass&&(q=m.getFeatureLayers(),c.forEach(q,function(a){b.push(a.id)},this))},this);c.forEach(this.map.graphicsLayerIds,
function(m){var q=this.map.getLayer(m);-1==c.indexOf(a,m)&&-1==c.indexOf(b,m)&&(this._isSupportedLayerType(q)&&q._params&&q._params.drawMode)&&(q.arcgisProps&&q.arcgisProps.title&&(q._titleForLegend=q.arcgisProps.title),this.layers.push(q))},this)}this._createLegend()},_activate:function(){this._deactivate();this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=h.connect(this.map,"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=h.connect(this.map,"onLayerAdd",
this,"_updateAllMapLayers"),this._olrConnect=h.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=h.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),c.forEach(this.layers,function(a){a.ovcConnect=h.connect(a,"onVisibilityChange",this,"_refreshLayers");a.oscConnect=h.connect(a,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&(a.odcConnect=h.connect(a,"_onDynamicLayersChange",
g.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&(a.oirConnect=h.connect(a,"onRenderingChange",g.partial(this._updateImageServiceLayers,this,a)));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(a.oivrConnect=h.connect(a,"onRendererChange",g.hitch(this,"_refreshLayers")))},this))},_deactivate:function(){this._ozeConnect&&h.disconnect(this._ozeConnect);this._olaConnect&&h.disconnect(this._olaConnect);this._olroConnect&&h.disconnect(this._olroConnect);
this._olrConnect&&h.disconnect(this._olrConnect);c.forEach(this.layers,function(a){a.ovcConnect&&h.disconnect(a.ovcConnect);a.oscConnect&&h.disconnect(a.oscConnect);a.odcConnect&&h.disconnect(a.odcConnect);a.oirConnect&&h.disconnect(a.oirConnect);a.oivrConnect&&h.disconnect(a.oivrConnect)},this)},_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},
_updateAllMapLayers:function(){this.layers=[];c.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this.layers.push(a)},this);c.forEach(this.map.graphicsLayerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&(a._params&&a._params.drawMode)&&this.layers.push(a)},this);this.refresh()},_createLegend:function(){var a=!1;p.set(this.domNode,"position","relative");f.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+
"..."},this.domNode);var b=[];c.forEach(this.layers,function(m){if("esri.layers.KMLLayer"==m.declaredClass||"esri.layers.GeoRSSLayer"==m.declaredClass){var E;m.loaded?("esri.layers.KMLLayer"==m.declaredClass?E=m.getLayers():"esri.layers.GeoRSSLayer"==m.declaredClass&&(E=m.getFeatureLayers(),this.hideLayersInLegend[m.id]&&(E=c.filter(E,function(a){return-1==c.indexOf(this.hideLayersInLegend[m.id],a.id)},this))),c.forEach(E,function(a){"esri.layers.FeatureLayer"==a.declaredClass&&m._titleForLegend&&
(a._titleForLegend=m._titleForLegend+" - ","esriGeometryPoint"==a.geometryType?a._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==a.geometryType?a._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==a.geometryType&&(a._titleForLegend+=this.NLS_polygons),b.push(a))},this)):h.connect(m,"onLoad",g.hitch(this,function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===m.declaredClass)if(m.loaded){if((!this._respectVisibility||this._respectVisibility&&m.visible)&&0<m.layerInfos.length&&
c.some(m.layerInfos,function(a){return a.legendURL})){var e=!1;c.forEach(m.layerInfos,function(b){b.legendURL&&-1<c.indexOf(m.visibleLayers,b.name)&&(e||(f.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(m._titleForLegend||m.name||m.id)+"\x3c/span\x3e"},this.domNode),e=!0),f.create("div",{innerHTML:"\x3cimg src\x3d'"+b.legendURL+"'/\x3e"},this.domNode),a=!0)},this)}}else h.connect(m,"onLoad",g.hitch(this,function(){this.refresh(this.layerInfos)}));else b.push(m)},this);var m=
[];c.forEach(b,function(a){if(a.loaded){if((!this._respectVisibility||this._respectVisibility&&a.visible)&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var y=f.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});f.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},f.create("td",{align:this._align},f.create("tr",{},f.create("tbody",{},f.create("table",{width:"95%"},y)))));f.place(y,this.id,"first");
a.legendResponse||a.renderer?this._createLegendForLayer(a):m.push(this._legendRequest(a))}}else var b=h.connect(a,"onLoad",this,function(a){h.disconnect(b);b=null;this.refresh()})},this);0===m.length&&!a?(w.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate()):(new s(m)).addCallback(g.hitch(this,function(b){a?w.byId(this.id+"_msg").innerHTML="":w.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()}))},_createLegendForLayer:function(a){if(a.legendResponse||a.renderer){var b=
!1;if(a.legendResponse){var m=a.dynamicLayerInfos||a.layerInfos;m&&m.length?c.forEach(m,function(m,f){if(!this.hideLayersInLegend[a.id]||-1==c.indexOf(this.hideLayersInLegend[a.id],m.id)){var e=this._buildLegendItems(a,m,f);b=b||e}},this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(b=this._buildLegendItems(a,{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(m=a.url?a.url.substring(a.url.lastIndexOf("/")+1,a.url.length):"fc_"+a.id,b=this._buildLegendItems(a,
{id:m,name:null,subLayerIds:null,parentLayerId:-1},0));b&&(p.set(w.byId(this.id+"_"+a.id),"display","block"),p.set(w.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a);h.connect(a,"onLoad",g.hitch(this,"_legendRequest"))},_legendRequestServer:function(a){var b=a.url,c=b.indexOf("?"),b=-1<c?b.substring(0,c)+"/legend"+b.substring(c):b+"/legend";(c=a._getToken())&&(b+="?token\x3d"+c);var q=
g.hitch(this,"_processLegendResponse"),c={f:"json"};a._params.dynamicLayers&&(c.dynamicLayers=z.stringify(this._createDynamicLayers(a)),"[{}]"===c.dynamicLayers&&(c.dynamicLayers="[]"));a._params.bandIds&&(c.bandIds=a._params.bandIds);a._params.renderingRule&&(c.renderingRule=a._params.renderingRule);return F({url:b,content:c,callbackParamName:"callback",load:function(b,c){q(a,b,c)},error:t.defaults.io.errorHandler})},_legendRequestTools:function(y){var b=y.url.toLowerCase().indexOf("/rest/"),b=y.url.substring(0,
b)+y.url.substring(b+5,y.url.length),b=this._legendUrl+"?soapUrl\x3d"+window.escape(b);if(!a("ie")||8<a("ie"))b+="\x26returnbytes\x3dtrue";var c=g.hitch(this,"_processLegendResponse");return F({url:b,content:{f:"json"},callbackParamName:"callback",load:function(a,b){c(y,a,b)},error:t.defaults.io.errorHandler})},_processLegendResponse:function(a,b){b&&b.layers?(a.legendResponse=b,w.byId(this.id+"_"+a.id)&&f.empty(w.byId(this.id+"_"+a.id)),f.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},
f.create("td",{align:this._align},f.create("tr",{},f.create("tbody",{},f.create("table",{width:"95%"},w.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+d.toJson(b))},_buildLegendItems:function(a,b,c){var q=!1,E=w.byId(this.id+"_"+a.id),e=b.parentLayerId;if(b.subLayerIds)a=f.create("div",{id:this.id+"_"+a.id+"_"+b.id+"_group",style:{display:"none"},"class":-1==e?0<c?"esriLegendGroupLayer":"":this._legendAlign},-1==e?E:w.byId(this.id+
"_"+a.id+"_"+e+"_group")),f.create("td",{innerHTML:u.encode(b.name),align:this._align},f.create("tr",{},f.create("tbody",{},f.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(a.visibleLayers&&-1==(","+a.visibleLayers+",").indexOf(","+b.id+","))return q;c=f.create("div",{id:this.id+"_"+a.id+"_"+b.id,style:{display:"none"},"class":-1<e?this._legendAlign:""},-1==e?E:w.byId(this.id+"_"+a.id+"_"+e+"_group"));f.create("td",{innerHTML:u.encode(b.name)||"",align:this._align},f.create("tr",
{},f.create("tbody",{},f.create("table",{width:"95%","class":"esriLegendLayerLabel"},c))));a.legendResponse?q=q||this._buildLegendItems_Tools(a,b,c):a.renderer&&(q=q||this._buildLegendItems_Renderer(a,b,c))}return q},_buildLegendItems_Tools:function(a,b,m){var q=b.parentLayerId,E=this.map.getScale(),e=!1,d=function(a,b){var y,c;for(y=0;y<a.length;y++)if(b.dynamicLayerInfos)for(c=0;c<b.dynamicLayerInfos[c].length;c++){if(b.dynamicLayerInfos[c].mapLayerId==a[y].layerId)return a[y]}else if(b.id==a[y].layerId)return a[y];
return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(a,b,E)){var g=!0;if(this._respectCurrentMapScale&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass)){var h=this._getEffectiveScale(a,b);if(h.minScale&&h.minScale<E||h.maxScale&&h.maxScale>E)g=!1}if(g){var E=d(a.legendResponse.layers,b),n=E.legendType,k=E.legend;if(k){"esri.layers.ArcGISImageServiceLayer"!==a.declaredClass&&this._sanitizeLegendResponse(a,
E,b);m=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},m);var l=f.create("tbody",{},m);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(m,a,b);c.forEach(k,function(c){if(!(10.1<=a.version&&!c.values&&1<k.length&&(a._hideDefaultSymbol||"\x3call other values\x3e"===c.label||!c.label&&!("esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.3<=a.version))))if(c.url&&0===c.url.indexOf("http")||c.imageData&&0<c.imageData.length)e=!0,this._buildRow_Tools(c,
l,a,b.id,n)},this)}}}e&&(p.set(w.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<q&&(p.set(w.byId(this.id+"_"+a.id+"_"+q+"_group"),"display","block"),this._findParentGroup(a.id,a,q)));return e},_sanitizeLegendResponse:function(a,b,m){var q=b.legend;if(10.1<=a.version&&1<q.length&&!b._sanitized){a=g.getObject("layerDefinition.drawingInfo.renderer",!1,m);var f,e;a||(a=g.getObject("drawingInfo.renderer",!1,m));c.some(q,function(a,b){a.values||(e=b,f=a);return!!f});a?"uniqueValue"===a.type?f&&(q.splice(e,
1),q.push(f)):"classBreaks"===a.type&&(f&&q.splice(e,1),q.reverse(),f&&q.push(f)):f&&(q.splice(e,1),q.push(f));b._sanitized=!0}},_buildRow_Tools:function(b,c,m,q,e){var d=f.create("tr",{},c),g;this.alignRight?(c=f.create("td",{align:this._isRightToLeft?"left":"right"},d),g=f.create("td",{align:this._isRightToLeft?"left":"right",width:35},d)):(g=f.create("td",{width:35,align:"center"},d),c=f.create("td",{},d));d=b.url;(!a("ie")||9<=a("ie")||9>a("ie")&&"esri.layers.ArcGISImageServiceLayer"===m.declaredClass)&&
b.imageData&&0<b.imageData.length?d="data:image/png;base64,"+b.imageData:0!==b.url.indexOf("http")&&(d=m.url+"/"+q+"/images/"+b.url,(q=m._getToken())&&(d+="?token\x3d"+q));q=f.create("img",{src:d,border:0,style:"opacity:"+m.opacity},g);b=f.create("td",{innerHTML:u.encode(b.label),align:this._align},f.create("tr",{},f.create("tbody",{},f.create("table",{width:"95%",dir:"ltr"},c))));e&&("Stretched"===e&&10.3<=m.version&&"esri.layers.ArcGISImageServiceLayer"===m.declaredClass)&&(b.style.verticalAlign=
"top",b.style.lineHeight="1",q.style.marginBottom="-1px",q.style.display="block",c.style.verticalAlign="top");9>a("ie")&&(q.style.filter="alpha(opacity\x3d"+100*m.opacity+")")},_getVariable:function(a,b,c){var q;a&&(q=(a=a.getVisualVariablesForType(b,c))&&a[0]);return q},_getFieldAlias:function(a,b){var c=b.infoTemplate,c=c&&c.getFieldInfo&&c.getFieldInfo(a),q=g.isFunction(a)?null:b.getField(a),f=c||q,e="";f&&(e=c&&c.label||q&&q.alias||f.name||f.fieldName);return e},_getDefaultHoverLabel:function(a,
b){var c;if(a){var q=this._getVariable(a,"colorInfo",!1),f=this._getVariable(a,"opacityInfo",!1),e=this._getVariable(a,"sizeInfo",!1),q=q||e||f,d,g,h,n,k;a instanceof S?d=a.field:a instanceof K&&!a.attributeField2&&!a.attributeField3?(d=a.attributeField,q&&(h=q.field,n=q.normalizationField)):a instanceof N?q?(d=q.field,g=q.normalizationField):(d=a.attributeField,g=a.normalizationField,k="percent-of-total"===a.normalizationType):a instanceof H&&q&&(d=q.field,g=q.normalizationField);(k=n&&"showOpNormField"||
h&&"showOpField"||g&&"showNormField"||(k?"showNormPct":null)||d&&"showField"||null)&&(c=B.substitute({field:d&&this._getFieldAlias(d,b),normField:g&&this._getFieldAlias(g,b),opField:h&&this._getFieldAlias(h,b),opNormField:n&&this._getFieldAlias(n,b)},this._i18n[k]))}return c},_buildLegendItems_Renderer:function(a,b,m){var q=b.parentLayerId,e=this.map,d=e.getScale(),h=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,b,d)){var D,A,n="esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass?
a.renderer.renderer:a.renderer,k,l,L,M,s,r;if(n instanceof O&&(n=(e="zoom"===n.rangeType?n.getRendererInfoByZoom(e.getZoom()):n.getRendererInfoByScale(d))&&e.renderer,!n))return!1;var e=this._getVariable(n,"colorInfo",!1),d=this._getVariable(n,"opacityInfo",!1),v=this._getVariable(n,"sizeInfo",!1),t=this._getDefaultHoverLabel(n,a);e?(k=this._getMedianColor(n,e),e.field&&(L=g.isFunction(e.field)?null:a.getField(e.field))):d&&(s=g.isFunction(d.field)?null:a.getField(d.field),r=d.normalizationField);
v&&v.field&&(M=g.isFunction(v.field)?null:a.getField(v.field));if(n instanceof S)h=!0,this._showHeatRamp(a,b,n,m,t);else if(n instanceof I)h=!0,this._showDotDensityLegend(a,b,n,m);else if(n instanceof U)h=!0,A=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},m),D=f.create("tbody",{},A),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(A,a,b),n.latestObservationRenderer&&n.latestObservationRenderer instanceof H&&this._buildRow_Renderer(a,n.latestObservationRenderer.symbol,
k,u.encode(n.latestObservationRenderer.label)||this.NLS_currentObservations,null,D),n.observationRenderer&&n.observationRenderer instanceof H&&this._buildRow_Renderer(a,n.observationRenderer.symbol,k,u.encode(n.observationRenderer.label)||this.NLS_previousObservations,null,D);else if(n instanceof K){if(n.infos&&0<n.infos.length){h=!0;A=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},m);D=f.create("tbody",{},A);(a._hoverLabel||a._hoverLabels||t)&&this._createHoverAction(A,
a,b,t);var x=[];c.forEach(n.infos,function(b){var m=null;a._editable&&a.types&&(m=this._getTemplateFromTypes(a.types,b.value));var J=b.label;null==J&&(J=b.value);-1===c.indexOf(x,J)&&(x.push(J),this._buildRow_Renderer(a,b.symbol,k,u.encode(J),m,D))},this)}}else if(n instanceof N){if(n.infos&&0<n.infos.length||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass){h=!0;r=L||M||s;if(!r||!this._isSmartRenderer(n,r.name))A=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},
m),D=f.create("tbody",{},A),r=(n.normalizationField||"percent-of-total"===n.normalizationType)&&t?t:this._getFieldAlias(n.attributeField,a),this._buildRow_Renderer(a,null,k,u.encode(r),null,D);A=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},m);D=f.create("tbody",{},A);(a._hoverLabel||a._hoverLabels||t)&&this._createHoverAction(A,a,b,t);r=n.infos.slice(0).reverse();c.forEach(r,function(b){var c=b.label;null==c&&(c=(c=L||M||s)&&this._isSmartRenderer(n,c.name)?
n.normalizationField&&t?t:this._getFieldAlias(c.name,a):b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,k,u.encode(c),null,D)},this);if("esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&(a.renderer.style===R.STYLE_SCALAR||a.renderer.style===R.STYLE_SINGLE_ARROW))this._buildRow_Renderer(a,n.defaultSymbol,null,"",null,D),a._hideDefaultSymbol=!0}}else n instanceof H&&(h=!0,A=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},m),D=f.create("tbody",
{},A),(a._hoverLabel||a._hoverLabels||t)&&this._createHoverAction(A,a,b,t),l=null,a._editable&&(a.templates&&0<a.templates.length)&&(l=a.templates[0]),A=(L||s)&&M?null:L||s||M,this._buildRow_Renderer(a,n.symbol,k,u.encode(r&&t?t:A?this._getFieldAlias(A.name,a):n.label),l,D),l=n.symbol&&n.symbol.color,A&&(L=s=M=null));h&&(e&&e.field?(L&&this._isSmartRenderer(n,L.name)&&(L=null),this._showColorRamp(a,b,n,null,m,e,L,t)):d&&l&&this._showColorRamp(a,b,n,l,m,d,s,t),v&&v.field&&(M&&this._isSmartRenderer(n,
M.name)&&(M=null),this._showSizeLegend(a,b,n,v,k,m,M,t)));!a._hideDefaultSymbol&&n.defaultSymbol&&(h=!0,A=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},m),D=f.create("tbody",{},A),this._buildRow_Renderer(a,n.defaultSymbol,null,u.encode(n.defaultLabel)||"others",null,D))}h&&(p.set(w.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<q&&(p.set(w.byId(this.id+"_"+a.id+"_"+q+"_group"),"display","block"),this._findParentGroup(a.id,q)));return h},_isSmartRenderer:function(a,
b){return a instanceof N&&a.infos&&1===a.infos.length&&a.attributeField===b},_showColorRamp:function(a,b,c,q,e,d,g,h){var k;k=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);e=f.create("tbody",{},k);(a._hoverLabel||a._hoverLabels||h)&&this._createHoverAction(k,a,b,h);g&&this._addSubHeader(e,this._getFieldAlias(g.name,a));b=this._getRampStops(c,d,q);b.length&&this._drawColorRamp(e,b,!0,a,this._getRampBorderColor(c))},_getMedianColor:function(a,b){var c,e;b.colors?
(c=b.minDataValue,e=b.maxDataValue):b.stops&&(c=b.stops[0].value,e=b.stops[b.stops.length-1].value);return a.getColor(c+(e-c)/2,{colorInfo:b})},_getRampStops:function(a,b,m){var q,f,d,g,h=!1;b.colors||b.opacityValues?(f=b.maxDataValue-b.minDataValue,q=c.map([0,0.25,0.5,0.75,1],function(a){d=b.minDataValue+a*f;return Number(d.toFixed(6))}),this._checkPrecision(0,4,q)):b.stops&&(q=c.map(b.stops,function(a){return a.value}),(h=c.some(b.stops,function(a){return!!a.label}))&&(g=c.map(b.stops,function(a){return a.label})));
var k=q[0],n,l,p;f=q[q.length-1]-k;return c.map(q,function(c,d){m?(n=new e(m.toRgba()),l=a.getOpacity(c,{opacityInfo:b}),null!=l&&(n.a=l)):n=a.getColor(c,{colorInfo:b});p="";0===d?p=this._specialChars.lt+" ":d===q.length-1&&(p=this._specialChars.gt+" ");return{value:c,color:n,offset:1-(c-k)/f,label:h?g[d]:p+C.format(c)}},this).reverse()},_checkPrecision:function(a,b,c){var e=a+(b-a)/2,f=c[a],d=c[e],g=c[b],h=Math.floor(f),k=Math.floor(d),n=Math.floor(g);h===f&&(n===g&&k!==d&&h!==k&&n!==k)&&(c[e]=k);
a+1!==e&&this._checkPrecision(a,e,c);e+1!==b&&this._checkPrecision(e,b,c)},_getRampBorderColor:function(a){var b;if(a instanceof H)b=a.symbol;else if(a instanceof K||a instanceof N)b=a.infos[0].symbol;return(a=b&&-1===b.type.indexOf("linesymbol")?b.getStroke():null)&&a.color},_drawColorRamp:function(b,d,m,q,g){var h=f.create("tr",{},b),k,D,A,n,l,t=d.length-1,r;n=0;this.alignRight?(b=f.create("td",{align:this._isRightToLeft?"left":"right"},h),k=f.create("td",{align:this._isRightToLeft?"left":"right",
width:this.gradientWidth},h)):(k=f.create("td",{width:this.gradientWidth,align:"center"},h),b=f.create("td",{},h));var s=g&&0<g.a&&!(240<=g.r&&240<=g.g&&240<=g.b);D=f.create("div",{"class":s?"":"esriLegendBorderLessColorRamp",style:"position: relative; width:"+this.gradientWidth+"px;"},k);h=f.create("div",{"class":"esriLegendColorRamp"},D);k=p.get(h,"width");s&&(g=9>a("ie")?g.toHex():"rgba("+g.toRgba().join(",")+")",p.set(h,"border",this.colorRampBorder+" "+g));m?(g=this.gradientHeight*t,p.set(h,
"height",g+"px")):g=p.get(h,"height");p.set(D,"height",g+"px");h=v.createSurface(h,k,g);9>a("ie")&&(n=h.getEventSource(),p.set(n,"position","relative"),p.set(n.parentNode,"position","relative"),n=1);try{m&&c.forEach(d,function(a,b){a.offset=b/t}),l=h.createRect({x:-n,y:-n,width:k+n,height:g+n}),l.setFill({type:"linear",x1:0,y1:0,x2:0,y2:g,colors:d}).setStroke(null),h.createRect({width:k,height:g}).setFill(new e([255,255,255,1-q.opacity])).setStroke(null),this._surfaceItems.push(h)}catch(w){h.clear(),
h.destroy()}c.forEach(d,function(a,b){if(a.label){r="top:"+100*a.offset+"%;";var c="";0===b&&(c+=" esriLegendColorRampTickFirst");b===d.length-1&&(c+=" esriLegendColorRampTickLast");f.create("div",{"class":"esriLegendColorRampTick"+c,innerHTML:"\x26nbsp;",style:r},D)}});A=f.create("div",{"class":"esriLegendColorRampLabels",style:{height:g+this.gradientHeight+"px"}},b);m?c.forEach(d,function(a){f.create("div",{"class":"esriLegendColorRampLabel",innerHTML:u.encode(a.label)||"\x26nbsp;"},A)}):(f.create("div",
{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.high},A),f.create("div",{"class":"esriLegendColorRampLabel",innerHTML:this._i18n.low,style:"top: "+(g+this.gradientHeight-2*this.gradientHeight)+"px;"},A))},_showHeatRamp:function(a,b,c,e,d){var g,h=c.field;g=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);e=f.create("tbody",{},g);(a._hoverLabel||a._hoverLabels||d)&&this._createHoverAction(g,a,b,d);(h=h&&a.getField(h))&&this._addSubHeader(e,this._getFieldAlias(h.name,
a));b=this._getHeatmapStops(c);b.length&&this._drawColorRamp(e,b,!1,a)},_getHeatmapStops:function(a){var b=a.colorStops;a=a.colors;var m,e,d,f;if(b&&b[0])if(m=b.length-1,a=b[0]&&null!=b[0].ratio){if((a=b[m])&&1!==a.ratio)b=b.slice(0),b.push({ratio:1,color:a.color}),m++}else e=b[0].value,d=b[m].value-e,b=c.map(b,function(a){return{color:a.color,ratio:(a.value-e)/d}});else a&&a[0]&&(m=a.length-1,f=1/(a.length-1),b=c.map(a,function(a,b){return{color:a,ratio:b*f}}));b=c.map(b,function(a,b){var c="";0===
b?c="Low":b===m&&(c="High");return{color:a.color,label:c,offset:1-a.ratio}});return b.reverse()},_showDotDensityLegend:function(a,b,m,e){var d=m.legendOptions,h,k,l,A,n,p,t,r=this.dotDensitySwatchSize,s=Math.round(r/2);d&&(k=d.backgroundColor,l=d.outline,A=d.valueUnit,n=d.dotCoverage);n=(n||this.dotCoverage)/100;t=Math.round(r*r/Math.pow(m.dotSize,2)*n);e=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},e);p=f.create("tbody",{},e);(a._hoverLabel||a._hoverLabels)&&
this._createHoverAction(e,a,b);this._addSubHeader(p,B.substitute({value:m.dotValue,unit:A||""},this.NLS_dotValue));c.forEach(m.fields,function(b){b=g.mixin({},b);b.numPoints=t;h=new V(m._generateImageSrc(r,r,[b],{x:0,y:0},{x:r,y:r},k),l||m.outline,r,r);b=a.getField(b.name)||b;this._buildRow_Renderer(a,h,null,u.encode(this._getFieldAlias(b.name,a)),null,p,{type:"path",path:"M "+-s+","+-s+" L "+s+","+-s+" L "+s+","+s+" L "+-s+","+s+" L "+-s+","+-s+" E"})},this)},_showSizeLegend:function(a,b,m,e,d,g,
h,k){var l=e.legendOptions,l=l&&l.customValues,n,p,r=this._getSizeSymbol(m,d);"unknown"!==e.valueUnit||(!r||!l&&(null==e.minSize||null==e.maxSize))||(d=f.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g),n=f.create("tbody",{},d),(a._hoverLabel||a._hoverLabels||k)&&this._createHoverAction(d,a,b,k),h&&this._addSubHeader(n,this._getFieldAlias(h.name,a)),p=l||this._getDataValues(m,r,e),p.reverse(),c.forEach(p,function(b,c){r=Q.fromJson(r.toJson());this._applySize(r,
m,e,b);b=C.format(b);var d="";0===c?d=this._specialChars.gt+" ":c===p.length-1&&(d=this._specialChars.lt+" ");d="\x3cspan class\x3d'esriLegendSizeRampLabel'\x3e"+u.encode(d+b)+"\x3c/span\x3e";this._buildRow_Renderer(a,r,null,d,null,n)},this))},_getSizeSymbol:function(a,b){var c;if(a instanceof H)c=a.symbol;else if(a instanceof R)c=a.defaultSymbol;else if(a instanceof K||a instanceof N)c=a.infos[0].symbol;if(c=-1!==c.type.indexOf("fillsymbol")?null:c)c=Q.fromJson(c.toJson()),b&&c.setColor(new e(b.toRgba()));
return c},_getDataValues:function(a,b,e,d,f){d=null==d?5:d;f=null==f?20:f;var h=a.getSizeRangeAtScale(e,this.map.getScale());d=this._interpolateSizeRange(h,d);var g=c.map(d,function(a){return this._getDataValueFromSize(a,e,h)},this),k,l,g=C.round(g);for(k=1;k<g.length-1;k++)if(l=this._roundDataValue(a,b,e,g[k],g[k-1],f))g[k]=l[0],d[k]=l[1];return g},_interpolateSizeRange:function(a,b){var c=a.minSize,e=(a.maxSize-c)/(b-1),d,f=[];for(d=0;d<b;d++)f.push(c+e*d);return f},_getDataValueFromSize:function(a,
b,c){var e=c.minSize;c=c.maxSize;var d=b.minDataValue;b=b.maxDataValue;return a=a<=e?d:a>=c?b:(a-e)/(c-e)*(b-d)+d},_roundDataValue:function(a,b,c,e,d,f){var g=this._getSize(b,a,c,e);d=this._getSize(b,a,c,d);var h,k=C.getDigits(e),n=k.integer,k=k.fractional,l,p,r,s,t,v,u,w,x,z,B;0<e&&1>e&&(h=Math.pow(10,k),e*=h,n=C.getDigits(e).integer);for(n-=1;0<=n&&!(l=Math.pow(10,n),k=Math.floor(e/l)*l,l*=Math.ceil(e/l),null!=h&&(k/=h,l/=h),p=(k+l)/2,p=C.round([k,p,l],{indexes:[1]})[1],r=this._getSize(b,a,c,k),
s=this._getSize(b,a,c,l),t=this._getSize(b,a,c,p),v=C.getPctChange(g,r,d,null),u=C.getPctChange(g,s,d,null),w=C.getPctChange(g,t,d,null),x=v.prev<=f,z=u.prev<=f,x&&z&&(v.prev<=u.prev?(x=!0,z=!1):(z=!0,x=!1)),x?B=[k,r]:z?B=[l,s]:w.prev<=f&&(B=[p,t]),B);n--);return B},_applySize:function(a,b,c,e){var d=a.type;b=this._getSize(a,b,c,e);switch(d){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":d=a.width;c=a.height;a.setHeight(b);a.setWidth(b*(d/c));break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b);
break;case "textsymbol":a.font&&a.font.setSize(b)}},_getSize:function(a,b,c,e){return b.getSize(e,{sizeInfo:c,scale:this.map.getScale(),shape:-1!==a.type.indexOf("markersymbol")?a.style:null})},_buildRow_Renderer:function(a,b,c,e,d,g,h){var k=f.create("tr",{},g),l;this.alignRight?(g=f.create("td",{align:this._isRightToLeft?"left":"right"},k),b&&(l=f.create("td",{align:this._isRightToLeft?"left":"right",width:35},k))):(b&&(l=f.create("td",{width:35,align:"center"},k)),g=f.create("td",{},k));var n=
k=30;if(b){if("simplemarkersymbol"==b.type)k=Math.min(Math.max(k,b.size+12),125),n=Math.min(Math.max(n,b.size+12),125);else if("picturemarkersymbol"==b.type)k=Math.min(Math.max(k,b.width),125),n=Math.min(b.height||n,125);else if("textsymbol"==b.type){var p,r;b.text||(p=b.text,r=!0,b.setText(this.defaultText));k=Math.min(Math.max(k,b.getWidth()+12),125);n=Math.min(Math.max(n,b.getHeight()+12),125);r&&b.setText(p)}var s=f.create("div",{style:"width:"+k+"px;height:"+n+"px;"},l)}B.isDefined(e)&&"number"===
typeof e&&(e=""+e);f.create("td",{innerHTML:e||"",align:this._align},f.create("tr",{},f.create("tbody",{},f.create("table",{width:"95%"},g))));b&&(a=this._drawSymbol(s,b,c,k,n,d,a,h),this._surfaceItems.push(a))},_addSubHeader:function(a,b){var c=f.create("tr",{},a),c=f.create("td",{align:this._align,colspan:2},c);f.create("td",{innerHTML:u.encode(b)||"",align:this._align},f.create("tr",{},f.create("tbody",{},f.create("table",{width:"95%"},c))))},_drawSymbol:function(b,c,d,f,h,k,l,r){c=Q.fromJson(c.toJson());
var s=l.opacity;d&&c.setColor(new e(d.toRgba()));if("simplelinesymbol"===c.type||"cartographiclinesymbol"===c.type||"textsymbol"===c.type){if(!c.color)return;d=c.color.toRgba();d[3]*=s;c.color.setColor(d)}else"simplemarkersymbol"===c.type||"simplefillsymbol"===c.type?(c.color&&(d=c.color.toRgba(),d[3]*=s,c.color.setColor(d)),c.outline&&c.outline.color&&(d=c.outline.color.toRgba(),d[3]*=s,c.outline.color.setColor(d))):"picturemarkersymbol"===c.type&&(b.style.opacity=s,b.style.filter="alpha(opacity\x3d("+
100*s+"))");b=v.createSurface(b,f,h);9>a("ie")&&(d=b.getEventSource(),p.set(d,"position","relative"),p.set(d.parentNode,"position","relative"));k=this._getDrawingToolShape(c,k)||Q.getShapeDescriptors(c);var n,s=(d=k.defaultShape)&&"text"===d.type;try{s&&!d.text&&(d.text=this.defaultText),n=b.createShape(r||d).setFill(k.fill).setStroke(k.stroke),s&&n.setFont(k.font)}catch(t){b.clear();b.destroy();return}var u=n.getBoundingBox();r=u.width;k=u.height;var s=-(u.x+r/2),w=-(u.y+k/2);d=b.getDimensions();
s={dx:s+d.width/2,dy:w+d.height/2};if("simplemarkersymbol"===c.type&&"path"===c.style)f=l._getScaleMatrix(u,c.size),n.applyTransform(G.scaleAt(f.xx,f.yy,{x:d.width/2,y:d.height/2}));else if(r>f||k>h)l=r/f>k/h,f=((l?f:h)-5)/(l?r:k),g.mixin(s,{xx:f,yy:f});n.applyTransform(s);return b},_getDrawingToolShape:function(a,b){var c;switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":c={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolTriangle":c=
{type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":c={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":c={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":c={type:"ellipse",cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:c,fill:a.getFill(),stroke:a.getStroke()}},_repaintItems:function(){c.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},
_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(b){}a.children&&g.isArray(a.children)&&c.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,b,c,d){if(d=b._hoverLabel||b._hoverLabels&&b._hoverLabels[c.id]||d)d=u.encode(d),b.mouseMoveHandler=b.mouseMoveHandler||{},b.mouseMoveHandler[c.id]=h.connect(a,"onmousemove",g.hitch(this,function(a,b){this.mouseX=b.clientX;this.mouseY=b.clientY;this.hoverLabelShowing&&
(this.hoverLabelShowing=!1,p.set(w.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(g.hitch(this,function(a,b,c){if(a==this.mouseX&&b==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,w.byId(this.id+"_hoverLabel")){var d=w.byId(this.id+"_hoverLabel");d.innerHTML="\x3cspan\x3e"+c+"\x3c/span\x3e";p.set(d,"top",b+"px");p.set(d,"left",a+15+"px");p.set(d,"display","")}else f.create("div",{innerHTML:"\x3cspan\x3e"+c+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",
style:{top:b+"px",left:a+15+"px"}},document.body)},b.clientX,b.clientY,a),500)},d)),b.mouseOutHandler=b.mouseOutHandler||{},b.mouseOutHandler[c.id]=h.connect(a,"onmouseout",g.hitch(this,function(a){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,p.set(w.byId(this.id+"_hoverLabel"),"display","none"))}))},_removeHoverHandlers:function(){var a;c.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)h.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)h.disconnect(b.mouseOutHandler[a])})},
_createDynamicLayers:function(a){var b=[],d;c.forEach(a.dynamicLayerInfos||a.layerInfos,function(c){d={id:c.id};d.source=c.source&&c.source.toJson();var e;a.layerDefinitions&&a.layerDefinitions[c.id]&&(e=a.layerDefinitions[c.id]);e&&(d.definitionExpression=e);var f;a.layerDrawingOptions&&a.layerDrawingOptions[c.id]&&(f=a.layerDrawingOptions[c.id]);f&&(d.drawingInfo=f.toJson());d.minScale=c.minScale||0;d.maxScale=c.maxScale||0;b.push(d)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<
a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var d,e=b.dynamicLayerInfos||b.layerInfos;for(d=0;d<e.length;d++)if(c==e[d].id){-1<e[d].parentLayerId&&(p.set(w.byId(this.id+"_"+a+"_"+e[d].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,b,e[d].parentLayerId));break}},_addSubLayersToHide:function(a){function b(d,e){var f=a.layer.dynamicLayerInfos||a.layer.layerInfos,g,h;for(g=0;g<f.length;g++)if(f[g].id===
d&&f[g].subLayerIds)for(h=0;h<f[g].subLayerIds.length;h++){var k=f[g].subLayerIds[h];-1===c.indexOf(e,k)&&(e.push(k),b(k,e))}}a.layer.layerInfos&&c.forEach(this.hideLayersInLegend[a.layer.id],function(c){b(c,this.hideLayersInLegend[a.layer.id])},this)},_isLayerInScale:function(a,b,c){var d,e=!0;if(a.legendResponse&&a.legendResponse.layers)for(d=0;d<a.legendResponse.layers.length;d++){var f=a.legendResponse.layers[d];if(b.id==f.layerId){var g,h;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?
(0==f.minScale&&a.tileInfo&&(g=a.tileInfo.lods[0].scale),0==f.maxScale&&a.tileInfo&&(h=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(g=Math.min(a.minScale,f.minScale)||a.minScale||f.minScale,h=Math.max(a.maxScale,f.maxScale));if(0<g&&g<c||h>c)e=!1;break}}else if(a.minScale||a.maxScale)if(a.minScale&&a.minScale<c||a.maxScale&&a.maxScale>c)e=!1;return e},_getServiceTitle:function(a){var b=a._titleForLegend;b||((b=a.url)?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),
b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass&&a.vectorFieldPixelFilter&&(a=a.vectorFieldPixelFilter.outputUnit?this["NLS_"+
a.vectorFieldPixelFilter.outputUnit]:this["NLS_"+a.vectorFieldPixelFilter.inputUnit],B.isDefined(a)&&(b+=" ("+a+")"));return u.encode(b)},_getEffectiveScale:function(a,b){var c=b.minScale,d=b.maxScale;if(B.isDefined(b.parentLayerId)){var e=a.layerInfos,f=b.parentLayerId,g;for(g=e.length-1;0<=g;g--)if(e[g].id==f)if(0==c&&0<e[g].minScale?c=e[g].minScale:0<c&&0==e[g].minScale||0<c&&0<e[g].minScale&&(c=Math.min(c,e[g].minScale)),d=Math.max(d||0,e[g].maxScale||0),-1<e[g].parentLayerId)f=e[g].parentLayerId;
else break}return{minScale:c,maxScale:d}},_isSupportedLayerType:function(a){return a&&("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISImageServiceVectorLayer"===a.declaredClass||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===
a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1}});g.mixin(P,{ALIGN_LEFT:0,ALIGN_RIGHT:1});a("extend-esri")&&g.setObject("dijit.Legend",P,x);return P});